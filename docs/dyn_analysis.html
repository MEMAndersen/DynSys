Version: 1.1.0_dev
<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>dyn_analysis API documentation</title>
    <meta name="description" content="Classes and methods used to implement specific forms of dynamic analysis" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
  
  <script type="text/javascript" async src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML"> </script>
  
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#dyn_analysis.currentVersion">currentVersion</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#dyn_analysis.CalcTransverseAreaIntegral">CalcTransverseAreaIntegral</a></li>
    <li class="mono"><a href="#dyn_analysis.Calc_Seff">Calc_Seff</a></li>
    <li class="mono"><a href="#dyn_analysis.DesignResponseSpectrum_BSEN1998_1">DesignResponseSpectrum_BSEN1998_1</a></li>
    <li class="mono"><a href="#dyn_analysis.ResponseSpectrum">ResponseSpectrum</a></li>
    <li class="mono"><a href="#dyn_analysis.UKNA_BSEN1991_2_Figure_NA_9">UKNA_BSEN1991_2_Figure_NA_9</a></li>
    <li class="mono"><a href="#dyn_analysis.load">load</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#dyn_analysis.Dyn_Analysis">Dyn_Analysis</a></span>
        
          
  <ul>
    <li class="mono"><a href="#dyn_analysis.Dyn_Analysis.__init__">__init__</a></li>
    <li class="mono"><a href="#dyn_analysis.Dyn_Analysis.run">run</a></li>
    <li class="mono"><a href="#dyn_analysis.Dyn_Analysis.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#dyn_analysis.MovingLoadAnalysis">MovingLoadAnalysis</a></span>
        
          
  <ul>
    <li class="mono"><a href="#dyn_analysis.MovingLoadAnalysis.__init__">__init__</a></li>
    <li class="mono"><a href="#dyn_analysis.MovingLoadAnalysis.PlotResults">PlotResults</a></li>
    <li class="mono"><a href="#dyn_analysis.MovingLoadAnalysis.run">run</a></li>
    <li class="mono"><a href="#dyn_analysis.MovingLoadAnalysis.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#dyn_analysis.Multiple">Multiple</a></span>
        
          
  <ul>
    <li class="mono"><a href="#dyn_analysis.Multiple.__init__">__init__</a></li>
    <li class="mono"><a href="#dyn_analysis.Multiple.collate_stats">collate_stats</a></li>
    <li class="mono"><a href="#dyn_analysis.Multiple.plot_stats">plot_stats</a></li>
    <li class="mono"><a href="#dyn_analysis.Multiple.run">run</a></li>
    <li class="mono"><a href="#dyn_analysis.Multiple.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses">PedestrianDynamics_transientAnalyses</a></span>
        
          
  <ul>
    <li class="mono"><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses.__init__">__init__</a></li>
    <li class="mono"><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses.collate_stats">collate_stats</a></li>
    <li class="mono"><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses.plot_modal_params">plot_modal_params</a></li>
    <li class="mono"><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses.plot_response_stats">plot_response_stats</a></li>
    <li class="mono"><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses.plot_stats">plot_stats</a></li>
    <li class="mono"><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses.run">run</a></li>
    <li class="mono"><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#dyn_analysis.UKNA_BSEN1991_2_crowd">UKNA_BSEN1991_2_crowd</a></span>
        
          
  <ul>
    <li class="mono"><a href="#dyn_analysis.UKNA_BSEN1991_2_crowd.__init__">__init__</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#dyn_analysis.UKNA_BSEN1991_2_walkers_joggers">UKNA_BSEN1991_2_walkers_joggers</a></span>
        
          
  <ul>
    <li class="mono"><a href="#dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.__init__">__init__</a></li>
    <li class="mono"><a href="#dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.PlotResults">PlotResults</a></li>
    <li class="mono"><a href="#dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.run">run</a></li>
    <li class="mono"><a href="#dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.save">save</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">dyn_analysis</span> module</h1>
  <p>Classes and methods used to implement specific forms of dynamic analysis</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis" class="source">
    <div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classes and methods used to implement specific forms of dynamic analysis</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__init__</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">currentVersion</span>

<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">timeit</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FuncFormatter</span>
<span class="kn">import</span> <span class="nn">dill</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isfunction</span>
<span class="c1">#import multiprocessing   # does not work with Spyder!</span>

<span class="kn">import</span> <span class="nn">tstep</span>
<span class="kn">import</span> <span class="nn">loading</span>
<span class="kn">import</span> <span class="nn">msd_chain</span>

<span class="kn">from</span> <span class="nn">loading</span> <span class="kn">import</span> <span class="n">UKNA_BSEN1991_2_walkers_joggers_loading</span> <span class="k">as</span> <span class="n">pedestrian_loading</span>


<span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    De-serialises `Dyn_Analysis` object from pickle fill</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fName</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Loading serialised `tstep_results` object from `{0}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">))</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;De-serialisation successful!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">obj</span>

<span class="k">class</span> <span class="nc">Dyn_Analysis</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for dynamic analysis implementations</span>
<span class="sd">    </span>
<span class="sd">    _Inheritance expected_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">dynsys_obj</span><span class="p">,</span><span class="n">loading_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        _All derived classes are expected to run this function_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String identifier for object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span> <span class="o">=</span> <span class="n">dynsys_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamic system to which analysis relates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span> <span class="o">=</span> <span class="n">loading_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Object defining applied loading</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs dynamic analysis</span>
<span class="sd">        </span>
<span class="sd">        _Inheritance expected_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">_pickle_fName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines default filename for pickle files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="n">fName</span> <span class="o">=</span> <span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">fName</span> <span class="o">+=</span> <span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                
            <span class="n">fName</span> <span class="o">+=</span> <span class="s2">&quot;.pkl&quot;</span> 
                
        <span class="k">return</span> <span class="n">fName</span>
    
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialises object to file `fName`</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
            <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
            
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!&quot;</span><span class="p">)</span>
        
    
    
    
<span class="k">class</span> <span class="nc">MovingLoadAnalysis</span><span class="p">(</span><span class="n">Dyn_Analysis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to implement moving load analysis</span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    _Moving load analysis_ involves the determining the response of the system </span>
<span class="sd">    to groups of point loads moving in a pre-defined manner along a defined </span>
<span class="sd">    track.</span>
<span class="sd">    </span>
<span class="sd">    _Moving loads_ include, but are not limited to:</span>
<span class="sd">    </span>
<span class="sd">    *   Train axles, which are usually at pre-defined spacings</span>
<span class="sd">    </span>
<span class="sd">    *   Vehicle axles</span>
<span class="sd">    </span>
<span class="sd">    *   Forces to represent the actions of walkers/joggers per UK NA to </span>
<span class="sd">        BS EN 1991-2</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">loadtrain_obj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">loadtrain_fName</span><span class="o">=</span><span class="s2">&quot;loadDefs.csv&quot;</span><span class="p">,</span>
                 <span class="n">loadVel</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                 <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">tEpilogue</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                 <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">dt_loads</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                 <span class="n">max_dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">retainDOFTimeSeries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">retainResponseTimeSeries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">writeResults2File</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">results_fName</span><span class="o">=</span><span class="s2">&quot;results.csv&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">        </span>
<span class="sd">        **Important note:** `modalsys_obj` must be a modal system, as the </span>
<span class="sd">        action of the moving loads is determined by obtaining the </span>
<span class="sd">        mode-generalised force functions for each mode. _This is checked_.</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `loadtrain_obj`, load train object defining load pattern. If _None_ </span>
<span class="sd">          then `loadtrain_fName` must be provided (see below)</span>
<span class="sd">          </span>
<span class="sd">        * `loadtrain_fName&quot;, file containing load train definition</span>
<span class="sd">            </span>
<span class="sd">        * `loadVel`, constant velocity of load pattern (m/s)</span>
<span class="sd">        </span>
<span class="sd">        * `loadDefs_fName`, file containing load definitions</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Handle None for loadtrain_obj</span>
        <span class="k">if</span> <span class="n">loadtrain_obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">loadtrain_obj</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">LoadTrain</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">loadtrain_fName</span><span class="p">)</span>
        
        <span class="c1"># Check class name of modalsys_obj</span>
        <span class="k">if</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;ModalSys&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modalsys_obj`: instance of `ModalSys` class expected!&quot;</span><span class="p">)</span>
            
        <span class="c1"># Check class name of base class of loadtrain_obj</span>
        <span class="k">if</span> <span class="n">loadtrain_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;LoadTrain&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`loadtrain_obj`: instance of `LoadTrain` class &quot;</span><span class="o">+</span>
                             <span class="s2">&quot;(or dervied classes) expected!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Run parent init</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">loadtrain_obj</span><span class="p">)</span>
        
        <span class="c1"># Save details as attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadVel</span> <span class="o">=</span> <span class="n">loadVel</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Velocity of load pattern along track</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define time-stepping analysis</span>
        
        <span class="n">tStart</span><span class="p">,</span> <span class="n">tEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CalcSimDuration</span><span class="p">(</span><span class="n">loadVel</span><span class="o">=</span><span class="n">loadVel</span><span class="p">,</span>
                                             <span class="n">tEpilogue</span><span class="o">=</span><span class="n">tEpilogue</span><span class="p">)</span>
        
        <span class="c1"># Define force function for parent system and subsystems</span>
        <span class="n">modalForces_func</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcModalForces</span><span class="p">(</span><span class="n">loading_obj</span><span class="o">=</span><span class="n">loadtrain_obj</span><span class="p">,</span>
                                                        <span class="n">loadVel</span><span class="o">=</span><span class="n">loadVel</span><span class="p">,</span>
                                                        <span class="n">dt</span><span class="o">=</span><span class="n">dt_loads</span><span class="p">,</span>
                                                        <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="n">use_abs_modeshape</span><span class="p">)</span>
        
        <span class="n">force_func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">modalsys_obj</span> <span class="p">:</span> <span class="n">modalForces_func</span><span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                     <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                     <span class="n">tStart</span><span class="o">=</span><span class="n">tStart</span><span class="p">,</span>
                                     <span class="n">tEnd</span><span class="o">=</span><span class="n">tEnd</span><span class="p">,</span>
                                     <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                                     <span class="n">max_dt</span><span class="o">=</span><span class="n">max_dt</span><span class="p">,</span>
                                     <span class="n">force_func_dict</span><span class="o">=</span><span class="n">force_func_dict</span><span class="p">,</span>
                                     <span class="n">retainDOFTimeSeries</span><span class="o">=</span><span class="n">retainDOFTimeSeries</span><span class="p">,</span>
                                     <span class="n">retainResponseTimeSeries</span><span class="o">=</span><span class="n">retainResponseTimeSeries</span><span class="p">,</span>
                                     <span class="n">writeResults2File</span><span class="o">=</span><span class="n">writeResults2File</span><span class="p">,</span>
                                     <span class="n">results_fName</span><span class="o">=</span><span class="n">results_fName</span>
                                     <span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Time-stepping solver object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">results_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Results object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">save_fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs moving load analysis, using `tstep.run()`</span>
<span class="sd">        </span>
<span class="sd">        _Refer documentation for that function for more details_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Running `</span><span class="si">%s</span><span class="s2">`...&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Dynamic system: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load pattern: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadVel</span><span class="p">)</span>
        <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        
        <span class="n">results_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        
        <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>
               
        <span class="k">if</span> <span class="n">saveResults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">save_fName</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">results_obj</span>
    
        
    <span class="k">def</span> <span class="nf">_CalcSimDuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">loadVel</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span><span class="n">tEpilogue</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the required duration for time-stepping simulation</span>
<span class="sd">        ***</span>
<span class="sd">        </span>
<span class="sd">        Optional:</span>
<span class="sd">         </span>
<span class="sd">        * `loadVel`, constant velocity (m/s) of the load pattern</span>
<span class="sd">        </span>
<span class="sd">        * `tEpilogue`, additional time to run following exit of last load from </span>
<span class="sd">          track overlying the dynamic system in question.</span>
<span class="sd">          </span>
<span class="sd">        In the case of `Ltrack` and `loadLength`, if _None_ is provided then </span>
<span class="sd">        function will attempt to obtain this information from class attributes.</span>
<span class="sd">          </span>
<span class="sd">        ***</span>
<span class="sd">        Returns:</span>
<span class="sd">            </span>
<span class="sd">        tStart, `tEnd`: start and end times (secs) for simulation</span>
<span class="sd">         </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#print(&quot;tEpilogue = %.3f&quot; % tEpilogue)</span>
        
        <span class="n">modalsys_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span>
        <span class="n">loadtrain_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span>
        
        <span class="c1"># Get length of track along which loading is running</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Ltrack&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">modalsys_obj</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
            <span class="n">Ltrack</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`{0}` not defined!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
            
        <span class="c1"># Get length of load train</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;loadLength&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">loadtrain_obj</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
            <span class="n">loadLength</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`{0}` not defined!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
      
        <span class="c1"># Determine time required for all loads to pass along track</span>
        <span class="n">tStart</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">Ltotal</span> <span class="o">=</span> <span class="n">Ltrack</span> <span class="o">+</span> <span class="n">loadLength</span>
        <span class="n">tEnd</span> <span class="o">=</span> <span class="n">Ltotal</span><span class="o">/</span><span class="n">loadVel</span> <span class="o">+</span> <span class="n">tEpilogue</span>
        
        <span class="k">return</span> <span class="n">tStart</span><span class="p">,</span> <span class="n">tEnd</span>
    
    
    <span class="k">def</span> <span class="nf">PlotResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots results using `tstep_results.PlotResults()`.</span>
<span class="sd">        </span>
<span class="sd">        _Refer documentation from that function for further details_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_obj</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="n">dofs2Plot</span><span class="p">)</span>
        
        
<span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_walkers_joggers</span><span class="p">(</span><span class="n">MovingLoadAnalysis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements transient analysis for walkers/joggers case</span>
<span class="sd">        per NA.2.44.4 of UK NA to BS EN 1992-1:2003</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">modalsys_obj</span><span class="p">,</span>
                     <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                     <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                     <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initialisation function</span>
<span class="sd">            </span>
<span class="sd">            ***</span>
<span class="sd">            Required:</span>
<span class="sd">               </span>
<span class="sd">            * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">            </span>
<span class="sd">            * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">              to targeted</span>
<span class="sd">        </span>
<span class="sd">            ***</span>
<span class="sd">            Optional:</span>
<span class="sd">                </span>
<span class="sd">            * `dt`, time step to be used for results evaluation. If _None_ then </span>
<span class="sd">              a reasonable time step to use will be determined, based on the </span>
<span class="sd">              frequency of the forcing function</span>
<span class="sd">            </span>
<span class="sd">            * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">              computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">              used (conservative).</span>
<span class="sd">            </span>
<span class="sd">            Additional keyword arguments can be defined. These should relate </span>
<span class="sd">            the `__init__()` function of the `MovingLoadAnalysis` class </span>
<span class="sd">                </span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="c1"># Create default name for analysis object</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="p">,</span>
                                                                <span class="n">analysis_type</span><span class="p">)</span>
            
            <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
            <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
                <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">0</span>
                
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
                <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">1</span>
                
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">2</span>
                
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
                <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">16</span>
                <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">4</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
            
            <span class="c1"># Define loading velocity per Table NA.8</span>
            <span class="c1"># Get appropriate N value to use</span>
            <span class="k">if</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
                <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">1.7</span>
                <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_walkers</span>
                
            <span class="k">elif</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
                <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">3.0</span>
                <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_joggers</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N_to_use</span>
                
            <span class="c1"># Get natural frequency of mode to consider</span>
            <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
            <span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">]</span> <span class="c1"># damped natural frequencies of mode</span>
            <span class="n">f_d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
            
            <span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="n">mode_index</span><span class="p">]</span>
            <span class="n">logdec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logdec</span> <span class="o">=</span> <span class="n">logdec</span>
            
            <span class="c1"># Analyse modeshape to determine effective span</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
            
            <span class="k">if</span> <span class="n">calc_Seff</span><span class="p">:</span>
                
                <span class="n">attrName</span> <span class="o">=</span> <span class="s2">&quot;Seff&quot;</span>
                
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">):</span>
                    <span class="n">Seff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">)</span>
                
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">Calc_Seff</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span>
                                                  <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                                  <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    
                    <span class="c1"># save to avoid recalculating</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span> 
                    <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">lambda_vals</span>
                    
                <span class="c1"># Get Seff for mode being considered</span>
                <span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mode_index</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># &quot;In all cases it is conservative to use Seff = S&quot;</span>
                <span class="n">Seff</span> <span class="o">=</span> <span class="n">S</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span>
            
            <span class="c1"># Obtain gamma from Figure NA.9</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logdec</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
            
            <span class="c1"># Define loading objects to represent walkers and joggers</span>
            <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">pedestrian_loading</span><span class="p">(</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span><span class="p">,</span>
                                             <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                             <span class="n">N</span><span class="o">=</span><span class="n">N_to_use</span><span class="p">,</span>
                                             <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">)</span>
            
            <span class="c1"># Determine reasonable time step to use</span>
            <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1"># Rule of thumb - 10x frequency under consideration</span>
                <span class="n">fs</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">f_d</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span>  
            
            <span class="c1"># Run parent init</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                             <span class="n">loadtrain_obj</span><span class="o">=</span><span class="n">loading_obj</span><span class="p">,</span>
                             <span class="n">loadVel</span><span class="o">=</span><span class="n">load_velocity</span><span class="p">,</span>
                             <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c1"># use sign-corrected modeshapes</span>
                             <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Transient moving load analysis initialised *****&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal system:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode index:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode frequency:</span><span class="se">\t\t</span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">f_d</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Loading object:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity:</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2"> m/s&quot;</span> <span class="o">%</span> <span class="n">load_velocity</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Seff</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;gamma:</span><span class="se">\t\t\t</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
            
<span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_crowd</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to implement crowd loading analysis to UK NA to BS EN1991-2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                 <span class="n">deck_width_func_list</span><span class="o">=</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">],</span>
                 <span class="n">modeshapes_fname_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;modeshapes_edge1.csv&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;modeshapes_edge2.csv&quot;</span><span class="p">],</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">               </span>
<span class="sd">        * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">            </span>
<span class="sd">        * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">          to targeted</span>
<span class="sd">          </span>
<span class="sd">        * `modeshapes_fname_list`, list of strings denoting files containing </span>
<span class="sd">          modeshape data along minimum of 2 deck lines:</span>
<span class="sd">              </span>
<span class="sd">              * List length = nDeckLines</span>
<span class="sd">              </span>
<span class="sd">              * Minimum nDeckLines = 2</span>
<span class="sd">          </span>
<span class="sd">        * `deck_width_func_list`, list of functions to denote how width (m) of </span>
<span class="sd">          each deck strip (between lines relating to `modeshapes_fname_list`)</span>
<span class="sd">          varies with chainage:</span>
<span class="sd">              </span>
<span class="sd">              * List length = (nDeckLines-1) required (this is checked)</span>
<span class="sd">              </span>
<span class="sd">              * Default function establishes single deck strip of width = 3.0m.</span>
<span class="sd">    </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">          computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">          used (conservative).</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Create default name for analysis object</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - Crowd&quot;</span> <span class="o">%</span> <span class="n">mode_index</span>
            
        <span class="c1"># Check `modeshapes_fname_list` input</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modeshapes_fname_list`: list expected&quot;</span><span class="p">)</span>
            
        <span class="n">nDeckLines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">nDeckLines</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Minimum of 2 deck lines must be defined &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;via `modeshapes_fname_list`&quot;</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_str</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modeshapes_fname_list[</span><span class="si">%d</span><span class="s2">]`&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span>
                                 <span class="s2">&quot; does not exist!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check `deck_width_func_list` input</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`deck_width_func_list`: list expected&quot;</span><span class="p">)</span>
            
        <span class="n">nDeckStrips</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">nDeckStrips</span> <span class="o">!=</span> <span class="n">nDeckLines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nDeckStrips = nDeckLines - 1 expected&quot;</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">width_func</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">width_func</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`deck_width_func_list[</span><span class="si">%d</span><span class="s2">]`&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> 
                                 <span class="s2">&quot; is not a function&quot;</span><span class="p">)</span>
                
            
        <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
        <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;CHECK DENSITIES!&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">crowd_density</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># persons/m2</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
            <span class="n">crowd_density</span><span class="o">=</span><span class="mf">0.4</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">crowd_density</span><span class="o">=</span><span class="mf">0.8</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
            <span class="n">crowd_density</span><span class="o">=</span><span class="mf">1.5</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Read modeshape data from file, determine interpolation functions</span>
        <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">modeshapeFunc_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">fName</span> <span class="ow">in</span> <span class="n">modeshapes_fname_list</span><span class="p">:</span>
            
            <span class="n">mfunc</span><span class="p">,</span> <span class="n">Ltrack</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">DefineModeshapes</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">fName</span><span class="p">,</span>
                                                          <span class="n">saveAsAttr</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">Ltrack_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ltrack</span><span class="p">)</span>
            <span class="n">modeshapeFunc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mfunc</span><span class="p">)</span>
            
            
    
        
        
        
    
    
    
     
<span class="k">class</span> <span class="nc">Multiple</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to run multiple dynamic analyses and provide functionality to </span>
<span class="sd">    store, plot and analyse results from multiple dynamic analyses in a </span>
<span class="sd">    systematic manner</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">className</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                 <span class="n">dynsys_obj</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span>
                 <span class="n">writeResults2File</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">retainDOFTimeSeries</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">retainResponseTimeSeries</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        ****</span>
<span class="sd">        </span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `className`, _string_ to denote `Dyn_Analysis` class (usually inherited) </span>
<span class="sd">          that implements the required analysis type</span>
<span class="sd">          </span>
<span class="sd">        * `dynsys_obj`, dynamic system to which analysis relates</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `retainResponseTimeSeries`, _boolean_, denotes whether detailed </span>
<span class="sd">          _response_ time series results can be deleted once summary </span>
<span class="sd">          statistics have been computed</span>
<span class="sd">          </span>
<span class="sd">        * `retainDOFTimeSeries`, _boolean_, denotes whether detailed _DOF_ </span>
<span class="sd">          time series results can be deleted once summary statistics have been </span>
<span class="sd">          computed</span>
<span class="sd">            </span>
<span class="sd">        By default _False_ is assigned to be above (contrary to usual defaults) </span>
<span class="sd">        as running multiple analyses would otherwise often lead to large </span>
<span class="sd">        memory demands.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Initialising multiple `{0}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">className</span><span class="p">))</span>
    
        <span class="k">if</span> <span class="n">className</span> <span class="o">==</span> <span class="s2">&quot;MovingLoadAnalysis&quot;</span><span class="p">:</span>
            
            <span class="n">ReqdClass</span> <span class="o">=</span> <span class="n">MovingLoadAnalysis</span>
            
            <span class="n">kwargs2permute</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;loadVel&quot;</span><span class="p">,</span><span class="s2">&quot;loadtrain_obj&quot;</span><span class="p">]</span>
            
        <span class="k">elif</span> <span class="n">className</span> <span class="o">==</span> <span class="s2">&quot;UKNA_BSEN1991_2_walkers_joggers&quot;</span><span class="p">:</span>
            
            <span class="n">ReqdClass</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_walkers_joggers</span>
            
            <span class="n">kwargs2permute</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;analysis_type&quot;</span><span class="p">,</span><span class="s2">&quot;mode_index&quot;</span><span class="p">]</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported class name!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get input arguments to permute</span>
        <span class="n">vals2permute</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs2permute</span><span class="p">:</span>
            
            <span class="c1"># Get list as supplied via **kwargs</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                
                <span class="n">vals_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                
                <span class="c1"># Convert to list if single</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                        <span class="n">vals_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">vals_list</span><span class="p">]</span>
                        
                <span class="n">vals2permute</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">vals_list</span>
                        
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;{0}&#39; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> 
                                 <span class="s2">&quot;included in `kwargs2permute` list but &quot;</span> <span class="o">+</span> 
                                 <span class="s2">&quot;list of values to permute not provided!&quot;</span><span class="p">)</span>

        <span class="c1"># Populate object array with initialised objects</span>
        <span class="n">vals_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">vals2permute</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        
        <span class="n">analysis_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">nAnalysis</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nAnalysis</span><span class="p">):</span>
            
            <span class="c1"># Prepare dict of key arguments to pass</span>
            <span class="n">kwargs_vals</span> <span class="o">=</span> <span class="n">vals_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">kwargs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">kwargs2permute</span><span class="p">,</span> <span class="n">kwargs_vals</span><span class="p">))</span>
            
            <span class="c1"># Append any general kwargs provided</span>
            <span class="n">results_fName</span> <span class="o">=</span> <span class="s2">&quot;results/analysis</span><span class="si">%04d</span><span class="s2">.csv&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="n">kwargs_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;retainDOFTimeSeries&quot;</span><span class="p">:</span><span class="n">retainDOFTimeSeries</span><span class="p">,</span>
                                <span class="s2">&quot;retainResponseTimeSeries&quot;</span><span class="p">:</span><span class="n">retainResponseTimeSeries</span><span class="p">,</span>
                                <span class="s2">&quot;writeResults2File&quot;</span><span class="p">:</span><span class="n">writeResults2File</span><span class="p">,</span>
                                <span class="s2">&quot;results_fName&quot;</span><span class="p">:</span><span class="n">results_fName</span><span class="p">})</span>
            
            <span class="c1"># Initialisise analysis object</span>
            <span class="n">analysis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReqdClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%04d</span><span class="s2">&quot;</span><span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                                           <span class="n">modalsys_obj</span><span class="o">=</span><span class="n">dynsys_obj</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">kwargs_dict</span><span class="p">))</span>
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span> <span class="o">=</span> <span class="n">dynsys_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `DynSys` object to which analysis relates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span> <span class="o">=</span> <span class="n">className</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class name of `dyn_analysis` derived class</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span> <span class="o">=</span> <span class="n">vals2permute</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary of keywords and values to permute in the multiple analyses </span>
<span class="sd">        defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tuple to denote the shape of lists specified in `vals2permute`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span><span class="o">=</span><span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ndarray of `tstep_results` object instances</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="o">=</span><span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dict of ndarrays containing stats (max, min, std, absmax) for each of </span>
<span class="sd">        the analyses carried out, for each of the responses defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span> <span class="o">=</span> <span class="n">analysis_list</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of `Dyn_Analysis` object instances, each of which defines a </span>
<span class="sd">        dynamic analysis to be performed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">solveInParallel</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs multiple dynamic analyses, as defined by `__init__`</span>
<span class="sd">        ***</span>
<span class="sd">        </span>
<span class="sd">        In principle this can be done in parallel, to efficiently use all </span>
<span class="sd">        avaliable cores and give improve runtime.</span>
<span class="sd">        </span>
<span class="sd">        _Parallel processing not yet implemented due to outstanding bug </span>
<span class="sd">        associated with using `multiprocessing` module from within Spyder_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running multiple `{0}`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">))</span>
        <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
            
        <span class="c1"># Run analyses using parallel processing (if possible)</span>
        <span class="k">if</span> <span class="n">solveInParallel</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Parallel processing not yet implemented due to &quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;outstanding bug associated with using &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;`multiprocessing` module from within Spyder</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                  <span class="s2">&quot;A single-process analysis will be carried out instead.&quot;</span><span class="p">)</span>    

        <span class="c1"># Run all pre-defined analyses</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">):</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis #</span><span class="si">%04d</span><span class="s2"> of #</span><span class="si">%04d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)))</span>
            <span class="n">x</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="c1">#clear line for emphasis</span>
        
        <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Multiple `</span><span class="si">%s</span><span class="s2">` analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds!</span><span class="se">\n</span><span class="s2">&quot;</span> 
              <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">,(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)))</span>
            
        <span class="c1"># Reshape results objects in ndarray</span>
        <span class="n">results_obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">]</span>
        <span class="n">reqdShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span>
        <span class="n">results_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">results_obj_list</span><span class="p">,</span><span class="n">reqdShape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="o">=</span> <span class="n">results_arr</span>
        
        <span class="c1"># Collate statistics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
        
        <span class="c1"># Pickle results</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    
    
    <span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stat_name</span><span class="o">=</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span>
                   <span class="n">key2plot</span><span class="o">=</span><span class="s1">&#39;loadVel&#39;</span><span class="p">,</span>
                   <span class="n">xConversionFactor</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                   <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">figsize_inches</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produces a plot of a given taken across multiple analyses</span>
<span class="sd">        </span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * `stat_name`, name of statistic to be plotted</span>
<span class="sd">        * `key2plot`, name of key within `vals2permute` dict to be used</span>
<span class="sd">          as x-axis in plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;UNFINISHED: DO NOT USE!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Re-collate statistics as required</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
            
        <span class="c1"># Check requested stats is in dict</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid statistic selected!&quot;</span><span class="p">)</span>
            
        <span class="c1"># Obtain responses names</span>
        <span class="n">responseNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names_list</span>
        <span class="k">print</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
        
        <span class="c1"># Get index and value to use along x-axis</span>
        <span class="c1">#kwargs2permute = list(self.vals2permute.keys())</span>
        <span class="c1">#key2plot_index=[i for i, x in enumerate(kwargs2permute) if x==key2plot][0]</span>
        
        <span class="n">x_vals</span> <span class="o">=</span> <span class="n">xConversionFactor</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span><span class="p">[</span><span class="n">key2plot</span><span class="p">])</span>

        <span class="c1"># Retrieve stats to plot</span>
        <span class="n">stats_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">stat_name</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;stats_arr.shape: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Current manual workaround to produce load vs velocity plot!</span>
<span class="sd">        (Code should be tidied to be more generic)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Create figure for each set of responses</span>
        <span class="n">nFigures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
        <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">fig_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nFigures</span><span class="p">):</span>
                
            <span class="n">nSubplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">])</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize_inches</span><span class="p">)</span>
            
            <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Create subplots for each response</span>
            <span class="k">for</span> <span class="n">splt_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">):</span>
                
                <span class="n">r</span> <span class="o">=</span> <span class="n">splt_index</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">splt_index</span><span class="p">]</span>
                <span class="n">vals2plot</span> <span class="o">=</span> <span class="n">stats_arr</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">vals2plot</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">splt_index</span><span class="o">==</span><span class="n">nSubplots</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">fig_list</span>
    
    <span class="k">def</span> <span class="nf">_pickle_fName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines default filename for pickle files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="n">fName</span> <span class="o">=</span> <span class="s2">&quot;{0}_{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">fName</span> <span class="o">+=</span> <span class="s2">&quot;_{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                
            <span class="n">fName</span> <span class="o">+=</span> <span class="s2">&quot;.pkl&quot;</span> 
                
        <span class="k">return</span> <span class="n">fName</span>
    
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialises object to file `fName`</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
            <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
            
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">collate_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collates computed statistics into a dict of ndarrays, to faciliate </span>
<span class="sd">        efficient slicing operations, for example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating statistics...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get list of all tstep_results objects associate with Multiple()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;self.results_arr=None! No results to collate!&quot;</span><span class="p">)</span>
        
        <span class="n">results_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function to collate specified stats, across all results objects</span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="c1"># Loop over all tstep_results objects</span>
            <span class="n">stats_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">results_obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results_list</span><span class="p">):</span>
                
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">results_obj</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    
                    <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
                    <span class="n">stats_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
            
            <span class="c1"># Flatten nested list</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">stats_list</span><span class="p">)</span>
            
            <span class="c1"># Reshape as ndarray</span>
            <span class="n">newshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">nResponses</span><span class="p">,)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">newshape</span><span class="p">)</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;`{0}` stats saved as {1} ndarray&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_name</span><span class="p">,</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            
            <span class="k">return</span> <span class="n">arr</span>
        
        <span class="c1"># Loop over all systems and subsystems</span>
        <span class="n">stats_dict_outer</span><span class="o">=</span><span class="p">{}</span>
        
        <span class="n">DynSys_list</span> <span class="o">=</span> <span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
        
        <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">DynSys_list</span><span class="p">:</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating response stats for system &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    
            <span class="c1"># Loop over all response stats types, e.g. &#39;max&#39;, &#39;min&#39; etc.</span>
            <span class="n">stats_dict_inner</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">stats_names_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            
            <span class="k">for</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="n">stats_names_list</span><span class="p">:</span>
                
                <span class="n">stats_dict_inner</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span><span class="p">)</span>
                
            <span class="n">stats_dict_outer</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_dict_inner</span>
                
        <span class="c1"># Save as attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="o">=</span> <span class="n">stats_dict_outer</span>
        
        <span class="k">return</span> <span class="n">stats_dict_outer</span>
    
    
    
<span class="k">class</span> <span class="nc">PedestrianDynamics_transientAnalyses</span><span class="p">(</span><span class="n">Multiple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements the full set of analyses required to fully-implement the </span>
<span class="sd">    method given in NA.2.44.4 of UK NA to BS EN 1991-2</span>
<span class="sd">    i.e. transient analyses for both walkers and joggers, for all modes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        ****</span>
<span class="sd">        </span>
<span class="sd">        Required:</span>
<span class="sd">          </span>
<span class="sd">        * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `bridgeClass`, _string_, either &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, or &#39;D&#39;. </span>
<span class="sd">          Refer Table NA.7 for description of bridge classes</span>
<span class="sd">          </span>
<span class="sd">        Additional keyword arguments may be passed. These should relate to the </span>
<span class="sd">        `__init__()` function of the `Multiple` class.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get mode indexs to loop over</span>
        <span class="c1"># Note modes sorted into ascending frequency but in conjugate pairs</span>
        <span class="c1"># Hence step through modes x2</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetSystemMatrices</span><span class="p">()[</span><span class="s2">&quot;nDOF&quot;</span><span class="p">]</span>
        <span class="n">mode_index_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nModes</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="c1"># Run parent init function</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;UKNA_BSEN1991_2_walkers_joggers&quot;</span><span class="p">,</span>
                         <span class="n">dynsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                         <span class="n">bridgeClass</span><span class="o">=</span><span class="n">bridgeClass</span><span class="p">,</span>
                         <span class="n">mode_index</span><span class="o">=</span><span class="n">mode_index_list</span><span class="p">,</span>
                         <span class="n">analysis_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span><span class="s2">&quot;joggers&quot;</span><span class="p">],</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># Save key variables as attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
        
        
    <span class="k">def</span> <span class="nf">plot_modal_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        
        <span class="c1"># Get modal properties as used in analyses</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">fv</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">eta</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
        
        <span class="c1"># Plot details of system</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$f_{d}$ (Hz)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">eta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s1">&#39;{:.1%}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Modal damping&quot;</span><span class="p">)</span>
        
        <span class="c1"># Add equivilent axis for log dec</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">logdec</span><span class="p">(</span><span class="n">eta</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
        
        <span class="n">delta_incr</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">new_yticks</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">delta_incr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">logdec</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Log decrement $\delta$&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
    
    
    <span class="k">def</span> <span class="nf">plot_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">dynsys2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">responses2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots statistics of responses computed, across all analyses</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `dynsys2plot`, list of subsystem objects to plot responses </span>
<span class="sd">          for. If None (default) responses will be plotted for all </span>
<span class="sd">          subsystems</span>
<span class="sd">            </span>
<span class="sd">        * `responses2plot`, list of indices specifying responses to be</span>
<span class="sd">          plotted. If None (default) all responses will be plotted, for</span>
<span class="sd">          each sub-system</span>
<span class="sd">          </span>
<span class="sd">        * `sharey`, passed to pyplot.subplots() method. Controls whether </span>
<span class="sd">          subplots should share common y scale.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting response statistics...&quot;</span><span class="p">)</span>
        
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">dynsys2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dynsys2plot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dynsys2plot&#39; does not belong &quot;</span> <span class="o">+</span> 
                                 <span class="s2">&quot;to system analysed!&quot;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dynsys2plot</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">dynsys2plot</span><span class="p">]</span>
            
        <span class="c1"># Loop over all systems and subsystems</span>
        <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">dynsys2plot</span><span class="p">:</span>
            
            <span class="c1"># Get stats dict relating to this system</span>
            <span class="n">stats_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span>
            
            <span class="c1"># Get indices of responses to plot</span>
            <span class="n">response_names</span> <span class="o">=</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names</span>
            
            <span class="k">if</span> <span class="n">responses2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_names</span><span class="p">)</span>
                <span class="n">responses2plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nResponses</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">)</span>
            
            <span class="c1"># Create new figure</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nResponses</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                      <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Loop to plot all responses requested</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">):</span>
                
                <span class="n">response_name</span> <span class="o">=</span> <span class="n">response_names</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                
                <span class="c1"># Get stats for this response</span>
                <span class="n">stats_dict_r</span> <span class="o">=</span> <span class="p">{}</span>
                
                <span class="k">for</span> <span class="n">stats_name</span><span class="p">,</span> <span class="n">stats_vals</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    
                    <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">=</span><span class="n">stats_vals</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
            
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting stats for response &#39;</span><span class="si">%s</span><span class="s2">&#39;:&quot;</span> <span class="o">%</span> <span class="n">response_name</span><span class="p">)</span>
                
                <span class="c1"># Plot response stats for walkers and joggers responses</span>
                
                <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s1">&#39;walkers&#39;</span><span class="p">,</span><span class="s1">&#39;joggers&#39;</span><span class="p">]):</span>
                    
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
                    
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">]):</span>
                    
                        <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">][</span><span class="n">col</span><span class="p">,:]</span>
                        
                        <span class="n">w</span><span class="o">=</span><span class="mf">0.1</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                               <span class="n">stats_vals</span><span class="p">,</span>
                               <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                               <span class="n">label</span><span class="o">=</span><span class="n">stats_name</span>
                               <span class="p">)</span>
    
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">col</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">response_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Responses to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">case</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="n">nResponses</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
                        
                
            
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Statistics of computed responses to pedestrian loading</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;UK NA to BS EN 1991-2, NA.2.44.4</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;Subsystem: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="n">fig_list</span>
        
    
    
<span class="c1"># ********************** FUNCTIONS   ****************************************</span>
        
<span class="k">def</span> <span class="nf">Calc_Seff</span><span class="p">(</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="p">,</span>
              <span class="n">dx</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
              <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates effective span, as defined by NA.2.44.4 and Figure NA.7 in </span>
<span class="sd">    BS EN 1991-2</span>
<span class="sd">    </span>
<span class="sd">    ![Figure_NA_7](../dynsys/img/UKNA_BSEN1991_2_FigNA7.PNG)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `modeshapeFunc`, _function_ defining variation of modeshapes with </span>
<span class="sd">      chainage. In general, for systems with multiple modes, `modeshapeFunc` to </span>
<span class="sd">      return _array_.</span>
<span class="sd">      </span>
<span class="sd">    * `S`, length of structure. Integration of modeshapes to compute </span>
<span class="sd">      _effective span_ is carried out in the interval _[0, S]_.</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">      </span>
<span class="sd">    * `dx`, distance increment used by `scipy.integrate.cumtrapz()`</span>
<span class="sd">      </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Note absolute value integral to be computed</span>
    <span class="k">def</span> <span class="nf">abs_modeshapeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">modeshapeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
    <span class="c1"># Evaluate modeshapes at specified chainages</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">modeshapeFunc</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
    <span class="n">y_abs_vals</span> <span class="o">=</span> <span class="n">abs_modeshapeFunc</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
    
    <span class="c1"># Integrate using Scipy routine</span>
    <span class="n">y_integral_vals</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">x_vals</span><span class="p">,</span>
                                               <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">y_integral</span> <span class="o">=</span> <span class="n">y_integral_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
    
    <span class="c1"># Get maxima</span>
    <span class="n">y_absmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_absmax_overall</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_absmax</span><span class="p">)</span>
    
    <span class="c1"># Compute Seff</span>
    <span class="n">Seff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">y_integral</span><span class="p">,</span> <span class="mf">0.634</span><span class="o">*</span><span class="n">y_absmax</span><span class="p">)</span>
    
    <span class="c1"># Compute lambda per eqn in Figure NA.7</span>
    <span class="n">lambda_vals</span> <span class="o">=</span> <span class="mf">0.634</span> <span class="o">*</span> <span class="n">Seff</span> <span class="o">/</span> <span class="n">S</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysing modeshape functions to determine Seff...&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;S (m):</span><span class="se">\t\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Seff</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Max modeshapes:</span><span class="se">\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_absmax</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Calculation of $S_{eff}$ (m)&quot;</span><span class="p">)</span>
        
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="n">handles</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_vals</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Modeshapes, $\phi(x)$&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="n">y_absmax_overall</span><span class="p">,</span><span class="n">y_absmax_overall</span><span class="p">])</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_abs_vals</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$|\phi|(x)$&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">y_absmax_overall</span><span class="p">])</span>
        
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_integral_vals</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">])</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Chainage (m)&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\int_{0}^{x}|\phi|(x).dx$&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_integral</span><span class="p">,</span><span class="n">handles</span><span class="p">):</span>
        
            <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="n">S</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">handle</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            
            <span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">val</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span>


<span class="k">def</span> <span class="nf">CalcTransverseAreaIntegral</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">phi1</span><span class="p">,</span><span class="n">phi2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes sign-corrected integral across domain of width `b`, given (signed) </span>
<span class="sd">    edge ordinates `phi1` and phi2`.</span>
<span class="sd">    </span>
<span class="sd">    Linear variation of integrand within integration domain is assumed </span>
<span class="sd">    </span>
<span class="sd">    ![derivation](../dynsys/img/sign_corrected_integral_derivation.PNG)</span>
<span class="sd">        </span>
<span class="sd">    Arrays of equal length can be supplied.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Change shapes agree</span>
    <span class="k">if</span> <span class="n">phi1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">phi2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shapes of `phi1` and `phi2` do not agree!&quot;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">phi1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shapes of `phi1` and `b` do not agree!&quot;</span><span class="p">)</span>        
    
    <span class="c1"># Test to see if same signs</span>
    <span class="n">same_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">phi1</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">phi2</span><span class="p">))</span>
    
    <span class="c1"># Obtain absolute values</span>
    <span class="n">phi1_abs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span>
    <span class="n">phi2_abs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span>
    
    <span class="c1"># Compute area integral on assumption of same sign</span>
    <span class="n">area_same_sign</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">phi1_abs</span><span class="o">+</span><span class="n">phi2_abs</span><span class="p">)</span>
    
    <span class="c1"># Compute area integral where different sign</span>
    <span class="n">area_different_sign</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">phi1_abs</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">phi2_abs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">phi1_abs</span><span class="o">+</span><span class="n">phi2_abs</span><span class="p">)</span>
    
    <span class="c1"># Select appropriate case</span>
    <span class="n">area_to_use</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">same_sign</span><span class="p">,</span><span class="n">area_same_sign</span><span class="p">,</span><span class="n">area_different_sign</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">area_to_use</span>


    
    
<span class="k">def</span> <span class="nf">ResponseSpectrum</span><span class="p">(</span><span class="n">accFunc</span><span class="p">,</span>
                     <span class="n">tResponse</span><span class="p">,</span>
                     <span class="n">T_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">eta</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                     <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to express ground acceleration time series as a seismic response </span>
<span class="sd">    spectrum</span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    _Seismic response spectra_ are used to summarises the vibration response </span>
<span class="sd">    of a SDOF oscillator in response to a transient ground acceleration </span>
<span class="sd">    time series. Seismic response spectra therefore represent a useful way of </span>
<span class="sd">    quantifying and graphically illustrating the severity of a given </span>
<span class="sd">    ground acceleration time series.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">    </span>
<span class="sd">    * `accFunc`, function a(t) defining the ground acceleration time series </span>
<span class="sd">      (usually this is most convenient to supply via an interpolation function)</span>
<span class="sd">      </span>
<span class="sd">    * `tResponse`, time interval over which to carry out time-stepping analysis.</span>
<span class="sd">      Set this to be at least the duration of the input acceleration time </span>
<span class="sd">      series!</span>
<span class="sd">      </span>
<span class="sd">    **Important note**:</span>
<span class="sd">        </span>
<span class="sd">    This routine expects a(t) to have units of m/s&lt;sup&gt;2&lt;/sup&gt;. </span>
<span class="sd">    It is common (at least in the field of seismic analysis) to quote ground </span>
<span class="sd">    accelerations in terms of &#39;g&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Any such time series must be pre-processed by multiplying by </span>
<span class="sd">    g=9.81m/s&lt;sup&gt;2&lt;/sup&gt;) prior to using this function, such that the </span>
<span class="sd">    supplied `accFunc` returns ground acceleration in m/s&lt;sup&gt;2&lt;/sup&gt;.</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `T_vals`, _list_, periods (in seconds) at which response spectra</span>
<span class="sd">      are to be evaluated. If _None_ will be set to logarithmically span the range </span>
<span class="sd">      [0.01,10.0] seconds, which is suitable for most applications.</span>
<span class="sd">        </span>
<span class="sd">    * `eta`, damping ratio to which response spectrum obtained is applicable. </span>
<span class="sd">      5% is used by default, as this a common default in seismic design.</span>
<span class="sd">      </span>
<span class="sd">     * `makePlot`, _boolean_, controls whether results are plotted</span>
<span class="sd">      </span>
<span class="sd">     `kwargs` may be used to pass additional arguments down to `TStep` object </span>
<span class="sd">     that is used to implement time-stepping analysis. Refer `tstep` docs for </span>
<span class="sd">     further details</span>
<span class="sd">     </span>
<span class="sd">    ***</span>
<span class="sd">    Returns:</span>
<span class="sd">        </span>
<span class="sd">    Values are returned as a dictionary, containing the following entries:</span>
<span class="sd">        </span>
<span class="sd">    * `T_vals`, periods at which spectra are evaluated.</span>
<span class="sd">    * `S_D`, relative displacement spectrum (in m)</span>
<span class="sd">    * `S_V`, relative velocity spectrum (in m/s)</span>
<span class="sd">    * `S_A`, absolute acceleration spectrum (in m/s&lt;sup&gt;2&lt;/sup&gt;)</span>
<span class="sd">    * `PSV`, psuedo-velocity spectrum (in m/s)</span>
<span class="sd">    * `PSA`, psuedo-acceleration spectrum (in m/s&lt;sup&gt;2&lt;/sup&gt;)</span>
<span class="sd">    </span>
<span class="sd">    In addition, if `makePlot=True`:</span>
<span class="sd">        </span>
<span class="sd">    * `fig`, figure object for plot</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Handle optional inputs</span>
    <span class="k">if</span> <span class="n">T_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">T_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        
    <span class="n">T_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">T_vals</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="c1"># Print summary of key inputs</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">accFunc</span><span class="p">,</span><span class="s2">&quot;__name__&quot;</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Ground motion function supplied: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">accFunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Time-stepping analysis interval: [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tResponse</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Number of SDOF oscillators to be analysed: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_vals</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damping ratio for SDOF oscillators: {:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span>
    
    <span class="c1"># Loop through all periods</span>
    <span class="n">M</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># unit mass for all oscillators</span>
    <span class="n">results_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Obtaining SDOF responses to ground acceleration...&quot;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_T</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">T_vals</span><span class="p">):</span>

        <span class="n">period_str</span> <span class="o">=</span> <span class="s2">&quot;Period </span><span class="si">%.2f</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">_T</span>
        
        <span class="c1"># Define SDOF oscillator</span>
        <span class="n">SDOF_sys</span> <span class="o">=</span> <span class="n">msd_chain</span><span class="o">.</span><span class="n">MSD_Chain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">period_str</span><span class="p">,</span>
                                       <span class="n">M_vals</span> <span class="o">=</span> <span class="n">M</span><span class="p">,</span>
                                       <span class="n">f_vals</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">_T</span><span class="p">,</span>
                                       <span class="n">eta_vals</span> <span class="o">=</span> <span class="n">eta</span><span class="p">,</span>
                                       <span class="n">showMsgs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Add output matrix to extract results</span>
        <span class="n">SDOF_sys</span><span class="o">.</span><span class="n">AddOutputMtrx</span><span class="p">(</span><span class="n">output_mtrx</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                               <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RelDisp&quot;</span><span class="p">,</span><span class="s2">&quot;RelVel&quot;</span><span class="p">,</span><span class="s2">&quot;Acc&quot;</span><span class="p">])</span>
        
        <span class="c1"># Define forcing function</span>
        <span class="k">def</span> <span class="nf">forceFunc</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">M</span><span class="o">*</span><span class="n">accFunc</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        
        <span class="c1"># Define time-stepping analysis</span>
        <span class="n">tstep_obj</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">SDOF_sys</span><span class="p">,</span>
                                <span class="n">tStart</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tEnd</span><span class="o">=</span><span class="n">tResponse</span><span class="p">,</span>
                                <span class="n">force_func</span><span class="o">=</span><span class="n">forceFunc</span><span class="p">,</span>
                                <span class="n">retainResponseTimeSeries</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Run time-stepping analysis and append results</span>
        <span class="n">results_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">showMsgs</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        
        <span class="c1"># Obtain absolute acceleration by adding back in ground motion</span>
        <span class="n">results_obj</span> <span class="o">=</span> <span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span>
        <span class="n">results_obj</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">+=</span> <span class="n">accFunc</span><span class="p">(</span><span class="n">results_obj</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        
        <span class="c1"># Recalculate statistics</span>
        <span class="n">results_obj</span><span class="o">.</span><span class="n">CalcResponseStats</span><span class="p">(</span><span class="n">showMsgs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Tidy up</span>
        <span class="k">del</span> <span class="n">SDOF_sys</span>
    
    <span class="c1"># Collate absmax statistics</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Retrieving maximum response statistics...&quot;</span><span class="p">)</span>
    <span class="n">S_D</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">response_stats</span><span class="p">[</span><span class="s1">&#39;absmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_list</span><span class="p">])</span>
    <span class="n">S_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">response_stats</span><span class="p">[</span><span class="s1">&#39;absmax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_list</span><span class="p">])</span>
    <span class="n">S_A</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">response_stats</span><span class="p">[</span><span class="s1">&#39;absmax&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_list</span><span class="p">])</span>
    
    <span class="c1"># Evaluate psuedo-specta</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">T_vals</span><span class="p">)</span>
    <span class="n">PSV</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">S_D</span>
    <span class="n">PSA</span> <span class="o">=</span> <span class="n">omega</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S_D</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Response spectra: {:.0%} damping&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">S_D</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SD (m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Relative displacement&quot;</span><span class="p">)</span>
        
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">S_V</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">PSV</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">),(</span><span class="s2">&quot;$S_V$&quot;</span><span class="p">,</span><span class="s2">&quot;Psuedo $S_V$&quot;</span><span class="p">,),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SV (m/s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Relative velocity&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">S_A</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">PSA</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">),(</span><span class="s2">&quot;$S_A$&quot;</span><span class="p">,</span><span class="s2">&quot;Psuedo $S_A$&quot;</span><span class="p">,),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SA (m/$s^2$)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Absolute acceleration&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">T_vals</span><span class="p">)])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Oscillator natural period T (secs)&quot;</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>
    
    <span class="c1"># Return values as dict</span>
    <span class="n">return_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;T_vals&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">T_vals</span>
    
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;S_D&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S_D</span>
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;S_V&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S_V</span>
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;S_A&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S_A</span>
    
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;PSV&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">PSV</span>
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;PSA&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">PSA</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;fig&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;fig&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
    
    <span class="k">return</span> <span class="n">return_dict</span>
    
<span class="k">def</span> <span class="nf">DesignResponseSpectrum_BSEN1998_1</span><span class="p">(</span><span class="n">T_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                      <span class="n">a_g</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
                                      <span class="n">S</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
                                      <span class="n">nu</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
                                      <span class="n">T_BCD</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">1.20</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns horizontal elastic design response spectrum as given by </span>
<span class="sd">    Cl. 3.2.2.2 of BS EN 1998-1:2004</span>
<span class="sd">    </span>
<span class="sd">    ![figure_3_1](../dynsys/img/design_response_spectrum_BSEN1998-1.png)</span>
<span class="sd">    ![equations](../dynsys/img/design_response_spectrum_BSEN1998-1_equations.png)</span>
<span class="sd">    </span>
<span class="sd">    Note response spectrum has units as given by `a_g` (units of &#39;g&#39; typically)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_BCD</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`T_BCD` expected to be list of length 3&quot;</span><span class="p">)</span>
        
    <span class="c1"># Unpack list items for salient periods</span>
    <span class="n">T_B</span> <span class="o">=</span> <span class="n">T_BCD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">T_C</span> <span class="o">=</span> <span class="n">T_BCD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">T_D</span> <span class="o">=</span> <span class="n">T_BCD</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">T_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
        <span class="c1"># Create default T_vals list to fully-illustrate key features</span>
        <span class="n">T_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T_B</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                    <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T_B</span><span class="p">,</span><span class="n">T_C</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                    <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T_C</span><span class="p">,</span><span class="n">T_D</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                    <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T_D</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">T_D</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>
    
    <span class="n">Se_vals</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">T_vals</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;T_vals to be &gt;0!&quot;</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="n">T_B</span><span class="p">:</span>
            <span class="n">Se</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">T_B</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nu</span><span class="o">*</span><span class="mf">2.5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="n">T_C</span><span class="p">:</span>
            <span class="n">Se</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="mf">2.5</span>
            
        <span class="k">elif</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="n">T_D</span><span class="p">:</span>
            <span class="n">Se</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_C</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Se</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_C</span><span class="o">*</span><span class="n">T_D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="n">Se</span> <span class="o">=</span> <span class="n">a_g</span> <span class="o">*</span> <span class="n">S</span> <span class="o">*</span> <span class="n">Se</span>
        <span class="n">Se_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Se</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">T_vals</span><span class="p">,</span> <span class="n">Se_vals</span>


<span class="k">def</span> <span class="nf">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">Seff</span><span class="p">,</span>
                                <span class="n">groupType</span><span class="o">=</span><span class="s2">&quot;pedestrian&quot;</span><span class="p">,</span>
                                <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine reduction factor gamma, </span>
<span class="sd">    per Figure NA.9, UK NA to BS EN 1991-2:2003</span>
<span class="sd">    </span>
<span class="sd">    Gamma factors allows for the unsynchronized combination of pedestrian </span>
<span class="sd">    actions within groups and crowds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Digitised data for Figure NA.9</span>
    <span class="n">delta_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.21</span><span class="p">,</span><span class="mf">0.02</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">Seff_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">]</span>
    
    <span class="n">gamma_vals</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.680</span><span class="p">,</span><span class="mf">0.435</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.245</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.135</span><span class="p">,</span><span class="mf">0.100</span><span class="p">,</span><span class="mf">0.062</span><span class="p">,</span><span class="mf">0.048</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.692</span><span class="p">,</span><span class="mf">0.462</span><span class="p">,</span><span class="mf">0.345</span><span class="p">,</span><span class="mf">0.283</span><span class="p">,</span><span class="mf">0.240</span><span class="p">,</span><span class="mf">0.180</span><span class="p">,</span><span class="mf">0.150</span><span class="p">,</span><span class="mf">0.117</span><span class="p">,</span><span class="mf">0.103</span><span class="p">,</span><span class="mf">0.093</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.705</span><span class="p">,</span><span class="mf">0.488</span><span class="p">,</span><span class="mf">0.380</span><span class="p">,</span><span class="mf">0.320</span><span class="p">,</span><span class="mf">0.280</span><span class="p">,</span><span class="mf">0.225</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.175</span><span class="p">,</span><span class="mf">0.163</span><span class="p">,</span><span class="mf">0.155</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.716</span><span class="p">,</span><span class="mf">0.512</span><span class="p">,</span><span class="mf">0.410</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.267</span><span class="p">,</span><span class="mf">0.248</span><span class="p">,</span><span class="mf">0.230</span><span class="p">,</span><span class="mf">0.218</span><span class="p">,</span><span class="mf">0.215</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.728</span><span class="p">,</span><span class="mf">0.535</span><span class="p">,</span><span class="mf">0.437</span><span class="p">,</span><span class="mf">0.382</span><span class="p">,</span><span class="mf">0.352</span><span class="p">,</span><span class="mf">0.310</span><span class="p">,</span><span class="mf">0.292</span><span class="p">,</span><span class="mf">0.277</span><span class="p">,</span><span class="mf">0.270</span><span class="p">,</span><span class="mf">0.268</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.738</span><span class="p">,</span><span class="mf">0.556</span><span class="p">,</span><span class="mf">0.465</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.385</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.335</span><span class="p">,</span><span class="mf">0.322</span><span class="p">,</span><span class="mf">0.320</span><span class="p">,</span><span class="mf">0.320</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.746</span><span class="p">,</span><span class="mf">0.577</span><span class="p">,</span><span class="mf">0.492</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.420</span><span class="p">,</span><span class="mf">0.390</span><span class="p">,</span><span class="mf">0.375</span><span class="p">,</span><span class="mf">0.367</span><span class="p">,</span><span class="mf">0.366</span><span class="p">,</span><span class="mf">0.366</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.755</span><span class="p">,</span><span class="mf">0.597</span><span class="p">,</span><span class="mf">0.518</span><span class="p">,</span><span class="mf">0.473</span><span class="p">,</span><span class="mf">0.451</span><span class="p">,</span><span class="mf">0.426</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.408</span><span class="p">,</span><span class="mf">0.408</span><span class="p">,</span><span class="mf">0.408</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.763</span><span class="p">,</span><span class="mf">0.614</span><span class="p">,</span><span class="mf">0.540</span><span class="p">,</span><span class="mf">0.503</span><span class="p">,</span><span class="mf">0.482</span><span class="p">,</span><span class="mf">0.460</span><span class="p">,</span><span class="mf">0.450</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.445</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.774</span><span class="p">,</span><span class="mf">0.632</span><span class="p">,</span><span class="mf">0.565</span><span class="p">,</span><span class="mf">0.530</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.496</span><span class="p">,</span><span class="mf">0.485</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.783</span><span class="p">,</span><span class="mf">0.645</span><span class="p">,</span><span class="mf">0.585</span><span class="p">,</span><span class="mf">0.555</span><span class="p">,</span><span class="mf">0.540</span><span class="p">,</span><span class="mf">0.530</span><span class="p">,</span><span class="mf">0.520</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.513</span><span class="p">]]</span>
    <span class="n">gamma_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_vals</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">gamma_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">Seff_vals</span><span class="p">,</span><span class="n">gamma_vals</span><span class="p">,</span>
                                            <span class="n">bounds_error</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Use interpolation function to read off value at inputs specified</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_func</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span>
    
    <span class="c1"># Make plot (to show digitised curves)</span>
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">Seff</span> <span class="ow">in</span> <span class="n">Seff_vals</span><span class="p">:</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">gamma_func</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">Seff</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">Seff</span><span class="p">))</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;$S_{eff}$ (m)&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span> <span class="c1"># per Fig.NA.9</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span> <span class="c1"># per Fig.NA.9</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Reduction factor $\gamma$</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;per Figure NA.9, UK NA to BS EN 1992-1:2003&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Log decrement damping&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\gamma$&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">gamma</span>
    
    
<span class="c1"># ********************** TEST ROUTINE ****************************************</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    
    <span class="n">testRoutine</span><span class="o">=</span><span class="mi">8</span>
    
    <span class="k">if</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        
        <span class="kn">import</span> <span class="nn">modalsys</span>
    
        <span class="n">modal_sys</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">ModalSys</span><span class="p">(</span><span class="n">isSparse</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">modal_sys</span><span class="o">.</span><span class="n">AddOutputMtrx</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="s2">&quot;outputs.csv&quot;</span><span class="p">)</span>
        
        <span class="k">def</span> <span class="nf">sine</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">5</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        
        <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">LoadTrain</span><span class="p">(</span><span class="n">loadX</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">loadVals</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span>
                                        <span class="n">intensityFunc</span><span class="o">=</span><span class="n">sine</span><span class="p">,</span>
                                        <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Sine test&quot;</span><span class="p">)</span>
        
        <span class="c1">#loading_obj = loading.LoadTrain()</span>
        
        <span class="n">ML_analysis</span> <span class="o">=</span> <span class="n">MovingLoadAnalysis</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">=</span><span class="n">modal_sys</span><span class="p">,</span>
                                         <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                                         <span class="n">loadVel</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                                         <span class="n">loadtrain_obj</span><span class="o">=</span><span class="n">loading_obj</span><span class="p">,</span>
                                         <span class="n">tEpilogue</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="n">ML_analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">ML_analysis</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
        
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        
        <span class="kn">import</span> <span class="nn">modalsys</span>
    
        <span class="n">modal_sys</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">ModalSys</span><span class="p">(</span><span class="n">isSparse</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">modal_sys</span><span class="o">.</span><span class="n">AddOutputMtrx</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="s2">&quot;outputs.csv&quot;</span><span class="p">)</span>
        
        <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">LoadTrain</span><span class="p">()</span>
        
        <span class="n">ML_analysis</span> <span class="o">=</span> <span class="n">MovingLoadAnalysis</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">=</span><span class="n">modal_sys</span><span class="p">,</span>
                                         <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                                         <span class="n">loadVel</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                                         <span class="n">loadtrain_obj</span><span class="o">=</span><span class="n">loading_obj</span><span class="p">,</span>
                                         <span class="n">tEpilogue</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
        <span class="n">ML_analysis</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        <span class="n">ML_analysis</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span><span class="mi">4</span><span class="p">])</span>
        
    
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        
        <span class="kn">import</span> <span class="nn">modalsys</span>
    
        <span class="n">modal_sys</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">ModalSys</span><span class="p">(</span><span class="n">isSparse</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">modal_sys</span><span class="o">.</span><span class="n">AddOutputMtrx</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="s2">&quot;outputs.csv&quot;</span><span class="p">)</span>
        
        <span class="n">rslts</span> <span class="o">=</span> <span class="n">run_multiple</span><span class="p">(</span><span class="s2">&quot;MovingLoadAnalysis&quot;</span><span class="p">,</span>
                             <span class="n">dynsys_obj</span><span class="o">=</span><span class="n">modal_sys</span><span class="p">,</span>
                             <span class="n">loadVel</span><span class="o">=</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">380</span><span class="p">,</span><span class="mi">390</span><span class="p">,</span><span class="mi">400</span><span class="p">])</span><span class="o">*</span><span class="mi">1000</span><span class="o">/</span><span class="mi">3600</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span>
                             <span class="n">loadtrain_fName</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;trainA2.csv&quot;</span><span class="p">,</span><span class="s2">&quot;trainA5.csv&quot;</span><span class="p">],</span>
                             <span class="n">dt</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
        
        <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">rslts</span><span class="p">]</span>
        
    
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">4</span><span class="p">:</span>    

        <span class="k">def</span> <span class="nf">test_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">0.02</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">2.0</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        
        <span class="n">results</span> <span class="o">=</span> <span class="n">ResponseSpectrum</span><span class="p">(</span><span class="n">test_func</span><span class="p">,</span>
                                   <span class="n">eta</span><span class="o">=</span><span class="mf">0.005</span><span class="p">,</span>
                                   <span class="n">T_vals</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.01</span><span class="p">,</span><span class="mf">8.0</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">80</span><span class="p">))</span>
        
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        
        <span class="n">T_vals</span><span class="p">,</span> <span class="n">Se_vals</span> <span class="o">=</span> <span class="n">DesignResponseSpectrum_BSEN1998_1</span><span class="p">()</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">Se_vals</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">6</span><span class="p">:</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="mf">0.045</span><span class="p">,</span><span class="mf">35.0</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="mf">0.100</span><span class="p">,</span><span class="mf">200.</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="mf">0.080</span><span class="p">,</span><span class="mf">400.</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span> <span class="c1"># out of bounds error expected</span>
           
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">7</span><span class="p">:</span>
        
        <span class="n">L</span> <span class="o">=</span> <span class="mf">50.0</span>
        
        <span class="k">def</span> <span class="nf">testFunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">L</span><span class="p">),</span>
                                <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">1.2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">L</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        
        <span class="n">Seff</span> <span class="o">=</span> <span class="n">Calc_Seff</span><span class="p">(</span><span class="n">testFunc</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">8</span><span class="p">:</span>
        
        <span class="n">b</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">])</span>
        <span class="n">phi1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">])</span>
        <span class="n">phi2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="o">-</span><span class="mf">1.0</span><span class="p">])</span>
        <span class="n">integral_area</span> <span class="o">=</span> <span class="n">CalcTransverseAreaIntegral</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">phi1</span><span class="p">,</span><span class="n">phi2</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="n">integral_area</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Test routine does not exist!&quot;</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="dyn_analysis.currentVersion" class="name">var <span class="ident">currentVersion</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="dyn_analysis.CalcTransverseAreaIntegral">
    <p>def <span class="ident">CalcTransverseAreaIntegral</span>(</p><p>b, phi1, phi2)</p>
    </div>
    

    
  
    <div class="desc"><p>Computes sign-corrected integral across domain of width <code>b</code>, given (signed) 
edge ordinates <code>phi1</code> and phi2`.</p>
<p>Linear variation of integrand within integration domain is assumed </p>
<p><img alt="derivation" src="../dynsys/img/sign_corrected_integral_derivation.PNG" /></p>
<p>Arrays of equal length can be supplied.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.CalcTransverseAreaIntegral', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.CalcTransverseAreaIntegral" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">CalcTransverseAreaIntegral</span><span class="p">(</span><span class="n">b</span><span class="p">,</span><span class="n">phi1</span><span class="p">,</span><span class="n">phi2</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes sign-corrected integral across domain of width `b`, given (signed) </span>
<span class="sd">    edge ordinates `phi1` and phi2`.</span>
<span class="sd">    </span>
<span class="sd">    Linear variation of integrand within integration domain is assumed </span>
<span class="sd">    </span>
<span class="sd">    ![derivation](../dynsys/img/sign_corrected_integral_derivation.PNG)</span>
<span class="sd">        </span>
<span class="sd">    Arrays of equal length can be supplied.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Change shapes agree</span>
    <span class="k">if</span> <span class="n">phi1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">phi2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shapes of `phi1` and `phi2` do not agree!&quot;</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">phi1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shapes of `phi1` and `b` do not agree!&quot;</span><span class="p">)</span>        
    
    <span class="c1"># Test to see if same signs</span>
    <span class="n">same_sign</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">phi1</span><span class="p">),</span><span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">phi2</span><span class="p">))</span>
    
    <span class="c1"># Obtain absolute values</span>
    <span class="n">phi1_abs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">phi1</span><span class="p">)</span>
    <span class="n">phi2_abs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">phi2</span><span class="p">)</span>
    
    <span class="c1"># Compute area integral on assumption of same sign</span>
    <span class="n">area_same_sign</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">phi1_abs</span><span class="o">+</span><span class="n">phi2_abs</span><span class="p">)</span>
    
    <span class="c1"># Compute area integral where different sign</span>
    <span class="n">area_different_sign</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">b</span><span class="o">*</span><span class="p">(</span><span class="n">phi1_abs</span><span class="o">**</span><span class="mi">2</span><span class="o">+</span><span class="n">phi2_abs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">phi1_abs</span><span class="o">+</span><span class="n">phi2_abs</span><span class="p">)</span>
    
    <span class="c1"># Select appropriate case</span>
    <span class="n">area_to_use</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">same_sign</span><span class="p">,</span><span class="n">area_same_sign</span><span class="p">,</span><span class="n">area_different_sign</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">area_to_use</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="dyn_analysis.Calc_Seff">
    <p>def <span class="ident">Calc_Seff</span>(</p><p>modeshapeFunc, S, dx=2.0, makePlot=True, verbose=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculates effective span, as defined by NA.2.44.4 and Figure NA.7 in 
BS EN 1991-2</p>
<p><img alt="Figure_NA_7" src="../dynsys/img/UKNA_BSEN1991_2_FigNA7.PNG" /></p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>modeshapeFunc</code>, <em>function</em> defining variation of modeshapes with 
  chainage. In general, for systems with multiple modes, <code>modeshapeFunc</code> to 
  return <em>array</em>.</p>
</li>
<li>
<p><code>S</code>, length of structure. Integration of modeshapes to compute 
  <em>effective span</em> is carried out in the interval <em>[0, S]</em>.</p>
</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li><code>dx</code>, distance increment used by <code>scipy.integrate.cumtrapz()</code></li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Calc_Seff', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Calc_Seff" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">Calc_Seff</span><span class="p">(</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="p">,</span>
              <span class="n">dx</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
              <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates effective span, as defined by NA.2.44.4 and Figure NA.7 in </span>
<span class="sd">    BS EN 1991-2</span>
<span class="sd">    </span>
<span class="sd">    ![Figure_NA_7](../dynsys/img/UKNA_BSEN1991_2_FigNA7.PNG)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `modeshapeFunc`, _function_ defining variation of modeshapes with </span>
<span class="sd">      chainage. In general, for systems with multiple modes, `modeshapeFunc` to </span>
<span class="sd">      return _array_.</span>
<span class="sd">      </span>
<span class="sd">    * `S`, length of structure. Integration of modeshapes to compute </span>
<span class="sd">      _effective span_ is carried out in the interval _[0, S]_.</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">      </span>
<span class="sd">    * `dx`, distance increment used by `scipy.integrate.cumtrapz()`</span>
<span class="sd">      </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Note absolute value integral to be computed</span>
    <span class="k">def</span> <span class="nf">abs_modeshapeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">modeshapeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
    <span class="c1"># Evaluate modeshapes at specified chainages</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">modeshapeFunc</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
    <span class="n">y_abs_vals</span> <span class="o">=</span> <span class="n">abs_modeshapeFunc</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
    
    <span class="c1"># Integrate using Scipy routine</span>
    <span class="n">y_integral_vals</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">x_vals</span><span class="p">,</span>
                                               <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">y_integral</span> <span class="o">=</span> <span class="n">y_integral_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">,:]</span>
    
    <span class="c1"># Get maxima</span>
    <span class="n">y_absmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_absmax_overall</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_absmax</span><span class="p">)</span>
    
    <span class="c1"># Compute Seff</span>
    <span class="n">Seff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">y_integral</span><span class="p">,</span> <span class="mf">0.634</span><span class="o">*</span><span class="n">y_absmax</span><span class="p">)</span>
    
    <span class="c1"># Compute lambda per eqn in Figure NA.7</span>
    <span class="n">lambda_vals</span> <span class="o">=</span> <span class="mf">0.634</span> <span class="o">*</span> <span class="n">Seff</span> <span class="o">/</span> <span class="n">S</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysing modeshape functions to determine Seff...&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;S (m):</span><span class="se">\t\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Seff</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Max modeshapes:</span><span class="se">\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_absmax</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Calculation of $S_{eff}$ (m)&quot;</span><span class="p">)</span>
        
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="n">handles</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_vals</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Modeshapes, $\phi(x)$&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="n">y_absmax_overall</span><span class="p">,</span><span class="n">y_absmax_overall</span><span class="p">])</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_abs_vals</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$|\phi|(x)$&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">y_absmax_overall</span><span class="p">])</span>
        
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_integral_vals</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">])</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Chainage (m)&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\int_{0}^{x}|\phi|(x).dx$&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_integral</span><span class="p">,</span><span class="n">handles</span><span class="p">):</span>
        
            <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="n">S</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">handle</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            
            <span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">val</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="dyn_analysis.DesignResponseSpectrum_BSEN1998_1">
    <p>def <span class="ident">DesignResponseSpectrum_BSEN1998_1</span>(</p><p>T_vals=None, a_g=0.02, S=1.0, nu=1.0, T_BCD=[0.05, 0.25, 1.2])</p>
    </div>
    

    
  
    <div class="desc"><p>Returns horizontal elastic design response spectrum as given by 
Cl. 3.2.2.2 of BS EN 1998-1:2004</p>
<p><img alt="figure_3_1" src="../dynsys/img/design_response_spectrum_BSEN1998-1.png" />
<img alt="equations" src="../dynsys/img/design_response_spectrum_BSEN1998-1_equations.png" /></p>
<p>Note response spectrum has units as given by <code>a_g</code> (units of 'g' typically)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.DesignResponseSpectrum_BSEN1998_1', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.DesignResponseSpectrum_BSEN1998_1" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">DesignResponseSpectrum_BSEN1998_1</span><span class="p">(</span><span class="n">T_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                      <span class="n">a_g</span><span class="o">=</span><span class="mf">0.02</span><span class="p">,</span>
                                      <span class="n">S</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
                                      <span class="n">nu</span><span class="o">=</span><span class="mf">1.00</span><span class="p">,</span>
                                      <span class="n">T_BCD</span><span class="o">=</span><span class="p">[</span><span class="mf">0.05</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">1.20</span><span class="p">]):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns horizontal elastic design response spectrum as given by </span>
<span class="sd">    Cl. 3.2.2.2 of BS EN 1998-1:2004</span>
<span class="sd">    </span>
<span class="sd">    ![figure_3_1](../dynsys/img/design_response_spectrum_BSEN1998-1.png)</span>
<span class="sd">    ![equations](../dynsys/img/design_response_spectrum_BSEN1998-1_equations.png)</span>
<span class="sd">    </span>
<span class="sd">    Note response spectrum has units as given by `a_g` (units of &#39;g&#39; typically)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_BCD</span><span class="p">)</span><span class="o">!=</span><span class="mi">3</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`T_BCD` expected to be list of length 3&quot;</span><span class="p">)</span>
        
    <span class="c1"># Unpack list items for salient periods</span>
    <span class="n">T_B</span> <span class="o">=</span> <span class="n">T_BCD</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">T_C</span> <span class="o">=</span> <span class="n">T_BCD</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">T_D</span> <span class="o">=</span> <span class="n">T_BCD</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">T_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
        <span class="c1"># Create default T_vals list to fully-illustrate key features</span>
        <span class="n">T_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T_B</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                    <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T_B</span><span class="p">,</span><span class="n">T_C</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                    <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T_C</span><span class="p">,</span><span class="n">T_D</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">),</span>
                                    <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">T_D</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">T_D</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)))</span>
    
    <span class="n">Se_vals</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="n">T_vals</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;T_vals to be &gt;0!&quot;</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="n">T_B</span><span class="p">:</span>
            <span class="n">Se</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">T</span> <span class="o">/</span> <span class="n">T_B</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">nu</span><span class="o">*</span><span class="mf">2.5</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
        
        <span class="k">elif</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="n">T_C</span><span class="p">:</span>
            <span class="n">Se</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="mf">2.5</span>
            
        <span class="k">elif</span> <span class="n">T</span> <span class="o">&lt;</span> <span class="n">T_D</span><span class="p">:</span>
            <span class="n">Se</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_C</span> <span class="o">/</span> <span class="n">T</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Se</span> <span class="o">=</span> <span class="n">nu</span> <span class="o">*</span> <span class="mf">2.5</span> <span class="o">*</span> <span class="p">(</span><span class="n">T_C</span><span class="o">*</span><span class="n">T_D</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">T</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
            
        <span class="n">Se</span> <span class="o">=</span> <span class="n">a_g</span> <span class="o">*</span> <span class="n">S</span> <span class="o">*</span> <span class="n">Se</span>
        <span class="n">Se_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Se</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">T_vals</span><span class="p">,</span> <span class="n">Se_vals</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="dyn_analysis.ResponseSpectrum">
    <p>def <span class="ident">ResponseSpectrum</span>(</p><p>accFunc, tResponse, T_vals=None, eta=0.05, makePlot=True, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to express ground acceleration time series as a seismic response 
spectrum</p>
<hr />
<p><em>Seismic response spectra</em> are used to summarises the vibration response 
of a SDOF oscillator in response to a transient ground acceleration 
time series. Seismic response spectra therefore represent a useful way of 
quantifying and graphically illustrating the severity of a given 
ground acceleration time series.</p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>accFunc</code>, function a(t) defining the ground acceleration time series 
  (usually this is most convenient to supply via an interpolation function)</p>
</li>
<li>
<p><code>tResponse</code>, time interval over which to carry out time-stepping analysis.
  Set this to be at least the duration of the input acceleration time 
  series!</p>
</li>
</ul>
<p><strong>Important note</strong>:</p>
<p>This routine expects a(t) to have units of m/s<sup>2</sup>. 
It is common (at least in the field of seismic analysis) to quote ground 
accelerations in terms of 'g'.</p>
<p>Any such time series must be pre-processed by multiplying by 
g=9.81m/s<sup>2</sup>) prior to using this function, such that the 
supplied <code>accFunc</code> returns ground acceleration in m/s<sup>2</sup>.</p>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>T_vals</code>, <em>list</em>, periods (in seconds) at which response spectra
  are to be evaluated. If <em>None</em> will be set to logarithmically span the range 
  [0.01,10.0] seconds, which is suitable for most applications.</p>
</li>
<li>
<p><code>eta</code>, damping ratio to which response spectrum obtained is applicable. 
  5% is used by default, as this a common default in seismic design.</p>
</li>
<li>
<p><code>makePlot</code>, <em>boolean</em>, controls whether results are plotted</p>
</li>
</ul>
<p><code>kwargs</code> may be used to pass additional arguments down to <code>TStep</code> object 
 that is used to implement time-stepping analysis. Refer <code>tstep</code> docs for 
 further details</p>
<hr />
<p>Returns:</p>
<p>Values are returned as a dictionary, containing the following entries:</p>
<ul>
<li><code>T_vals</code>, periods at which spectra are evaluated.</li>
<li><code>S_D</code>, relative displacement spectrum (in m)</li>
<li><code>S_V</code>, relative velocity spectrum (in m/s)</li>
<li><code>S_A</code>, absolute acceleration spectrum (in m/s<sup>2</sup>)</li>
<li><code>PSV</code>, psuedo-velocity spectrum (in m/s)</li>
<li><code>PSA</code>, psuedo-acceleration spectrum (in m/s<sup>2</sup>)</li>
</ul>
<p>In addition, if <code>makePlot=True</code>:</p>
<ul>
<li><code>fig</code>, figure object for plot</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.ResponseSpectrum', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.ResponseSpectrum" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">ResponseSpectrum</span><span class="p">(</span><span class="n">accFunc</span><span class="p">,</span>
                     <span class="n">tResponse</span><span class="p">,</span>
                     <span class="n">T_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">eta</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
                     <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to express ground acceleration time series as a seismic response </span>
<span class="sd">    spectrum</span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    _Seismic response spectra_ are used to summarises the vibration response </span>
<span class="sd">    of a SDOF oscillator in response to a transient ground acceleration </span>
<span class="sd">    time series. Seismic response spectra therefore represent a useful way of </span>
<span class="sd">    quantifying and graphically illustrating the severity of a given </span>
<span class="sd">    ground acceleration time series.</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">    </span>
<span class="sd">    * `accFunc`, function a(t) defining the ground acceleration time series </span>
<span class="sd">      (usually this is most convenient to supply via an interpolation function)</span>
<span class="sd">      </span>
<span class="sd">    * `tResponse`, time interval over which to carry out time-stepping analysis.</span>
<span class="sd">      Set this to be at least the duration of the input acceleration time </span>
<span class="sd">      series!</span>
<span class="sd">      </span>
<span class="sd">    **Important note**:</span>
<span class="sd">        </span>
<span class="sd">    This routine expects a(t) to have units of m/s&lt;sup&gt;2&lt;/sup&gt;. </span>
<span class="sd">    It is common (at least in the field of seismic analysis) to quote ground </span>
<span class="sd">    accelerations in terms of &#39;g&#39;.</span>
<span class="sd">    </span>
<span class="sd">    Any such time series must be pre-processed by multiplying by </span>
<span class="sd">    g=9.81m/s&lt;sup&gt;2&lt;/sup&gt;) prior to using this function, such that the </span>
<span class="sd">    supplied `accFunc` returns ground acceleration in m/s&lt;sup&gt;2&lt;/sup&gt;.</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `T_vals`, _list_, periods (in seconds) at which response spectra</span>
<span class="sd">      are to be evaluated. If _None_ will be set to logarithmically span the range </span>
<span class="sd">      [0.01,10.0] seconds, which is suitable for most applications.</span>
<span class="sd">        </span>
<span class="sd">    * `eta`, damping ratio to which response spectrum obtained is applicable. </span>
<span class="sd">      5% is used by default, as this a common default in seismic design.</span>
<span class="sd">      </span>
<span class="sd">     * `makePlot`, _boolean_, controls whether results are plotted</span>
<span class="sd">      </span>
<span class="sd">     `kwargs` may be used to pass additional arguments down to `TStep` object </span>
<span class="sd">     that is used to implement time-stepping analysis. Refer `tstep` docs for </span>
<span class="sd">     further details</span>
<span class="sd">     </span>
<span class="sd">    ***</span>
<span class="sd">    Returns:</span>
<span class="sd">        </span>
<span class="sd">    Values are returned as a dictionary, containing the following entries:</span>
<span class="sd">        </span>
<span class="sd">    * `T_vals`, periods at which spectra are evaluated.</span>
<span class="sd">    * `S_D`, relative displacement spectrum (in m)</span>
<span class="sd">    * `S_V`, relative velocity spectrum (in m/s)</span>
<span class="sd">    * `S_A`, absolute acceleration spectrum (in m/s&lt;sup&gt;2&lt;/sup&gt;)</span>
<span class="sd">    * `PSV`, psuedo-velocity spectrum (in m/s)</span>
<span class="sd">    * `PSA`, psuedo-acceleration spectrum (in m/s&lt;sup&gt;2&lt;/sup&gt;)</span>
<span class="sd">    </span>
<span class="sd">    In addition, if `makePlot=True`:</span>
<span class="sd">        </span>
<span class="sd">    * `fig`, figure object for plot</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Handle optional inputs</span>
    <span class="k">if</span> <span class="n">T_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">T_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        
    <span class="n">T_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">T_vals</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="c1"># Print summary of key inputs</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">accFunc</span><span class="p">,</span><span class="s2">&quot;__name__&quot;</span><span class="p">):</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Ground motion function supplied: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">accFunc</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Time-stepping analysis interval: [</span><span class="si">%.2f</span><span class="s2">, </span><span class="si">%.2f</span><span class="s2">]&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tResponse</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Number of SDOF oscillators to be analysed: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">T_vals</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damping ratio for SDOF oscillators: {:.2%}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span>
    
    <span class="c1"># Loop through all periods</span>
    <span class="n">M</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># unit mass for all oscillators</span>
    <span class="n">results_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Obtaining SDOF responses to ground acceleration...&quot;</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">_T</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">T_vals</span><span class="p">):</span>

        <span class="n">period_str</span> <span class="o">=</span> <span class="s2">&quot;Period </span><span class="si">%.2f</span><span class="s2">s&quot;</span> <span class="o">%</span> <span class="n">_T</span>
        
        <span class="c1"># Define SDOF oscillator</span>
        <span class="n">SDOF_sys</span> <span class="o">=</span> <span class="n">msd_chain</span><span class="o">.</span><span class="n">MSD_Chain</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="n">period_str</span><span class="p">,</span>
                                       <span class="n">M_vals</span> <span class="o">=</span> <span class="n">M</span><span class="p">,</span>
                                       <span class="n">f_vals</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">_T</span><span class="p">,</span>
                                       <span class="n">eta_vals</span> <span class="o">=</span> <span class="n">eta</span><span class="p">,</span>
                                       <span class="n">showMsgs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Add output matrix to extract results</span>
        <span class="n">SDOF_sys</span><span class="o">.</span><span class="n">AddOutputMtrx</span><span class="p">(</span><span class="n">output_mtrx</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">identity</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span>
                               <span class="n">output_names</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;RelDisp&quot;</span><span class="p">,</span><span class="s2">&quot;RelVel&quot;</span><span class="p">,</span><span class="s2">&quot;Acc&quot;</span><span class="p">])</span>
        
        <span class="c1"># Define forcing function</span>
        <span class="k">def</span> <span class="nf">forceFunc</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="n">M</span><span class="o">*</span><span class="n">accFunc</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
        
        <span class="c1"># Define time-stepping analysis</span>
        <span class="n">tstep_obj</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">SDOF_sys</span><span class="p">,</span>
                                <span class="n">tStart</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">tEnd</span><span class="o">=</span><span class="n">tResponse</span><span class="p">,</span>
                                <span class="n">force_func</span><span class="o">=</span><span class="n">forceFunc</span><span class="p">,</span>
                                <span class="n">retainResponseTimeSeries</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Run time-stepping analysis and append results</span>
        <span class="n">results_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">showMsgs</span><span class="o">=</span><span class="bp">False</span><span class="p">))</span>
        
        <span class="c1"># Obtain absolute acceleration by adding back in ground motion</span>
        <span class="n">results_obj</span> <span class="o">=</span> <span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span>
        <span class="n">results_obj</span><span class="o">.</span><span class="n">responses</span><span class="p">[</span><span class="mi">2</span><span class="p">,:]</span> <span class="o">+=</span> <span class="n">accFunc</span><span class="p">(</span><span class="n">results_obj</span><span class="o">.</span><span class="n">t</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
        
        <span class="c1"># Recalculate statistics</span>
        <span class="n">results_obj</span><span class="o">.</span><span class="n">CalcResponseStats</span><span class="p">(</span><span class="n">showMsgs</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Tidy up</span>
        <span class="k">del</span> <span class="n">SDOF_sys</span>
    
    <span class="c1"># Collate absmax statistics</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Retrieving maximum response statistics...&quot;</span><span class="p">)</span>
    <span class="n">S_D</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">response_stats</span><span class="p">[</span><span class="s1">&#39;absmax&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_list</span><span class="p">])</span>
    <span class="n">S_V</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">response_stats</span><span class="p">[</span><span class="s1">&#39;absmax&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_list</span><span class="p">])</span>
    <span class="n">S_A</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">response_stats</span><span class="p">[</span><span class="s1">&#39;absmax&#39;</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">results_list</span><span class="p">])</span>
    
    <span class="c1"># Evaluate psuedo-specta</span>
    <span class="n">omega</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span><span class="n">T_vals</span><span class="p">)</span>
    <span class="n">PSV</span> <span class="o">=</span> <span class="n">omega</span> <span class="o">*</span> <span class="n">S_D</span>
    <span class="n">PSA</span> <span class="o">=</span> <span class="n">omega</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="n">S_D</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Response spectra: {:.0%} damping&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">eta</span><span class="p">))</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">S_D</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SD (m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Relative displacement&quot;</span><span class="p">)</span>
        
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">S_V</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">PSV</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">),(</span><span class="s2">&quot;$S_V$&quot;</span><span class="p">,</span><span class="s2">&quot;Psuedo $S_V$&quot;</span><span class="p">,),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SV (m/s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Relative velocity&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">S_A</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">T_vals</span><span class="p">,</span><span class="n">PSA</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">((</span><span class="n">ax</span><span class="o">.</span><span class="n">lines</span><span class="p">),(</span><span class="s2">&quot;$S_A$&quot;</span><span class="p">,</span><span class="s2">&quot;Psuedo $S_A$&quot;</span><span class="p">,),</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;SA (m/$s^2$)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Absolute acceleration&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">T_vals</span><span class="p">)])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Oscillator natural period T (secs)&quot;</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.90</span><span class="p">)</span>
    
    <span class="c1"># Return values as dict</span>
    <span class="n">return_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;T_vals&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">T_vals</span>
    
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;S_D&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S_D</span>
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;S_V&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S_V</span>
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;S_A&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S_A</span>
    
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;PSV&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">PSV</span>
    <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;PSA&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">PSA</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;fig&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">fig</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;fig&quot;</span><span class="p">]</span><span class="o">=</span><span class="bp">None</span>
    
    <span class="k">return</span> <span class="n">return_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="dyn_analysis.UKNA_BSEN1991_2_Figure_NA_9">
    <p>def <span class="ident">UKNA_BSEN1991_2_Figure_NA_9</span>(</p><p>logDec, Seff, groupType=&#39;pedestrian&#39;, makePlot=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Determine reduction factor gamma, 
per Figure NA.9, UK NA to BS EN 1991-2:2003</p>
<p>Gamma factors allows for the unsynchronized combination of pedestrian 
actions within groups and crowds.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.UKNA_BSEN1991_2_Figure_NA_9', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.UKNA_BSEN1991_2_Figure_NA_9" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">Seff</span><span class="p">,</span>
                                <span class="n">groupType</span><span class="o">=</span><span class="s2">&quot;pedestrian&quot;</span><span class="p">,</span>
                                <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine reduction factor gamma, </span>
<span class="sd">    per Figure NA.9, UK NA to BS EN 1991-2:2003</span>
<span class="sd">    </span>
<span class="sd">    Gamma factors allows for the unsynchronized combination of pedestrian </span>
<span class="sd">    actions within groups and crowds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Digitised data for Figure NA.9</span>
    <span class="n">delta_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.21</span><span class="p">,</span><span class="mf">0.02</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    <span class="n">Seff_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">]</span>
    
    <span class="n">gamma_vals</span><span class="o">=</span><span class="p">[[</span><span class="mf">0.680</span><span class="p">,</span><span class="mf">0.435</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.245</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.135</span><span class="p">,</span><span class="mf">0.100</span><span class="p">,</span><span class="mf">0.062</span><span class="p">,</span><span class="mf">0.048</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.692</span><span class="p">,</span><span class="mf">0.462</span><span class="p">,</span><span class="mf">0.345</span><span class="p">,</span><span class="mf">0.283</span><span class="p">,</span><span class="mf">0.240</span><span class="p">,</span><span class="mf">0.180</span><span class="p">,</span><span class="mf">0.150</span><span class="p">,</span><span class="mf">0.117</span><span class="p">,</span><span class="mf">0.103</span><span class="p">,</span><span class="mf">0.093</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.705</span><span class="p">,</span><span class="mf">0.488</span><span class="p">,</span><span class="mf">0.380</span><span class="p">,</span><span class="mf">0.320</span><span class="p">,</span><span class="mf">0.280</span><span class="p">,</span><span class="mf">0.225</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.175</span><span class="p">,</span><span class="mf">0.163</span><span class="p">,</span><span class="mf">0.155</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.716</span><span class="p">,</span><span class="mf">0.512</span><span class="p">,</span><span class="mf">0.410</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.267</span><span class="p">,</span><span class="mf">0.248</span><span class="p">,</span><span class="mf">0.230</span><span class="p">,</span><span class="mf">0.218</span><span class="p">,</span><span class="mf">0.215</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.728</span><span class="p">,</span><span class="mf">0.535</span><span class="p">,</span><span class="mf">0.437</span><span class="p">,</span><span class="mf">0.382</span><span class="p">,</span><span class="mf">0.352</span><span class="p">,</span><span class="mf">0.310</span><span class="p">,</span><span class="mf">0.292</span><span class="p">,</span><span class="mf">0.277</span><span class="p">,</span><span class="mf">0.270</span><span class="p">,</span><span class="mf">0.268</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.738</span><span class="p">,</span><span class="mf">0.556</span><span class="p">,</span><span class="mf">0.465</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.385</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.335</span><span class="p">,</span><span class="mf">0.322</span><span class="p">,</span><span class="mf">0.320</span><span class="p">,</span><span class="mf">0.320</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.746</span><span class="p">,</span><span class="mf">0.577</span><span class="p">,</span><span class="mf">0.492</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.420</span><span class="p">,</span><span class="mf">0.390</span><span class="p">,</span><span class="mf">0.375</span><span class="p">,</span><span class="mf">0.367</span><span class="p">,</span><span class="mf">0.366</span><span class="p">,</span><span class="mf">0.366</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.755</span><span class="p">,</span><span class="mf">0.597</span><span class="p">,</span><span class="mf">0.518</span><span class="p">,</span><span class="mf">0.473</span><span class="p">,</span><span class="mf">0.451</span><span class="p">,</span><span class="mf">0.426</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.408</span><span class="p">,</span><span class="mf">0.408</span><span class="p">,</span><span class="mf">0.408</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.763</span><span class="p">,</span><span class="mf">0.614</span><span class="p">,</span><span class="mf">0.540</span><span class="p">,</span><span class="mf">0.503</span><span class="p">,</span><span class="mf">0.482</span><span class="p">,</span><span class="mf">0.460</span><span class="p">,</span><span class="mf">0.450</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.445</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.774</span><span class="p">,</span><span class="mf">0.632</span><span class="p">,</span><span class="mf">0.565</span><span class="p">,</span><span class="mf">0.530</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.496</span><span class="p">,</span><span class="mf">0.485</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],</span>
                <span class="p">[</span><span class="mf">0.783</span><span class="p">,</span><span class="mf">0.645</span><span class="p">,</span><span class="mf">0.585</span><span class="p">,</span><span class="mf">0.555</span><span class="p">,</span><span class="mf">0.540</span><span class="p">,</span><span class="mf">0.530</span><span class="p">,</span><span class="mf">0.520</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.513</span><span class="p">]]</span>
    <span class="n">gamma_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_vals</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

    <span class="n">gamma_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">Seff_vals</span><span class="p">,</span><span class="n">gamma_vals</span><span class="p">,</span>
                                            <span class="n">bounds_error</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Use interpolation function to read off value at inputs specified</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_func</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span>
    
    <span class="c1"># Make plot (to show digitised curves)</span>
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="k">for</span> <span class="n">Seff</span> <span class="ow">in</span> <span class="n">Seff_vals</span><span class="p">:</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">gamma_func</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">Seff</span><span class="p">),</span><span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">Seff</span><span class="p">))</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;$S_{eff}$ (m)&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span> <span class="c1"># per Fig.NA.9</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span> <span class="c1"># per Fig.NA.9</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Reduction factor $\gamma$</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;per Figure NA.9, UK NA to BS EN 1992-1:2003&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Log decrement damping&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\gamma$&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">gamma</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="dyn_analysis.load">
    <p>def <span class="ident">load</span>(</p><p>fName)</p>
    </div>
    

    
  
    <div class="desc"><p>De-serialises <code>Dyn_Analysis</code> object from pickle fill</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.load', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.load" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">load</span><span class="p">(</span><span class="n">fName</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    De-serialises `Dyn_Analysis` object from pickle fill</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">fName</span><span class="p">,</span><span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fobj</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Loading serialised `tstep_results` object from `{0}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">))</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">dill</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fobj</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;De-serialisation successful!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">obj</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="dyn_analysis.Dyn_Analysis" class="name">class <span class="ident">Dyn_Analysis</span></p>
      
  
    <div class="desc"><p>Base class for dynamic analysis implementations</p>
<p><em>Inheritance expected</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Dyn_Analysis', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Dyn_Analysis" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Dyn_Analysis</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Base class for dynamic analysis implementations</span>
<span class="sd">    </span>
<span class="sd">    _Inheritance expected_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">dynsys_obj</span><span class="p">,</span><span class="n">loading_obj</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        _All derived classes are expected to run this function_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        String identifier for object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span> <span class="o">=</span> <span class="n">dynsys_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dynamic system to which analysis relates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span> <span class="o">=</span> <span class="n">loading_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Object defining applied loading</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs dynamic analysis</span>
<span class="sd">        </span>
<span class="sd">        _Inheritance expected_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">pass</span>
    
    <span class="k">def</span> <span class="nf">_pickle_fName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines default filename for pickle files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="n">fName</span> <span class="o">=</span> <span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">fName</span> <span class="o">+=</span> <span class="s2">&quot;{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                
            <span class="n">fName</span> <span class="o">+=</span> <span class="s2">&quot;.pkl&quot;</span> 
                
        <span class="k">return</span> <span class="n">fName</span>
    
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialises object to file `fName`</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
            <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
            
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#dyn_analysis.Dyn_Analysis">Dyn_Analysis</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="dyn_analysis.Dyn_Analysis.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, name, dynsys_obj, loading_obj)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<p><em>All derived classes are expected to run this function</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Dyn_Analysis.__init__', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Dyn_Analysis.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">dynsys_obj</span><span class="p">,</span><span class="n">loading_obj</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    </span>
<span class="sd">    _All derived classes are expected to run this function_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    String identifier for object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span> <span class="o">=</span> <span class="n">dynsys_obj</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dynamic system to which analysis relates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span> <span class="o">=</span> <span class="n">loading_obj</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Object defining applied loading</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.Dyn_Analysis.run">
    <p>def <span class="ident">run</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Runs dynamic analysis</p>
<p><em>Inheritance expected</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Dyn_Analysis.run', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Dyn_Analysis.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs dynamic analysis</span>
<span class="sd">    </span>
<span class="sd">    _Inheritance expected_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">pass</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.Dyn_Analysis.save">
    <p>def <span class="ident">save</span>(</p><p>self, fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Serialises object to file <code>fName</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Dyn_Analysis.save', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Dyn_Analysis.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialises object to file `fName`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="dyn_analysis.Dyn_Analysis.dynsys_obj" class="name">var <span class="ident">dynsys_obj</span></p>
            

            
  
    <div class="desc"><p>Dynamic system to which analysis relates</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.Dyn_Analysis.loading_obj" class="name">var <span class="ident">loading_obj</span></p>
            

            
  
    <div class="desc"><p>Object defining applied loading</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.Dyn_Analysis.name" class="name">var <span class="ident">name</span></p>
            

            
  
    <div class="desc"><p>String identifier for object</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="dyn_analysis.MovingLoadAnalysis" class="name">class <span class="ident">MovingLoadAnalysis</span></p>
      
  
    <div class="desc"><p>Class to implement moving load analysis</p>
<hr />
<p><em>Moving load analysis</em> involves the determining the response of the system 
to groups of point loads moving in a pre-defined manner along a defined 
track.</p>
<p><em>Moving loads</em> include, but are not limited to:</p>
<ul>
<li>
<p>Train axles, which are usually at pre-defined spacings</p>
</li>
<li>
<p>Vehicle axles</p>
</li>
<li>
<p>Forces to represent the actions of walkers/joggers per UK NA to 
    BS EN 1991-2</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.MovingLoadAnalysis', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.MovingLoadAnalysis" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">MovingLoadAnalysis</span><span class="p">(</span><span class="n">Dyn_Analysis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to implement moving load analysis</span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    _Moving load analysis_ involves the determining the response of the system </span>
<span class="sd">    to groups of point loads moving in a pre-defined manner along a defined </span>
<span class="sd">    track.</span>
<span class="sd">    </span>
<span class="sd">    _Moving loads_ include, but are not limited to:</span>
<span class="sd">    </span>
<span class="sd">    *   Train axles, which are usually at pre-defined spacings</span>
<span class="sd">    </span>
<span class="sd">    *   Vehicle axles</span>
<span class="sd">    </span>
<span class="sd">    *   Forces to represent the actions of walkers/joggers per UK NA to </span>
<span class="sd">        BS EN 1991-2</span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">loadtrain_obj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">loadtrain_fName</span><span class="o">=</span><span class="s2">&quot;loadDefs.csv&quot;</span><span class="p">,</span>
                 <span class="n">loadVel</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
                 <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">tEpilogue</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
                 <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">dt_loads</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
                 <span class="n">max_dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">retainDOFTimeSeries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">retainResponseTimeSeries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">writeResults2File</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">results_fName</span><span class="o">=</span><span class="s2">&quot;results.csv&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">        </span>
<span class="sd">        **Important note:** `modalsys_obj` must be a modal system, as the </span>
<span class="sd">        action of the moving loads is determined by obtaining the </span>
<span class="sd">        mode-generalised force functions for each mode. _This is checked_.</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `loadtrain_obj`, load train object defining load pattern. If _None_ </span>
<span class="sd">          then `loadtrain_fName` must be provided (see below)</span>
<span class="sd">          </span>
<span class="sd">        * `loadtrain_fName&quot;, file containing load train definition</span>
<span class="sd">            </span>
<span class="sd">        * `loadVel`, constant velocity of load pattern (m/s)</span>
<span class="sd">        </span>
<span class="sd">        * `loadDefs_fName`, file containing load definitions</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Handle None for loadtrain_obj</span>
        <span class="k">if</span> <span class="n">loadtrain_obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">loadtrain_obj</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">LoadTrain</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">loadtrain_fName</span><span class="p">)</span>
        
        <span class="c1"># Check class name of modalsys_obj</span>
        <span class="k">if</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;ModalSys&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modalsys_obj`: instance of `ModalSys` class expected!&quot;</span><span class="p">)</span>
            
        <span class="c1"># Check class name of base class of loadtrain_obj</span>
        <span class="k">if</span> <span class="n">loadtrain_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;LoadTrain&quot;</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`loadtrain_obj`: instance of `LoadTrain` class &quot;</span><span class="o">+</span>
                             <span class="s2">&quot;(or dervied classes) expected!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Run parent init</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">loadtrain_obj</span><span class="p">)</span>
        
        <span class="c1"># Save details as attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">loadVel</span> <span class="o">=</span> <span class="n">loadVel</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Velocity of load pattern along track</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define time-stepping analysis</span>
        
        <span class="n">tStart</span><span class="p">,</span> <span class="n">tEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CalcSimDuration</span><span class="p">(</span><span class="n">loadVel</span><span class="o">=</span><span class="n">loadVel</span><span class="p">,</span>
                                             <span class="n">tEpilogue</span><span class="o">=</span><span class="n">tEpilogue</span><span class="p">)</span>
        
        <span class="c1"># Define force function for parent system and subsystems</span>
        <span class="n">modalForces_func</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcModalForces</span><span class="p">(</span><span class="n">loading_obj</span><span class="o">=</span><span class="n">loadtrain_obj</span><span class="p">,</span>
                                                        <span class="n">loadVel</span><span class="o">=</span><span class="n">loadVel</span><span class="p">,</span>
                                                        <span class="n">dt</span><span class="o">=</span><span class="n">dt_loads</span><span class="p">,</span>
                                                        <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="n">use_abs_modeshape</span><span class="p">)</span>
        
        <span class="n">force_func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">modalsys_obj</span> <span class="p">:</span> <span class="n">modalForces_func</span><span class="p">}</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                     <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                     <span class="n">tStart</span><span class="o">=</span><span class="n">tStart</span><span class="p">,</span>
                                     <span class="n">tEnd</span><span class="o">=</span><span class="n">tEnd</span><span class="p">,</span>
                                     <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                                     <span class="n">max_dt</span><span class="o">=</span><span class="n">max_dt</span><span class="p">,</span>
                                     <span class="n">force_func_dict</span><span class="o">=</span><span class="n">force_func_dict</span><span class="p">,</span>
                                     <span class="n">retainDOFTimeSeries</span><span class="o">=</span><span class="n">retainDOFTimeSeries</span><span class="p">,</span>
                                     <span class="n">retainResponseTimeSeries</span><span class="o">=</span><span class="n">retainResponseTimeSeries</span><span class="p">,</span>
                                     <span class="n">writeResults2File</span><span class="o">=</span><span class="n">writeResults2File</span><span class="p">,</span>
                                     <span class="n">results_fName</span><span class="o">=</span><span class="n">results_fName</span>
                                     <span class="p">)</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Time-stepping solver object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">results_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Results object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">save_fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs moving load analysis, using `tstep.run()`</span>
<span class="sd">        </span>
<span class="sd">        _Refer documentation for that function for more details_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Running `</span><span class="si">%s</span><span class="s2">`...&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Dynamic system: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load pattern: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadVel</span><span class="p">)</span>
        <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        
        <span class="n">results_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
        
        <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>
               
        <span class="k">if</span> <span class="n">saveResults</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">save_fName</span><span class="p">)</span>
            
        <span class="k">return</span> <span class="n">results_obj</span>
    
        
    <span class="k">def</span> <span class="nf">_CalcSimDuration</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">loadVel</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span><span class="n">tEpilogue</span><span class="o">=</span><span class="mf">5.0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates the required duration for time-stepping simulation</span>
<span class="sd">        ***</span>
<span class="sd">        </span>
<span class="sd">        Optional:</span>
<span class="sd">         </span>
<span class="sd">        * `loadVel`, constant velocity (m/s) of the load pattern</span>
<span class="sd">        </span>
<span class="sd">        * `tEpilogue`, additional time to run following exit of last load from </span>
<span class="sd">          track overlying the dynamic system in question.</span>
<span class="sd">          </span>
<span class="sd">        In the case of `Ltrack` and `loadLength`, if _None_ is provided then </span>
<span class="sd">        function will attempt to obtain this information from class attributes.</span>
<span class="sd">          </span>
<span class="sd">        ***</span>
<span class="sd">        Returns:</span>
<span class="sd">            </span>
<span class="sd">        tStart, `tEnd`: start and end times (secs) for simulation</span>
<span class="sd">         </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1">#print(&quot;tEpilogue = %.3f&quot; % tEpilogue)</span>
        
        <span class="n">modalsys_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span>
        <span class="n">loadtrain_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span>
        
        <span class="c1"># Get length of track along which loading is running</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;Ltrack&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">modalsys_obj</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
            <span class="n">Ltrack</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`{0}` not defined!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
            
        <span class="c1"># Get length of load train</span>
        <span class="n">attr</span> <span class="o">=</span> <span class="s2">&quot;loadLength&quot;</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="n">loadtrain_obj</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attr</span><span class="p">):</span>
            <span class="n">loadLength</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span><span class="n">attr</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`{0}` not defined!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">attr</span><span class="p">))</span>
      
        <span class="c1"># Determine time required for all loads to pass along track</span>
        <span class="n">tStart</span><span class="o">=</span><span class="mi">0</span>
        <span class="n">Ltotal</span> <span class="o">=</span> <span class="n">Ltrack</span> <span class="o">+</span> <span class="n">loadLength</span>
        <span class="n">tEnd</span> <span class="o">=</span> <span class="n">Ltotal</span><span class="o">/</span><span class="n">loadVel</span> <span class="o">+</span> <span class="n">tEpilogue</span>
        
        <span class="k">return</span> <span class="n">tStart</span><span class="p">,</span> <span class="n">tEnd</span>
    
    
    <span class="k">def</span> <span class="nf">PlotResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots results using `tstep_results.PlotResults()`.</span>
<span class="sd">        </span>
<span class="sd">        _Refer documentation from that function for further details_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_obj</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="n">dofs2Plot</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#dyn_analysis.MovingLoadAnalysis">MovingLoadAnalysis</a></li>
          <li><a href="#dyn_analysis.Dyn_Analysis">Dyn_Analysis</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="dyn_analysis.MovingLoadAnalysis.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, modalsys_obj, name=None, loadtrain_obj=None, loadtrain_fName=&#39;loadDefs.csv&#39;, loadVel=5.0, use_abs_modeshape=False, tEpilogue=10.0, dt=None, dt_loads=0.01, max_dt=None, retainDOFTimeSeries=True, retainResponseTimeSeries=True, writeResults2File=False, results_fName=&#39;results.csv&#39;)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Required:</p>
<ul>
<li><code>modalsys_obj</code>, modal system to which analysis relates</li>
</ul>
<p><strong>Important note:</strong> <code>modalsys_obj</code> must be a modal system, as the 
action of the moving loads is determined by obtaining the 
mode-generalised force functions for each mode. <em>This is checked</em>.</p>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>loadtrain_obj</code>, load train object defining load pattern. If <em>None</em> 
  then <code>loadtrain_fName</code> must be provided (see below)</p>
</li>
<li>
<p>`loadtrain_fName", file containing load train definition</p>
</li>
<li>
<p><code>loadVel</code>, constant velocity of load pattern (m/s)</p>
</li>
<li>
<p><code>loadDefs_fName</code>, file containing load definitions</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.MovingLoadAnalysis.__init__', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.MovingLoadAnalysis.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">modalsys_obj</span><span class="p">,</span>
             <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">loadtrain_obj</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">loadtrain_fName</span><span class="o">=</span><span class="s2">&quot;loadDefs.csv&quot;</span><span class="p">,</span>
             <span class="n">loadVel</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
             <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">tEpilogue</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span>
             <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">dt_loads</span><span class="o">=</span><span class="mf">0.01</span><span class="p">,</span>
             <span class="n">max_dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">retainDOFTimeSeries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">retainResponseTimeSeries</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">writeResults2File</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">results_fName</span><span class="o">=</span><span class="s2">&quot;results.csv&quot;</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">    </span>
<span class="sd">    **Important note:** `modalsys_obj` must be a modal system, as the </span>
<span class="sd">    action of the moving loads is determined by obtaining the </span>
<span class="sd">    mode-generalised force functions for each mode. _This is checked_.</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `loadtrain_obj`, load train object defining load pattern. If _None_ </span>
<span class="sd">      then `loadtrain_fName` must be provided (see below)</span>
<span class="sd">      </span>
<span class="sd">    * `loadtrain_fName&quot;, file containing load train definition</span>
<span class="sd">        </span>
<span class="sd">    * `loadVel`, constant velocity of load pattern (m/s)</span>
<span class="sd">    </span>
<span class="sd">    * `loadDefs_fName`, file containing load definitions</span>
<span class="sd">    </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Handle None for loadtrain_obj</span>
    <span class="k">if</span> <span class="n">loadtrain_obj</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">loadtrain_obj</span> <span class="o">=</span> <span class="n">loading</span><span class="o">.</span><span class="n">LoadTrain</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">loadtrain_fName</span><span class="p">)</span>
    
    <span class="c1"># Check class name of modalsys_obj</span>
    <span class="k">if</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;ModalSys&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modalsys_obj`: instance of `ModalSys` class expected!&quot;</span><span class="p">)</span>
        
    <span class="c1"># Check class name of base class of loadtrain_obj</span>
    <span class="k">if</span> <span class="n">loadtrain_obj</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__bases__</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__name__</span> <span class="o">!=</span> <span class="s2">&quot;LoadTrain&quot;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`loadtrain_obj`: instance of `LoadTrain` class &quot;</span><span class="o">+</span>
                         <span class="s2">&quot;(or dervied classes) expected!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Run parent init</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">name</span><span class="p">,</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">loadtrain_obj</span><span class="p">)</span>
    
    <span class="c1"># Save details as attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">loadVel</span> <span class="o">=</span> <span class="n">loadVel</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Velocity of load pattern along track</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define time-stepping analysis</span>
    
    <span class="n">tStart</span><span class="p">,</span> <span class="n">tEnd</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_CalcSimDuration</span><span class="p">(</span><span class="n">loadVel</span><span class="o">=</span><span class="n">loadVel</span><span class="p">,</span>
                                         <span class="n">tEpilogue</span><span class="o">=</span><span class="n">tEpilogue</span><span class="p">)</span>
    
    <span class="c1"># Define force function for parent system and subsystems</span>
    <span class="n">modalForces_func</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcModalForces</span><span class="p">(</span><span class="n">loading_obj</span><span class="o">=</span><span class="n">loadtrain_obj</span><span class="p">,</span>
                                                    <span class="n">loadVel</span><span class="o">=</span><span class="n">loadVel</span><span class="p">,</span>
                                                    <span class="n">dt</span><span class="o">=</span><span class="n">dt_loads</span><span class="p">,</span>
                                                    <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="n">use_abs_modeshape</span><span class="p">)</span>
    
    <span class="n">force_func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">modalsys_obj</span> <span class="p">:</span> <span class="n">modalForces_func</span><span class="p">}</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                 <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                                 <span class="n">tStart</span><span class="o">=</span><span class="n">tStart</span><span class="p">,</span>
                                 <span class="n">tEnd</span><span class="o">=</span><span class="n">tEnd</span><span class="p">,</span>
                                 <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                                 <span class="n">max_dt</span><span class="o">=</span><span class="n">max_dt</span><span class="p">,</span>
                                 <span class="n">force_func_dict</span><span class="o">=</span><span class="n">force_func_dict</span><span class="p">,</span>
                                 <span class="n">retainDOFTimeSeries</span><span class="o">=</span><span class="n">retainDOFTimeSeries</span><span class="p">,</span>
                                 <span class="n">retainResponseTimeSeries</span><span class="o">=</span><span class="n">retainResponseTimeSeries</span><span class="p">,</span>
                                 <span class="n">writeResults2File</span><span class="o">=</span><span class="n">writeResults2File</span><span class="p">,</span>
                                 <span class="n">results_fName</span><span class="o">=</span><span class="n">results_fName</span>
                                 <span class="p">)</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Time-stepping solver object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">results_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Results object</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.MovingLoadAnalysis.PlotResults">
    <p>def <span class="ident">PlotResults</span>(</p><p>self, dofs2Plot=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots results using <code>tstep_results.PlotResults()</code>.</p>
<p><em>Refer documentation from that function for further details</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.MovingLoadAnalysis.PlotResults', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.MovingLoadAnalysis.PlotResults" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">PlotResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots results using `tstep_results.PlotResults()`.</span>
<span class="sd">    </span>
<span class="sd">    _Refer documentation from that function for further details_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results_obj</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="n">dofs2Plot</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.MovingLoadAnalysis.run">
    <p>def <span class="ident">run</span>(</p><p>self, saveResults=False, save_fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Runs moving load analysis, using <code>tstep.run()</code></p>
<p><em>Refer documentation for that function for more details</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.MovingLoadAnalysis.run', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.MovingLoadAnalysis.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">save_fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs moving load analysis, using `tstep.run()`</span>
<span class="sd">    </span>
<span class="sd">    _Refer documentation for that function for more details_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Running `</span><span class="si">%s</span><span class="s2">`...&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Dynamic system: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load pattern: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadVel</span><span class="p">)</span>
    <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    
    <span class="n">results_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
    <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>
           
    <span class="k">if</span> <span class="n">saveResults</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">save_fName</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">results_obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.MovingLoadAnalysis.save">
    <p>def <span class="ident">save</span>(</p><p>self, fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Serialises object to file <code>fName</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.MovingLoadAnalysis.save', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.MovingLoadAnalysis.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialises object to file `fName`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="dyn_analysis.MovingLoadAnalysis.loadVel" class="name">var <span class="ident">loadVel</span></p>
            

            
  
    <div class="desc"><p>Velocity of load pattern along track</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.MovingLoadAnalysis.results_obj" class="name">var <span class="ident">results_obj</span></p>
            

            
  
    <div class="desc"><p>Results object</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.MovingLoadAnalysis.tstep_obj" class="name">var <span class="ident">tstep_obj</span></p>
            

            
  
    <div class="desc"><p>Time-stepping solver object</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="dyn_analysis.Multiple" class="name">class <span class="ident">Multiple</span></p>
      
  
    <div class="desc"><p>Function to run multiple dynamic analyses and provide functionality to 
store, plot and analyse results from multiple dynamic analyses in a 
systematic manner</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Multiple', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Multiple" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Multiple</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to run multiple dynamic analyses and provide functionality to </span>
<span class="sd">    store, plot and analyse results from multiple dynamic analyses in a </span>
<span class="sd">    systematic manner</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">className</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                 <span class="n">dynsys_obj</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span>
                 <span class="n">writeResults2File</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">retainDOFTimeSeries</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">retainResponseTimeSeries</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        ****</span>
<span class="sd">        </span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `className`, _string_ to denote `Dyn_Analysis` class (usually inherited) </span>
<span class="sd">          that implements the required analysis type</span>
<span class="sd">          </span>
<span class="sd">        * `dynsys_obj`, dynamic system to which analysis relates</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `retainResponseTimeSeries`, _boolean_, denotes whether detailed </span>
<span class="sd">          _response_ time series results can be deleted once summary </span>
<span class="sd">          statistics have been computed</span>
<span class="sd">          </span>
<span class="sd">        * `retainDOFTimeSeries`, _boolean_, denotes whether detailed _DOF_ </span>
<span class="sd">          time series results can be deleted once summary statistics have been </span>
<span class="sd">          computed</span>
<span class="sd">            </span>
<span class="sd">        By default _False_ is assigned to be above (contrary to usual defaults) </span>
<span class="sd">        as running multiple analyses would otherwise often lead to large </span>
<span class="sd">        memory demands.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Initialising multiple `{0}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">className</span><span class="p">))</span>
    
        <span class="k">if</span> <span class="n">className</span> <span class="o">==</span> <span class="s2">&quot;MovingLoadAnalysis&quot;</span><span class="p">:</span>
            
            <span class="n">ReqdClass</span> <span class="o">=</span> <span class="n">MovingLoadAnalysis</span>
            
            <span class="n">kwargs2permute</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;loadVel&quot;</span><span class="p">,</span><span class="s2">&quot;loadtrain_obj&quot;</span><span class="p">]</span>
            
        <span class="k">elif</span> <span class="n">className</span> <span class="o">==</span> <span class="s2">&quot;UKNA_BSEN1991_2_walkers_joggers&quot;</span><span class="p">:</span>
            
            <span class="n">ReqdClass</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_walkers_joggers</span>
            
            <span class="n">kwargs2permute</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;analysis_type&quot;</span><span class="p">,</span><span class="s2">&quot;mode_index&quot;</span><span class="p">]</span>
        
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported class name!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get input arguments to permute</span>
        <span class="n">vals2permute</span><span class="o">=</span><span class="p">{}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs2permute</span><span class="p">:</span>
            
            <span class="c1"># Get list as supplied via **kwargs</span>
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
                
                <span class="n">vals_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
                
                <span class="c1"># Convert to list if single</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                        <span class="n">vals_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">vals_list</span><span class="p">]</span>
                        
                <span class="n">vals2permute</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">vals_list</span>
                        
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;{0}&#39; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> 
                                 <span class="s2">&quot;included in `kwargs2permute` list but &quot;</span> <span class="o">+</span> 
                                 <span class="s2">&quot;list of values to permute not provided!&quot;</span><span class="p">)</span>

        <span class="c1"># Populate object array with initialised objects</span>
        <span class="n">vals_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">vals2permute</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
        
        <span class="n">analysis_list</span><span class="o">=</span><span class="p">[]</span>
        <span class="n">nAnalysis</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals_list</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nAnalysis</span><span class="p">):</span>
            
            <span class="c1"># Prepare dict of key arguments to pass</span>
            <span class="n">kwargs_vals</span> <span class="o">=</span> <span class="n">vals_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">kwargs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">kwargs2permute</span><span class="p">,</span> <span class="n">kwargs_vals</span><span class="p">))</span>
            
            <span class="c1"># Append any general kwargs provided</span>
            <span class="n">results_fName</span> <span class="o">=</span> <span class="s2">&quot;results/analysis</span><span class="si">%04d</span><span class="s2">.csv&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
            
            <span class="n">kwargs_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">kwargs_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;retainDOFTimeSeries&quot;</span><span class="p">:</span><span class="n">retainDOFTimeSeries</span><span class="p">,</span>
                                <span class="s2">&quot;retainResponseTimeSeries&quot;</span><span class="p">:</span><span class="n">retainResponseTimeSeries</span><span class="p">,</span>
                                <span class="s2">&quot;writeResults2File&quot;</span><span class="p">:</span><span class="n">writeResults2File</span><span class="p">,</span>
                                <span class="s2">&quot;results_fName&quot;</span><span class="p">:</span><span class="n">results_fName</span><span class="p">})</span>
            
            <span class="c1"># Initialisise analysis object</span>
            <span class="n">analysis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReqdClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%04d</span><span class="s2">&quot;</span><span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                                           <span class="n">modalsys_obj</span><span class="o">=</span><span class="n">dynsys_obj</span><span class="p">,</span>
                                           <span class="o">**</span><span class="n">kwargs_dict</span><span class="p">))</span>
            
        
        <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span> <span class="o">=</span> <span class="n">dynsys_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `DynSys` object to which analysis relates</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span> <span class="o">=</span> <span class="n">className</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Class name of `dyn_analysis` derived class</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span> <span class="o">=</span> <span class="n">vals2permute</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dictionary of keywords and values to permute in the multiple analyses </span>
<span class="sd">        defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Tuple to denote the shape of lists specified in `vals2permute`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span><span class="o">=</span><span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        ndarray of `tstep_results` object instances</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="o">=</span><span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Dict of ndarrays containing stats (max, min, std, absmax) for each of </span>
<span class="sd">        the analyses carried out, for each of the responses defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span> <span class="o">=</span> <span class="n">analysis_list</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of `Dyn_Analysis` object instances, each of which defines a </span>
<span class="sd">        dynamic analysis to be performed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">solveInParallel</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs multiple dynamic analyses, as defined by `__init__`</span>
<span class="sd">        ***</span>
<span class="sd">        </span>
<span class="sd">        In principle this can be done in parallel, to efficiently use all </span>
<span class="sd">        avaliable cores and give improve runtime.</span>
<span class="sd">        </span>
<span class="sd">        _Parallel processing not yet implemented due to outstanding bug </span>
<span class="sd">        associated with using `multiprocessing` module from within Spyder_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running multiple `{0}`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">))</span>
        <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
            
        <span class="c1"># Run analyses using parallel processing (if possible)</span>
        <span class="k">if</span> <span class="n">solveInParallel</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Parallel processing not yet implemented due to &quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;outstanding bug associated with using &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;`multiprocessing` module from within Spyder</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                  <span class="s2">&quot;A single-process analysis will be carried out instead.&quot;</span><span class="p">)</span>    

        <span class="c1"># Run all pre-defined analyses</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">):</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis #</span><span class="si">%04d</span><span class="s2"> of #</span><span class="si">%04d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)))</span>
            <span class="n">x</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="c1">#clear line for emphasis</span>
        
        <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Multiple `</span><span class="si">%s</span><span class="s2">` analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds!</span><span class="se">\n</span><span class="s2">&quot;</span> 
              <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">,(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)))</span>
            
        <span class="c1"># Reshape results objects in ndarray</span>
        <span class="n">results_obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">]</span>
        <span class="n">reqdShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span>
        <span class="n">results_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">results_obj_list</span><span class="p">,</span><span class="n">reqdShape</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="o">=</span> <span class="n">results_arr</span>
        
        <span class="c1"># Collate statistics</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
        
        <span class="c1"># Pickle results</span>
        <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
    
    
    <span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stat_name</span><span class="o">=</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span>
                   <span class="n">key2plot</span><span class="o">=</span><span class="s1">&#39;loadVel&#39;</span><span class="p">,</span>
                   <span class="n">xConversionFactor</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                   <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                   <span class="n">figsize_inches</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">)):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produces a plot of a given taken across multiple analyses</span>
<span class="sd">        </span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * `stat_name`, name of statistic to be plotted</span>
<span class="sd">        * `key2plot`, name of key within `vals2permute` dict to be used</span>
<span class="sd">          as x-axis in plot</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;UNFINISHED: DO NOT USE!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Re-collate statistics as required</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
            
        <span class="c1"># Check requested stats is in dict</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid statistic selected!&quot;</span><span class="p">)</span>
            
        <span class="c1"># Obtain responses names</span>
        <span class="n">responseNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names_list</span>
        <span class="k">print</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
        
        <span class="c1"># Get index and value to use along x-axis</span>
        <span class="c1">#kwargs2permute = list(self.vals2permute.keys())</span>
        <span class="c1">#key2plot_index=[i for i, x in enumerate(kwargs2permute) if x==key2plot][0]</span>
        
        <span class="n">x_vals</span> <span class="o">=</span> <span class="n">xConversionFactor</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span><span class="p">[</span><span class="n">key2plot</span><span class="p">])</span>

        <span class="c1"># Retrieve stats to plot</span>
        <span class="n">stats_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">stat_name</span><span class="p">]</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;stats_arr.shape: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Current manual workaround to produce load vs velocity plot!</span>
<span class="sd">        (Code should be tidied to be more generic)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Create figure for each set of responses</span>
        <span class="n">nFigures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
        <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">fig_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nFigures</span><span class="p">):</span>
                
            <span class="n">nSubplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">])</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize_inches</span><span class="p">)</span>
            
            <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Create subplots for each response</span>
            <span class="k">for</span> <span class="n">splt_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">):</span>
                
                <span class="n">r</span> <span class="o">=</span> <span class="n">splt_index</span>
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">splt_index</span><span class="p">]</span>
                <span class="n">vals2plot</span> <span class="o">=</span> <span class="n">stats_arr</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">vals2plot</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
                
                <span class="k">if</span> <span class="p">(</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">splt_index</span><span class="o">==</span><span class="n">nSubplots</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">fig_list</span>
    
    <span class="k">def</span> <span class="nf">_pickle_fName</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines default filename for pickle files</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fName</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="n">fName</span> <span class="o">=</span> <span class="s2">&quot;{0}_{1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">fName</span> <span class="o">+=</span> <span class="s2">&quot;_{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                
            <span class="n">fName</span> <span class="o">+=</span> <span class="s2">&quot;.pkl&quot;</span> 
                
        <span class="k">return</span> <span class="n">fName</span>
    
    <span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Serialises object to file `fName`</span>
<span class="sd">        &quot;&quot;&quot;</span>
    
        <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
            <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
            
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">collate_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Collates computed statistics into a dict of ndarrays, to faciliate </span>
<span class="sd">        efficient slicing operations, for example</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating statistics...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get list of all tstep_results objects associate with Multiple()</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;self.results_arr=None! No results to collate!&quot;</span><span class="p">)</span>
        
        <span class="n">results_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function to collate specified stats, across all results objects</span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="c1"># Loop over all tstep_results objects</span>
            <span class="n">stats_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">results_obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results_list</span><span class="p">):</span>
                
                <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">results_obj</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    
                    <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
                    <span class="n">stats_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
            
            <span class="c1"># Flatten nested list</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">stats_list</span><span class="p">)</span>
            
            <span class="c1"># Reshape as ndarray</span>
            <span class="n">newshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">nResponses</span><span class="p">,)</span>
            <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">newshape</span><span class="p">)</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;`{0}` stats saved as {1} ndarray&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_name</span><span class="p">,</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            
            <span class="k">return</span> <span class="n">arr</span>
        
        <span class="c1"># Loop over all systems and subsystems</span>
        <span class="n">stats_dict_outer</span><span class="o">=</span><span class="p">{}</span>
        
        <span class="n">DynSys_list</span> <span class="o">=</span> <span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
        
        <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">DynSys_list</span><span class="p">:</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating response stats for system &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    
            <span class="c1"># Loop over all response stats types, e.g. &#39;max&#39;, &#39;min&#39; etc.</span>
            <span class="n">stats_dict_inner</span><span class="o">=</span><span class="p">{}</span>
            <span class="n">stats_names_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            
            <span class="k">for</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="n">stats_names_list</span><span class="p">:</span>
                
                <span class="n">stats_dict_inner</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span><span class="p">)</span>
                
            <span class="n">stats_dict_outer</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_dict_inner</span>
                
        <span class="c1"># Save as attribute</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="o">=</span> <span class="n">stats_dict_outer</span>
        
        <span class="k">return</span> <span class="n">stats_dict_outer</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#dyn_analysis.Multiple">Multiple</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="dyn_analysis.Multiple.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, className, dynsys_obj, writeResults2File=False, retainDOFTimeSeries=False, retainResponseTimeSeries=False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>className</code>, <em>string</em> to denote <code>Dyn_Analysis</code> class (usually inherited) 
  that implements the required analysis type</p>
</li>
<li>
<p><code>dynsys_obj</code>, dynamic system to which analysis relates</p>
</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>retainResponseTimeSeries</code>, <em>boolean</em>, denotes whether detailed 
  <em>response</em> time series results can be deleted once summary 
  statistics have been computed</p>
</li>
<li>
<p><code>retainDOFTimeSeries</code>, <em>boolean</em>, denotes whether detailed <em>DOF</em> 
  time series results can be deleted once summary statistics have been 
  computed</p>
</li>
</ul>
<p>By default <em>False</em> is assigned to be above (contrary to usual defaults) 
as running multiple analyses would otherwise often lead to large 
memory demands.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Multiple.__init__', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Multiple.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">className</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
             <span class="n">dynsys_obj</span><span class="p">:</span><span class="nb">object</span><span class="p">,</span>
             <span class="n">writeResults2File</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">retainDOFTimeSeries</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">retainResponseTimeSeries</span><span class="p">:</span><span class="nb">bool</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    ****</span>
<span class="sd">    </span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `className`, _string_ to denote `Dyn_Analysis` class (usually inherited) </span>
<span class="sd">      that implements the required analysis type</span>
<span class="sd">      </span>
<span class="sd">    * `dynsys_obj`, dynamic system to which analysis relates</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `retainResponseTimeSeries`, _boolean_, denotes whether detailed </span>
<span class="sd">      _response_ time series results can be deleted once summary </span>
<span class="sd">      statistics have been computed</span>
<span class="sd">      </span>
<span class="sd">    * `retainDOFTimeSeries`, _boolean_, denotes whether detailed _DOF_ </span>
<span class="sd">      time series results can be deleted once summary statistics have been </span>
<span class="sd">      computed</span>
<span class="sd">        </span>
<span class="sd">    By default _False_ is assigned to be above (contrary to usual defaults) </span>
<span class="sd">    as running multiple analyses would otherwise often lead to large </span>
<span class="sd">    memory demands.</span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Initialising multiple `{0}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">className</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">className</span> <span class="o">==</span> <span class="s2">&quot;MovingLoadAnalysis&quot;</span><span class="p">:</span>
        
        <span class="n">ReqdClass</span> <span class="o">=</span> <span class="n">MovingLoadAnalysis</span>
        
        <span class="n">kwargs2permute</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;loadVel&quot;</span><span class="p">,</span><span class="s2">&quot;loadtrain_obj&quot;</span><span class="p">]</span>
        
    <span class="k">elif</span> <span class="n">className</span> <span class="o">==</span> <span class="s2">&quot;UKNA_BSEN1991_2_walkers_joggers&quot;</span><span class="p">:</span>
        
        <span class="n">ReqdClass</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_walkers_joggers</span>
        
        <span class="n">kwargs2permute</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;analysis_type&quot;</span><span class="p">,</span><span class="s2">&quot;mode_index&quot;</span><span class="p">]</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unsupported class name!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get input arguments to permute</span>
    <span class="n">vals2permute</span><span class="o">=</span><span class="p">{}</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs2permute</span><span class="p">:</span>
        
        <span class="c1"># Get list as supplied via **kwargs</span>
        <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            
            <span class="n">vals_list</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>
            
            <span class="c1"># Convert to list if single</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">vals_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                    <span class="n">vals_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">vals_list</span><span class="p">]</span>
                    
            <span class="n">vals2permute</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">=</span><span class="n">vals_list</span>
                    
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;{0}&#39; &quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="o">+</span> 
                             <span class="s2">&quot;included in `kwargs2permute` list but &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;list of values to permute not provided!&quot;</span><span class="p">)</span>
    <span class="c1"># Populate object array with initialised objects</span>
    <span class="n">vals_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">vals2permute</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    
    <span class="n">analysis_list</span><span class="o">=</span><span class="p">[]</span>
    <span class="n">nAnalysis</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">vals_list</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nAnalysis</span><span class="p">):</span>
        
        <span class="c1"># Prepare dict of key arguments to pass</span>
        <span class="n">kwargs_vals</span> <span class="o">=</span> <span class="n">vals_list</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="n">kwargs_dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">kwargs2permute</span><span class="p">,</span> <span class="n">kwargs_vals</span><span class="p">))</span>
        
        <span class="c1"># Append any general kwargs provided</span>
        <span class="n">results_fName</span> <span class="o">=</span> <span class="s2">&quot;results/analysis</span><span class="si">%04d</span><span class="s2">.csv&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="n">kwargs_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">kwargs_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;retainDOFTimeSeries&quot;</span><span class="p">:</span><span class="n">retainDOFTimeSeries</span><span class="p">,</span>
                            <span class="s2">&quot;retainResponseTimeSeries&quot;</span><span class="p">:</span><span class="n">retainResponseTimeSeries</span><span class="p">,</span>
                            <span class="s2">&quot;writeResults2File&quot;</span><span class="p">:</span><span class="n">writeResults2File</span><span class="p">,</span>
                            <span class="s2">&quot;results_fName&quot;</span><span class="p">:</span><span class="n">results_fName</span><span class="p">})</span>
        
        <span class="c1"># Initialisise analysis object</span>
        <span class="n">analysis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ReqdClass</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;</span><span class="si">%04d</span><span class="s2">&quot;</span><span class="o">%</span> <span class="n">i</span><span class="p">,</span>
                                       <span class="n">modalsys_obj</span><span class="o">=</span><span class="n">dynsys_obj</span><span class="p">,</span>
                                       <span class="o">**</span><span class="n">kwargs_dict</span><span class="p">))</span>
        
    
    <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span> <span class="o">=</span> <span class="n">dynsys_obj</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `DynSys` object to which analysis relates</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span> <span class="o">=</span> <span class="n">className</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class name of `dyn_analysis` derived class</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span> <span class="o">=</span> <span class="n">vals2permute</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dictionary of keywords and values to permute in the multiple analyses </span>
<span class="sd">    defined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Tuple to denote the shape of lists specified in `vals2permute`</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span><span class="o">=</span><span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    ndarray of `tstep_results` object instances</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="o">=</span><span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Dict of ndarrays containing stats (max, min, std, absmax) for each of </span>
<span class="sd">    the analyses carried out, for each of the responses defined</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span> <span class="o">=</span> <span class="n">analysis_list</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List of `Dyn_Analysis` object instances, each of which defines a </span>
<span class="sd">    dynamic analysis to be performed</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.Multiple.collate_stats">
    <p>def <span class="ident">collate_stats</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Collates computed statistics into a dict of ndarrays, to faciliate 
efficient slicing operations, for example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Multiple.collate_stats', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Multiple.collate_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">collate_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collates computed statistics into a dict of ndarrays, to faciliate </span>
<span class="sd">    efficient slicing operations, for example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating statistics...&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get list of all tstep_results objects associate with Multiple()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;self.results_arr=None! No results to collate!&quot;</span><span class="p">)</span>
    
    <span class="n">results_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to collate specified stats, across all results objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Loop over all tstep_results objects</span>
        <span class="n">stats_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">results_obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results_list</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">results_obj</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
                <span class="n">stats_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
        
        <span class="c1"># Flatten nested list</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">stats_list</span><span class="p">)</span>
        
        <span class="c1"># Reshape as ndarray</span>
        <span class="n">newshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">nResponses</span><span class="p">,)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">newshape</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;`{0}` stats saved as {1} ndarray&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_name</span><span class="p">,</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">arr</span>
    
    <span class="c1"># Loop over all systems and subsystems</span>
    <span class="n">stats_dict_outer</span><span class="o">=</span><span class="p">{}</span>
    
    <span class="n">DynSys_list</span> <span class="o">=</span> <span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
    
    <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">DynSys_list</span><span class="p">:</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating response stats for system &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Loop over all response stats types, e.g. &#39;max&#39;, &#39;min&#39; etc.</span>
        <span class="n">stats_dict_inner</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">stats_names_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="k">for</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="n">stats_names_list</span><span class="p">:</span>
            
            <span class="n">stats_dict_inner</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span><span class="p">)</span>
            
        <span class="n">stats_dict_outer</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_dict_inner</span>
            
    <span class="c1"># Save as attribute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="o">=</span> <span class="n">stats_dict_outer</span>
    
    <span class="k">return</span> <span class="n">stats_dict_outer</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.Multiple.plot_stats">
    <p>def <span class="ident">plot_stats</span>(</p><p>self, stat_name=&#39;absmax&#39;, key2plot=&#39;loadVel&#39;, xConversionFactor=1.0, xlabel=None, figsize_inches=(14, 8))</p>
    </div>
    

    
  
    <div class="desc"><p>Produces a plot of a given taken across multiple analyses</p>
<p>Optional:</p>
<ul>
<li><code>stat_name</code>, name of statistic to be plotted</li>
<li><code>key2plot</code>, name of key within <code>vals2permute</code> dict to be used
  as x-axis in plot</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Multiple.plot_stats', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Multiple.plot_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stat_name</span><span class="o">=</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span>
               <span class="n">key2plot</span><span class="o">=</span><span class="s1">&#39;loadVel&#39;</span><span class="p">,</span>
               <span class="n">xConversionFactor</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
               <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">figsize_inches</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produces a plot of a given taken across multiple analyses</span>
<span class="sd">    </span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * `stat_name`, name of statistic to be plotted</span>
<span class="sd">    * `key2plot`, name of key within `vals2permute` dict to be used</span>
<span class="sd">      as x-axis in plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;UNFINISHED: DO NOT USE!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Re-collate statistics as required</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
        
    <span class="c1"># Check requested stats is in dict</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid statistic selected!&quot;</span><span class="p">)</span>
        
    <span class="c1"># Obtain responses names</span>
    <span class="n">responseNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names_list</span>
    <span class="k">print</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
    
    <span class="c1"># Get index and value to use along x-axis</span>
    <span class="c1">#kwargs2permute = list(self.vals2permute.keys())</span>
    <span class="c1">#key2plot_index=[i for i, x in enumerate(kwargs2permute) if x==key2plot][0]</span>
    
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">xConversionFactor</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span><span class="p">[</span><span class="n">key2plot</span><span class="p">])</span>
    <span class="c1"># Retrieve stats to plot</span>
    <span class="n">stats_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">stat_name</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;stats_arr.shape: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Current manual workaround to produce load vs velocity plot!</span>
<span class="sd">    (Code should be tidied to be more generic)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create figure for each set of responses</span>
    <span class="n">nFigures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
    <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">fig_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nFigures</span><span class="p">):</span>
            
        <span class="n">nSubplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">])</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize_inches</span><span class="p">)</span>
        
        <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="c1"># Create subplots for each response</span>
        <span class="k">for</span> <span class="n">splt_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">):</span>
            
            <span class="n">r</span> <span class="o">=</span> <span class="n">splt_index</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">splt_index</span><span class="p">]</span>
            <span class="n">vals2plot</span> <span class="o">=</span> <span class="n">stats_arr</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">vals2plot</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">splt_index</span><span class="o">==</span><span class="n">nSubplots</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.Multiple.run">
    <p>def <span class="ident">run</span>(</p><p>self, save=True, solveInParallel=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Runs multiple dynamic analyses, as defined by <code>__init__</code></p>
<hr />
<p>In principle this can be done in parallel, to efficiently use all 
avaliable cores and give improve runtime.</p>
<p><em>Parallel processing not yet implemented due to outstanding bug 
associated with using <code>multiprocessing</code> module from within Spyder</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Multiple.run', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Multiple.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">solveInParallel</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs multiple dynamic analyses, as defined by `__init__`</span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    In principle this can be done in parallel, to efficiently use all </span>
<span class="sd">    avaliable cores and give improve runtime.</span>
<span class="sd">    </span>
<span class="sd">    _Parallel processing not yet implemented due to outstanding bug </span>
<span class="sd">    associated with using `multiprocessing` module from within Spyder_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running multiple `{0}`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">))</span>
    <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        
    <span class="c1"># Run analyses using parallel processing (if possible)</span>
    <span class="k">if</span> <span class="n">solveInParallel</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Parallel processing not yet implemented due to &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;outstanding bug associated with using &quot;</span><span class="o">+</span>
              <span class="s2">&quot;`multiprocessing` module from within Spyder</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
              <span class="s2">&quot;A single-process analysis will be carried out instead.&quot;</span><span class="p">)</span>    
    <span class="c1"># Run all pre-defined analyses</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">):</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis #</span><span class="si">%04d</span><span class="s2"> of #</span><span class="si">%04d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)))</span>
        <span class="n">x</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="c1">#clear line for emphasis</span>
    
    <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Multiple `</span><span class="si">%s</span><span class="s2">` analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds!</span><span class="se">\n</span><span class="s2">&quot;</span> 
          <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">,(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)))</span>
        
    <span class="c1"># Reshape results objects in ndarray</span>
    <span class="n">results_obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">]</span>
    <span class="n">reqdShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span>
    <span class="n">results_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">results_obj_list</span><span class="p">,</span><span class="n">reqdShape</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="o">=</span> <span class="n">results_arr</span>
    
    <span class="c1"># Collate statistics</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
    
    <span class="c1"># Pickle results</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.Multiple.save">
    <p>def <span class="ident">save</span>(</p><p>self, fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Serialises object to file <code>fName</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.Multiple.save', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.Multiple.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialises object to file `fName`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="dyn_analysis.Multiple.analysisType" class="name">var <span class="ident">analysisType</span></p>
            

            
  
    <div class="desc"><p>Class name of <code>dyn_analysis</code> derived class</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.Multiple.analysis_list" class="name">var <span class="ident">analysis_list</span></p>
            

            
  
    <div class="desc"><p>List of <code>Dyn_Analysis</code> object instances, each of which defines a 
dynamic analysis to be performed</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.Multiple.dynsys_obj" class="name">var <span class="ident">dynsys_obj</span></p>
            

            
  
    <div class="desc"><p><code>DynSys</code> object to which analysis relates</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.Multiple.results_arr" class="name">var <span class="ident">results_arr</span></p>
            

            
  
    <div class="desc"><p>ndarray of <code>tstep_results</code> object instances</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.Multiple.stats_dict" class="name">var <span class="ident">stats_dict</span></p>
            

            
  
    <div class="desc"><p>Dict of ndarrays containing stats (max, min, std, absmax) for each of 
the analyses carried out, for each of the responses defined</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.Multiple.vals2permute" class="name">var <span class="ident">vals2permute</span></p>
            

            
  
    <div class="desc"><p>Dictionary of keywords and values to permute in the multiple analyses 
defined</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.Multiple.vals2permute_shape" class="name">var <span class="ident">vals2permute_shape</span></p>
            

            
  
    <div class="desc"><p>Tuple to denote the shape of lists specified in <code>vals2permute</code></p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="dyn_analysis.PedestrianDynamics_transientAnalyses" class="name">class <span class="ident">PedestrianDynamics_transientAnalyses</span></p>
      
  
    <div class="desc"><p>Implements the full set of analyses required to fully-implement the 
method given in NA.2.44.4 of UK NA to BS EN 1991-2
i.e. transient analyses for both walkers and joggers, for all modes</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.PedestrianDynamics_transientAnalyses', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.PedestrianDynamics_transientAnalyses" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PedestrianDynamics_transientAnalyses</span><span class="p">(</span><span class="n">Multiple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements the full set of analyses required to fully-implement the </span>
<span class="sd">    method given in NA.2.44.4 of UK NA to BS EN 1991-2</span>
<span class="sd">    i.e. transient analyses for both walkers and joggers, for all modes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        ****</span>
<span class="sd">        </span>
<span class="sd">        Required:</span>
<span class="sd">          </span>
<span class="sd">        * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `bridgeClass`, _string_, either &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, or &#39;D&#39;. </span>
<span class="sd">          Refer Table NA.7 for description of bridge classes</span>
<span class="sd">          </span>
<span class="sd">        Additional keyword arguments may be passed. These should relate to the </span>
<span class="sd">        `__init__()` function of the `Multiple` class.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get mode indexs to loop over</span>
        <span class="c1"># Note modes sorted into ascending frequency but in conjugate pairs</span>
        <span class="c1"># Hence step through modes x2</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetSystemMatrices</span><span class="p">()[</span><span class="s2">&quot;nDOF&quot;</span><span class="p">]</span>
        <span class="n">mode_index_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nModes</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="c1"># Run parent init function</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;UKNA_BSEN1991_2_walkers_joggers&quot;</span><span class="p">,</span>
                         <span class="n">dynsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                         <span class="n">bridgeClass</span><span class="o">=</span><span class="n">bridgeClass</span><span class="p">,</span>
                         <span class="n">mode_index</span><span class="o">=</span><span class="n">mode_index_list</span><span class="p">,</span>
                         <span class="n">analysis_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span><span class="s2">&quot;joggers&quot;</span><span class="p">],</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># Save key variables as attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
        
        
    <span class="k">def</span> <span class="nf">plot_modal_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        
        <span class="c1"># Get modal properties as used in analyses</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">fv</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">eta</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
        
        <span class="c1"># Plot details of system</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$f_{d}$ (Hz)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">eta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s1">&#39;{:.1%}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Modal damping&quot;</span><span class="p">)</span>
        
        <span class="c1"># Add equivilent axis for log dec</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">logdec</span><span class="p">(</span><span class="n">eta</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
        
        <span class="n">delta_incr</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">new_yticks</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">delta_incr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">logdec</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Log decrement $\delta$&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
    
    
    <span class="k">def</span> <span class="nf">plot_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">dynsys2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">responses2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots statistics of responses computed, across all analyses</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `dynsys2plot`, list of subsystem objects to plot responses </span>
<span class="sd">          for. If None (default) responses will be plotted for all </span>
<span class="sd">          subsystems</span>
<span class="sd">            </span>
<span class="sd">        * `responses2plot`, list of indices specifying responses to be</span>
<span class="sd">          plotted. If None (default) all responses will be plotted, for</span>
<span class="sd">          each sub-system</span>
<span class="sd">          </span>
<span class="sd">        * `sharey`, passed to pyplot.subplots() method. Controls whether </span>
<span class="sd">          subplots should share common y scale.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting response statistics...&quot;</span><span class="p">)</span>
        
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">dynsys2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dynsys2plot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dynsys2plot&#39; does not belong &quot;</span> <span class="o">+</span> 
                                 <span class="s2">&quot;to system analysed!&quot;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dynsys2plot</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">dynsys2plot</span><span class="p">]</span>
            
        <span class="c1"># Loop over all systems and subsystems</span>
        <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">dynsys2plot</span><span class="p">:</span>
            
            <span class="c1"># Get stats dict relating to this system</span>
            <span class="n">stats_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span>
            
            <span class="c1"># Get indices of responses to plot</span>
            <span class="n">response_names</span> <span class="o">=</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names</span>
            
            <span class="k">if</span> <span class="n">responses2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_names</span><span class="p">)</span>
                <span class="n">responses2plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nResponses</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">)</span>
            
            <span class="c1"># Create new figure</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nResponses</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                      <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Loop to plot all responses requested</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">):</span>
                
                <span class="n">response_name</span> <span class="o">=</span> <span class="n">response_names</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                
                <span class="c1"># Get stats for this response</span>
                <span class="n">stats_dict_r</span> <span class="o">=</span> <span class="p">{}</span>
                
                <span class="k">for</span> <span class="n">stats_name</span><span class="p">,</span> <span class="n">stats_vals</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    
                    <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">=</span><span class="n">stats_vals</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
            
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting stats for response &#39;</span><span class="si">%s</span><span class="s2">&#39;:&quot;</span> <span class="o">%</span> <span class="n">response_name</span><span class="p">)</span>
                
                <span class="c1"># Plot response stats for walkers and joggers responses</span>
                
                <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s1">&#39;walkers&#39;</span><span class="p">,</span><span class="s1">&#39;joggers&#39;</span><span class="p">]):</span>
                    
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
                    
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">]):</span>
                    
                        <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">][</span><span class="n">col</span><span class="p">,:]</span>
                        
                        <span class="n">w</span><span class="o">=</span><span class="mf">0.1</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                               <span class="n">stats_vals</span><span class="p">,</span>
                               <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                               <span class="n">label</span><span class="o">=</span><span class="n">stats_name</span>
                               <span class="p">)</span>
    
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">col</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">response_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Responses to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">case</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="n">nResponses</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
                        
                
            
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Statistics of computed responses to pedestrian loading</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;UK NA to BS EN 1991-2, NA.2.44.4</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;Subsystem: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#dyn_analysis.PedestrianDynamics_transientAnalyses">PedestrianDynamics_transientAnalyses</a></li>
          <li><a href="#dyn_analysis.Multiple">Multiple</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="dyn_analysis.PedestrianDynamics_transientAnalyses.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, modalsys_obj, bridgeClass=&#39;A&#39;, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Required:</p>
<ul>
<li><code>modalsys_obj</code>, modal system to which analysis relates</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li><code>bridgeClass</code>, <em>string</em>, either 'A', 'B', 'C', or 'D'. 
  Refer Table NA.7 for description of bridge classes</li>
</ul>
<p>Additional keyword arguments may be passed. These should relate to the 
<code>__init__()</code> function of the <code>Multiple</code> class.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.PedestrianDynamics_transientAnalyses.__init__', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.PedestrianDynamics_transientAnalyses.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">modalsys_obj</span><span class="p">,</span>
             <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    ****</span>
<span class="sd">    </span>
<span class="sd">    Required:</span>
<span class="sd">      </span>
<span class="sd">    * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `bridgeClass`, _string_, either &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, or &#39;D&#39;. </span>
<span class="sd">      Refer Table NA.7 for description of bridge classes</span>
<span class="sd">      </span>
<span class="sd">    Additional keyword arguments may be passed. These should relate to the </span>
<span class="sd">    `__init__()` function of the `Multiple` class.</span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get mode indexs to loop over</span>
    <span class="c1"># Note modes sorted into ascending frequency but in conjugate pairs</span>
    <span class="c1"># Hence step through modes x2</span>
    <span class="n">nModes</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetSystemMatrices</span><span class="p">()[</span><span class="s2">&quot;nDOF&quot;</span><span class="p">]</span>
    <span class="n">mode_index_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nModes</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="c1"># Run parent init function</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">className</span><span class="o">=</span><span class="s2">&quot;UKNA_BSEN1991_2_walkers_joggers&quot;</span><span class="p">,</span>
                     <span class="n">dynsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                     <span class="n">bridgeClass</span><span class="o">=</span><span class="n">bridgeClass</span><span class="p">,</span>
                     <span class="n">mode_index</span><span class="o">=</span><span class="n">mode_index_list</span><span class="p">,</span>
                     <span class="n">analysis_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span><span class="s2">&quot;joggers&quot;</span><span class="p">],</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="c1"># Save key variables as attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.PedestrianDynamics_transientAnalyses.collate_stats">
    <p>def <span class="ident">collate_stats</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Collates computed statistics into a dict of ndarrays, to faciliate 
efficient slicing operations, for example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.PedestrianDynamics_transientAnalyses.collate_stats', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.PedestrianDynamics_transientAnalyses.collate_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">collate_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collates computed statistics into a dict of ndarrays, to faciliate </span>
<span class="sd">    efficient slicing operations, for example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating statistics...&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get list of all tstep_results objects associate with Multiple()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;self.results_arr=None! No results to collate!&quot;</span><span class="p">)</span>
    
    <span class="n">results_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to collate specified stats, across all results objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Loop over all tstep_results objects</span>
        <span class="n">stats_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">results_obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results_list</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">results_obj</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
                <span class="n">stats_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
        
        <span class="c1"># Flatten nested list</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">stats_list</span><span class="p">)</span>
        
        <span class="c1"># Reshape as ndarray</span>
        <span class="n">newshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">nResponses</span><span class="p">,)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">newshape</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;`{0}` stats saved as {1} ndarray&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_name</span><span class="p">,</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">arr</span>
    
    <span class="c1"># Loop over all systems and subsystems</span>
    <span class="n">stats_dict_outer</span><span class="o">=</span><span class="p">{}</span>
    
    <span class="n">DynSys_list</span> <span class="o">=</span> <span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
    
    <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">DynSys_list</span><span class="p">:</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating response stats for system &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Loop over all response stats types, e.g. &#39;max&#39;, &#39;min&#39; etc.</span>
        <span class="n">stats_dict_inner</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">stats_names_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="k">for</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="n">stats_names_list</span><span class="p">:</span>
            
            <span class="n">stats_dict_inner</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span><span class="p">)</span>
            
        <span class="n">stats_dict_outer</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_dict_inner</span>
            
    <span class="c1"># Save as attribute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="o">=</span> <span class="n">stats_dict_outer</span>
    
    <span class="k">return</span> <span class="n">stats_dict_outer</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.PedestrianDynamics_transientAnalyses.plot_modal_params">
    <p>def <span class="ident">plot_modal_params</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.PedestrianDynamics_transientAnalyses.plot_modal_params', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.PedestrianDynamics_transientAnalyses.plot_modal_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_modal_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    
    <span class="c1"># Get modal properties as used in analyses</span>
    <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">fv</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">fv</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">eta</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
    
    <span class="c1"># Plot details of system</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$f_{d}$ (Hz)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies&quot;</span><span class="p">)</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">eta</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s1">&#39;{:.1%}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Modal damping&quot;</span><span class="p">)</span>
    
    <span class="c1"># Add equivilent axis for log dec</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">logdec</span><span class="p">(</span><span class="n">eta</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
    
    <span class="n">delta_incr</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">new_yticks</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">delta_incr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">logdec</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Log decrement $\delta$&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.PedestrianDynamics_transientAnalyses.plot_response_stats">
    <p>def <span class="ident">plot_response_stats</span>(</p><p>self, dynsys2plot=None, responses2plot=None, sharey=&#39;row&#39;, verbose=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots statistics of responses computed, across all analyses</p>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>dynsys2plot</code>, list of subsystem objects to plot responses 
  for. If None (default) responses will be plotted for all 
  subsystems</p>
</li>
<li>
<p><code>responses2plot</code>, list of indices specifying responses to be
  plotted. If None (default) all responses will be plotted, for
  each sub-system</p>
</li>
<li>
<p><code>sharey</code>, passed to pyplot.subplots() method. Controls whether 
  subplots should share common y scale.</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.PedestrianDynamics_transientAnalyses.plot_response_stats', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.PedestrianDynamics_transientAnalyses.plot_response_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">dynsys2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">responses2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots statistics of responses computed, across all analyses</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `dynsys2plot`, list of subsystem objects to plot responses </span>
<span class="sd">      for. If None (default) responses will be plotted for all </span>
<span class="sd">      subsystems</span>
<span class="sd">        </span>
<span class="sd">    * `responses2plot`, list of indices specifying responses to be</span>
<span class="sd">      plotted. If None (default) all responses will be plotted, for</span>
<span class="sd">      each sub-system</span>
<span class="sd">      </span>
<span class="sd">    * `sharey`, passed to pyplot.subplots() method. Controls whether </span>
<span class="sd">      subplots should share common y scale.</span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting response statistics...&quot;</span><span class="p">)</span>
    
    <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    
    <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">dynsys2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dynsys2plot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dynsys2plot&#39; does not belong &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;to system analysed!&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dynsys2plot</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">dynsys2plot</span><span class="p">]</span>
        
    <span class="c1"># Loop over all systems and subsystems</span>
    <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">dynsys2plot</span><span class="p">:</span>
        
        <span class="c1"># Get stats dict relating to this system</span>
        <span class="n">stats_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span>
        
        <span class="c1"># Get indices of responses to plot</span>
        <span class="n">response_names</span> <span class="o">=</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names</span>
        
        <span class="k">if</span> <span class="n">responses2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_names</span><span class="p">)</span>
            <span class="n">responses2plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nResponses</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">)</span>
        
        <span class="c1"># Create new figure</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nResponses</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                  <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="c1"># Loop to plot all responses requested</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">):</span>
            
            <span class="n">response_name</span> <span class="o">=</span> <span class="n">response_names</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            
            <span class="c1"># Get stats for this response</span>
            <span class="n">stats_dict_r</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="k">for</span> <span class="n">stats_name</span><span class="p">,</span> <span class="n">stats_vals</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">=</span><span class="n">stats_vals</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
        
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting stats for response &#39;</span><span class="si">%s</span><span class="s2">&#39;:&quot;</span> <span class="o">%</span> <span class="n">response_name</span><span class="p">)</span>
            
            <span class="c1"># Plot response stats for walkers and joggers responses</span>
            
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s1">&#39;walkers&#39;</span><span class="p">,</span><span class="s1">&#39;joggers&#39;</span><span class="p">]):</span>
                
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
                
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">]):</span>
                
                    <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">][</span><span class="n">col</span><span class="p">,:]</span>
                    
                    <span class="n">w</span><span class="o">=</span><span class="mf">0.1</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                           <span class="n">stats_vals</span><span class="p">,</span>
                           <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="n">stats_name</span>
                           <span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">col</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">response_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Responses to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">case</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="n">nResponses</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
                    
            
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Statistics of computed responses to pedestrian loading</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;UK NA to BS EN 1991-2, NA.2.44.4</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;Subsystem: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.PedestrianDynamics_transientAnalyses.plot_stats">
    <p>def <span class="ident">plot_stats</span>(</p><p>self, stat_name=&#39;absmax&#39;, key2plot=&#39;loadVel&#39;, xConversionFactor=1.0, xlabel=None, figsize_inches=(14, 8))</p>
    </div>
    

    
  
    <div class="desc"><p>Produces a plot of a given taken across multiple analyses</p>
<p>Optional:</p>
<ul>
<li><code>stat_name</code>, name of statistic to be plotted</li>
<li><code>key2plot</code>, name of key within <code>vals2permute</code> dict to be used
  as x-axis in plot</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.PedestrianDynamics_transientAnalyses.plot_stats', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.PedestrianDynamics_transientAnalyses.plot_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stat_name</span><span class="o">=</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span>
               <span class="n">key2plot</span><span class="o">=</span><span class="s1">&#39;loadVel&#39;</span><span class="p">,</span>
               <span class="n">xConversionFactor</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
               <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">figsize_inches</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produces a plot of a given taken across multiple analyses</span>
<span class="sd">    </span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * `stat_name`, name of statistic to be plotted</span>
<span class="sd">    * `key2plot`, name of key within `vals2permute` dict to be used</span>
<span class="sd">      as x-axis in plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;UNFINISHED: DO NOT USE!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Re-collate statistics as required</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
        
    <span class="c1"># Check requested stats is in dict</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid statistic selected!&quot;</span><span class="p">)</span>
        
    <span class="c1"># Obtain responses names</span>
    <span class="n">responseNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names_list</span>
    <span class="k">print</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
    
    <span class="c1"># Get index and value to use along x-axis</span>
    <span class="c1">#kwargs2permute = list(self.vals2permute.keys())</span>
    <span class="c1">#key2plot_index=[i for i, x in enumerate(kwargs2permute) if x==key2plot][0]</span>
    
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">xConversionFactor</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span><span class="p">[</span><span class="n">key2plot</span><span class="p">])</span>
    <span class="c1"># Retrieve stats to plot</span>
    <span class="n">stats_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">stat_name</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;stats_arr.shape: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Current manual workaround to produce load vs velocity plot!</span>
<span class="sd">    (Code should be tidied to be more generic)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create figure for each set of responses</span>
    <span class="n">nFigures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
    <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">fig_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nFigures</span><span class="p">):</span>
            
        <span class="n">nSubplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">])</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize_inches</span><span class="p">)</span>
        
        <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="c1"># Create subplots for each response</span>
        <span class="k">for</span> <span class="n">splt_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">):</span>
            
            <span class="n">r</span> <span class="o">=</span> <span class="n">splt_index</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">splt_index</span><span class="p">]</span>
            <span class="n">vals2plot</span> <span class="o">=</span> <span class="n">stats_arr</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">vals2plot</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">splt_index</span><span class="o">==</span><span class="n">nSubplots</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.PedestrianDynamics_transientAnalyses.run">
    <p>def <span class="ident">run</span>(</p><p>self, save=True, solveInParallel=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Runs multiple dynamic analyses, as defined by <code>__init__</code></p>
<hr />
<p>In principle this can be done in parallel, to efficiently use all 
avaliable cores and give improve runtime.</p>
<p><em>Parallel processing not yet implemented due to outstanding bug 
associated with using <code>multiprocessing</code> module from within Spyder</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.PedestrianDynamics_transientAnalyses.run', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.PedestrianDynamics_transientAnalyses.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">solveInParallel</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs multiple dynamic analyses, as defined by `__init__`</span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    In principle this can be done in parallel, to efficiently use all </span>
<span class="sd">    avaliable cores and give improve runtime.</span>
<span class="sd">    </span>
<span class="sd">    _Parallel processing not yet implemented due to outstanding bug </span>
<span class="sd">    associated with using `multiprocessing` module from within Spyder_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running multiple `{0}`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">))</span>
    <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        
    <span class="c1"># Run analyses using parallel processing (if possible)</span>
    <span class="k">if</span> <span class="n">solveInParallel</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Parallel processing not yet implemented due to &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;outstanding bug associated with using &quot;</span><span class="o">+</span>
              <span class="s2">&quot;`multiprocessing` module from within Spyder</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
              <span class="s2">&quot;A single-process analysis will be carried out instead.&quot;</span><span class="p">)</span>    
    <span class="c1"># Run all pre-defined analyses</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">):</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis #</span><span class="si">%04d</span><span class="s2"> of #</span><span class="si">%04d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)))</span>
        <span class="n">x</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="c1">#clear line for emphasis</span>
    
    <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Multiple `</span><span class="si">%s</span><span class="s2">` analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds!</span><span class="se">\n</span><span class="s2">&quot;</span> 
          <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">,(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)))</span>
        
    <span class="c1"># Reshape results objects in ndarray</span>
    <span class="n">results_obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">]</span>
    <span class="n">reqdShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span>
    <span class="n">results_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">results_obj_list</span><span class="p">,</span><span class="n">reqdShape</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="o">=</span> <span class="n">results_arr</span>
    
    <span class="c1"># Collate statistics</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
    
    <span class="c1"># Pickle results</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.PedestrianDynamics_transientAnalyses.save">
    <p>def <span class="ident">save</span>(</p><p>self, fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Serialises object to file <code>fName</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.PedestrianDynamics_transientAnalyses.save', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.PedestrianDynamics_transientAnalyses.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialises object to file `fName`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="dyn_analysis.PedestrianDynamics_transientAnalyses.bridgeClass" class="name">var <span class="ident">bridgeClass</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="dyn_analysis.UKNA_BSEN1991_2_crowd" class="name">class <span class="ident">UKNA_BSEN1991_2_crowd</span></p>
      
  
    <div class="desc"><p>Class to implement crowd loading analysis to UK NA to BS EN1991-2</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.UKNA_BSEN1991_2_crowd', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.UKNA_BSEN1991_2_crowd" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_crowd</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to implement crowd loading analysis to UK NA to BS EN1991-2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                 <span class="n">deck_width_func_list</span><span class="o">=</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">],</span>
                 <span class="n">modeshapes_fname_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;modeshapes_edge1.csv&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;modeshapes_edge2.csv&quot;</span><span class="p">],</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">               </span>
<span class="sd">        * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">            </span>
<span class="sd">        * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">          to targeted</span>
<span class="sd">          </span>
<span class="sd">        * `modeshapes_fname_list`, list of strings denoting files containing </span>
<span class="sd">          modeshape data along minimum of 2 deck lines:</span>
<span class="sd">              </span>
<span class="sd">              * List length = nDeckLines</span>
<span class="sd">              </span>
<span class="sd">              * Minimum nDeckLines = 2</span>
<span class="sd">          </span>
<span class="sd">        * `deck_width_func_list`, list of functions to denote how width (m) of </span>
<span class="sd">          each deck strip (between lines relating to `modeshapes_fname_list`)</span>
<span class="sd">          varies with chainage:</span>
<span class="sd">              </span>
<span class="sd">              * List length = (nDeckLines-1) required (this is checked)</span>
<span class="sd">              </span>
<span class="sd">              * Default function establishes single deck strip of width = 3.0m.</span>
<span class="sd">    </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">          computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">          used (conservative).</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Create default name for analysis object</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - Crowd&quot;</span> <span class="o">%</span> <span class="n">mode_index</span>
            
        <span class="c1"># Check `modeshapes_fname_list` input</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modeshapes_fname_list`: list expected&quot;</span><span class="p">)</span>
            
        <span class="n">nDeckLines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">nDeckLines</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Minimum of 2 deck lines must be defined &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;via `modeshapes_fname_list`&quot;</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_str</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modeshapes_fname_list[</span><span class="si">%d</span><span class="s2">]`&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span>
                                 <span class="s2">&quot; does not exist!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check `deck_width_func_list` input</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`deck_width_func_list`: list expected&quot;</span><span class="p">)</span>
            
        <span class="n">nDeckStrips</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">nDeckStrips</span> <span class="o">!=</span> <span class="n">nDeckLines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nDeckStrips = nDeckLines - 1 expected&quot;</span><span class="p">)</span>
            
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">width_func</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">width_func</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`deck_width_func_list[</span><span class="si">%d</span><span class="s2">]`&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> 
                                 <span class="s2">&quot; is not a function&quot;</span><span class="p">)</span>
                
            
        <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
        <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;CHECK DENSITIES!&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">crowd_density</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># persons/m2</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
            <span class="n">crowd_density</span><span class="o">=</span><span class="mf">0.4</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">crowd_density</span><span class="o">=</span><span class="mf">0.8</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
            <span class="n">crowd_density</span><span class="o">=</span><span class="mf">1.5</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Read modeshape data from file, determine interpolation functions</span>
        <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">modeshapeFunc_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">fName</span> <span class="ow">in</span> <span class="n">modeshapes_fname_list</span><span class="p">:</span>
            
            <span class="n">mfunc</span><span class="p">,</span> <span class="n">Ltrack</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">DefineModeshapes</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">fName</span><span class="p">,</span>
                                                          <span class="n">saveAsAttr</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            <span class="n">Ltrack_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ltrack</span><span class="p">)</span>
            <span class="n">modeshapeFunc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mfunc</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#dyn_analysis.UKNA_BSEN1991_2_crowd">UKNA_BSEN1991_2_crowd</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="dyn_analysis.UKNA_BSEN1991_2_crowd.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, modalsys_obj, mode_index, deck_width_func_list=[&lt;function UKNA_BSEN1991_2_crowd.&lt;lambda&gt; at 0x000000000E1A9D90&gt;], modeshapes_fname_list=[&#39;modeshapes_edge1.csv&#39;, &#39;modeshapes_edge2.csv&#39;], name=None, bridgeClass=&#39;A&#39;, verbose=True, calc_Seff=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>modalsys_obj</code>, object defining modal system to be analysed</p>
</li>
<li>
<p><code>mode_index</code>, <em>integer</em> to denote mode at which resonance should 
  to targeted</p>
</li>
<li>
<p><code>modeshapes_fname_list</code>, list of strings denoting files containing 
  modeshape data along minimum of 2 deck lines:</p>
<ul>
<li>
<p>List length = nDeckLines</p>
</li>
<li>
<p>Minimum nDeckLines = 2</p>
</li>
</ul>
</li>
<li>
<p><code>deck_width_func_list</code>, list of functions to denote how width (m) of 
  each deck strip (between lines relating to <code>modeshapes_fname_list</code>)
  varies with chainage:</p>
<ul>
<li>
<p>List length = (nDeckLines-1) required (this is checked)</p>
</li>
<li>
<p>Default function establishes single deck strip of width = 3.0m.</p>
</li>
</ul>
</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li>calc_Seff`, <em>boolean</em>, dictates whether effective span will be 
  computed according to Figure NA.7. If False, overall span will be 
  used (conservative).</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.UKNA_BSEN1991_2_crowd.__init__', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.UKNA_BSEN1991_2_crowd.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">modalsys_obj</span><span class="p">,</span>
             <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
             <span class="n">deck_width_func_list</span><span class="o">=</span><span class="p">[</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">3.0</span><span class="p">],</span>
             <span class="n">modeshapes_fname_list</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;modeshapes_edge1.csv&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;modeshapes_edge2.csv&quot;</span><span class="p">],</span>
             <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">           </span>
<span class="sd">    * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">        </span>
<span class="sd">    * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">      to targeted</span>
<span class="sd">      </span>
<span class="sd">    * `modeshapes_fname_list`, list of strings denoting files containing </span>
<span class="sd">      modeshape data along minimum of 2 deck lines:</span>
<span class="sd">          </span>
<span class="sd">          * List length = nDeckLines</span>
<span class="sd">          </span>
<span class="sd">          * Minimum nDeckLines = 2</span>
<span class="sd">      </span>
<span class="sd">    * `deck_width_func_list`, list of functions to denote how width (m) of </span>
<span class="sd">      each deck strip (between lines relating to `modeshapes_fname_list`)</span>
<span class="sd">      varies with chainage:</span>
<span class="sd">          </span>
<span class="sd">          * List length = (nDeckLines-1) required (this is checked)</span>
<span class="sd">          </span>
<span class="sd">          * Default function establishes single deck strip of width = 3.0m.</span>

<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">      computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">      used (conservative).</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create default name for analysis object</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - Crowd&quot;</span> <span class="o">%</span> <span class="n">mode_index</span>
        
    <span class="c1"># Check `modeshapes_fname_list` input</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modeshapes_fname_list`: list expected&quot;</span><span class="p">)</span>
        
    <span class="n">nDeckLines</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">nDeckLines</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Minimum of 2 deck lines must be defined &quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;via `modeshapes_fname_list`&quot;</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">file_str</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">modeshapes_fname_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modeshapes_fname_list[</span><span class="si">%d</span><span class="s2">]`&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span>
                             <span class="s2">&quot; does not exist!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check `deck_width_func_list` input</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`deck_width_func_list`: list expected&quot;</span><span class="p">)</span>
        
    <span class="n">nDeckStrips</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">nDeckStrips</span> <span class="o">!=</span> <span class="n">nDeckLines</span> <span class="o">-</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nDeckStrips = nDeckLines - 1 expected&quot;</span><span class="p">)</span>
        
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">width_func</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">deck_width_func_list</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">width_func</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`deck_width_func_list[</span><span class="si">%d</span><span class="s2">]`&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> 
                             <span class="s2">&quot; is not a function&quot;</span><span class="p">)</span>
            
        
    <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
    <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;CHECK DENSITIES!&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
        <span class="n">crowd_density</span><span class="o">=</span><span class="mi">0</span> <span class="c1"># persons/m2</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
        <span class="n">crowd_density</span><span class="o">=</span><span class="mf">0.4</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">crowd_density</span><span class="o">=</span><span class="mf">0.8</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
        <span class="n">crowd_density</span><span class="o">=</span><span class="mf">1.5</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Read modeshape data from file, determine interpolation functions</span>
    <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">modeshapeFunc_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">fName</span> <span class="ow">in</span> <span class="n">modeshapes_fname_list</span><span class="p">:</span>
        
        <span class="n">mfunc</span><span class="p">,</span> <span class="n">Ltrack</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">DefineModeshapes</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">fName</span><span class="p">,</span>
                                                      <span class="n">saveAsAttr</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="n">Ltrack_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ltrack</span><span class="p">)</span>
        <span class="n">modeshapeFunc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mfunc</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
      </div>
      </div>
      
      <div class="item">
      <p id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers" class="name">class <span class="ident">UKNA_BSEN1991_2_walkers_joggers</span></p>
      
  
    <div class="desc"><p>Implements transient analysis for walkers/joggers case
per NA.2.44.4 of UK NA to BS EN 1992-1:2003</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_walkers_joggers</span><span class="p">(</span><span class="n">MovingLoadAnalysis</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Implements transient analysis for walkers/joggers case</span>
<span class="sd">        per NA.2.44.4 of UK NA to BS EN 1992-1:2003</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                     <span class="n">modalsys_obj</span><span class="p">,</span>
                     <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                     <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                     <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Initialisation function</span>
<span class="sd">            </span>
<span class="sd">            ***</span>
<span class="sd">            Required:</span>
<span class="sd">               </span>
<span class="sd">            * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">            </span>
<span class="sd">            * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">              to targeted</span>
<span class="sd">        </span>
<span class="sd">            ***</span>
<span class="sd">            Optional:</span>
<span class="sd">                </span>
<span class="sd">            * `dt`, time step to be used for results evaluation. If _None_ then </span>
<span class="sd">              a reasonable time step to use will be determined, based on the </span>
<span class="sd">              frequency of the forcing function</span>
<span class="sd">            </span>
<span class="sd">            * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">              computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">              used (conservative).</span>
<span class="sd">            </span>
<span class="sd">            Additional keyword arguments can be defined. These should relate </span>
<span class="sd">            the `__init__()` function of the `MovingLoadAnalysis` class </span>
<span class="sd">                </span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="c1"># Create default name for analysis object</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="p">,</span>
                                                                <span class="n">analysis_type</span><span class="p">)</span>
            
            <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
            <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
            
            <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
                <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">2</span>
                <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">0</span>
                
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
                <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">4</span>
                <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">1</span>
                
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">8</span>
                <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">2</span>
                
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
                <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">16</span>
                <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">4</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
            
            <span class="c1"># Define loading velocity per Table NA.8</span>
            <span class="c1"># Get appropriate N value to use</span>
            <span class="k">if</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
                <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">1.7</span>
                <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_walkers</span>
                
            <span class="k">elif</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
                <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">3.0</span>
                <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_joggers</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span><span class="p">)</span>
                
            <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N_to_use</span>
                
            <span class="c1"># Get natural frequency of mode to consider</span>
            <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
            <span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">]</span> <span class="c1"># damped natural frequencies of mode</span>
            <span class="n">f_d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
            
            <span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="n">mode_index</span><span class="p">]</span>
            <span class="n">logdec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">logdec</span> <span class="o">=</span> <span class="n">logdec</span>
            
            <span class="c1"># Analyse modeshape to determine effective span</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
            
            <span class="k">if</span> <span class="n">calc_Seff</span><span class="p">:</span>
                
                <span class="n">attrName</span> <span class="o">=</span> <span class="s2">&quot;Seff&quot;</span>
                
                <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">):</span>
                    <span class="n">Seff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">)</span>
                
                <span class="k">else</span><span class="p">:</span>
                    
                    <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">Calc_Seff</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span>
                                                  <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                                  <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
                    
                    <span class="c1"># save to avoid recalculating</span>
                    <span class="nb">setattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span> 
                    <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">lambda_vals</span>
                    
                <span class="c1"># Get Seff for mode being considered</span>
                <span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mode_index</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># &quot;In all cases it is conservative to use Seff = S&quot;</span>
                <span class="n">Seff</span> <span class="o">=</span> <span class="n">S</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span>
            
            <span class="c1"># Obtain gamma from Figure NA.9</span>
            <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logdec</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
            
            <span class="c1"># Define loading objects to represent walkers and joggers</span>
            <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">pedestrian_loading</span><span class="p">(</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span><span class="p">,</span>
                                             <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                             <span class="n">N</span><span class="o">=</span><span class="n">N_to_use</span><span class="p">,</span>
                                             <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">)</span>
            
            <span class="c1"># Determine reasonable time step to use</span>
            <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="c1"># Rule of thumb - 10x frequency under consideration</span>
                <span class="n">fs</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">f_d</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span>  
            
            <span class="c1"># Run parent init</span>
            <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                             <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                             <span class="n">loadtrain_obj</span><span class="o">=</span><span class="n">loading_obj</span><span class="p">,</span>
                             <span class="n">loadVel</span><span class="o">=</span><span class="n">load_velocity</span><span class="p">,</span>
                             <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c1"># use sign-corrected modeshapes</span>
                             <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                             <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Transient moving load analysis initialised *****&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal system:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode index:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode frequency:</span><span class="se">\t\t</span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">f_d</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Loading object:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity:</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2"> m/s&quot;</span> <span class="o">%</span> <span class="n">load_velocity</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Seff</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;gamma:</span><span class="se">\t\t\t</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#dyn_analysis.UKNA_BSEN1991_2_walkers_joggers">UKNA_BSEN1991_2_walkers_joggers</a></li>
          <li><a href="#dyn_analysis.MovingLoadAnalysis">MovingLoadAnalysis</a></li>
          <li><a href="#dyn_analysis.Dyn_Analysis">Dyn_Analysis</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, modalsys_obj, mode_index, name=None, bridgeClass=&#39;A&#39;, analysis_type=&#39;walkers&#39;, dt=None, verbose=True, calc_Seff=True, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>modalsys_obj</code>, object defining modal system to be analysed</p>
</li>
<li>
<p><code>mode_index</code>, <em>integer</em> to denote mode at which resonance should 
  to targeted</p>
</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>dt</code>, time step to be used for results evaluation. If <em>None</em> then 
  a reasonable time step to use will be determined, based on the 
  frequency of the forcing function</p>
</li>
<li>
<p>calc_Seff`, <em>boolean</em>, dictates whether effective span will be 
  computed according to Figure NA.7. If False, overall span will be 
  used (conservative).</p>
</li>
</ul>
<p>Additional keyword arguments can be defined. These should relate 
the <code>__init__()</code> function of the <code>MovingLoadAnalysis</code> class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.__init__', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">modalsys_obj</span><span class="p">,</span>
             <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
             <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
             <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
             <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">       </span>
<span class="sd">    * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">    </span>
<span class="sd">    * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">      to targeted</span>

<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `dt`, time step to be used for results evaluation. If _None_ then </span>
<span class="sd">      a reasonable time step to use will be determined, based on the </span>
<span class="sd">      frequency of the forcing function</span>
<span class="sd">    </span>
<span class="sd">    * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">      computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">      used (conservative).</span>
<span class="sd">    </span>
<span class="sd">    Additional keyword arguments can be defined. These should relate </span>
<span class="sd">    the `__init__()` function of the `MovingLoadAnalysis` class </span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create default name for analysis object</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="p">,</span>
                                                        <span class="n">analysis_type</span><span class="p">)</span>
    
    <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
    <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
        <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
        <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">2</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
        <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">4</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Define loading velocity per Table NA.8</span>
    <span class="c1"># Get appropriate N value to use</span>
    <span class="k">if</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
        <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">1.7</span>
        <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_walkers</span>
        
    <span class="k">elif</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
        <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">3.0</span>
        <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_joggers</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N_to_use</span>
        
    <span class="c1"># Get natural frequency of mode to consider</span>
    <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
    <span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">]</span> <span class="c1"># damped natural frequencies of mode</span>
    <span class="n">f_d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
    
    <span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="n">mode_index</span><span class="p">]</span>
    <span class="n">logdec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logdec</span> <span class="o">=</span> <span class="n">logdec</span>
    
    <span class="c1"># Analyse modeshape to determine effective span</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
    
    <span class="k">if</span> <span class="n">calc_Seff</span><span class="p">:</span>
        
        <span class="n">attrName</span> <span class="o">=</span> <span class="s2">&quot;Seff&quot;</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">):</span>
            <span class="n">Seff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">Calc_Seff</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span>
                                          <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                          <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
            
            <span class="c1"># save to avoid recalculating</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span> 
            <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">lambda_vals</span>
            
        <span class="c1"># Get Seff for mode being considered</span>
        <span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mode_index</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># &quot;In all cases it is conservative to use Seff = S&quot;</span>
        <span class="n">Seff</span> <span class="o">=</span> <span class="n">S</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span>
    
    <span class="c1"># Obtain gamma from Figure NA.9</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logdec</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
    
    <span class="c1"># Define loading objects to represent walkers and joggers</span>
    <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">pedestrian_loading</span><span class="p">(</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span><span class="p">,</span>
                                     <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                     <span class="n">N</span><span class="o">=</span><span class="n">N_to_use</span><span class="p">,</span>
                                     <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">)</span>
    
    <span class="c1"># Determine reasonable time step to use</span>
    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Rule of thumb - 10x frequency under consideration</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">f_d</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span>  
    
    <span class="c1"># Run parent init</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                     <span class="n">loadtrain_obj</span><span class="o">=</span><span class="n">loading_obj</span><span class="p">,</span>
                     <span class="n">loadVel</span><span class="o">=</span><span class="n">load_velocity</span><span class="p">,</span>
                     <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c1"># use sign-corrected modeshapes</span>
                     <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Transient moving load analysis initialised *****&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal system:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode index:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode frequency:</span><span class="se">\t\t</span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">f_d</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Loading object:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity:</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2"> m/s&quot;</span> <span class="o">%</span> <span class="n">load_velocity</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Seff</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;gamma:</span><span class="se">\t\t\t</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.PlotResults">
    <p>def <span class="ident">PlotResults</span>(</p><p>self, dofs2Plot=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots results using <code>tstep_results.PlotResults()</code>.</p>
<p><em>Refer documentation from that function for further details</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.PlotResults', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.PlotResults" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">PlotResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots results using `tstep_results.PlotResults()`.</span>
<span class="sd">    </span>
<span class="sd">    _Refer documentation from that function for further details_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results_obj</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="n">dofs2Plot</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.run">
    <p>def <span class="ident">run</span>(</p><p>self, saveResults=False, save_fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Runs moving load analysis, using <code>tstep.run()</code></p>
<p><em>Refer documentation for that function for more details</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.run', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">save_fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs moving load analysis, using `tstep.run()`</span>
<span class="sd">    </span>
<span class="sd">    _Refer documentation for that function for more details_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Running `</span><span class="si">%s</span><span class="s2">`...&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Dynamic system: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load pattern: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadVel</span><span class="p">)</span>
    <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    
    <span class="n">results_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
    
    <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>
           
    <span class="k">if</span> <span class="n">saveResults</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">save_fName</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">results_obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.save">
    <p>def <span class="ident">save</span>(</p><p>self, fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Serialises object to file <code>fName</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.save', this);">Show source &equiv;</a></p>
  <div id="source-dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialises object to file `fName`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.N" class="name">var <span class="ident">N</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.Seff" class="name">var <span class="ident">Seff</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.eta" class="name">var <span class="ident">eta</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.fv" class="name">var <span class="ident">fv</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.gamma" class="name">var <span class="ident">gamma</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="dyn_analysis.UKNA_BSEN1991_2_walkers_joggers.logdec" class="name">var <span class="ident">logdec</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>