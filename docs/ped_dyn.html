Version: 1.6.2_dev
<!doctype html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />

    <title>ped_dyn API documentation</title>
    <meta name="description" content="Classes used to implement pedestrian dynamics analyses

@author: rihy" />

  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:400,300' rel='stylesheet' type='text/css'>
  
  <style type="text/css">
  
* {
  box-sizing: border-box;
}
/*! normalize.css v1.1.1 | MIT License | git.io/normalize */

/* ==========================================================================
   HTML5 display definitions
   ========================================================================== */

/**
 * Correct `block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block;
}

/**
 * Correct `inline-block` display not defined in IE 6/7/8/9 and Firefox 3.
 */

audio,
canvas,
video {
    display: inline-block;
    *display: inline;
    *zoom: 1;
}

/**
 * Prevent modern browsers from displaying `audio` without controls.
 * Remove excess height in iOS 5 devices.
 */

audio:not([controls]) {
    display: none;
    height: 0;
}

/**
 * Address styling not present in IE 7/8/9, Firefox 3, and Safari 4.
 * Known issue: no IE 6 support.
 */

[hidden] {
    display: none;
}

/* ==========================================================================
   Base
   ========================================================================== */

/**
 * 1. Prevent system color scheme's background color being used in Firefox, IE,
 *    and Opera.
 * 2. Prevent system color scheme's text color being used in Firefox, IE, and
 *    Opera.
 * 3. Correct text resizing oddly in IE 6/7 when body `font-size` is set using
 *    `em` units.
 * 4. Prevent iOS text size adjust after orientation change, without disabling
 *    user zoom.
 */

html {
    background: #fff; /* 1 */
    color: #000; /* 2 */
    font-size: 100%; /* 3 */
    -webkit-text-size-adjust: 100%; /* 4 */
    -ms-text-size-adjust: 100%; /* 4 */
}

/**
 * Address `font-family` inconsistency between `textarea` and other form
 * elements.
 */

html,
button,
input,
select,
textarea {
    font-family: sans-serif;
}

/**
 * Address margins handled incorrectly in IE 6/7.
 */

body {
    margin: 0;
}

/* ==========================================================================
   Links
   ========================================================================== */

/**
 * Address `outline` inconsistency between Chrome and other browsers.
 */

a:focus {
    outline: thin dotted;
}

/**
 * Improve readability when focused and also mouse hovered in all browsers.
 */

a:active,
a:hover {
    outline: 0;
}

/* ==========================================================================
   Typography
   ========================================================================== */

/**
 * Address font sizes and margins set differently in IE 6/7.
 * Address font sizes within `section` and `article` in Firefox 4+, Safari 5,
 * and Chrome.
 */

h1 {
    font-size: 2em;
    margin: 0.67em 0;
}

h2 {
    font-size: 1.5em;
    margin: 0.83em 0;
}

h3 {
    font-size: 1.17em;
    margin: 1em 0;
}

h4 {
    font-size: 1em;
    margin: 1.33em 0;
}

h5 {
    font-size: 0.83em;
    margin: 1.67em 0;
}

h6 {
    font-size: 0.67em;
    margin: 2.33em 0;
}

/**
 * Address styling not present in IE 7/8/9, Safari 5, and Chrome.
 */

abbr[title] {
    border-bottom: 1px dotted;
}

/**
 * Address style set to `bolder` in Firefox 3+, Safari 4/5, and Chrome.
 */

b,
strong {
    font-weight: bold;
}

blockquote {
    margin: 1em 40px;
}

/**
 * Address styling not present in Safari 5 and Chrome.
 */

dfn {
    font-style: italic;
}

/**
 * Address differences between Firefox and other browsers.
 * Known issue: no IE 6/7 normalization.
 */

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0;
}

/**
 * Address styling not present in IE 6/7/8/9.
 */

mark {
    background: #ff0;
    color: #000;
}

/**
 * Address margins set differently in IE 6/7.
 */

p,
pre {
    margin: 1em 0;
}

/**
 * Correct font family set oddly in IE 6, Safari 4/5, and Chrome.
 */

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    _font-family: 'courier new', monospace;
    font-size: 1em;
}

/**
 * Improve readability of pre-formatted text in all browsers.
 */

pre {
    white-space: pre;
    white-space: pre-wrap;
    word-wrap: break-word;
}

/**
 * Address CSS quotes not supported in IE 6/7.
 */

q {
    quotes: none;
}

/**
 * Address `quotes` property not supported in Safari 4.
 */

q:before,
q:after {
    content: '';
    content: none;
}

/**
 * Address inconsistent and variable font size in all browsers.
 */

small {
    font-size: 80%;
}

/**
 * Prevent `sub` and `sup` affecting `line-height` in all browsers.
 */

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline;
}

sup {
    top: -0.5em;
}

sub {
    bottom: -0.25em;
}

/* ==========================================================================
   Lists
   ========================================================================== */

/**
 * Address margins set differently in IE 6/7.
 */

dl,
menu,
ol,
ul {
    margin: 1em 0;
}

dd {
    margin: 0 0 0 40px;
}

/**
 * Address paddings set differently in IE 6/7.
 */

menu,
ol,
ul {
    padding: 0 0 0 40px;
}

/**
 * Correct list images handled incorrectly in IE 7.
 */

nav ul,
nav ol {
    list-style: none;
    list-style-image: none;
}

/* ==========================================================================
   Embedded content
   ========================================================================== */

/**
 * 1. Remove border when inside `a` element in IE 6/7/8/9 and Firefox 3.
 * 2. Improve image quality when scaled in IE 7.
 */

img {
    border: 0; /* 1 */
    -ms-interpolation-mode: bicubic; /* 2 */
}

/**
 * Correct overflow displayed oddly in IE 9.
 */

svg:not(:root) {
    overflow: hidden;
}

/* ==========================================================================
   Figures
   ========================================================================== */

/**
 * Address margin not present in IE 6/7/8/9, Safari 5, and Opera 11.
 */

figure {
    margin: 0;
}

/* ==========================================================================
   Forms
   ========================================================================== */

/**
 * Correct margin displayed oddly in IE 6/7.
 */

form {
    margin: 0;
}

/**
 * Define consistent border, margin, and padding.
 */

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em;
}

/**
 * 1. Correct color not being inherited in IE 6/7/8/9.
 * 2. Correct text not wrapping in Firefox 3.
 * 3. Correct alignment displayed oddly in IE 6/7.
 */

legend {
    border: 0; /* 1 */
    padding: 0;
    white-space: normal; /* 2 */
    *margin-left: -7px; /* 3 */
}

/**
 * 1. Correct font size not being inherited in all browsers.
 * 2. Address margins set differently in IE 6/7, Firefox 3+, Safari 5,
 *    and Chrome.
 * 3. Improve appearance and consistency in all browsers.
 */

button,
input,
select,
textarea {
    font-size: 100%; /* 1 */
    margin: 0; /* 2 */
    vertical-align: baseline; /* 3 */
    *vertical-align: middle; /* 3 */
}

/**
 * Address Firefox 3+ setting `line-height` on `input` using `!important` in
 * the UA stylesheet.
 */

button,
input {
    line-height: normal;
}

/**
 * Address inconsistent `text-transform` inheritance for `button` and `select`.
 * All other form control elements do not inherit `text-transform` values.
 * Correct `button` style inheritance in Chrome, Safari 5+, and IE 6+.
 * Correct `select` style inheritance in Firefox 4+ and Opera.
 */

button,
select {
    text-transform: none;
}

/**
 * 1. Avoid the WebKit bug in Android 4.0.* where (2) destroys native `audio`
 *    and `video` controls.
 * 2. Correct inability to style clickable `input` types in iOS.
 * 3. Improve usability and consistency of cursor style between image-type
 *    `input` and others.
 * 4. Remove inner spacing in IE 7 without affecting normal text inputs.
 *    Known issue: inner spacing remains in IE 6.
 */

button,
html input[type="button"], /* 1 */
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button; /* 2 */
    cursor: pointer; /* 3 */
    *overflow: visible;  /* 4 */
}

/**
 * Re-set default cursor for disabled elements.
 */

button[disabled],
html input[disabled] {
    cursor: default;
}

/**
 * 1. Address box sizing set to content-box in IE 8/9.
 * 2. Remove excess padding in IE 8/9.
 * 3. Remove excess padding in IE 7.
 *    Known issue: excess padding remains in IE 6.
 */

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box; /* 1 */
    padding: 0; /* 2 */
    *height: 13px; /* 3 */
    *width: 13px; /* 3 */
}

/**
 * 1. Address `appearance` set to `searchfield` in Safari 5 and Chrome.
 * 2. Address `box-sizing` set to `border-box` in Safari 5 and Chrome
 *    (include `-moz` to future-proof).
 */

input[type="search"] {
    -webkit-appearance: textfield; /* 1 */
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box; /* 2 */
    box-sizing: content-box;
}

/**
 * Remove inner padding and search cancel button in Safari 5 and Chrome
 * on OS X.
 */

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none;
}

/**
 * Remove inner padding and border in Firefox 3+.
 */

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0;
}

/**
 * 1. Remove default vertical scrollbar in IE 6/7/8/9.
 * 2. Improve readability and alignment in all browsers.
 */

textarea {
    overflow: auto; /* 1 */
    vertical-align: top; /* 2 */
}

/* ==========================================================================
   Tables
   ========================================================================== */

/**
 * Remove most spacing between table cells.
 */

table {
    border-collapse: collapse;
    border-spacing: 0;
}

  </style>

  <style type="text/css">
  
  html, body {
    margin: 0;
    padding: 0;
    min-height: 100%;
  }
  body {
    background: #fff;
    font-family: "Source Sans Pro", "Helvetica Neueue", Helvetica, sans;
    font-weight: 300;
    font-size: 16px;
    line-height: 1.6em;
  }
  #content {
    width: 70%;
    max-width: 850px;
    float: left;
    padding: 30px 60px;
    border-left: 1px solid #ddd;
  }
  #sidebar {
    width: 25%;
    float: left;
    padding: 30px;
    overflow: hidden;
  }
  #nav {
    font-size: 130%;
    margin: 0 0 15px 0;
  }

  #top {
    display: block;
    position: fixed;
    bottom: 5px;
    left: 5px;
    font-size: .85em;
    text-transform: uppercase;
  }

  #footer {
    font-size: .75em;
    padding: 5px 30px;
    border-top: 1px solid #ddd;
    text-align: right;
  }
    #footer p {
      margin: 0 0 0 30px;
      display: inline-block;
    }

  h1, h2, h3, h4, h5 {
    font-weight: 300;
  }
  h1 {
    font-size: 2.5em;
    line-height: 1.1em;
    margin: 0 0 .50em 0;
  }

  h2 {
    font-size: 1.75em;
    margin: 1em 0 .50em 0;
  }

  h3 {
    margin: 25px 0 10px 0;
  }

  h4 {
    margin: 0;
    font-size: 105%;
  }

  a {
    color: #058;
    text-decoration: none;
    transition: color .3s ease-in-out;
  }

  a:hover {
    color: #e08524;
    transition: color .3s ease-in-out;
  }

  pre, code, .mono, .name {
    font-family: "Ubuntu Mono", "Cousine", "DejaVu Sans Mono", monospace;
  }

  .title .name {
    font-weight: bold;
  }
  .section-title {
    margin-top: 2em;
  }
  .ident {
    color: #900;
  }

  code {
    background: #f9f9f9;
  } 

  pre {
    background: #fefefe;
    border: 1px solid #ddd;
    box-shadow: 2px 2px 0 #f3f3f3;
    margin: 0 30px;
    padding: 15px 30px;
  }

  .codehilite {
    margin: 0 30px 10px 30px;
  }

    .codehilite pre {
      margin: 0;
    }
    .codehilite .err { background: #ff3300; color: #fff !important; } 

  table#module-list {
    font-size: 110%;
  }

    table#module-list tr td:first-child {
      padding-right: 10px;
      white-space: nowrap;
    }

    table#module-list td {
      vertical-align: top;
      padding-bottom: 8px;
    }

      table#module-list td p {
        margin: 0 0 7px 0;
      }

  .def {
    display: table;
  }

    .def p {
      display: table-cell;
      vertical-align: top;
      text-align: left;
    }

    .def p:first-child {
      white-space: nowrap;
    }

    .def p:last-child {
      width: 100%;
    }


  #index {
    list-style-type: none;
    margin: 0;
    padding: 0;
  }
    ul#index .class_name {
      /* font-size: 110%; */
      font-weight: bold;
    }
    #index ul {
      margin: 0;
    }

  .item {
    margin: 0 0 15px 0;
  }

    .item .class {
      margin: 0 0 25px 30px;
    }

      .item .class ul.class_list {
        margin: 0 0 20px 0;
      }

    .item .name {
      background: #fafafa;
      margin: 0;
      font-weight: bold;
      padding: 5px 10px;
      border-radius: 3px;
      display: inline-block;
      min-width: 40%;
    }
      .item .name:hover {
        background: #f6f6f6;
      }

    .item .empty_desc {
      margin: 0 0 5px 0;
      padding: 0;
    }

    .item .inheritance {
      margin: 3px 0 0 30px;
    }

    .item .inherited {
      color: #666;
    }

    .item .desc {
      padding: 0 8px;
      margin: 0;
    }

      .item .desc p {
        margin: 0 0 10px 0;
      }

    .source_cont {
      margin: 0;
      padding: 0;
    }

    .source_link a {
      background: #ffc300;
      font-weight: 400;
      font-size: .75em;
      text-transform: uppercase;
      color: #fff;
      text-shadow: 1px 1px 0 #f4b700;
      
      padding: 3px 8px;
      border-radius: 2px;
      transition: background .3s ease-in-out;
    }
      .source_link a:hover {
        background: #FF7200;
        text-shadow: none;
        transition: background .3s ease-in-out;
      }

    .source {
      display: none;
      max-height: 600px;
      overflow-y: scroll;
      margin-bottom: 15px;
    }

      .source .codehilite {
        margin: 0;
      }

  .desc h1, .desc h2, .desc h3 {
    font-size: 100% !important;
  }
  .clear {
    clear: both;
  }

  @media all and (max-width: 950px) {
    #sidebar {
      width: 35%;
    }
    #content {
      width: 65%;
    }
  }
  @media all and (max-width: 650px) {
    #top {
      display: none;
    }
    #sidebar {
      float: none;
      width: auto;
    }
    #content {
      float: none;
      width: auto;
      padding: 30px;
    }

    #index ul {
      padding: 0;
      margin-bottom: 15px;
    }
    #index ul li {
      display: inline-block;
      margin-right: 30px;
    }
    #footer {
      text-align: left;
    }
    #footer p {
      display: block;
      margin: inherit;
    }
  }

  /*****************************/

  </style>

  <style type="text/css">
  .codehilite .hll { background-color: #ffffcc }
.codehilite  { background: #f8f8f8; }
.codehilite .c { color: #408080; font-style: italic } /* Comment */
.codehilite .err { border: 1px solid #FF0000 } /* Error */
.codehilite .k { color: #008000; font-weight: bold } /* Keyword */
.codehilite .o { color: #666666 } /* Operator */
.codehilite .ch { color: #408080; font-style: italic } /* Comment.Hashbang */
.codehilite .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.codehilite .cp { color: #BC7A00 } /* Comment.Preproc */
.codehilite .cpf { color: #408080; font-style: italic } /* Comment.PreprocFile */
.codehilite .c1 { color: #408080; font-style: italic } /* Comment.Single */
.codehilite .cs { color: #408080; font-style: italic } /* Comment.Special */
.codehilite .gd { color: #A00000 } /* Generic.Deleted */
.codehilite .ge { font-style: italic } /* Generic.Emph */
.codehilite .gr { color: #FF0000 } /* Generic.Error */
.codehilite .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.codehilite .gi { color: #00A000 } /* Generic.Inserted */
.codehilite .go { color: #888888 } /* Generic.Output */
.codehilite .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.codehilite .gs { font-weight: bold } /* Generic.Strong */
.codehilite .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.codehilite .gt { color: #0044DD } /* Generic.Traceback */
.codehilite .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.codehilite .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.codehilite .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.codehilite .kp { color: #008000 } /* Keyword.Pseudo */
.codehilite .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.codehilite .kt { color: #B00040 } /* Keyword.Type */
.codehilite .m { color: #666666 } /* Literal.Number */
.codehilite .s { color: #BA2121 } /* Literal.String */
.codehilite .na { color: #7D9029 } /* Name.Attribute */
.codehilite .nb { color: #008000 } /* Name.Builtin */
.codehilite .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.codehilite .no { color: #880000 } /* Name.Constant */
.codehilite .nd { color: #AA22FF } /* Name.Decorator */
.codehilite .ni { color: #999999; font-weight: bold } /* Name.Entity */
.codehilite .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.codehilite .nf { color: #0000FF } /* Name.Function */
.codehilite .nl { color: #A0A000 } /* Name.Label */
.codehilite .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.codehilite .nt { color: #008000; font-weight: bold } /* Name.Tag */
.codehilite .nv { color: #19177C } /* Name.Variable */
.codehilite .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.codehilite .w { color: #bbbbbb } /* Text.Whitespace */
.codehilite .mb { color: #666666 } /* Literal.Number.Bin */
.codehilite .mf { color: #666666 } /* Literal.Number.Float */
.codehilite .mh { color: #666666 } /* Literal.Number.Hex */
.codehilite .mi { color: #666666 } /* Literal.Number.Integer */
.codehilite .mo { color: #666666 } /* Literal.Number.Oct */
.codehilite .sa { color: #BA2121 } /* Literal.String.Affix */
.codehilite .sb { color: #BA2121 } /* Literal.String.Backtick */
.codehilite .sc { color: #BA2121 } /* Literal.String.Char */
.codehilite .dl { color: #BA2121 } /* Literal.String.Delimiter */
.codehilite .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.codehilite .s2 { color: #BA2121 } /* Literal.String.Double */
.codehilite .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.codehilite .sh { color: #BA2121 } /* Literal.String.Heredoc */
.codehilite .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.codehilite .sx { color: #008000 } /* Literal.String.Other */
.codehilite .sr { color: #BB6688 } /* Literal.String.Regex */
.codehilite .s1 { color: #BA2121 } /* Literal.String.Single */
.codehilite .ss { color: #19177C } /* Literal.String.Symbol */
.codehilite .bp { color: #008000 } /* Name.Builtin.Pseudo */
.codehilite .fm { color: #0000FF } /* Name.Function.Magic */
.codehilite .vc { color: #19177C } /* Name.Variable.Class */
.codehilite .vg { color: #19177C } /* Name.Variable.Global */
.codehilite .vi { color: #19177C } /* Name.Variable.Instance */
.codehilite .vm { color: #19177C } /* Name.Variable.Magic */
.codehilite .il { color: #666666 } /* Literal.Number.Integer.Long */
  </style>

  <style type="text/css">
  
/* ==========================================================================
   EXAMPLE Media Queries for Responsive Design.
   These examples override the primary ('mobile first') styles.
   Modify as content requires.
   ========================================================================== */

@media only screen and (min-width: 35em) {
    /* Style adjustments for viewports that meet the condition */
}

@media print,
       (-o-min-device-pixel-ratio: 5/4),
       (-webkit-min-device-pixel-ratio: 1.25),
       (min-resolution: 120dpi) {
    /* Style adjustments for high resolution devices */
}

/* ==========================================================================
   Print styles.
   Inlined to avoid required HTTP connection: h5bp.com/r
   ========================================================================== */

@media print {
    * {
        background: transparent !important;
        color: #000 !important; /* Black prints faster: h5bp.com/s */
        box-shadow: none !important;
        text-shadow: none !important;
    }

    a,
    a:visited {
        text-decoration: underline;
    }

    a[href]:after {
        content: " (" attr(href) ")";
    }

    abbr[title]:after {
        content: " (" attr(title) ")";
    }

    /*
     * Don't show links for images, or javascript/internal links
     */

    .ir a:after,
    a[href^="javascript:"]:after,
    a[href^="#"]:after {
        content: "";
    }

    pre,
    blockquote {
        border: 1px solid #999;
        page-break-inside: avoid;
    }

    thead {
        display: table-header-group; /* h5bp.com/t */
    }

    tr,
    img {
        page-break-inside: avoid;
    }

    img {
        max-width: 100% !important;
    }

    @page {
        margin: 0.5cm;
    }

    p,
    h2,
    h3 {
        orphans: 3;
        widows: 3;
    }

    h2,
    h3 {
        page-break-after: avoid;
    }
}

  </style>

  <script type="text/javascript">
  function toggle(id, $link) {
    $node = document.getElementById(id);
    if (!$node)
    return;
    if (!$node.style.display || $node.style.display == 'none') {
    $node.style.display = 'block';
    $link.innerHTML = 'Hide source &nequiv;';
    } else {
    $node.style.display = 'none';
    $link.innerHTML = 'Show source &equiv;';
    }
  }
  </script>
</head>
<body>
<a href="#" id="top">Top</a>

<div id="container">
    
  
  <div id="sidebar">
    <h1>Index</h1>
    <ul id="index">
    <li class="set"><h3><a href="#header-variables">Module variables</a></h3>
      
  <ul>
    <li class="mono"><a href="#ped_dyn.currentVersion">currentVersion</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-functions">Functions</a></h3>
      
  <ul>
    <li class="mono"><a href="#ped_dyn.Calc_Seff">Calc_Seff</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_Figure_NA_11">UKNA_BSEN1991_2_Figure_NA_11</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_Figure_NA_8">UKNA_BSEN1991_2_Figure_NA_8</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_Figure_NA_9">UKNA_BSEN1991_2_Figure_NA_9</a></li>
    <li class="mono"><a href="#ped_dyn.calc_psi_HIVOSS">calc_psi_HIVOSS</a></li>
  </ul>

    </li>

    <li class="set"><h3><a href="#header-classes">Classes</a></h3>
      <ul>
        <li class="mono">
        <span class="class_name"><a href="#ped_dyn.HIVOSS">HIVOSS</a></span>
        
          
  <ul>
    <li class="mono"><a href="#ped_dyn.HIVOSS.__init__">__init__</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.calc_deck_area">calc_deck_area</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.calc_load_intensity">calc_load_intensity</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.calc_modal_areas">calc_modal_areas</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.calc_responses">calc_responses</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.get_response_amplitudes">get_response_amplitudes</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.get_response_stats">get_response_stats</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.plot_results">plot_results</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.plot_results_freq_method">plot_results_freq_method</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.plot_results_modal_accn">plot_results_modal_accn</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.plot_results_responses">plot_results_responses</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.plot_results_tstep_method">plot_results_tstep_method</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.print_details">print_details</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.print_results">print_results</a></li>
    <li class="mono"><a href="#ped_dyn.HIVOSS.run">run</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#ped_dyn.LatSync_McRobie">LatSync_McRobie</a></span>
        
          
  <ul>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.__init__">__init__</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.calc_Np_crit">calc_Np_crit</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.calc_pedestrian_effect">calc_pedestrian_effect</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.init_cp_func">init_cp_func</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.init_mp_func">init_mp_func</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.plot_cp_func">plot_cp_func</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.plot_damping_vs_freq">plot_damping_vs_freq</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.plot_damping_vs_pedestrians">plot_damping_vs_pedestrians</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.plot_mp_func">plot_mp_func</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.plot_poles">plot_poles</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.plot_results">plot_results</a></li>
    <li class="mono"><a href="#ped_dyn.LatSync_McRobie.run">run</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#ped_dyn.PedestrianDynamics_transientAnalyses">PedestrianDynamics_transientAnalyses</a></span>
        
          
  <ul>
    <li class="mono"><a href="#ped_dyn.PedestrianDynamics_transientAnalyses.__init__">__init__</a></li>
    <li class="mono"><a href="#ped_dyn.PedestrianDynamics_transientAnalyses.collate_stats">collate_stats</a></li>
    <li class="mono"><a href="#ped_dyn.PedestrianDynamics_transientAnalyses.plot_modal_params">plot_modal_params</a></li>
    <li class="mono"><a href="#ped_dyn.PedestrianDynamics_transientAnalyses.plot_response_stats">plot_response_stats</a></li>
    <li class="mono"><a href="#ped_dyn.PedestrianDynamics_transientAnalyses.plot_stats">plot_stats</a></li>
    <li class="mono"><a href="#ped_dyn.PedestrianDynamics_transientAnalyses.run">run</a></li>
    <li class="mono"><a href="#ped_dyn.PedestrianDynamics_transientAnalyses.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#ped_dyn.SteadyStateCrowdLoading">SteadyStateCrowdLoading</a></span>
        
          
  <ul>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.__init__">__init__</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.calc_deck_area">calc_deck_area</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.calc_load_intensity">calc_load_intensity</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.calc_modal_areas">calc_modal_areas</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.calc_responses">calc_responses</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.get_response_amplitudes">get_response_amplitudes</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.get_response_stats">get_response_stats</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.plot_results">plot_results</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.plot_results_freq_method">plot_results_freq_method</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.plot_results_modal_accn">plot_results_modal_accn</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.plot_results_responses">plot_results_responses</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.plot_results_tstep_method">plot_results_tstep_method</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.print_details">print_details</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.print_results">print_results</a></li>
    <li class="mono"><a href="#ped_dyn.SteadyStateCrowdLoading.run">run</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd">UKNA_BSEN1991_2_crowd</a></span>
        
          
  <ul>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.__init__">__init__</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.calc_deck_area">calc_deck_area</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.calc_load_intensity">calc_load_intensity</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.calc_modal_areas">calc_modal_areas</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.calc_responses">calc_responses</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.get_crowd_density">get_crowd_density</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.get_response_amplitudes">get_response_amplitudes</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.get_response_stats">get_response_stats</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.plot_results">plot_results</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_freq_method">plot_results_freq_method</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_modal_accn">plot_results_modal_accn</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_responses">plot_results_responses</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_tstep_method">plot_results_tstep_method</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.print_details">print_details</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.print_results">print_results</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_crowd.run">run</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers">UKNA_BSEN1991_2_walkers_joggers</a></span>
        
          
  <ul>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers.__init__">__init__</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers.PlotResults">PlotResults</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers.run">run</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers.save">save</a></li>
  </ul>

        </li>
        <li class="mono">
        <span class="class_name"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading">UKNA_BSEN1991_2_walkers_joggers_loading</a></span>
        
          
  <ul>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.__init__">__init__</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.PrintDetails">PrintDetails</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.evaluate_loads">evaluate_loads</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot">plot</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot_init">plot_init</a></li>
    <li class="mono"><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot_update">plot_update</a></li>
  </ul>

        </li>
      </ul>
    </li>

    </ul>
  </div>

    <article id="content">
      
  

  


  <header id="section-intro">
  <h1 class="title"><span class="name">ped_dyn</span> module</h1>
  <p>Classes used to implement pedestrian dynamics analyses</p>
<p>@author: rihy</p>
  
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn" class="source">
    <div class="codehilite"><pre><span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Classes used to implement pedestrian dynamics analyses</span>

<span class="sd">@author: rihy</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">from</span> <span class="nn">__init__</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">currentVersion</span>

<span class="c1"># Std imports</span>
<span class="kn">import</span> <span class="nn">numpy</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">scipy</span>
<span class="kn">import</span> <span class="nn">pandas</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.gridspec</span> <span class="kn">as</span> <span class="nn">gridspec</span>
<span class="kn">from</span> <span class="nn">matplotlib.ticker</span> <span class="kn">import</span> <span class="n">FuncFormatter</span>
<span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">inspect</span> <span class="kn">import</span> <span class="n">isfunction</span>
<span class="kn">from</span> <span class="nn">numpy</span> <span class="kn">import</span> <span class="n">real</span><span class="p">,</span> <span class="n">imag</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>

<span class="c1"># DynSys package imports</span>
<span class="kn">import</span> <span class="nn">dyn_analysis</span>
<span class="kn">import</span> <span class="nn">loading</span>
<span class="kn">from</span> <span class="nn">dynsys</span> <span class="kn">import</span> <span class="n">PlotFrequencyResponse</span>
<span class="kn">import</span> <span class="nn">tstep</span>
<span class="c1">#from loading import UKNA_BSEN1991_2_walkers_joggers_loading as ped_loading</span>


<span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_walkers_joggers_loading</span><span class="p">(</span><span class="n">loading</span><span class="o">.</span><span class="n">LoadTrain</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines moving point load to represent the action of walkers / joggers</span>
<span class="sd">    per NA.2.44.4 of BS EN 1991-2</span>
<span class="sd">    </span>
<span class="sd">    ![NA.2.44.4](../dynsys/img/UKNA_BSEN1991_2_NA2_44_4.PNG)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                 <span class="n">gamma</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">N</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">analysis_type</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                 <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines fluctuating point load to represent either walkers or joggers </span>
<span class="sd">        according to NA.2.44.4, UK NA to BS EN 1991-2</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">        </span>
<span class="sd">        * `fv`, natural frequency (Hz) of the mode under consideration</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * `gamma`, reduction factor to allow for unsynchronised actions in a </span>
<span class="sd">          pedestrian group. Value of 1.0 used by default (conservative)</span>
<span class="sd">          </span>
<span class="sd">        * `N`, _integer_ number of pedestrians in group. Default value </span>
<span class="sd">          corresponds to bridge class A; but actual value should generally be </span>
<span class="sd">          provided</span>
<span class="sd">          </span>
<span class="sd">        * `analysis_type`, _string_, either &#39;walkers&#39; or &#39;joggers&#39; required, </span>
<span class="sd">          to denote the case under consideration</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Determine F0 from Table NA.8</span>
        <span class="k">if</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="mi">280</span>
        <span class="k">elif</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="mi">910</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;&#39;walkers&#39; or &#39;joggers&#39; expected&quot;</span><span class="p">)</span>
            
        <span class="c1"># Get k(fv) factor</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span>
                                        <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">,</span>
                                        <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
            
        <span class="c1"># Calculate amplitude of sinusoidal forcing function per NA.2.44.4(1)</span>
        <span class="n">F_amplitude</span> <span class="o">=</span> <span class="n">F0</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gamma</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
        
        <span class="c1"># Define sinusoidal function of unit amplitude</span>
        <span class="k">def</span> <span class="nf">sine_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fv</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        
        <span class="c1"># Run init for parent &#39;LoadTrain&#39; class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">loadX</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                         <span class="n">loadVals</span><span class="o">=</span><span class="n">F_amplitude</span><span class="p">,</span>
                         <span class="n">intensityFunc</span><span class="o">=</span><span class="n">sine_func</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">)</span>
        
        <span class="c1"># Save other attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F0</span> <span class="o">=</span> <span class="n">F0</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reference amplitude of applied fluctuating force (N)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of pedestrians in the group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduction factor, in the range [0,1.0], to allow for unsynchronised </span>
<span class="sd">        actions in a pedestrian group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">fv</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Natural frequency (Hz) of the mode for which loading has been derived</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Factor to account for:</span>
<span class="sd">            </span>
<span class="sd">        * The effects of a more realistic pedestrian population</span>
<span class="sd">        * Harmonic responses</span>
<span class="sd">        * Relative weighting of pedestrian sensitivity to response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">F_amplitude</span> <span class="o">=</span> <span class="n">F_amplitude</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Amplitude of sinusoidal moving load (N)</span>
<span class="sd">        calculated according to NA.2.44.4(1)</span>
<span class="sd">        &quot;&quot;&quot;</span>


        
<span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_walkers_joggers</span><span class="p">(</span><span class="n">dyn_analysis</span><span class="o">.</span><span class="n">MovingLoadAnalysis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements transient analysis for walkers/joggers case</span>
<span class="sd">    per NA.2.44.4 of UK NA to BS EN 1992-1:2003</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                 <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                 <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">dt_factor</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">           </span>
<span class="sd">        * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">        </span>
<span class="sd">        * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">          to targeted</span>
<span class="sd">    </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `dt`, time step to be used for results evaluation. If _None_ then </span>
<span class="sd">          a suitable `dt` to use will be determined according to </span>
<span class="sd">          `dt_factor` (see below)</span>
<span class="sd">          </span>
<span class="sd">        * `dt_factor`, factor to apply to damped natural frequency `f_d` of </span>
<span class="sd">          mode under consideration, for the purpose of determining </span>
<span class="sd">          appropriate `dt` value (see above):</span>
<span class="sd">          `dt = 1 / (dt_factor * f_d)`.</span>
<span class="sd">          Note only used if `dt=None`</span>
<span class="sd">        </span>
<span class="sd">        * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">          computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">          used (conservative)</span>
<span class="sd">        </span>
<span class="sd">        Additional keyword arguments can be defined. These should relate </span>
<span class="sd">        the `__init__()` function of the `MovingLoadAnalysis` class </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Create default name for analysis object</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="p">,</span>
                                                            <span class="n">analysis_type</span><span class="p">)</span>
        
        <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
        <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">0</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
            <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">1</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">2</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
            <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">4</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Define loading velocity per Table NA.8</span>
        <span class="c1"># Get appropriate N value to use</span>
        <span class="k">if</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
            <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">1.7</span>
            <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_walkers</span>
            
        <span class="k">elif</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
            <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">3.0</span>
            <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_joggers</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N_to_use</span>
            
        <span class="c1"># Get natural frequency of mode to consider</span>
        <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
        <span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">]</span> <span class="c1"># damped natural frequencies of mode</span>
        <span class="n">f_d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
        
        <span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="n">mode_index</span><span class="p">]</span>
        <span class="n">logdec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logdec</span> <span class="o">=</span> <span class="n">logdec</span>
        
        <span class="c1"># Analyse modeshape to determine effective span</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
        
        <span class="k">if</span> <span class="n">calc_Seff</span><span class="p">:</span>
            
            <span class="n">attrName</span> <span class="o">=</span> <span class="s2">&quot;Seff&quot;</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">):</span>
                <span class="n">Seff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>
                
                <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">Calc_Seff</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span>
                                              <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                              <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
                
                <span class="c1"># save to avoid recalculating</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span> 
                <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">lambda_vals</span>
                
            <span class="c1"># Get Seff for mode being considered</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Seff</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mode_index</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                        
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># &quot;In all cases it is conservative to use Seff = S&quot;</span>
            <span class="n">Seff</span> <span class="o">=</span> <span class="n">S</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span>
        
        <span class="c1"># Obtain gamma from Figure NA.9</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logdec</span><span class="p">,</span><span class="n">Seff</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        
        <span class="c1"># Define loading objects to represent walkers and joggers</span>
        <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_walkers_joggers_loading</span><span class="p">(</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span><span class="p">,</span>
                                                              <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                                              <span class="n">N</span><span class="o">=</span><span class="n">N_to_use</span><span class="p">,</span>
                                                              <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">,</span>
                                                              <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        
        <span class="c1"># Determine reasonable time step to use</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Rule of thumb - 10x frequency under consideration</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">dt_factor</span> <span class="o">*</span> <span class="n">f_d</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span>  
        
        <span class="c1"># Run parent init</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">loadtrain_obj</span><span class="o">=</span><span class="n">loading_obj</span><span class="p">,</span>
                         <span class="n">loadVel</span><span class="o">=</span><span class="n">load_velocity</span><span class="p">,</span>
                         <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c1"># use sign-corrected modeshapes</span>
                         <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Transient moving load analysis initialised *****&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal system:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode index:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode frequency:</span><span class="se">\t\t</span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">f_d</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Loading object:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity:</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2"> m/s&quot;</span> <span class="o">%</span> <span class="n">load_velocity</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Seff</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;gamma:</span><span class="se">\t\t\t</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
            
            
            
            
            
            
<span class="k">class</span> <span class="nc">SteadyStateCrowdLoading</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to implement steady state crowd loading analysis</span>
<span class="sd">    </span>
<span class="sd">    _Will usually be used as base class for analyses to specific codes, </span>
<span class="sd">    e.g. HiVoSS or UK NA to BS EN 1991-2_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">width_func_list</span><span class="o">=</span><span class="p">[</span><span class="mf">3.0</span><span class="p">],</span>
                 <span class="n">modeshapes_fname_arr</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;modeshapes_edge1.csv&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;modeshapes_edge2.csv&quot;</span><span class="p">],</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">               </span>
<span class="sd">        * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">            </span>
<span class="sd">        * `modeshapes_fname_arr`, array of strings, of shape (nRegions,2) </span>
<span class="sd">          denoting files containing modeshape variation along the edges of </span>
<span class="sd">          each deck region:</span>
<span class="sd">              </span>
<span class="sd">              * Axis 1 to be of shape = 2 (1 file for each edge)</span>
<span class="sd">              </span>
<span class="sd">              * Axis 0 length corresponds to number of deck regions, nRegions</span>
<span class="sd">          </span>
<span class="sd">        * `width_func_list`, list of functions to denote how width (m) of </span>
<span class="sd">          each deck region varies with chainage _along the centreline of the </span>
<span class="sd">          region_:</span>
<span class="sd">              </span>
<span class="sd">              * List length = nRegions required (this is checked)</span>
<span class="sd">              </span>
<span class="sd">              * List of floats may be provided if deck width is constant within </span>
<span class="sd">                each regions. But list length requirement above still applies</span>
<span class="sd">    </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">          computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">          used (conservative)</span>
<span class="sd">          </span>
<span class="sd">        * `nLcuts`, _integer_, denotes number of transverse cuts to make when </span>
<span class="sd">          evaluating area integrals. Increasing number will increase accuracy,  </span>
<span class="sd">          at the cost of longer computation time</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Create default name for analysis object</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Crowd Loading&quot;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Name assigned to class instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
        <span class="c1"># Check `width_func_list` input</span>
        <span class="n">width_func_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_width_func_list</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">)</span>
        <span class="n">nRegions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nRegions</span> <span class="o">=</span> <span class="n">nRegions</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integer, denotes number deck regions</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
        <span class="c1"># Check `modeshapes_fname_arr` input</span>
        
        <span class="k">if</span> <span class="n">modeshapes_fname_arr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="c1"># Use already-defined modeshope for system</span>
            <span class="n">mFunc</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span>
            <span class="n">mFunc_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">mFunc</span><span class="p">,</span><span class="n">mFunc</span><span class="p">]])</span>
            
            <span class="n">Ltrack</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
            <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Ltrack</span><span class="p">,</span><span class="n">Ltrack</span><span class="p">]])</span>
            
            <span class="n">max_ordinates</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mFunc</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
            
        <span class="k">else</span><span class="p">:</span>
                
            <span class="n">modeshapes_fname_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modeshapes_fname_arr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_modeshapes_fname_arr</span><span class="p">(</span><span class="n">modeshapes_fname_arr</span><span class="p">,</span><span class="n">nRegions</span><span class="p">)</span>
                
            <span class="c1"># Read modeshape data from file, determine interpolation functions</span>
            <span class="n">mFunc_list</span><span class="p">,</span> <span class="n">Ltrack_list</span><span class="p">,</span> <span class="n">max_ordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_modeshapes</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                                                          <span class="n">modeshapes_fname_arr</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_modeshape</span> <span class="o">=</span> <span class="n">max_ordinates</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maximum |modeshape| ordinates, evaluated over all deck regions.</span>
<span class="sd">        Array of length equal to number of modes considered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define deck regions</span>
        <span class="n">deck_regions_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRegions</span><span class="p">):</span>
            
            <span class="n">deckregion_obj</span> <span class="o">=</span> <span class="n">_DeckStrip</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Region </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">,</span>
                                        <span class="n">L</span><span class="o">=</span><span class="n">Ltrack_list</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
                                        <span class="n">width_func</span><span class="o">=</span><span class="n">width_func_list</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
                                        <span class="n">func_edge1</span><span class="o">=</span><span class="n">mFunc_list</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">func_edge2</span><span class="o">=</span><span class="n">mFunc_list</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">deck_regions_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deckregion_obj</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span> <span class="o">=</span> <span class="n">deck_regions_list</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of DeckStrip classes, defining deck strips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Calculate deck area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_deck_area</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Total deck area ($m^2$), obtained by integration over all deck strips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get damped natural frequencies for system</span>
        <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Damped natural frequencies of system being analysed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Damping ratios for system modes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Save other attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span> <span class="o">=</span> <span class="n">modalsys_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `ModalSys` object, corresponding to system being analysed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Names of responses computed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Amplitudes of defined responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
                
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">print_details</span><span class="p">()</span>
                
        
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">target_mode</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">load_intensity</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">forcing_freq</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">run_freq_method</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">run_tstep</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">tstep_kwargs</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">makePlot</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
            <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs calculations to determine steady-state crowd loading responses</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        **Required:**</span>
<span class="sd">            </span>
<span class="sd">        * `target_mode`, _integer_, denotes the mode at which resonance is </span>
<span class="sd">          to be targeted</span>
<span class="sd">          </span>
<span class="sd">        ***</span>
<span class="sd">        **Optional:**</span>
<span class="sd">        </span>
<span class="sd">        * `load_intensity`, _float_, denotes the load intensity (in N/m2) </span>
<span class="sd">          to be applied. If _None_, `load_intensity` to be calculated </span>
<span class="sd">          using `calc_load_intensity()` method function.</span>
<span class="sd">          </span>
<span class="sd">        * `forcing_freq`, _float_, defines forcing frequency (in Hz) at which </span>
<span class="sd">          response is to be determined. For ordinary modal systems with no </span>
<span class="sd">          added dampers this value should normally be set to equal the damped </span>
<span class="sd">          natural frequency for the mode given by `target_mode`, as this will </span>
<span class="sd">          ensure the worst-case resonance response is obtained. This is thus </span>
<span class="sd">          the default behaviour. However is some circumstances </span>
<span class="sd">          (e.g. systems with multiple TMDs appended) it is necessary to </span>
<span class="sd">          evaluate responses at various assumed forcing frequencies, </span>
<span class="sd">          hence why this optional input is provided to the user.</span>
<span class="sd">          </span>
<span class="sd">        * `run_freq_method`, _boolean_, if True the amplitude of modal and </span>
<span class="sd">          real-world responses at steady-state will be determine by frequency </span>
<span class="sd">          transfer matrix method. This is the default behaviour, as it allows </span>
<span class="sd">          the steady-state amplitudes of responses to be efficiently </span>
<span class="sd">          calculated. In some cases (e.g. for systems with constraints, for </span>
<span class="sd">          which the `DynSys.CalcFreqResponse()` method is not currently </span>
<span class="sd">          implemented), it may be desirable to carry out a time-stepping </span>
<span class="sd">          analysis instead. This can be done by setting `run_freq_method=False` </span>
<span class="sd">          and `run_tstep=True` (see documentation in next bullet for further </span>
<span class="sd">          details)</span>
<span class="sd">          </span>
<span class="sd">        * `run_tstep`, _boolean_, if True a time-stepping analysis will be run, </span>
<span class="sd">          which can be used to verify the the steady-state resonance solution </span>
<span class="sd">          that is ordinarily obtained.</span>
<span class="sd">          </span>
<span class="sd">        * `tstep_kwargs`, _dict_ of keyword arguments to be passed when </span>
<span class="sd">          initialising time-stepping analysis using the `TStep()` class. Only </span>
<span class="sd">          used if `run_tstep` is True. </span>
<span class="sd">          Refer [documentation](../docs/tstep.html) for `TStep()` </span>
<span class="sd">          class for more details.</span>
<span class="sd">          </span>
<span class="sd">        * `makePlot`, _dict_ or _bool_, used to control which plots are </span>
<span class="sd">          produced</span>
<span class="sd">          </span>
<span class="sd">          [documentation]: </span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** Running steady-state crowd loading analysis ****&quot;</span><span class="p">)</span>
        
        <span class="c1"># Handle makePlot</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">makePlot</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
            
            <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
            <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="n">makePlot</span>
        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span> <span class="o">=</span> <span class="n">target_mode</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Target mode index: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_mode</span><span class="p">)</span>
        
        <span class="c1"># Define forcing frequency</span>
        <span class="k">if</span> <span class="n">forcing_freq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="c1"># Set to be damped natural frequency of mode being targeted</span>
            <span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
            
        <span class="k">else</span><span class="p">:</span> <span class="c1"># where input value provided via optional arg</span>
            
            <span class="c1"># Check float type is provided</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: float expected for `forcing_freq`&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">forcing_freq</span>
        
        <span class="c1"># Obtain area integrals over all deck strips</span>
        <span class="n">modal_areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_modal_areas</span><span class="p">(</span><span class="n">target_mode</span><span class="p">,</span>
                                            <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_areas</span> <span class="o">=</span> <span class="n">modal_areas</span>
        
        <span class="c1"># Calculate load intensity, if not provided directly</span>
        <span class="k">if</span> <span class="n">load_intensity</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">load_intensity</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_load_intensity</span><span class="p">(</span><span class="n">mode_index</span><span class="o">=</span><span class="n">target_mode</span><span class="p">,</span>
                                                         <span class="n">fv</span><span class="o">=</span><span class="n">forcing_freq</span><span class="p">,</span>
                                                         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                         <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># null dict</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">=</span> <span class="n">load_intensity</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uniform load intensity (in N/m2) to be applied to deck regions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity_rslts_dict</span> <span class="o">=</span> <span class="n">d</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _Dict_ to store key results from load intensity calculation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;UDL intensity (N/m2): </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span><span class="p">)</span>
                 
        <span class="c1"># Multiply by load intensity to obtain modal force amplitudes</span>
        <span class="c1"># Note modal force amplitudes should be regarded as complex variables </span>
        <span class="c1"># (although here they will be real-valued) whereby negative values </span>
        <span class="c1"># imply a force which is 180 degrees out of phase</span>
        <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">*</span> <span class="n">modal_areas</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span> <span class="o">=</span> <span class="n">modal_forces</span>
            
        <span class="c1"># Save settings used to determine which analyses run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span> <span class="o">=</span> <span class="n">run_freq_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span> <span class="o">=</span> <span class="n">run_tstep</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Forcing frequency: </span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">forcing_freq</span><span class="p">)</span>
        
        <span class="c1"># Run frequency domain method to determine steady-state responses               </span>
        <span class="k">if</span> <span class="n">run_freq_method</span><span class="p">:</span>
            
            <span class="c1"># Evaluate frequency transfer functions G(f) relating applied forces </span>
            <span class="c1"># (i.e. modal forces in this application) to DOF accelerations, </span>
            <span class="c1"># displacements and velocities</span>
            <span class="c1"># (i.e. modal disp, vel, accn in this application)</span>
            <span class="c1">#</span>
            <span class="c1"># It is only necessary to evaluate G(f) at resonant frequency for mode </span>
            <span class="c1"># being targeted, although for validation / plotting it may be </span>
            <span class="c1"># advantageous to evaluate G(f) over a wider frequency range</span>
            <span class="c1">#</span>
            <span class="c1"># By definition, G(f1) is a matrix that can be used to relate </span>
            <span class="c1"># sinusoidal modal forces to sinusoidal modal accelerations, </span>
            <span class="c1"># given forcing frequency f1.</span>
            <span class="c1">#</span>
            <span class="c1"># Note: G(f) will in general be complex-valued; the should be </span>
            <span class="c1"># intepreted to denote scaling and phase lag</span>
            
            <span class="c1"># Calculate matrix mapping applied loads to state DOFs</span>
            <span class="k">def</span> <span class="nf">Calc_Gf</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">rslts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcFreqResponse</span><span class="p">(</span><span class="n">fVals</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">C</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span>
                                                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
                <span class="n">G_f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;G_f&quot;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">G_f</span>
            
            <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">Calc_Gf</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
            
            <span class="c1"># Retain only submatrix mapping modal forces to state DOFs</span>
            <span class="n">nModes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modal_forces</span><span class="p">)</span>
            <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[:,:</span><span class="n">nModes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span>
            
            <span class="c1"># Get submatrix mapping applied forces to DOF accelerations</span>
            <span class="n">nDOF</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">G_state_vars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">G_acc</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nDOF</span><span class="p">:,:]</span>
            
            <span class="c1"># Get submatrix mapping modal forces to m accelerations</span>
            <span class="n">G_modalacc</span> <span class="o">=</span> <span class="n">G_acc</span><span class="p">[:</span><span class="n">nModes</span><span class="p">,:</span><span class="n">nModes</span><span class="p">]</span>
            
            <span class="c1"># Calculate modal acceleration amplitudes using transfer matrix</span>
            <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">G_modalacc</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span>
            
            <span class="c1"># Adjust phase such that acc for target mode has phase=0</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">]))</span>
            <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span> <span class="o">/</span> <span class="n">z1</span>
            
            <span class="c1"># Get modal acceleration of targeted mode</span>
            <span class="c1"># Note phase=0 due to above adjustment, hence ok to take real part only</span>
            <span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">modal_accn_target</span>
                           
            <span class="c1"># Calculate responses amplitudes using full transfer matrix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_responses</span><span class="p">()</span>
              
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;**** Analysis complete! ****</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">run_tstep</span><span class="p">:</span>
            
            <span class="c1"># Run time-stepping analysis to validate /check the above approach</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Running time-stepping analysis, as cross-check of &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;steady-state resonance approach...***&quot;</span><span class="p">)</span>
                        
            <span class="c1"># Define sinusoidal load function consistent with above</span>
            <span class="k">def</span> <span class="nf">load_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">modal_forces</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">forcing_freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
            
            <span class="n">load_func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span> <span class="p">:</span> <span class="n">load_func</span><span class="p">}</span>
            
            <span class="c1"># Define and run time-stepping analysis</span>
            <span class="n">tstep_analysis</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">dynsys_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                         <span class="n">force_func_dict</span><span class="o">=</span><span class="n">load_func_dict</span><span class="p">,</span>
                                         <span class="o">**</span><span class="n">tstep_kwargs</span><span class="p">)</span>
            
            <span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_analysis</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>  
            
            <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_results</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Results from time-stepping analysis; instance of `TStep_Results()`</span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Time-stepping analysis complete!***&quot;</span><span class="p">)</span>
            
            
    <span class="k">def</span> <span class="nf">calc_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">output_mtrx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">output_names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate steady-steady amplitude response of defined responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get output matrix and output names, if not passed to this function</span>
        <span class="k">if</span> <span class="n">output_mtrx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">output_mtrx</span><span class="p">,</span> <span class="n">output_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetOutputMtrx</span><span class="p">(</span><span class="n">all_systems</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Get frequency response matrix for {disp,vel,accn} variables</span>
        <span class="c1"># (note: assumes already calculated!)</span>
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span>
            
        <span class="c1"># Get modal forces</span>
        <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span>
        
        <span class="c1"># Calculate responses at steady-state</span>
        <span class="n">nResponses</span> <span class="o">=</span> <span class="n">output_mtrx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">nResponses</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                
            <span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">output_mtrx</span> <span class="err">@</span> <span class="n">G_state_vars</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">response_amplitudes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span> <span class="o">=</span> <span class="n">output_names</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No output matrix provided. &quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Real-world responses have not been evaluated&quot;</span><span class="p">)</span>
                
    
    <span class="k">def</span> <span class="nf">print_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints details about the analysis that has been defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Details of deck regions:&quot;</span><span class="p">)</span>
        
        <span class="n">deck_regions_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;nRegions: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">deck_regions_list</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">deckregion_obj</span> <span class="ow">in</span> <span class="n">deck_regions_list</span><span class="p">:</span>
            
            <span class="n">deckregion_obj</span><span class="o">.</span><span class="n">print_details</span><span class="p">()</span>
            
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total deck area (m2):</span><span class="se">\n</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies of system (Hz):</span><span class="se">\n</span><span class="s2">{0}&quot;</span>
              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">))</span>
        
        
        
    <span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints key results from analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">printcomplex</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function for printing magnitude and phase of complex-valued vals</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Magnitudes:</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Phase angles (rad):</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
                    
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal forces (N):&quot;</span><span class="p">)</span>
        <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal accelerations (m/s2):&quot;</span><span class="p">)</span>
            <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Responses:&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="p">)</span>
            <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">get_response_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">print_phase</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns response amplitudes as pandas dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
        <span class="n">columns_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">print_phase</span><span class="p">:</span>
            <span class="n">phase_angles</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span><span class="n">phase_angles</span><span class="p">))</span>
            <span class="n">columns_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Phase angle&quot;</span><span class="p">)</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">index</span><span class="o">=</span><span class="n">index_list</span><span class="p">,</span>
                              <span class="n">columns</span><span class="o">=</span><span class="n">columns_list</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df</span>
    
    
    <span class="k">def</span> <span class="nf">get_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns response stats for time-stepping analysis carried out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: no time-stepping analysis run, &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;cannot retrieve results!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get dict of dict of stats</span>
        <span class="n">stats_dict_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">CalcResponseStats</span><span class="p">()</span>
        
        <span class="c1"># Loop over dict and return stats as list of pandas dataframes</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">sys_obj</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">stats_dict_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>   
            
            <span class="n">sys_name</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">name</span>
            <span class="n">response_names</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">output_names</span>
            
            <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stats_dict</span><span class="p">,</span>
                                  <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">sys_name</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">x</span>
                                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_names</span><span class="p">])</span>
            
            <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        
        <span class="c1"># Merge pandas dataframes to return a single dataframe</span>
        <span class="c1"># with all stats for all responses for all systems</span>
        <span class="n">df_merged</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
        
        <span class="c1"># Transpose such that stats as indexes, responses as columns</span>
        <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                
        <span class="k">return</span> <span class="n">df_merged</span>
    
        
    <span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots results of steady-state response analysis</span>
<span class="sd">        </span>
<span class="sd">        If time-stepping analysis has also been carried out (as a cross-check) </span>
<span class="sd">        results of that analysis will be plotted also</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        </span>
<span class="sd">        **Required:**</span>
<span class="sd">        </span>
<span class="sd">        (No arguments required)</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        **Optional:**</span>
<span class="sd">        </span>
<span class="sd">        * `overlay_val`, _float_, value to overlay onto response plots. </span>
<span class="sd">          (A common use of this would be to overlay the applicable acceleration </span>
<span class="sd">          limit, against which responses are to be compared)</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        **Returns:**</span>
<span class="sd">        </span>
<span class="sd">        _Nested list_ of figure objects</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_freq_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
            <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
            <span class="n">tstep_fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_tstep_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
            <span class="n">fig_list</span> <span class="o">+=</span> <span class="n">tstep_fig_list</span>    
        
        <span class="k">return</span> <span class="n">fig_list</span>      
    
    
    <span class="k">def</span> <span class="nf">plot_results_freq_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot results of frequency domain analysis method, if avaliable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for frequency domain method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        
        <span class="c1"># Produce and configure figure</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Steady-state pedestrian crowd loading analysis results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                     <span class="s2">&quot;Target mode: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># Produce bar plot of modal accelerations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_modal_accn</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># Produce bar plot of outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_responses</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
    
    
    <span class="k">def</span> <span class="nf">plot_results_modal_accn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produce bar plot of steady-state modal accelerations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define axes to plot to, if not done so already</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span>
        
        <span class="c1"># Get or define tick labels</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="s1">&#39;mode_IDs&#39;</span><span class="p">):</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">mode_IDs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mode </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">nDOF</span><span class="p">)]</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state modal acceleration amplitudes (m/$s^2$)&quot;</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">plot_results_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produce bar plot of steady-state responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define axes to plot to, if not done so already</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

        <span class="c1"># Get data to use in plot        </span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
        
        <span class="c1"># Flatten list in case of nested lists (only when multiple subsystems)</span>
        <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">ticks</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state response amplitudes&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">overlay_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
            
        
    <span class="k">def</span> <span class="nf">plot_results_tstep_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot results of time-stepping analysis, if avaliable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for time-stepping method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># Define +/- values based on overlay_val, if provided</span>
        <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">overlay_val</span><span class="o">=</span><span class="p">[</span><span class="o">+</span><span class="n">overlay_val</span><span class="p">,</span><span class="o">-</span><span class="n">overlay_val</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span>
        
        <span class="n">fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">useCommonPlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                  <span class="n">useCommonScale</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                  <span class="n">y_overlay</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        
    
        <span class="c1"># Overlay expected modal acceleration amplitudes</span>
        <span class="c1"># (from steady-state analysis, if run)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        
            <span class="n">state_results_fig</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="n">ax</span> <span class="o">=</span> <span class="n">state_results_fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># plot of modal accelerations</span>
            <span class="n">accn_val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span><span class="p">)</span>    <span class="c1"># value to overlay</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            <span class="c1"># Overlay expected response amplitudes </span>
            <span class="c1"># (from steady-state analysis, if run)</span>
            <span class="n">response_results_fig_list</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="n">axarr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_results_fig_list</span><span class="p">]</span>
            <span class="n">axarr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">axarr</span><span class="p">))</span> <span class="c1"># flatten list</span>

            <span class="n">val2overlay</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axarr</span><span class="p">,</span><span class="n">val2overlay</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> 
                
        <span class="k">return</span> <span class="n">fig_list</span>
    

    <span class="k">def</span> <span class="nf">_check_width_func_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">width_func_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs checks on input `width_func_list` </span>
<span class="sd">        as supplied to `__init__()`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that list type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>

            <span class="c1"># Handle case of single float supplied by converting to list</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
                <span class="n">width_func_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">width_func_list</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>    
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`width_func_list`: list expected&quot;</span><span class="p">)</span>

        <span class="c1"># Check all list items are functions or floats</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">width_func</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">width_func</span><span class="p">):</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width_func</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>

                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`width_func_list[</span><span class="si">%d</span><span class="s2">]`&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> 
                                     <span class="s2">&quot; is not a function, as required&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">width_func_list</span>


    <span class="k">def</span> <span class="nf">_check_modeshapes_fname_arr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">modeshapes_fname_arr</span><span class="p">,</span>
                                    <span class="n">nRegions_expected</span><span class="p">):</span>

        <span class="c1"># Check shapes</span>
        <span class="n">nRegions</span><span class="p">,</span> <span class="n">nEdges</span> <span class="o">=</span> <span class="n">modeshapes_fname_arr</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="n">nRegions_expected</span> <span class="o">!=</span> <span class="n">nRegions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `nRegions`</span><span class="se">\n</span><span class="s2">: &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;Conflicts with nRegions inferred &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;from `width_func_list` input&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nEdges</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nEdges = 2 required</span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;Modeshapes at edges &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;of each regions must be provided via &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;`modeshapes_fname_arr` input&quot;</span><span class="p">)</span>

        <span class="c1"># Check all files exist</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">file_str</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">modeshapes_fname_arr</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modeshapes_fname_list[{0}]`&quot;</span> <span class="o">%</span> <span class="n">index</span> <span class="o">+</span>
                                 <span class="s2">&quot; does not exist!&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_read_modeshapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">modeshapes_fname_arr</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads modeshapes from file</span>

<span class="sd">        ***</span>
<span class="sd">        Required:</span>

<span class="sd">        * `modeshapes_fname_arr`, array of strings, denoting file paths</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">modeshapeFunc_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">absmax_vals_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Loop through array containing modeshape filenames</span>
        <span class="k">for</span> <span class="n">fname_list</span> <span class="ow">in</span> <span class="n">modeshapes_fname_arr</span><span class="p">:</span>

            <span class="n">Ltrack_list_inner</span> <span class="o">=</span> <span class="p">[]</span> 
            <span class="n">modeshapeFunc_list_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">absmax_vals_list_inner</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">fName</span> <span class="ow">in</span> <span class="n">fname_list</span><span class="p">:</span>

                <span class="n">mfunc</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">DefineModeshapes</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">fName</span><span class="p">)</span>
                
                <span class="c1"># Evaluate to obtain maximum ordinates</span>
                <span class="n">m_vals</span> <span class="o">=</span> <span class="n">mfunc</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">num</span><span class="p">))</span>
                <span class="n">absmax_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m_vals</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">absmax_vals_list_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">absmax_vals</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

                <span class="c1"># Append to inner lists</span>
                <span class="n">Ltrack_list_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
                <span class="n">modeshapeFunc_list_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mfunc</span><span class="p">)</span>

            <span class="c1"># Append to create list of lists</span>
            <span class="n">Ltrack_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ltrack_list_inner</span><span class="p">)</span>
            <span class="n">modeshapeFunc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modeshapeFunc_list_inner</span><span class="p">)</span>
            <span class="n">absmax_vals_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">absmax_vals_list_inner</span><span class="p">)</span>

        <span class="c1"># Obtain overall max modeshape ordinate</span>
        <span class="n">absmax_vals_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">absmax_vals_list</span><span class="p">)</span>
        <span class="n">max_ordinate</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">absmax_vals_list</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Convert lists to arrays</span>
        <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ltrack_list</span><span class="p">)</span>
        <span class="n">modeshapeFunc_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modeshapeFunc_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">modeshapeFunc_list</span><span class="p">,</span> <span class="n">Ltrack_list</span><span class="p">,</span> <span class="n">max_ordinate</span>
        
    
    <span class="k">def</span> <span class="nf">calc_deck_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total deck area, taken across all deck strips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">total_area</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">calc_area</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_area</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">calc_modal_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns modal area integrals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
    
    <span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _Method to be overriden by derived classes_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`calc_load_intensity` not implemented!&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;To be overriden by derived class method&quot;</span><span class="p">)</span>
            


<span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_crowd</span><span class="p">(</span><span class="n">SteadyStateCrowdLoading</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to implement steady state crowd loading analysis </span>
<span class="sd">    to UK NA to BS EN1991-2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">crowd_density</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">load_direction</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * `bridgeClass`, string character (&#39;A&#39; to &#39;D&#39;), defines bridge class</span>
<span class="sd">          per UK NA to BS EN1991-2</span>
<span class="sd">          </span>
<span class="sd">        * `crowd_density`, float, defines crowd density (P/m2). Note only used </span>
<span class="sd">          if `bridgeClass=None`</span>
<span class="sd">          </span>
<span class="sd">        * `load_direction`, string, either &#39;vertical&#39; or &#39;lateral&#39; required</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">bridgeClass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
            <span class="k">if</span> <span class="n">crowd_density</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either `bridgeClass` or `crowd_density` required&quot;</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bridgeClass</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`bridgeClass` to be string character&quot;</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># correct to uppercase</span>
                <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bridge class per Table NA.7</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">crowd_density</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crowd density (P/m2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">load_direction</span> <span class="o">=</span> <span class="n">load_direction</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Direction of applied crowd loading</span>
<span class="sd">        &quot;&quot;&quot;</span>
               
        <span class="c1"># Run parent init function</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">get_crowd_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">saveAsAttr</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get crowd density according from Table NA.7, UK NA to BS EN </span>
<span class="sd">        1991-2, according to `bridgeClass`</span>

<span class="sd">        Returns density expressed as persons/m2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Define crowd density via bridge class, if defined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        
            <span class="n">bridgeClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span>

            <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
                <span class="n">density</span><span class="o">=</span><span class="mf">0.0</span>
    
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
                <span class="n">density</span><span class="o">=</span><span class="mf">0.4</span>
    
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                <span class="n">density</span><span class="o">=</span><span class="mf">0.8</span>
    
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
                <span class="n">density</span><span class="o">=</span><span class="mf">1.5</span>
    
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
             
        <span class="c1"># Otherwise use pre-defined density</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">density</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Crowd density (persons/m2): </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">density</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">density</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Crowd density = 0; no analysis required!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">density</span>
       
    
    <span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                            <span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">load_direction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">calc_lambda</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates required load intensity (N/m2) to UK NA to BS EN 1991-2</span>
<span class="sd">        </span>
<span class="sd">        ![Cl_2_44_5](../dynsys/img/UKNA_BSEN1991_2_Cl_2_44_5.png)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">load_direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">load_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_direction</span>
        
        <span class="c1"># Retrieve attributes    </span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span>
        <span class="n">max_modeshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_modeshape</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>
        
        <span class="c1"># Get crowd density according to bridgeClass</span>
        <span class="c1"># Crowd density, expressed in persons/m2</span>
        <span class="n">crowd_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crowd_density</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Get total number of pedestrians</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">crowd_density</span> <span class="o">*</span> <span class="n">A</span>
        
        <span class="c1"># Define code inputs</span>
        <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="mf">280.0</span>
            <span class="c1"># N, refer Table NA.8</span>
            <span class="c1"># n.b &#39;walkers&#39; value to be used in crowd loading calcs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="mf">70.0</span>  <span class="c1"># N, refer Tue 24/07/2018 12:56 Chris Barker email</span>

        <span class="c1"># Derive adjustment factors</span>
        <span class="k">if</span> <span class="n">fv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># If not provided explicitly set to damped frequency of target mode</span>
            <span class="n">fv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
            
        <span class="n">k</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span>
                                        <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                                        <span class="n">load_direction</span><span class="o">=</span><span class="n">load_direction</span><span class="p">,</span>
                                        <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        
        <span class="n">log_dec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logDec</span><span class="o">=</span><span class="n">log_dec</span><span class="p">,</span>
                                            <span class="n">groupType</span><span class="o">=</span><span class="s2">&quot;crowd&quot;</span><span class="p">,</span>
                                            <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        
        <span class="c1"># Effective number of pedestrians parameter, refer NA. 2.44.5(1)</span>
        <span class="c1"># To generalise to deck of variable width, use area ratio as Seff/S</span>
        <span class="k">if</span> <span class="n">calc_lambda</span><span class="p">:</span>
            <span class="n">Aeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_areas</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.634</span> <span class="o">*</span> <span class="n">max_modeshape</span><span class="p">)</span>
            <span class="n">lambda_val</span> <span class="o">=</span> <span class="mf">0.634</span><span class="o">*</span><span class="n">Aeff</span><span class="o">/</span><span class="n">A</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lambda_val</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># conservative according to text - but not always!</span>
    
        <span class="c1"># Calculate load intensity per NA.2.44.5(1)</span>
        <span class="n">load_intensity</span> <span class="o">=</span> <span class="mf">1.8</span><span class="o">*</span><span class="p">(</span><span class="n">F0</span><span class="o">/</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">((</span><span class="n">gamma</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="n">lambda_val</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># Prepare markdown string of nicely formatted text</span>
        <span class="n">md_txt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;Key results from UK NA to BS EN 1991-2 load intensity calculation:&quot;</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;F0        = </span><span class="si">%.1f</span><span class="se">\t</span><span class="s2">(N)&quot;</span> <span class="o">%</span> <span class="n">F0</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;A         = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(m2)&quot;</span> <span class="o">%</span> <span class="n">A</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;gamma_max = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">max_modeshape</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Aeff      = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(m2)&quot;</span> <span class="o">%</span> <span class="n">Aeff</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;rho       = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(P/m2)&quot;</span> <span class="o">%</span> <span class="n">crowd_density</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;N         = </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">N</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;fv        = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">(Hz)&quot;</span> <span class="o">%</span> <span class="n">fv</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;k         = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">k</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;log_dec   = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">log_dec</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;gamma     = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;lambda    = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">lambda_val</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;w         = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">(N/m2)&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">md_txt</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>    

        <span class="c1"># Prepare dict to return key results</span>
        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;F0&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">F0</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;fv&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">fv</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">crowd_density</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">N</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">k</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;lambda&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">lambda_val</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;log_dec&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">log_dec</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">load_intensity</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;md_txt&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">md_txt</span>

        <span class="k">return</span> <span class="n">load_intensity</span><span class="p">,</span> <span class="n">results_dict</span>
    
    
    
<span class="k">class</span> <span class="nc">HIVOSS</span><span class="p">(</span><span class="n">SteadyStateCrowdLoading</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements HIVOSS rules for lateral vibration due to crowds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">crowd_density</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation method</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">        </span>
<span class="sd">        * `crowd_density`, _float_ to denote crowd density, persons/m2</span>
<span class="sd">        </span>
<span class="sd">        * `direction`, _string_ to denote loading / response direction. </span>
<span class="sd">          Either &#39;Vertical&#39; or &#39;Lateral&#39; required.</span>
<span class="sd">          </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        Refer optional keyword arguments in parent class __init__() method</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">crowd_density</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crowd density for design situation consider, P/m2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Direction of loading / response calculation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Run parent init function</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    
    <span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate intensity of uniform deck load</span>
<span class="sd">        according to HIVOSS guidance</span>
<span class="sd">        </span>
<span class="sd">        Note: overrides parent class method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Calculating load intensity for mode </span><span class="si">%d</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">mode_index</span> <span class="o">+</span>
              <span class="s2">&quot;according to HIVOSS...&quot;</span><span class="p">)</span>
        
        <span class="n">rslts_dict</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span>
        
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span>
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Area of loaded surface, S: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">S</span><span class="p">)</span>
        
        <span class="c1"># Calculate number of pedestrians on loaded surface</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">S</span> <span class="o">*</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of pedestrians on loaded surface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Number of pedestrians, n: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
            
        <span class="c1"># Get damping ratio applicable to mode being considered</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">eta</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damping ratio for mode: </span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">eta</span><span class="p">)</span>
        
        <span class="c1"># Calculate effective number of pedestrians on loaded surface</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">n_dash</span> <span class="o">=</span> <span class="mf">10.8</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">S</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_dash</span> <span class="o">=</span> <span class="mf">1.85</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">S</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">n_dash</span> <span class="o">=</span> <span class="n">n_dash</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Effective number of pedestrians on loaded surface, [1/m2]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;n_dash&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">n_dash</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Effective number of pedestrians, n&#39;: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n_dash</span><span class="p">)</span>
            
        <span class="c1"># Define reference load</span>
        <span class="c1"># refer Table 4-7, HIVOSS guidelines</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span>
        
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">direction</span>
        
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Vertical&#39;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">280</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Longitudinal&#39;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">140</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">35</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid `direction`&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reference load, P [N]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">P</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Reference load, P [N]&#39;: </span><span class="si">%.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">P</span><span class="p">)</span>
           
        <span class="c1"># Calculate reduction factor</span>
        <span class="n">rslt</span> <span class="o">=</span> <span class="n">calc_psi_HIVOSS</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="mf">3.05</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">rslt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">psi</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Reduction factor, psi&#39;: </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">psi</span><span class="p">)</span>
        
        <span class="c1"># Calculate load intensity</span>
        <span class="n">load_intensity</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n_dash</span> <span class="o">*</span> <span class="n">psi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">=</span> <span class="n">load_intensity</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load intensity [N/m2] of UDL due to crowd loading</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load intensity [N/m2]&#39;: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">load_intensity</span><span class="p">,</span> <span class="n">rslts_dict</span>
   
        

<span class="k">class</span> <span class="nc">PedestrianDynamics_transientAnalyses</span><span class="p">(</span><span class="n">dyn_analysis</span><span class="o">.</span><span class="n">Multiple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements the full set of analyses required to fully-implement the </span>
<span class="sd">    method given in NA.2.44.4 of UK NA to BS EN 1991-2</span>
<span class="sd">    i.e. transient analyses for both walkers and joggers, for all modes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        ****</span>
<span class="sd">        </span>
<span class="sd">        Required:</span>
<span class="sd">          </span>
<span class="sd">        * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `bridgeClass`, _string_, either &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, or &#39;D&#39;. </span>
<span class="sd">          Refer Table NA.7 for description of bridge classes</span>
<span class="sd">          </span>
<span class="sd">        Additional keyword arguments may be passed. These should relate to the </span>
<span class="sd">        `__init__()` function of the `Multiple` class.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get mode indexs to loop over</span>
        <span class="c1"># Note modes sorted into ascending frequency but in conjugate pairs</span>
        <span class="c1"># Hence step through modes x2</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetSystemMatrices</span><span class="p">()[</span><span class="s2">&quot;nDOF&quot;</span><span class="p">]</span>
        <span class="n">mode_index_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nModes</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="c1"># Run parent init function</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">classDef</span><span class="o">=</span><span class="n">UKNA_BSEN1991_2_walkers_joggers</span><span class="p">,</span>
                         <span class="n">dynsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                         <span class="n">bridgeClass</span><span class="o">=</span><span class="n">bridgeClass</span><span class="p">,</span>
                         <span class="n">mode_index</span><span class="o">=</span><span class="n">mode_index_list</span><span class="p">,</span>
                         <span class="n">analysis_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span><span class="s2">&quot;joggers&quot;</span><span class="p">],</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># Save key variables as attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
        
        
    <span class="k">def</span> <span class="nf">plot_modal_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        
        <span class="c1"># Get modal properties as used in analyses</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">fv</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">eta</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
        
        <span class="c1"># Plot details of system</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$f_{d}$ (Hz)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">eta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s1">&#39;{:.1%}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Modal damping&quot;</span><span class="p">)</span>
        
        <span class="c1"># Add equivilent axis for log dec</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">logdec</span><span class="p">(</span><span class="n">eta</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
        
        <span class="n">delta_incr</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">new_yticks</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">delta_incr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">logdec</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Log decrement $\delta$&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
    
    
    <span class="k">def</span> <span class="nf">plot_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">dynsys2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">responses2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots statistics of responses computed, across all analyses</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `dynsys2plot`, list of subsystem objects to plot responses </span>
<span class="sd">          for. If None (default) responses will be plotted for all </span>
<span class="sd">          subsystems</span>
<span class="sd">            </span>
<span class="sd">        * `responses2plot`, list of indices specifying responses to be</span>
<span class="sd">          plotted. If None (default) all responses will be plotted, for</span>
<span class="sd">          each sub-system</span>
<span class="sd">          </span>
<span class="sd">        * `sharey`, passed to pyplot.subplots() method. Controls whether </span>
<span class="sd">          subplots should share common y scale.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting response statistics...&quot;</span><span class="p">)</span>
        
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">dynsys2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dynsys2plot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dynsys2plot&#39; does not belong &quot;</span> <span class="o">+</span> 
                                 <span class="s2">&quot;to system analysed!&quot;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dynsys2plot</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">dynsys2plot</span><span class="p">]</span>
            
        <span class="c1"># Loop over all systems and subsystems</span>
        <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">dynsys2plot</span><span class="p">:</span>
            
            <span class="c1"># Get stats dict relating to this system</span>
            <span class="n">stats_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span>
            
            <span class="c1"># Get indices of responses to plot</span>
            <span class="n">response_names</span> <span class="o">=</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names</span>
            
            <span class="k">if</span> <span class="n">responses2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_names</span><span class="p">)</span>
                <span class="n">responses2plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nResponses</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">)</span>
            
            <span class="c1"># Create new figure</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nResponses</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                      <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Loop to plot all responses requested</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">):</span>
                
                <span class="n">response_name</span> <span class="o">=</span> <span class="n">response_names</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                
                <span class="c1"># Get stats for this response</span>
                <span class="n">stats_dict_r</span> <span class="o">=</span> <span class="p">{}</span>
                
                <span class="k">for</span> <span class="n">stats_name</span><span class="p">,</span> <span class="n">stats_vals</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    
                    <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">=</span><span class="n">stats_vals</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
            
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting stats for response &#39;</span><span class="si">%s</span><span class="s2">&#39;:&quot;</span> <span class="o">%</span> <span class="n">response_name</span><span class="p">)</span>
                
                <span class="c1"># Plot response stats for walkers and joggers responses</span>
                
                <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s1">&#39;walkers&#39;</span><span class="p">,</span><span class="s1">&#39;joggers&#39;</span><span class="p">]):</span>
                    
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
                    
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">]):</span>
                    
                        <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">][</span><span class="n">col</span><span class="p">,:]</span>
                        
                        <span class="n">w</span><span class="o">=</span><span class="mf">0.1</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                               <span class="n">stats_vals</span><span class="p">,</span>
                               <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                               <span class="n">label</span><span class="o">=</span><span class="n">stats_name</span>
                               <span class="p">)</span>
    
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">col</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">response_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Responses to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">case</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="n">nResponses</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
                        
                
            
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Statistics of computed responses to pedestrian loading</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;UK NA to BS EN 1991-2, NA.2.44.4</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;Subsystem: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="n">fig_list</span>
    


<span class="k">class</span> <span class="nc">LatSync_McRobie</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class used to implement the multiple modes + multiple TMDs analysis method </span>
<span class="sd">    used to consider the phenomenon of Lateral Synchronous crowd loading </span>
<span class="sd">    response, per the following </span>
<span class="sd">    [paper](../references/The Lateral Dynamic Stablity of Stockton Infinity </span>
<span class="sd">    Footbridge using Complex Modes.pdf)    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys</span><span class="p">,</span>
                 <span class="n">cp_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">mp_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">store_mtrxs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">makePlots</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise analysis</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `modalsys`, instance of `ModalSys` class, defining the modal </span>
<span class="sd">          system to be analysed. For situations where TMDs are present, it is </span>
<span class="sd">          assumed that TMDs have already been appended to the parent modal </span>
<span class="sd">          system, e.g. by use of the `append_TMDs()` method in `damper.py`.</span>
<span class="sd">          </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `cp_func`, function of form g(fn), where fn is frequency in Hz,</span>
<span class="sd">          to define how _negative_ damping per pedestrian varies with frequency</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Initialising &#39;LatSync_McRobie&#39; analysis...&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">modalsys</span> <span class="o">=</span> <span class="n">modalsys</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modal system that form the basis of this analysis. May have subsystems </span>
<span class="sd">        pre-appended (e.g. TMDs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Defining pedestrian added damping function...&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cp_func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Default cp(f) function will be used&quot;</span><span class="p">)</span>
            <span class="n">cp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_cp_func</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;cp = </span><span class="si">%.1f</span><span class="s2"> will be used for all f&quot;</span> <span class="o">%</span> <span class="n">cp_func</span><span class="p">)</span>
            <span class="n">cp_val</span> <span class="o">=</span> <span class="n">cp_func</span>
            <span class="n">cp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="n">cp_val</span><span class="p">,</span><span class="n">cp_val</span><span class="p">],</span>
                                                 <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                 <span class="n">fill_value</span><span class="o">=</span><span class="n">cp_val</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">cp_func</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;User-supplied cp(f) function will be used&quot;</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `cp_func` argument&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span> <span class="o">=</span> <span class="n">cp_func</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to define how added damping per pedestrian varies with</span>
<span class="sd">        frequency. Function with single argument &#39;fn&#39; expected, </span>
<span class="sd">        i.e. cp = g(fn), cp in [Ns/m]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Defining pedestrian added mass function...&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">mp_func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Default mp(f) function will be used&quot;</span><span class="p">)</span>
            <span class="n">mp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mp_func</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mp_func</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;mp = </span><span class="si">%.1f</span><span class="s2"> will be used for all f&quot;</span> <span class="o">%</span> <span class="n">mp_func</span><span class="p">)</span>
            <span class="n">mp_val</span> <span class="o">=</span> <span class="n">mp_func</span>
            <span class="n">mp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="n">mp_val</span><span class="p">,</span><span class="n">mp_val</span><span class="p">],</span>
                                                 <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                 <span class="n">fill_value</span><span class="o">=</span><span class="n">mp_val</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">mp_func</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;User-supplied mp(f) function will be used&quot;</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `mp_func` argument&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span> <span class="o">=</span> <span class="n">mp_func</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to define how added mass per pedestrian varies with</span>
<span class="sd">        frequency. Function with single argument &#39;fn&#39; expected, </span>
<span class="sd">        i.e. mp = g(fn), cp in [kg]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">store_mtrxs</span> <span class="o">=</span> <span class="n">store_mtrxs</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Boolean option, if True then system damping and stiffness matrices</span>
<span class="sd">        will be stored via nested list for all Np values and modes considered</span>
<span class="sd">        (this can result in a large amount of data being stored!)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Class variables defined later on</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of complex-valued eigenvalues of shape (N_Np,N_modes), where:</span>
<span class="sd">            </span>
<span class="sd">        * _N_Np_ is number of pedestrian cases considered</span>
<span class="sd">        </span>
<span class="sd">        * _N_modes_ is number of system matrix eigenmodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of effective damping ratio for each mode and pedestrian </span>
<span class="sd">        count considered.</span>
<span class="sd">        </span>
<span class="sd">        _Ndarray shape as per eigenvalues above._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of damped natural frequencies for each mode and pedestrian </span>
<span class="sd">        count considered.</span>
<span class="sd">        </span>
<span class="sd">        _Ndarray shape as per eigenvalues above._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of complex-valued eigenvalues of shape _(N_Np,N_modes,N_dof)_, </span>
<span class="sd">        where:</span>
<span class="sd">        * _N_Np_ is number of pedestrian cases considered</span>
<span class="sd">        </span>
<span class="sd">        * _N_modes_ is number of system matrix eigenmodes</span>
<span class="sd">        </span>
<span class="sd">        * _N_dof_ is the total number of degrees of freedom / state variables </span>
<span class="sd">          for the system analysed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Array listing the set of pedestrian numbers analysed</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of effective damping rate per pedestrian for each mode and </span>
<span class="sd">        pedestrian count considered.</span>
<span class="sd">        </span>
<span class="sd">        _Ndarray shape as per eigenvalues above._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of effective added mass per pedestrian for each mode and </span>
<span class="sd">        pedestrian count considered.</span>
<span class="sd">        </span>
<span class="sd">        _Ndarray shape as per eigenvalues above._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matrix to represent the smeared effect of one pedestrian on the deck</span>
<span class="sd">        Used to calculate additive system matrices due to pedestrians</span>
<span class="sd">        &quot;&quot;&quot;</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Critical number of pedestrians to give zero net damping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Index of (complex) eigenmode that loses stability at Np=Np_crit </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Damped natural frequency of mode that loses stability at Np=Np_crit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Effective damping ratio of mode that loses stability at Np=Np_crit</span>
<span class="sd">        (damping ratio = 0.00 expected)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Complex-valued pole / eigenvalue at Np=Np_crit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">X_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Complex-valued eigenvector of mode that loses stability at Np=Np_crit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Damping matrix (of &#39;parent&#39; modal system) applicable to mode that loses </span>
<span class="sd">        stability at Np=Np_crit.</span>
<span class="sd">        </span>
<span class="sd">        Will in general include off-diagonal terms due to mode coupling effect </span>
<span class="sd">        of pedestrians, determined per method presented in McRobie&#39;s paper  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mass matrix (of &#39;parent&#39; modal system) applicable to mode that loses </span>
<span class="sd">        stability at Np=Np_crit.</span>
<span class="sd">        </span>
<span class="sd">        Will in general include off-diagonal terms due to mode coupling effect </span>
<span class="sd">        of pedestrians, determined per method presented in McRobie&#39;s paper  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">makePlots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_cp_func</span><span class="p">()</span>
        
        
    <span class="k">def</span> <span class="nf">init_cp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conservative</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise default function to use to define frequency-dependence of </span>
<span class="sd">        effective added damping per pedestrian (Ns/m per pedestrian).</span>
<span class="sd">        </span>
<span class="sd">        Note damping taken in conventional sense, such that positive values</span>
<span class="sd">        define added damping i.e. increased attenuation of vibrations. </span>
<span class="sd">        Correspondingly the effect of pedestrians will tend to be represented </span>
<span class="sd">        by a negative damping rate.</span>
<span class="sd">        </span>
<span class="sd">        This default profile has been defined with regards to the work done by</span>
<span class="sd">        Dallard et al (2006) and John MacDonald (2008). The default curve </span>
<span class="sd">        defined within this function is taken to be a conservative </span>
<span class="sd">        representation of the damping values presented in Figure 9(a) of </span>
<span class="sd">        the latter&#39;s paper _&quot;Lateral excitation of bridges by balancing </span>
<span class="sd">        pedestrians&quot;_</span>
<span class="sd">        </span>
<span class="sd">        If `conservative=True` is used then the negative 300Ns/m value proposed </span>
<span class="sd">        by Dallard et al will be used. This value is taken to be independent </span>
<span class="sd">        of frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">conservative</span><span class="p">:</span>
            <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
            <span class="n">cp_vals</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
            <span class="n">cp_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            
            
        <span class="n">cp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cp_func</span>
    
    
    <span class="k">def</span> <span class="nf">init_mp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise default function to use to define frequency-dependence of </span>
<span class="sd">        effective added mass per pedestrian (kg per pedestrian)</span>
<span class="sd">        </span>
<span class="sd">        The default curve defined within this function is taken to be a </span>
<span class="sd">        simplified representation of the added mass values presented in </span>
<span class="sd">        Figure 9(b) of John MacDonald&#39;s 2008 Proc. of the Royal Society paper </span>
<span class="sd">        _&quot;Lateral excitation of bridges by balancing pedestrians&quot;_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
        <span class="n">deltaM_vals</span> <span class="o">=</span> <span class="p">[</span><span class="o">+</span><span class="mi">70</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="n">deltaM_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">deltaM_vals</span><span class="p">,</span>
                                                 <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                                 <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                 <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deltaM_func</span>
    

    <span class="k">def</span> <span class="nf">calc_pedestrian_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates modal damping matrix due to pedestrians, per the method </span>
<span class="sd">        presented in McRobie paper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get system matrix to represent distributed action of pedestrians</span>
        <span class="c1"># along deck modeshapes</span>
        <span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span>
            
        <span class="k">if</span> <span class="n">ped_effect_mtrx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                
            <span class="n">modalsys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys</span>
            <span class="n">modeshape_func</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">modeshapeFunc</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">Ltrack</span>
            
            <span class="c1"># Evaluate modeshape ordinates at unif</span>
            <span class="n">dL</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="n">num</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="n">dL</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">modeshape_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                
            <span class="c1"># Evaluate matrix product of modeshape ordinate matrices</span>
            <span class="n">phi_product</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">T</span> <span class="err">@</span> <span class="n">phi</span>
            
            <span class="c1"># Return mode-generalised damping matrix</span>
            <span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="n">dL</span> <span class="o">/</span> <span class="n">L</span> <span class="o">*</span> <span class="n">phi_product</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="n">ped_effect_mtrx</span>
        
        <span class="c1"># Evaluate cp and mp given mode natural frequency provided</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c1"># positive frequencies to be used</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        
        <span class="n">C_pa</span> <span class="o">=</span> <span class="n">cp</span> <span class="o">*</span> <span class="n">ped_effect_mtrx</span>
        <span class="n">M_pa</span> <span class="o">=</span> <span class="n">mp</span> <span class="o">*</span> <span class="n">ped_effect_mtrx</span>
        
        <span class="c1"># Return results as dict</span>
        <span class="n">rslts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;C_pa&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">C_pa</span>
        <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;M_pa&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">M_pa</span>
        <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;cp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cp</span>
        <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;mp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mp</span>
        <span class="k">return</span> <span class="n">rslts</span>
        
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">calc_Np_crit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run analysis to explore eigenvalues of system state matrix for various </span>
<span class="sd">        assumed pedestrian crowd densities</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `Np_vals`, _array-like_: each value defines total number of </span>
<span class="sd">          pedestrians on bridge; a range of values will typically be provided, </span>
<span class="sd">          to allow exploration of how system eigenproperties (in particular </span>
<span class="sd">          effective damping) varies with pedestrian numbers</span>
<span class="sd">         </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running lat sync eigenvalues analysis...&quot;</span><span class="p">)</span>
    
        <span class="c1"># Run analysis </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_analysis</span><span class="p">(</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">append_rslts</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># Calculate critical number of pedestrians for onset on instability</span>
        <span class="k">if</span> <span class="n">calc_Np_crit</span><span class="p">:</span>
            <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Np_crit</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis complete!&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Np_crit</span>
    
    
    <span class="k">def</span> <span class="nf">_run_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Np_vals</span><span class="p">,</span>
                      <span class="n">append_rslts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run analysis for various pedestrian numbers, as provided to function</span>
<span class="sd">        </span>
<span class="sd">        To cater for frequency-dependent nature of pedestrian damping/mass</span>
<span class="sd">        effect an iterative procedure is adopted, similar to the p-k method </span>
<span class="sd">        devised by Theodorsen for solving aeroelastic problems</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">modalsys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys</span>
        
        <span class="n">store_mtrxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_mtrxs</span>
                
        <span class="c1"># Take copy of system damping matrix with no pedestrians</span>
        <span class="n">C0</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">modalsys</span><span class="o">.</span><span class="n">_C_mtrx</span><span class="p">)</span>
        <span class="n">M0</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">modalsys</span><span class="o">.</span><span class="n">_M_mtrx</span><span class="p">)</span>
        
        <span class="c1"># Define function to iterate with</span>
        <span class="k">def</span> <span class="nf">calc_modal_properties</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">mode_index</span><span class="p">,</span><span class="n">Np</span><span class="p">,</span><span class="n">return_rslts</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            
            <span class="c1"># Calculate change in model damping matrix</span>
            <span class="c1"># due to smeared effect of N=1 pedestrian</span>
            <span class="n">rslts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_pedestrian_effect</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">C_pa</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;C_pa&#39;</span><span class="p">]</span>
            <span class="n">M_pa</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;M_pa&#39;</span><span class="p">]</span>
            
            <span class="c1"># Adjust bridge damping and mass matrices</span>
            <span class="n">modalsys</span><span class="o">.</span><span class="n">_C_mtrx</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">+</span> <span class="n">Np</span> <span class="o">*</span> <span class="n">C_pa</span>
            <span class="n">modalsys</span><span class="o">.</span><span class="n">_M_mtrx</span> <span class="o">=</span> <span class="n">M0</span> <span class="o">+</span> <span class="n">Np</span> <span class="o">*</span> <span class="n">M_pa</span>
                    
            <span class="c1"># Carry out eigevalue analysis using updated system matrices</span>
            <span class="n">eig_props</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
            <span class="n">f_new</span> <span class="o">=</span> <span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;f_d&#39;</span><span class="p">][</span><span class="n">mode_index</span><span class="p">]</span>
            
            <span class="n">f_error</span> <span class="o">=</span> <span class="n">f_new</span> <span class="o">-</span> <span class="n">f</span>
            
            <span class="c1">#print(&quot;Calculating: Np=%d, mode=%d, f=%.3f, f_error=%.3f&quot; </span>
            <span class="c1">#      % (Np,mode_index,f,f_error))</span>
            
            <span class="k">if</span> <span class="n">return_rslts</span><span class="p">:</span>
                
                <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;eig_props&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">eig_props</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">rslts</span><span class="p">}</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;C_mtrx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">_C_mtrx</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;M_mtrx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">_M_mtrx</span>
                
                <span class="k">return</span> <span class="n">f_error</span><span class="p">,</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f_error</span>
            
        <span class="c1"># Carry out eigevalue analysis of system with no pedestrians</span>
        <span class="n">eig_props</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
        <span class="n">fd_vals_last</span> <span class="o">=</span> <span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;f_d&#39;</span><span class="p">]</span>
        
        <span class="c1"># Loop over all pedestrian numbers provided to function</span>
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mp_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">s_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eta_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fd_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X_vals</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
            <span class="n">C_mtrx_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">M_mtrx_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">_Np</span> <span class="ow">in</span> <span class="n">Np_vals</span><span class="p">:</span>
            
            <span class="n">cp_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mp_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">s_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">eta_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fd_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">X_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                <span class="n">C_mtrx_inner_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">M_mtrx_inner_list</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">_mode_index</span><span class="p">,</span> <span class="n">_fd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fd_vals_last</span><span class="p">):</span>
            
                <span class="c1"># Solve for consistent frequencies, allowing for </span>
                <span class="c1"># frequency-dependence of pedestrian-related mass and damping</span>
                <span class="n">fd_sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">calc_modal_properties</span><span class="p">,</span>
                                               <span class="n">x0</span><span class="o">=</span><span class="n">_fd</span><span class="p">,</span>
                                               <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_mode_index</span><span class="p">,</span><span class="n">_Np</span><span class="p">))</span>
                
                <span class="c1"># Rerun for converged frequency of given mode</span>
                <span class="n">ferr</span><span class="p">,</span> <span class="n">rslts</span> <span class="o">=</span> <span class="n">calc_modal_properties</span><span class="p">(</span><span class="n">fd_sol</span><span class="p">,</span>
                                                    <span class="n">_mode_index</span><span class="p">,</span><span class="n">_Np</span><span class="p">,</span>
                                                    <span class="n">return_rslts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                
                <span class="n">eig_props</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;eig_props&#39;</span><span class="p">]</span>
                <span class="n">cp</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;cp&#39;</span><span class="p">]</span>
                <span class="n">mp</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;mp&#39;</span><span class="p">]</span>
                <span class="n">C_mtrx</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;C_mtrx&#39;</span><span class="p">]</span>
                <span class="n">M_mtrx</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;M_mtrx&#39;</span><span class="p">]</span>
                
                <span class="c1"># Unpack results for this mode and append to inner lists</span>
                <span class="n">cp_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
                <span class="n">mp_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
                <span class="n">s_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">][</span><span class="n">_mode_index</span><span class="p">])</span>
                <span class="n">eta_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;eta&#39;</span><span class="p">][</span><span class="n">_mode_index</span><span class="p">])</span>
                <span class="n">fd_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;f_d&#39;</span><span class="p">][</span><span class="n">_mode_index</span><span class="p">])</span>
                <span class="n">X_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][:,</span><span class="n">_mode_index</span><span class="p">]))</span>
                
                <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                    <span class="n">C_mtrx_inner_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C_mtrx</span><span class="p">)</span>
                    <span class="n">M_mtrx_inner_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_mtrx</span><span class="p">)</span>
                
            <span class="c1"># Update last frequencies</span>
            <span class="n">fd_vals_last</span> <span class="o">=</span> <span class="n">fd_vals_inner</span>
                
            <span class="c1"># Append inner lists to outer lists</span>
            <span class="n">cp_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_vals_inner</span><span class="p">)</span>
            <span class="n">mp_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp_vals_inner</span><span class="p">)</span>
            <span class="n">s_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_vals_inner</span><span class="p">)</span>
            <span class="n">eta_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eta_vals_inner</span><span class="p">)</span>
            <span class="n">fd_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fd_vals_inner</span><span class="p">)</span>
            <span class="n">X_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_vals_inner</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                <span class="n">C_mtrx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C_mtrx_inner_list</span><span class="p">)</span>
                <span class="n">M_mtrx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_mtrx_inner_list</span><span class="p">)</span>
            
        <span class="c1"># Convert nested lists to numpy ndarray type</span>
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cp_vals</span><span class="p">)</span>
        <span class="n">mp_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mp_vals</span><span class="p">)</span>
        <span class="n">s_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_vals</span><span class="p">)</span>
        <span class="n">eta_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">)</span>
        <span class="n">fd_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fd_vals</span><span class="p">)</span>
        <span class="n">X_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_vals</span><span class="p">)</span>
        
        <span class="c1"># Restore original no-pedestrians system matrices</span>
        <span class="n">modalsys</span><span class="o">.</span><span class="n">_C_mtrx</span> <span class="o">=</span> <span class="n">C0</span>
        <span class="n">modalsys</span><span class="o">.</span><span class="n">_M_mtrx</span> <span class="o">=</span> <span class="n">M0</span>
        
        <span class="c1"># Check to see if previous results exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;eigenvalues&#39;</span><span class="p">):</span>
            <span class="n">append_rslts</span> <span class="o">=</span> <span class="bp">False</span> <span class="c1"># no previous results avaliable</span>
        
        <span class="c1"># Record key results as attributes, or append to previous results</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append_rslts</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">s_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">eta_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span> <span class="o">=</span> <span class="n">fd_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">X_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span> <span class="o">=</span> <span class="n">Np_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span> <span class="o">=</span> <span class="n">cp_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span> <span class="o">=</span> <span class="n">mp_vals</span>
            
            <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_list</span> <span class="o">=</span> <span class="n">C_mtrx_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_list</span> <span class="o">=</span> <span class="n">M_mtrx_list</span>
            
        <span class="k">if</span> <span class="n">append_rslts</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">,</span><span class="n">s_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">,</span><span class="n">eta_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span><span class="p">,</span><span class="n">fd_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">,</span><span class="n">X_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">,</span><span class="n">Np_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span><span class="p">,</span><span class="n">mp_vals</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C_mtrx_list</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_mtrx_list</span><span class="p">)</span>
            
 
    <span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots results from the above analysis</span>
<span class="sd">        </span>
<span class="sd">        N.b: Figures intentionally emulate the format of figures in </span>
<span class="sd">        McRobie&#39;s paper, as these have been used to validate the above routine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
        
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        
        <span class="c1"># Prepare subplots</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_damping_vs_freq</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_poles</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_damping_vs_pedestrians</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_cp_func</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">sharex</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_mp_func</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">fig</span>
        
    
    <span class="k">def</span> <span class="nf">plot_damping_vs_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;            </span>
<span class="sd">        Plot damping ratio against damped natural frequency</span>
<span class="sd">        (per Figure 5 in McRobie&#39;s paper)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        
        <span class="n">eta_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span>
        <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">,</span><span class="n">fd_vals</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span><span class="n">fd_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fd_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1"># denotes stability limit</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damped natural frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Frequency vs Effective Damping</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
        
    
    <span class="k">def</span> <span class="nf">plot_poles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot eigenvalues (poles) on complex plane</span>
<span class="sd">        (per Figure 4 in paper)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        
        <span class="n">s_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">),</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">]),</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1"># stability limit</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># illustrates Im(z)=0 axis</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Real(s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Imag(s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Eigenvalues of system state matrix&quot;</span><span class="p">)</span>
        
        <span class="n">s_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span>
        <span class="k">if</span> <span class="n">s_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_crit</span><span class="p">),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_crit</span><span class="p">),</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
        
    
    <span class="k">def</span> <span class="nf">plot_damping_vs_pedestrians</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots effective damping ratio of poles against number of pedestrians</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">Np_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span>
        <span class="n">eta_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">eta_vals</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of pedestrians&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Effective damping ratio&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Effect of pedestrians on effective damping&quot;</span><span class="p">)</span>
        
        <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span>
        <span class="k">if</span> <span class="n">Np_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Np_crit</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Np_crit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
            
            
    <span class="k">def</span> <span class="nf">plot_cp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">f_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots function defining how negative damping per pedestrian varies </span>
<span class="sd">        with frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span>
        
        <span class="k">if</span> <span class="n">f_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="n">f_vals</span> <span class="o">=</span> <span class="n">cp_func</span><span class="o">.</span><span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`f_vals` must be provided!&quot;</span><span class="p">)</span>
                
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="n">cp_func</span><span class="p">(</span><span class="n">f_vals</span><span class="p">)</span>
           
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Defined $c_p(f)$ function&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$c_p$ (Ns/m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damping rate per pedestrian, $c_p$&quot;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cp_vals&#39;</span><span class="p">):</span>
            <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>
            <span class="n">cp_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="s1">&#39;r|&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$c_p$ values for modes&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>
    
    
    <span class="k">def</span> <span class="nf">plot_mp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">f_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots function defining how negative damping per pedestrian varies </span>
<span class="sd">        with frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span>
        
        <span class="k">if</span> <span class="n">f_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mp_func</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="n">f_vals</span> <span class="o">=</span> <span class="n">mp_func</span><span class="o">.</span><span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`f_vals` must be provided!&quot;</span><span class="p">)</span>
                
        <span class="n">mp_vals</span> <span class="o">=</span> <span class="n">mp_func</span><span class="p">(</span><span class="n">f_vals</span><span class="p">)</span>
           
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">mp_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Defined $m_p(f)$ function&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">+</span><span class="mi">100</span><span class="p">])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta M$ (kg)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Added mass per pedestrian, $\Delta M$&quot;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;mp_vals&#39;</span><span class="p">):</span>
            <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>
            <span class="n">mp_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd_vals</span><span class="p">,</span><span class="n">mp_vals</span><span class="p">,</span><span class="s1">&#39;r|&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$\Delta M$ values for modes&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>
        
        
    <span class="k">def</span> <span class="nf">calc_Np_crit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rerun_factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates from results the critical number of pedestrians for the </span>
<span class="sd">        onset of pedestrian-induced lateral instability</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Determining critical number of pedestrians &quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;for onset on instability...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check that analysis has been run</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;N_pedestrians&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis does not appear to have been run!&quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;Cannot calculate Np_crit&quot;</span><span class="p">)</span>
                                
        <span class="c1"># Check that analysis has been run up to pedestrian numbers such that </span>
        <span class="c1"># the net effective damping in (at least) one mode has become &lt;0.0</span>
        <span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">)</span>
        <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">)</span>
        
        <span class="k">while</span> <span class="n">min_damping</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                 
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis has not identified net damping &lt; 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                      <span class="s2">&quot;Analysis will be extended to larger pedestrian numbers&quot;</span><span class="p">)</span>
            
            <span class="c1"># Get key details of Np analysed last time around</span>
            <span class="n">Np_max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">)</span> <span class="c1"># max from last run</span>
            <span class="n">Np_min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">)</span> <span class="c1"># min from last run</span>
            <span class="n">Np_step</span> <span class="o">=</span> <span class="p">(</span><span class="n">Np_max</span> <span class="o">-</span> <span class="n">Np_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">))</span>
            
            <span class="c1"># Define Np_vals for new analysis</span>
            <span class="n">new_Np_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Np_max</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Np_max</span><span class="o">*</span><span class="n">rerun_factor</span><span class="p">,</span><span class="n">Np_step</span><span class="p">)</span>
            
            <span class="c1"># Rerun analysis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_analysis</span><span class="p">(</span><span class="n">new_Np_vals</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            
            <span class="c1"># Recalculate minimum damping</span>
            <span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">)</span>
            <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">)</span>
            
        <span class="c1"># Determine minumum damping ratio across all modes for each Np value</span>
        <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Define interpolation function</span>
        <span class="n">Np_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span>
        
        <span class="n">Np_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">,</span>
                                             <span class="n">y</span><span class="o">=</span><span class="n">min_damping</span><span class="p">)</span>
                                      
        <span class="c1"># Use root finding function to obtain Np such that damping = 0.0</span>
        <span class="n">Np_crit</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">Np_func</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span> <span class="o">=</span> <span class="n">Np_crit</span>
        
        <span class="c1"># Rerun analysis to obtain properties at critical point</span>
        <span class="c1"># 1) take copy of class to pick up same attributes as analysis run</span>
        <span class="n">crit_rslts</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># 2) Edit a few key properties for this purpose</span>
        <span class="n">crit_rslts</span><span class="o">.</span><span class="n">store_mtrxs</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># 3) rerun to override results already held in the above object</span>
        <span class="n">crit_rslts</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Np_vals</span><span class="o">=</span><span class="p">[</span><span class="n">Np_crit</span><span class="p">],</span><span class="n">calc_Np_crit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Determine critical mode i.e. mode with damping =0 when Np=Np_crit</span>
        <span class="n">crit_mode</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">crit_rslts</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span> <span class="o">=</span> <span class="n">crit_mode</span>
        
        <span class="c1"># Extract key properties of critical mode at Np=Np_crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">damped_freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">C_mtrx_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">crit_mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">M_mtrx_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">crit_mode</span><span class="p">]</span>
                    
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Critical no. pedestrians, Np_crit:</span><span class="se">\t</span><span class="si">%.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Index of critical mode:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damped nat freq, critical mode:</span><span class="se">\t</span><span class="si">%.3f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damping ratio, critical mode:</span><span class="se">\t</span><span class="si">%.2e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Np_crit</span>

    
<span class="c1"># ************* PRIVATE CLASSES (only to be used within module) *************    </span>
        
<span class="k">class</span> <span class="nc">_DeckStrip</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class used to define and integrate over 2D regions (deck strips)</span>
<span class="sd">    spanning the following domains:</span>
<span class="sd">    </span>
<span class="sd">    x: [0, L]</span>
<span class="sd">    y: [-b(x)/2, +b(x)/2]</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">name</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span>
                 <span class="n">L</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                 <span class="n">width_func</span><span class="p">,</span>
                 <span class="n">func_edge1</span><span class="p">,</span>
                 <span class="n">func_edge2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">        </span>
<span class="sd">        * `name`, _string_; identifier for class instance, preferably unique</span>
<span class="sd">        </span>
<span class="sd">        * `L`, list of floats, length 2 expected. Denotes length of strip </span>
<span class="sd">          as measured along edge curves.</span>
<span class="sd">        </span>
<span class="sd">        * `width_func`, _function_ expected, defines width _b_ of strip (in m)</span>
<span class="sd">          as a function of chainage along the _centreline_ of the strip.</span>
<span class="sd">          _Float_ may also be provided, in case of deck strips which are uniform </span>
<span class="sd">          in x.</span>
<span class="sd">          </span>
<span class="sd">        * `func_edge1`, defines function to be integrated, along the edge of </span>
<span class="sd">        the strip at y = -b(x)/2</span>
<span class="sd">        </span>
<span class="sd">        * `func_edge2`, defines function to be integrated, along the edge of </span>
<span class="sd">        the strip at y = +b(x)/2</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Name assigned to deck strip instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">L</span><span class="p">)</span><span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;List of length 2 expected for `L` parameter&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">L_list</span> <span class="o">=</span> <span class="n">L</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Length of deck strip, measured along edge 1 and edge2 respectively</span>
<span class="sd">        </span>
<span class="sd">        _List_ of length 2 expected</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">width_func</span> <span class="o">=</span> <span class="n">width_func</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _Function (_ or _float_) to describe how width of deck strip</span>
<span class="sd">        varies with chainage, b(x)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">func_edge1</span> <span class="o">=</span> <span class="n">func_edge1</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _Function_ to define variation of integrand along -b(x) edge</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">func_edge2</span> <span class="o">=</span> <span class="n">func_edge2</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _Function_ to define variation of integrand along +b(x) edge</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        
    
    <span class="k">def</span> <span class="nf">print_details</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">calcArea</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints details of deck region instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">keys2print</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;L_list&quot;</span><span class="p">,</span><span class="s2">&quot;width_func&quot;</span><span class="p">,</span><span class="s2">&quot;func_edge1&quot;</span><span class="p">,</span><span class="s2">&quot;func_edge2&quot;</span><span class="p">]</span>
        
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            
            <span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">keys2print</span><span class="p">:</span>
                
                <span class="k">print</span><span class="p">(</span><span class="n">key</span> <span class="o">+</span> <span class="s2">&quot;:&quot;</span><span class="p">)</span>
                <span class="k">print</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">calcArea</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Area:&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_area</span><span class="p">())</span>
    
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">calc_area</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates area of deck strip by integration</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span>
                              <span class="n">func_edge1</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                              <span class="n">func_edge2</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                              <span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">,</span>
                              <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        
    <span class="k">def</span> <span class="nf">integrate</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">index</span><span class="p">,</span>
                  <span class="n">func_edge1</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">func_edge2</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                  <span class="n">num</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                  <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integrates function (integrand) over domain</span>
<span class="sd">        </span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `index`, integer index to apply to values returned by functions</span>
<span class="sd">            </span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * `num`, defines number of transverse cuts to make when integrating</span>
<span class="sd">        </span>
<span class="sd">        Functions `func_edge1` and `func_edge2` can be supplied to override</span>
<span class="sd">        corresponding functions held as attributes. Howeverr default behaviour </span>
<span class="sd">        is to use attribute functions.</span>
<span class="sd">        </span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Handle optional arguments</span>
        <span class="k">if</span> <span class="n">func_edge1</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">func_edge1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func_edge1</span>
         
        <span class="k">if</span> <span class="n">func_edge2</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">func_edge2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">func_edge2</span>
            
        <span class="c1"># Retrieve other attributes</span>
        <span class="n">L_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">L_list</span>
        <span class="n">width_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">width_func</span>    
        
        <span class="c1"># Evaluate functions</span>
        <span class="n">x_edge1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L_list</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)</span>
        <span class="n">x_edge2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L_list</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">num</span><span class="o">=</span><span class="n">num</span><span class="p">)</span>
        <span class="n">x_CL</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x_edge1</span><span class="o">+</span><span class="n">x_edge2</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func_edge1</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="n">f_edge1</span> <span class="o">=</span> <span class="n">func_edge1</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_edge1</span> <span class="o">=</span> <span class="n">func_edge1</span><span class="p">(</span><span class="n">x_edge1</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">func_edge2</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="n">f_edge2</span> <span class="o">=</span> <span class="n">func_edge2</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">num</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_edge2</span> <span class="o">=</span> <span class="n">func_edge2</span><span class="p">(</span><span class="n">x_edge2</span><span class="p">)</span>
          
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width_func</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">width_func</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">num</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">width</span> <span class="o">=</span> <span class="n">width_func</span><span class="p">(</span><span class="n">x_CL</span><span class="p">)</span>    
            
        <span class="c1"># Determine integrals on transverse sections</span>
        <span class="n">integral_y</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_integral_y</span><span class="p">(</span><span class="n">width</span><span class="p">,</span><span class="n">f_edge1</span><span class="p">,</span><span class="n">f_edge2</span><span class="p">,</span><span class="n">index</span><span class="p">)</span>

        <span class="c1"># Determine area integral by integrating over transverse cuts</span>
        <span class="n">integral_x</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">integral_y</span><span class="p">,</span>
                                              <span class="n">x</span><span class="o">=</span><span class="n">x_CL</span><span class="p">,</span>
                                              <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                              <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="n">overall_integral</span> <span class="o">=</span> <span class="n">integral_x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
            
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Deck region `</span><span class="si">%s</span><span class="s2">`</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> 
                         <span class="s2">&quot;Target index </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">index</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            
            <span class="n">ax2</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_CL</span><span class="p">,</span><span class="n">integral_y</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Transverse integrals (m)&quot;</span><span class="p">)</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">([])</span>
            <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            <span class="n">ax3</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_CL</span><span class="p">,</span><span class="n">integral_x</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Overall integrals ($m^2$)&quot;</span><span class="p">)</span>
            <span class="n">ax3</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">,</span><span class="n">proj_type</span> <span class="o">=</span> <span class="s1">&#39;ortho&#39;</span><span class="p">)</span>
            <span class="n">ax1</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Strip geometry and integrand&quot;</span><span class="p">)</span>
            <span class="c1">#ax.set_aspect(&#39;equal&#39;)</span>
            
            <span class="n">y_edge1</span> <span class="o">=</span> <span class="o">-</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">y_edge2</span> <span class="o">=</span> <span class="o">+</span><span class="n">width</span><span class="o">/</span><span class="mi">2</span>
            
            <span class="c1"># Get ordinates along third spine</span>
            <span class="n">y3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">y3</span>
            <span class="n">f3</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">phi3</span>
            
            <span class="n">N</span> <span class="o">=</span> <span class="n">f_edge1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">_h</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">),</span><span class="n">h</span><span class="p">):</span>
                
                <span class="n">x_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x_edge1</span><span class="p">,</span>
                                       <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">x_edge1</span><span class="o">+</span><span class="n">x_edge2</span><span class="p">),</span>
                                       <span class="n">x_edge2</span><span class="p">))</span>
                
                <span class="n">y_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">y_edge1</span><span class="p">,</span>
                                       <span class="n">y3</span><span class="p">,</span>
                                       <span class="n">y_edge2</span><span class="p">))</span>
                
                <span class="n">f_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">f_edge1</span><span class="p">[:,</span><span class="n">m</span><span class="p">],</span>
                                       <span class="n">f3</span><span class="p">[:,</span><span class="n">m</span><span class="p">],</span>
                                       <span class="n">f_edge2</span><span class="p">[:,</span><span class="n">m</span><span class="p">]))</span>
                                            
                <span class="n">ax1</span><span class="o">.</span><span class="n">plot_wireframe</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_vals</span><span class="p">,</span><span class="n">f_vals</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="n">_h</span><span class="o">.</span><span class="n">get_color</span><span class="p">())</span>
                <span class="c1">#ax.plot_surface(x_vals,y_vals,f_vals)</span>
                
                <span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">x_CL</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
                         <span class="n">overall_integral</span><span class="p">[</span><span class="n">m</span><span class="p">],</span>
                         <span class="s2">&quot;</span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">overall_integral</span><span class="p">[</span><span class="n">m</span><span class="p">])</span>
                
            <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">h</span><span class="p">,[</span><span class="s2">&quot;Index </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">h</span><span class="p">))])</span>
            
        <span class="c1"># Return overall integrat        </span>
        <span class="k">return</span> <span class="n">overall_integral</span>
    
    <span class="k">def</span> <span class="nf">calc_integral_y</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">b</span><span class="p">,</span><span class="n">phi1</span><span class="p">,</span><span class="n">phi2</span><span class="p">,</span><span class="n">target_index</span><span class="p">:</span><span class="nb">int</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes transverse 1D integral across domain of width `b`, </span>
<span class="sd">        given edge ordinates `phi1` and phi2` at various longitudinal </span>
<span class="sd">        ordinates.</span>
<span class="sd">        </span>
<span class="sd">        Linear variation of integrand within integration domain is assumed.</span>
<span class="sd">                    </span>
<span class="sd">        Arrays of compatible dimensions must be supplied (this is checked)</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `b`, 1D array of width ordinates</span>
<span class="sd">        </span>
<span class="sd">        * `phi1`, 2D array of function ordinates along edge 1</span>
<span class="sd">        </span>
<span class="sd">        * `phi2`, 2D array of function ordinates along edge 2</span>
<span class="sd">                </span>
<span class="sd">        * `target_index`, _integer_, used to denote index of arrays for which </span>
<span class="sd">          integral is &quot;targeted&quot;, along axis 0.</span>
<span class="sd">          </span>
<span class="sd">        For this dimension referred to be `target_index`, the sign of the </span>
<span class="sd">        integrand will be adjusted such that the integral over that dimension </span>
<span class="sd">        is equivilent to the integral of the modulus of the integrand function. </span>
<span class="sd">        The pattern of sign-reversal will be used consistently for integration </span>
<span class="sd">        over all other dimensions.</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        _A useful application of this function (for which it has been written!) </span>
<span class="sd">        is to situations where the sign of a distirbuted load is to varied to </span>
<span class="sd">        always be in the adverse (non-cancelling) sense._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Convert arrays</span>
        <span class="c1">#b = numpy.array(b)</span>
        <span class="c1">#phi1 = numpy.asmatrix(phi1).T</span>
        <span class="c1">#phi2 = numpy.asmatrix(phi2).T</span>
        
        <span class="c1"># Change shapes agree</span>
        <span class="k">if</span> <span class="n">phi1</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">phi2</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Shapes of `phi1` and `phi2` do not agree!&quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;phi1.shape: {0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phi1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> 
                             <span class="s2">&quot;phi2.shape: {0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phi2</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
            
        <span class="k">if</span> <span class="n">phi1</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Axis 0 of `phi1` and `b` do not agree!</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;phi1.shape: {0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">phi1</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">+</span> 
                             <span class="s2">&quot;b.shape: {0}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>  
            
        <span class="c1">#if target_index &lt; 0 or target_index &gt;= phi1.shape[1]:</span>
        <span class="c1">#    raise ValueError(&quot;Invalid `target_index` specified!&quot;)</span>
        
        <span class="c1"># Loop through one transverse cut at a time</span>
        <span class="n">integral_y_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">y3</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">phi3</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">_phi1</span><span class="p">,</span> <span class="n">_phi2</span><span class="p">,</span> <span class="n">_b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">phi1</span><span class="p">,</span><span class="n">phi2</span><span class="p">,</span><span class="n">b</span><span class="p">):</span>
            
            <span class="c1"># Define y-coordinate of edge lines</span>
            <span class="n">_y1</span> <span class="o">=</span> <span class="o">-</span><span class="n">_b</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">_y2</span> <span class="o">=</span> <span class="o">+</span><span class="n">_b</span><span class="o">/</span><span class="mi">2</span>
            
            <span class="c1"># Create a third spine along the deck centreline, </span>
            <span class="c1"># with intepolated (averaged) integrand values</span>
            <span class="n">_y3</span>   <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">_y1</span> <span class="o">+</span> <span class="n">_y2</span><span class="p">)</span>
            <span class="n">_phi3</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">_phi1</span> <span class="o">+</span> <span class="n">_phi2</span><span class="p">)</span>
            
            <span class="c1"># Test to see if integrand same sign (for target dimension)</span>
            <span class="n">i</span> <span class="o">=</span> <span class="n">target_index</span>
            <span class="n">phi_i</span> <span class="o">=</span> <span class="p">[</span><span class="n">_phi1</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">_phi2</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span>
            <span class="n">sign_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sign</span><span class="p">(</span><span class="n">phi_i</span><span class="p">)</span>
            
            <span class="c1"># Adjust third spine ordinates if signs differ</span>
            <span class="k">if</span> <span class="n">sign_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">sign_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">:</span>
                
                <span class="k">if</span> <span class="n">sign_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># 1st ordinate is positive, which implies the 2nd is not</span>
                    <span class="n">_y3</span> <span class="o">=</span> <span class="n">_y1</span> <span class="o">+</span> <span class="n">phi_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">phi_i</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi_i</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">*</span> <span class="n">_b</span>
                    
                    <span class="c1"># Negate ordinates across all dimensions</span>
                    <span class="n">_phi2</span> <span class="o">=</span> <span class="o">-</span><span class="n">_phi2</span>
                    
                <span class="k">elif</span> <span class="n">sign_vals</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
                    <span class="c1"># 2nd ordinate is positive, which implies the 1st is not</span>
                    <span class="n">_y3</span> <span class="o">=</span> <span class="n">_y2</span> <span class="o">-</span> <span class="n">phi_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">phi_i</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">phi_i</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">*</span> <span class="n">_b</span>
                    
                    <span class="c1"># Negate ordinates across all dimensions</span>
                    <span class="n">_phi1</span> <span class="o">=</span> <span class="o">-</span><span class="n">_phi1</span>
                    
                <span class="k">else</span><span class="p">:</span>
                    <span class="c1"># Both edge ordinates are negative</span>
                    <span class="c1"># Reverse to positive</span>
                    <span class="n">_phi1</span> <span class="o">=</span> <span class="o">-</span><span class="n">_phi1</span>
                    <span class="n">_phi2</span> <span class="o">=</span> <span class="o">-</span><span class="n">_phi2</span>
                    
                <span class="c1"># Modeshape along third spine = 0 given above definitions</span>
                <span class="c1"># for y-position of the spine</span>
                <span class="n">_phi3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">_phi1</span><span class="p">)</span>
        
            <span class="c1"># Calculate transverse integral</span>
            <span class="n">y_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">_y1</span><span class="p">,</span><span class="n">_y3</span><span class="p">,</span><span class="n">_y2</span><span class="p">))</span>
    
            <span class="n">phi_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">_phi1</span><span class="p">,</span><span class="n">_phi3</span><span class="p">,</span><span class="n">_phi2</span><span class="p">))</span>
    
            <span class="n">integral_y</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">phi_vals</span><span class="p">,</span>
                                                  <span class="n">x</span><span class="o">=</span><span class="n">y_vals</span><span class="p">,</span>
                                                  <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                                                  <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
            
            <span class="n">integral_y_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">integral_y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
            <span class="n">y3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_y3</span><span class="p">)</span>
            <span class="n">phi3</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">_phi3</span><span class="p">)</span>
            
        <span class="c1"># Save central spine as attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">y3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y3</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">phi3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">phi3</span><span class="p">)</span>
                    
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">integral_y_list</span><span class="p">)</span>
    

<span class="c1"># ********************** FUNCTIONS   ****************************************</span>
            
<span class="k">def</span> <span class="nf">Calc_Seff</span><span class="p">(</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="p">,</span>
              <span class="n">dx</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
              <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates effective span, as defined by NA.2.44.4 and Figure NA.7 in </span>
<span class="sd">    BS EN 1991-2</span>
<span class="sd">    </span>
<span class="sd">    ![Figure_NA_7](../dynsys/img/UKNA_BSEN1991_2_FigNA7.PNG)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `modeshapeFunc`, _function_ defining variation of modeshapes with </span>
<span class="sd">      chainage. In general, for systems with multiple modes, `modeshapeFunc` to </span>
<span class="sd">      return _array_.</span>
<span class="sd">      </span>
<span class="sd">    * `S`, length of structure. Integration of modeshapes to compute </span>
<span class="sd">      _effective span_ is carried out in the interval _[0, S]_.</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">      </span>
<span class="sd">    * `dx`, distance increment used by `scipy.integrate.cumtrapz()`</span>
<span class="sd">      </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Note absolute value integral to be computed</span>
    <span class="k">def</span> <span class="nf">abs_modeshapeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">modeshapeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
    <span class="c1"># Evaluate modeshapes at specified chainages</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">modeshapeFunc</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
    <span class="n">y_abs_vals</span> <span class="o">=</span> <span class="n">abs_modeshapeFunc</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
    
    <span class="c1"># Integrate using Scipy routine</span>
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        <span class="n">y_integral_vals</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">x_vals</span><span class="p">,</span>
                                                   <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="n">y_integral</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">x_vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Get maxima</span>
    <span class="n">y_absmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_absmax_overall</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_absmax</span><span class="p">)</span>
    
    <span class="c1"># Compute Seff</span>
    <span class="n">Seff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">y_integral</span><span class="p">,</span> <span class="mf">0.634</span><span class="o">*</span><span class="n">y_absmax</span><span class="p">)</span>
    
    <span class="c1"># Compute lambda per eqn in Figure NA.7</span>
    <span class="n">lambda_vals</span> <span class="o">=</span> <span class="mf">0.634</span> <span class="o">*</span> <span class="n">Seff</span> <span class="o">/</span> <span class="n">S</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysing modeshape functions to determine Seff...&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;S (m):</span><span class="se">\t\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Seff</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Max modeshapes:</span><span class="se">\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_absmax</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Calculation of $S_{eff}$ (m)&quot;</span><span class="p">)</span>
        
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="n">handles</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_vals</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Modeshapes, $\phi(x)$&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="n">y_absmax_overall</span><span class="p">,</span><span class="n">y_absmax_overall</span><span class="p">])</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_abs_vals</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$|\phi|(x)$&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">y_absmax_overall</span><span class="p">])</span>
        
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_integral_vals</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">])</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Chainage (m)&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\int_{0}^{x}|\phi|(x).dx$&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_integral</span><span class="p">,</span><span class="n">handles</span><span class="p">):</span>
        
            <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="n">S</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">handle</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            
            <span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">val</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span>



<span class="k">def</span> <span class="nf">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span>
                                <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                                <span class="n">load_direction</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span>
                                <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns $k_{v}(f)$ from Figure NA.8 in BS EN 1992-1:2003</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    For lateral loading, refer Tue 24/07/2018 12:56 Chris Barker email</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `fv`, mode frequency in Hz to evaluate kv at</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * `analysis_type`, _string_, either &#39;walkers&#39; or &#39;joggers&#39;</span>
<span class="sd">    </span>
<span class="sd">    * `load_direction`, _string_, either &#39;vertical&#39; or &#39;lateral&#39;</span>
<span class="sd">    </span>
<span class="sd">    * `kind`, keyword argument used by scipy.interpolate.interp1d function. </span>
<span class="sd">      Defines method of interpolation, e.g. &#39;linear&#39; or &#39;cubic&#39;</span>
<span class="sd">      </span>
<span class="sd">    * `makePlot`, _boolean_, if True plot will be made akin to Figure NA.8</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">fv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fv</span><span class="p">)</span> <span class="c1"># positive value to be used</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">load_direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span><span class="s1">&#39;lateral&#39;</span><span class="p">,</span><span class="s1">&#39;horizontal&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected load direction&quot;</span><span class="p">)</span>
        
    <span class="c1">#----------------</span>
    
    <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            
        <span class="c1"># Array to digitise Figure NA.8</span>
        <span class="n">walkersData</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span><span class="mf">0.010</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">0.080</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">,</span><span class="mf">0.240</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.20</span><span class="p">,</span><span class="mf">0.440</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.40</span><span class="p">,</span><span class="mf">0.720</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.60</span><span class="p">,</span><span class="mf">0.930</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.70</span><span class="p">,</span><span class="mf">0.980</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.80</span><span class="p">,</span><span class="mf">1.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">0.997</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.10</span><span class="p">,</span><span class="mf">0.970</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.20</span><span class="p">,</span><span class="mf">0.900</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.40</span><span class="p">,</span><span class="mf">0.650</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.60</span><span class="p">,</span><span class="mf">0.400</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.80</span><span class="p">,</span><span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.00</span><span class="p">,</span><span class="mf">0.280</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.20</span><span class="p">,</span><span class="mf">0.320</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">0.340</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.60</span><span class="p">,</span><span class="mf">0.360</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.80</span><span class="p">,</span><span class="mf">0.360</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.00</span><span class="p">,</span><span class="mf">0.350</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.50</span><span class="p">,</span><span class="mf">0.280</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">5.00</span><span class="p">,</span><span class="mf">0.180</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.50</span><span class="p">,</span><span class="mf">0.130</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.00</span><span class="p">,</span><span class="mf">0.115</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.50</span><span class="p">,</span><span class="mf">0.098</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">7.00</span><span class="p">,</span><span class="mf">0.080</span><span class="p">],</span> <span class="p">[</span><span class="mf">8.00</span><span class="p">,</span><span class="mf">0.020</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]]</span>
        
    <span class="k">else</span><span class="p">:</span>
        
        <span class="c1"># Digitised curve per Tue 24/07/2018 12:56 Chris Barker email</span>
        <span class="n">walkersData</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.008</span><span class="p">],[</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.020</span><span class="p">],[</span><span class="mf">0.30</span><span class="p">,</span><span class="mf">0.060</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span><span class="mf">0.170</span><span class="p">],[</span><span class="mf">0.50</span><span class="p">,</span><span class="mf">0.350</span><span class="p">],[</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">0.620</span><span class="p">],[</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">0.870</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.950</span><span class="p">],[</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">1.000</span><span class="p">],[</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.000</span><span class="p">],[</span><span class="mf">1.10</span><span class="p">,</span><span class="mf">0.950</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.15</span><span class="p">,</span><span class="mf">0.850</span><span class="p">],[</span><span class="mf">1.20</span><span class="p">,</span><span class="mf">0.730</span><span class="p">],[</span><span class="mf">1.30</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],[</span><span class="mf">1.40</span><span class="p">,</span><span class="mf">0.250</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.50</span><span class="p">,</span><span class="mf">0.120</span><span class="p">],[</span><span class="mf">1.52</span><span class="p">,</span><span class="mf">0.100</span><span class="p">],[</span><span class="mf">1.60</span><span class="p">,</span><span class="mf">0.065</span><span class="p">],[</span><span class="mf">1.70</span><span class="p">,</span><span class="mf">0.070</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.80</span><span class="p">,</span><span class="mf">0.070</span><span class="p">],[</span><span class="mf">1.90</span><span class="p">,</span><span class="mf">0.070</span><span class="p">],[</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">0.070</span><span class="p">],[</span><span class="mf">2.10</span><span class="p">,</span><span class="mf">0.065</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.20</span><span class="p">,</span><span class="mf">0.063</span><span class="p">],[</span><span class="mf">2.30</span><span class="p">,</span><span class="mf">0.055</span><span class="p">],[</span><span class="mf">2.40</span><span class="p">,</span><span class="mf">0.045</span><span class="p">],[</span><span class="mf">2.50</span><span class="p">,</span><span class="mf">0.035</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.60</span><span class="p">,</span><span class="mf">0.028</span><span class="p">],[</span><span class="mf">2.70</span><span class="p">,</span><span class="mf">0.020</span><span class="p">],[</span><span class="mf">2.80</span><span class="p">,</span><span class="mf">0.015</span><span class="p">],[</span><span class="mf">2.90</span><span class="p">,</span><span class="mf">0.008</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.10</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.20</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.30</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.50</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.60</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.70</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.80</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]]</span>
        
    <span class="n">walkersData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">walkersData</span><span class="p">)</span>
    <span class="n">walkersFunc</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">walkersData</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">y</span><span class="o">=</span><span class="n">walkersData</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="c1">#-------------------</span>
    
    <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
        
        <span class="c1"># Array to digitise Figure NA.8</span>
        <span class="n">joggersData</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">,</span><span class="mf">0.010</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.20</span><span class="p">,</span><span class="mf">0.040</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.40</span><span class="p">,</span><span class="mf">0.150</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.60</span><span class="p">,</span><span class="mf">0.300</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.70</span><span class="p">,</span><span class="mf">0.450</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.80</span><span class="p">,</span><span class="mf">0.550</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">0.870</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.10</span><span class="p">,</span><span class="mf">1.010</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.20</span><span class="p">,</span><span class="mf">1.110</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.40</span><span class="p">,</span><span class="mf">1.160</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.60</span><span class="p">,</span><span class="mf">1.120</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.80</span><span class="p">,</span><span class="mf">0.930</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.00</span><span class="p">,</span><span class="mf">0.640</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.20</span><span class="p">,</span><span class="mf">0.360</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">0.160</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.60</span><span class="p">,</span><span class="mf">0.100</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.80</span><span class="p">,</span><span class="mf">0.130</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.00</span><span class="p">,</span><span class="mf">0.160</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.50</span><span class="p">,</span><span class="mf">0.210</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">5.00</span><span class="p">,</span><span class="mf">0.220</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.50</span><span class="p">,</span><span class="mf">0.180</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.00</span><span class="p">,</span><span class="mf">0.110</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.50</span><span class="p">,</span><span class="mf">0.040</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">7.00</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span> <span class="p">[</span><span class="mf">8.00</span><span class="p">,</span><span class="mf">0.020</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]]</span>
        
    <span class="k">else</span><span class="p">:</span>
        
         <span class="c1"># Digitised curve per Tue 24/07/2018 12:56 Chris Barker email</span>
        <span class="n">joggersData</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">0.30</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span><span class="mf">0.010</span><span class="p">],[</span><span class="mf">0.50</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],[</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">0.100</span><span class="p">],[</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">0.250</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],[</span><span class="mf">0.90</span><span class="p">,</span><span class="mf">0.790</span><span class="p">],[</span><span class="mf">1.00</span><span class="p">,</span><span class="mf">1.030</span><span class="p">],[</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.120</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.10</span><span class="p">,</span><span class="mf">1.150</span><span class="p">],[</span><span class="mf">1.30</span><span class="p">,</span><span class="mf">1.150</span><span class="p">],[</span><span class="mf">1.35</span><span class="p">,</span><span class="mf">1.120</span><span class="p">],[</span><span class="mf">1.40</span><span class="p">,</span><span class="mf">1.030</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.45</span><span class="p">,</span><span class="mf">0.920</span><span class="p">],[</span><span class="mf">1.50</span><span class="p">,</span><span class="mf">0.780</span><span class="p">],[</span><span class="mf">1.60</span><span class="p">,</span><span class="mf">0.470</span><span class="p">],[</span><span class="mf">1.70</span><span class="p">,</span><span class="mf">0.240</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.80</span><span class="p">,</span><span class="mf">0.100</span><span class="p">],[</span><span class="mf">1.85</span><span class="p">,</span><span class="mf">0.060</span><span class="p">],[</span><span class="mf">1.90</span><span class="p">,</span><span class="mf">0.050</span><span class="p">],[</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">0.055</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.10</span><span class="p">,</span><span class="mf">0.063</span><span class="p">],[</span><span class="mf">2.20</span><span class="p">,</span><span class="mf">0.068</span><span class="p">],[</span><span class="mf">2.30</span><span class="p">,</span><span class="mf">0.069</span><span class="p">],[</span><span class="mf">2.40</span><span class="p">,</span><span class="mf">0.069</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.50</span><span class="p">,</span><span class="mf">0.069</span><span class="p">],[</span><span class="mf">2.60</span><span class="p">,</span><span class="mf">0.068</span><span class="p">],[</span><span class="mf">2.70</span><span class="p">,</span><span class="mf">0.067</span><span class="p">],[</span><span class="mf">2.80</span><span class="p">,</span><span class="mf">0.060</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.90</span><span class="p">,</span><span class="mf">0.050</span><span class="p">],[</span><span class="mf">3.00</span><span class="p">,</span><span class="mf">0.040</span><span class="p">],[</span><span class="mf">3.10</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],[</span><span class="mf">3.20</span><span class="p">,</span><span class="mf">0.021</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.30</span><span class="p">,</span><span class="mf">0.014</span><span class="p">],[</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">0.007</span><span class="p">],[</span><span class="mf">3.50</span><span class="p">,</span><span class="mf">0.004</span><span class="p">],[</span><span class="mf">3.60</span><span class="p">,</span><span class="mf">0.002</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">4.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]]</span>
        
    <span class="n">joggersData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">joggersData</span><span class="p">)</span>
    <span class="n">joggersFunc</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">joggersData</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">y</span><span class="o">=</span><span class="n">joggersData</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="c1">#-------------------</span>
    
    <span class="c1"># Get applicable array to use</span>
    <span class="k">if</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
        <span class="n">k_fv_func</span> <span class="o">=</span> <span class="n">walkersFunc</span>
    <span class="k">elif</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
        <span class="n">k_fv_func</span> <span class="o">=</span> <span class="n">joggersFunc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39; specified!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Use interpolation function to read off value at fv</span>
    <span class="n">k_fv</span> <span class="o">=</span> <span class="n">k_fv_func</span><span class="p">(</span><span class="n">fv</span><span class="p">)</span>
    
    <span class="c1"># Make plot (to show digitised curves)</span>
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fVals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">8.2</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">caseA</span> <span class="o">=</span> <span class="n">walkersFunc</span><span class="p">(</span><span class="n">fVals</span><span class="p">)</span>
        <span class="n">caseB</span> <span class="o">=</span> <span class="n">joggersFunc</span><span class="p">(</span><span class="n">fVals</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fVals</span><span class="p">,</span><span class="n">caseA</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Walkers&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fVals</span><span class="p">,</span><span class="n">caseB</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Joggers&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">k_fv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">])</span> <span class="c1"># per Fig.NA.8</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">])</span> <span class="c1"># per Tue 24/07/2018 12:56 Chris Barker email</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.4</span><span class="p">])</span> <span class="c1"># per Fig.NA.8</span>
        
        <span class="n">title_str</span> <span class="o">=</span> <span class="s2">&quot;Combined population and harmonic factor k($f_{v}$)</span><span class="se">\n</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">title_str</span> <span class="o">+=</span> <span class="s2">&quot;per Figure NA.8, UK NA to BS EN 1992-1:2003&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_str</span> <span class="o">+=</span> <span class="s2">&quot;adjusted for lateral response calculations&quot;</span>
                    
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_str</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode frequency $f_{v}$, Hz&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;k($f_{v}$)&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">k_fv</span>



    
    


<span class="k">def</span> <span class="nf">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">Seff</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">apply_PD6688_2_correction</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">groupType</span><span class="o">=</span><span class="s2">&quot;pedestrian&quot;</span><span class="p">,</span>
                                <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine reduction factor gamma, </span>
<span class="sd">    per Figure NA.9, UK NA to BS EN 1991-2:2003</span>
<span class="sd">    </span>
<span class="sd">    Gamma factors allows for the unsynchronized combination of pedestrian </span>
<span class="sd">    actions within groups and crowds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">groupType</span><span class="o">==</span><span class="s2">&quot;pedestrian&quot;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">Seff</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`Seff` required!&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">apply_PD6688_2_correction</span><span class="p">:</span>
            
            <span class="c1"># Manually digitised values per Figure 2 of PD6688-2:2011</span>
            <span class="n">delta_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.21</span><span class="p">,</span><span class="mf">0.02</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">Seff_vals</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">]</span>
            
            <span class="n">gamma_vals</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.685</span><span class="p">,</span><span class="mf">0.615</span><span class="p">,</span><span class="mf">0.534</span><span class="p">,</span><span class="mf">0.432</span><span class="p">,</span><span class="mf">0.312</span><span class="p">,</span><span class="mf">0.242</span><span class="p">,</span><span class="mf">0.167</span><span class="p">,</span><span class="mf">0.100</span><span class="p">,</span><span class="mf">0.048</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.700</span><span class="p">,</span><span class="mf">0.632</span><span class="p">,</span><span class="mf">0.550</span><span class="p">,</span><span class="mf">0.455</span><span class="p">,</span><span class="mf">0.343</span><span class="p">,</span><span class="mf">0.280</span><span class="p">,</span><span class="mf">0.213</span><span class="p">,</span><span class="mf">0.155</span><span class="p">,</span><span class="mf">0.108</span><span class="p">,</span><span class="mf">0.093</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.712</span><span class="p">,</span><span class="mf">0.646</span><span class="p">,</span><span class="mf">0.568</span><span class="p">,</span><span class="mf">0.476</span><span class="p">,</span><span class="mf">0.372</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.255</span><span class="p">,</span><span class="mf">0.205</span><span class="p">,</span><span class="mf">0.167</span><span class="p">,</span><span class="mf">0.155</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.725</span><span class="p">,</span><span class="mf">0.658</span><span class="p">,</span><span class="mf">0.584</span><span class="p">,</span><span class="mf">0.499</span><span class="p">,</span><span class="mf">0.401</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.298</span><span class="p">,</span><span class="mf">0.255</span><span class="p">,</span><span class="mf">0.224</span><span class="p">,</span><span class="mf">0.215</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.736</span><span class="p">,</span><span class="mf">0.673</span><span class="p">,</span><span class="mf">0.599</span><span class="p">,</span><span class="mf">0.518</span><span class="p">,</span><span class="mf">0.428</span><span class="p">,</span><span class="mf">0.385</span><span class="p">,</span><span class="mf">0.338</span><span class="p">,</span><span class="mf">0.302</span><span class="p">,</span><span class="mf">0.274</span><span class="p">,</span><span class="mf">0.268</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.746</span><span class="p">,</span><span class="mf">0.685</span><span class="p">,</span><span class="mf">0.613</span><span class="p">,</span><span class="mf">0.537</span><span class="p">,</span><span class="mf">0.455</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.376</span><span class="p">,</span><span class="mf">0.347</span><span class="p">,</span><span class="mf">0.323</span><span class="p">,</span><span class="mf">0.320</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.756</span><span class="p">,</span><span class="mf">0.696</span><span class="p">,</span><span class="mf">0.626</span><span class="p">,</span><span class="mf">0.554</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.447</span><span class="p">,</span><span class="mf">0.413</span><span class="p">,</span><span class="mf">0.386</span><span class="p">,</span><span class="mf">0.368</span><span class="p">,</span><span class="mf">0.366</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.765</span><span class="p">,</span><span class="mf">0.705</span><span class="p">,</span><span class="mf">0.639</span><span class="p">,</span><span class="mf">0.570</span><span class="p">,</span><span class="mf">0.505</span><span class="p">,</span><span class="mf">0.477</span><span class="p">,</span><span class="mf">0.448</span><span class="p">,</span><span class="mf">0.428</span><span class="p">,</span><span class="mf">0.410</span><span class="p">,</span><span class="mf">0.408</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.773</span><span class="p">,</span><span class="mf">0.715</span><span class="p">,</span><span class="mf">0.651</span><span class="p">,</span><span class="mf">0.588</span><span class="p">,</span><span class="mf">0.528</span><span class="p">,</span><span class="mf">0.506</span><span class="p">,</span><span class="mf">0.483</span><span class="p">,</span><span class="mf">0.465</span><span class="p">,</span><span class="mf">0.449</span><span class="p">,</span><span class="mf">0.445</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.780</span><span class="p">,</span><span class="mf">0.724</span><span class="p">,</span><span class="mf">0.662</span><span class="p">,</span><span class="mf">0.602</span><span class="p">,</span><span class="mf">0.552</span><span class="p">,</span><span class="mf">0.535</span><span class="p">,</span><span class="mf">0.515</span><span class="p">,</span><span class="mf">0.500</span><span class="p">,</span><span class="mf">0.486</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.785</span><span class="p">,</span><span class="mf">0.730</span><span class="p">,</span><span class="mf">0.671</span><span class="p">,</span><span class="mf">0.615</span><span class="p">,</span><span class="mf">0.575</span><span class="p">,</span><span class="mf">0.560</span><span class="p">,</span><span class="mf">0.545</span><span class="p">,</span><span class="mf">0.532</span><span class="p">,</span><span class="mf">0.520</span><span class="p">,</span><span class="mf">0.513</span><span class="p">]]</span>

        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;*** Warning: Figure NA.9 in UK NA to BS EN 1991-2 &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;is known to contain errors</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Cl. 3.20 of PD6688-2:2011 refers</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Figure 2 of PD6688-2:2011 should be used instead</span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;This can be done by setting `apply_PD6688_correction=True`&quot;</span><span class="p">)</span>
        
            <span class="c1"># Manually digitised values per Figure NA.9 of UK NA</span>
            <span class="n">delta_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.21</span><span class="p">,</span><span class="mf">0.02</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">Seff_vals</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">]</span>
            
            <span class="n">gamma_vals</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.680</span><span class="p">,</span><span class="mf">0.435</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.245</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.135</span><span class="p">,</span><span class="mf">0.100</span><span class="p">,</span><span class="mf">0.062</span><span class="p">,</span><span class="mf">0.048</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.692</span><span class="p">,</span><span class="mf">0.462</span><span class="p">,</span><span class="mf">0.345</span><span class="p">,</span><span class="mf">0.283</span><span class="p">,</span><span class="mf">0.240</span><span class="p">,</span><span class="mf">0.180</span><span class="p">,</span><span class="mf">0.150</span><span class="p">,</span><span class="mf">0.117</span><span class="p">,</span><span class="mf">0.103</span><span class="p">,</span><span class="mf">0.093</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.705</span><span class="p">,</span><span class="mf">0.488</span><span class="p">,</span><span class="mf">0.380</span><span class="p">,</span><span class="mf">0.320</span><span class="p">,</span><span class="mf">0.280</span><span class="p">,</span><span class="mf">0.225</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.175</span><span class="p">,</span><span class="mf">0.163</span><span class="p">,</span><span class="mf">0.155</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.716</span><span class="p">,</span><span class="mf">0.512</span><span class="p">,</span><span class="mf">0.410</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.267</span><span class="p">,</span><span class="mf">0.248</span><span class="p">,</span><span class="mf">0.230</span><span class="p">,</span><span class="mf">0.218</span><span class="p">,</span><span class="mf">0.215</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.728</span><span class="p">,</span><span class="mf">0.535</span><span class="p">,</span><span class="mf">0.437</span><span class="p">,</span><span class="mf">0.382</span><span class="p">,</span><span class="mf">0.352</span><span class="p">,</span><span class="mf">0.310</span><span class="p">,</span><span class="mf">0.292</span><span class="p">,</span><span class="mf">0.277</span><span class="p">,</span><span class="mf">0.270</span><span class="p">,</span><span class="mf">0.268</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.738</span><span class="p">,</span><span class="mf">0.556</span><span class="p">,</span><span class="mf">0.465</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.385</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.335</span><span class="p">,</span><span class="mf">0.322</span><span class="p">,</span><span class="mf">0.320</span><span class="p">,</span><span class="mf">0.320</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.746</span><span class="p">,</span><span class="mf">0.577</span><span class="p">,</span><span class="mf">0.492</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.420</span><span class="p">,</span><span class="mf">0.390</span><span class="p">,</span><span class="mf">0.375</span><span class="p">,</span><span class="mf">0.367</span><span class="p">,</span><span class="mf">0.366</span><span class="p">,</span><span class="mf">0.366</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.755</span><span class="p">,</span><span class="mf">0.597</span><span class="p">,</span><span class="mf">0.518</span><span class="p">,</span><span class="mf">0.473</span><span class="p">,</span><span class="mf">0.451</span><span class="p">,</span><span class="mf">0.426</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.408</span><span class="p">,</span><span class="mf">0.408</span><span class="p">,</span><span class="mf">0.408</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.763</span><span class="p">,</span><span class="mf">0.614</span><span class="p">,</span><span class="mf">0.540</span><span class="p">,</span><span class="mf">0.503</span><span class="p">,</span><span class="mf">0.482</span><span class="p">,</span><span class="mf">0.460</span><span class="p">,</span><span class="mf">0.450</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.445</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.774</span><span class="p">,</span><span class="mf">0.632</span><span class="p">,</span><span class="mf">0.565</span><span class="p">,</span><span class="mf">0.530</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.496</span><span class="p">,</span><span class="mf">0.485</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.783</span><span class="p">,</span><span class="mf">0.645</span><span class="p">,</span><span class="mf">0.585</span><span class="p">,</span><span class="mf">0.555</span><span class="p">,</span><span class="mf">0.540</span><span class="p">,</span><span class="mf">0.530</span><span class="p">,</span><span class="mf">0.520</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.513</span><span class="p">]]</span>
            
        <span class="c1"># Define 2D interpolation function using the above</span>
        <span class="n">gamma_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_vals</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">gamma_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">Seff_vals</span><span class="p">,</span><span class="n">gamma_vals</span><span class="p">,</span>
                                                <span class="n">bounds_error</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Use interpolation function to read off value at inputs specified</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_func</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span>
        
        <span class="c1"># Make plot (to show digitised curves)</span>
        <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            
            <span class="c1"># Plot all curves</span>
            <span class="k">for</span> <span class="n">Seff</span> <span class="ow">in</span> <span class="n">Seff_vals</span><span class="p">:</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">gamma_func</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">Seff</span><span class="p">),</span>
                        <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">Seff</span><span class="p">))</span>
            
            <span class="c1"># Plot cross of lines to denote value obtained using function</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;$S_{eff}$ (m)&quot;</span><span class="p">)</span>
            
            <span class="c1"># Define axis limits</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span> <span class="c1"># per Fig.NA.9</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span> <span class="c1"># per Fig.NA.9</span>
                
            <span class="c1"># Define title according to values used above</span>
            <span class="n">title_str</span> <span class="o">=</span> <span class="s2">&quot;Reduction factor $\gamma$</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">if</span> <span class="n">apply_PD6688_2_correction</span><span class="p">:</span>
                <span class="n">title_str</span> <span class="o">+=</span> <span class="s2">&quot;per Figure 2, PD6688-2:2011&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title_str</span> <span class="o">+=</span> <span class="s2">&quot;per Figure NA.9, UK NA to BS EN 1992-1:2003&quot;</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_str</span><span class="p">)</span>
            
            <span class="c1"># Define axis labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Log decrement damping&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\gamma$&quot;</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">groupType</span><span class="o">==</span><span class="s2">&quot;crowd&quot;</span><span class="p">:</span>
        
        <span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">logDec</span> <span class="o">/</span> <span class="mf">0.20</span><span class="p">)</span><span class="o">*</span><span class="mf">0.23</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `groupType`&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">gamma</span>


<span class="k">def</span> <span class="nf">UKNA_BSEN1991_2_Figure_NA_11</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine critical D factor according to Figure NA.11 of UK NA to BS EN </span>
<span class="sd">    1991-2:2003</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Data to digitise figure in code</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.165</span><span class="p">,</span><span class="mf">2.00</span><span class="p">],[</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">1.60</span><span class="p">],[</span><span class="mf">0.250</span><span class="p">,</span><span class="mf">1.30</span><span class="p">],[</span><span class="mf">0.300</span><span class="p">,</span><span class="mf">1.12</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.92</span><span class="p">],[</span><span class="mf">0.400</span><span class="p">,</span><span class="mf">0.79</span><span class="p">],[</span><span class="mf">0.450</span><span class="p">,</span><span class="mf">0.72</span><span class="p">],[</span><span class="mf">0.500</span><span class="p">,</span><span class="mf">0.67</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.600</span><span class="p">,</span><span class="mf">0.58</span><span class="p">],[</span><span class="mf">0.700</span><span class="p">,</span><span class="mf">0.51</span><span class="p">],[</span><span class="mf">0.800</span><span class="p">,</span><span class="mf">0.45</span><span class="p">],[</span><span class="mf">0.900</span><span class="p">,</span><span class="mf">0.40</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.000</span><span class="p">,</span><span class="mf">0.34</span><span class="p">],[</span><span class="mf">1.100</span><span class="p">,</span><span class="mf">0.29</span><span class="p">],[</span><span class="mf">1.200</span><span class="p">,</span><span class="mf">0.22</span><span class="p">],[</span><span class="mf">1.300</span><span class="p">,</span><span class="mf">0.16</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.400</span><span class="p">,</span><span class="mf">0.11</span><span class="p">],[</span><span class="mf">1.500</span><span class="p">,</span><span class="mf">0.07</span><span class="p">],[</span><span class="mf">1.600</span><span class="p">,</span><span class="mf">0.03</span><span class="p">],[</span><span class="mf">1.700</span><span class="p">,</span><span class="mf">0.01</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.800</span><span class="p">,</span><span class="mf">0.00</span><span class="p">]]</span>
    
    <span class="n">vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">f_vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">D_vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Define interpolation function</span>
    <span class="n">D_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f_vals</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">D_vals</span><span class="p">,</span>
                                        <span class="n">bounds_error</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># Determine D by interpolation</span>
    <span class="k">if</span> <span class="n">fn</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Warning: fn &lt; 0.5 requested. Corresponds to dotted line &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;in Figure NA.11. Use D value with caution!***&quot;</span><span class="p">)</span>
    
    <span class="n">D</span> <span class="o">=</span> <span class="n">D_func</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span> <span class="c1"># similar aspect ratio to figure in code</span>
        
        <span class="n">f1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.165</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.8</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">D_func</span><span class="p">(</span><span class="n">f1</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">D_func</span><span class="p">(</span><span class="n">f2</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">D</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.8</span><span class="p">])</span> <span class="c1"># per figure in code</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span> <span class="c1"># per figure in code</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency of lateral mode (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Pedestrian mass damping parameter, D</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;per Figure NA.11, UK NA to BS EN 1992-1:2003&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">D</span><span class="p">,</span> <span class="n">fig</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">D</span>


<span class="k">def</span> <span class="nf">calc_psi_HIVOSS</span><span class="p">(</span><span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">direction</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate reduction coefficient per Table 4-6 of HIVOSS guidelines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="s1">&#39;Longitudinal&#39;</span><span class="p">]:</span>
            
            <span class="c1"># Data defining phi variation with frequency</span>
            <span class="n">f_vals</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">1.7</span><span class="p">,</span><span class="mf">2.1</span><span class="p">,</span><span class="mf">2.3</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">4.20</span><span class="p">,</span><span class="mf">4.6</span><span class="p">]</span>
            <span class="n">psi_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
            
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">:</span>
            
            <span class="c1"># Data defining phi variation with frequency</span>
            <span class="n">f_vals</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">2.4</span><span class="p">]</span>
            <span class="n">psi_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `direction`&quot;</span><span class="p">)</span> 
        
        <span class="c1"># Define as interpolation function</span>
        <span class="n">psi_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f_vals</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">psi_vals</span><span class="p">,</span>
                                              <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                              <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="n">psi_fv</span> <span class="o">=</span> <span class="n">psi_func</span><span class="p">(</span><span class="n">fv</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">psi_vals</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">psi_fv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.4</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">4.6</span><span class="p">])</span>
                
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\psi$&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Reduction coefficient $\psi$, HIVOSS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                         <span class="s2">&quot;Loading direction: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">direction</span><span class="p">)</span>
        
            <span class="k">return</span> <span class="n">psi_fv</span><span class="p">,</span> <span class="n">fig</span>
        
        <span class="k">else</span><span class="p">:</span>
        
            <span class="k">return</span> <span class="n">psi_fv</span>


<span class="c1"># ********************** TEST ROUTINES ****************************************</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
    
    <span class="n">testRoutine</span><span class="o">=</span><span class="mi">1</span>
    
    <span class="k">if</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="c1"># Tests UKNA_BSEN1991_2_Figure_NA_9() function</span>
        
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="mf">0.045</span><span class="p">,</span>
                                                <span class="mf">35.0</span><span class="p">,</span>
                                                <span class="n">apply_PD6688_2_correction</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                                <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">gamma_val</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="mf">0.045</span><span class="p">,</span>
                                                <span class="mf">35.0</span><span class="p">,</span>
                                                <span class="n">apply_PD6688_2_correction</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
        <span class="c1"># Tests Calc_Seff() function</span>
        
        <span class="n">L</span> <span class="o">=</span> <span class="mf">50.0</span>
        
        <span class="k">def</span> <span class="nf">testFunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">L</span><span class="p">),</span>
                                <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mf">1.2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">x</span><span class="o">/</span><span class="n">L</span><span class="p">)])</span><span class="o">.</span><span class="n">T</span>
        
        <span class="n">Seff</span> <span class="o">=</span> <span class="n">Calc_Seff</span><span class="p">(</span><span class="n">testFunc</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">testRoutine</span><span class="o">==</span><span class="mi">3</span><span class="p">:</span>
        <span class="c1"># Tests _DeckStrip() class methods</span>
        
        <span class="n">L</span> <span class="o">=</span> <span class="mf">150.0</span>
        <span class="n">N</span> <span class="o">=</span> <span class="mi">151</span>
        
        <span class="k">def</span> <span class="nf">phi1_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="n">m1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span>
            <span class="n">m2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span><span class="p">))</span>
            <span class="n">m3</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="o">&lt;</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="mf">100.0</span><span class="p">),</span><span class="mf">0.0</span><span class="p">)</span>
            <span class="n">m</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">m1</span><span class="p">,</span><span class="n">m2</span><span class="p">,</span><span class="n">m3</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
            <span class="k">return</span> <span class="n">m</span>
        
        <span class="k">def</span> <span class="nf">phi2_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="o">-</span><span class="mf">0.2</span><span class="o">*</span><span class="n">phi1_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                
        <span class="k">def</span> <span class="nf">width_func</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
            <span class="k">return</span> <span class="mf">0.2</span> <span class="o">+</span> <span class="mf">1.0</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">x</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span>
        
        <span class="n">target_index</span><span class="o">=</span><span class="mi">0</span>
        
        <span class="n">deck_strip_obj</span> <span class="o">=</span> <span class="n">_DeckStrip</span><span class="p">(</span><span class="s2">&quot;test&quot;</span><span class="p">,[</span><span class="n">L</span><span class="p">,</span><span class="n">L</span><span class="p">],</span>
                                    <span class="n">width_func</span><span class="p">,</span>
                                    <span class="n">phi1_func</span><span class="p">,</span>
                                    <span class="n">phi2_func</span><span class="p">)</span>
        
        <span class="n">deck_strip_obj</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">N</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">deck_strip_obj</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">N</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">deck_strip_obj</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="n">N</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">testRoutine</span> <span class="o">==</span><span class="mi">4</span><span class="p">:</span>
        <span class="c1"># Tests UKNA_BSEN1991_2_Figure_NA_8() function</span>
        
        <span class="n">kv</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>
                                         <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;joggers&quot;</span><span class="p">,</span>
                                         <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="n">testRoutine</span> <span class="o">==</span><span class="mi">5</span><span class="p">:</span>
        <span class="c1"># Tests UKNA_BSEN1991_2_walkers_joggers_loading() class methods</span>
        
        <span class="n">fn</span> <span class="o">=</span> <span class="mf">2.3</span>
        <span class="n">Tn</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">fn</span>
        
        <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_walkers_joggers_loading</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span>
                                                      <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;joggers&quot;</span><span class="p">)</span>
        <span class="n">loading_obj</span><span class="o">.</span><span class="n">PrintDetails</span><span class="p">()</span>
        
        <span class="n">tVals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mf">0.01</span><span class="p">)</span>
        <span class="n">loadVals</span> <span class="o">=</span> <span class="p">[</span><span class="n">loading_obj</span><span class="o">.</span><span class="n">loadVals</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">tVals</span><span class="p">]</span>
            
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tVals</span><span class="p">,</span><span class="n">loadVals</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">T</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Tn</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">Tn</span><span class="p">,</span><span class="mi">3</span><span class="o">*</span><span class="n">Tn</span><span class="p">,</span><span class="mi">10</span><span class="o">*</span><span class="n">Tn</span><span class="p">]:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">T</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            
    <span class="k">if</span> <span class="n">testRoutine</span> <span class="o">==</span> <span class="mi">6</span><span class="p">:</span>
        
        <span class="n">D1</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_11</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="mf">1.34</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;D1 = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">D1</span><span class="p">)</span>
        <span class="n">D2</span><span class="p">,</span> <span class="n">fig</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_11</span><span class="p">(</span><span class="n">fn</span><span class="o">=</span><span class="mf">0.30</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;D2 = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">D2</span><span class="p">)</span>
        
        
    <span class="k">if</span> <span class="n">testRoutine</span> <span class="o">==</span> <span class="mi">7</span><span class="p">:</span>
        
        <span class="n">psi1</span> <span class="o">=</span> <span class="n">calc_psi_HIVOSS</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="mf">1.34</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Lateral&#39;</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">psi2</span> <span class="o">=</span> <span class="n">calc_psi_HIVOSS</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="mf">3.05</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></div>

  </div>

  </header>

  <section id="section-items">
    <h2 class="section-title" id="header-variables">Module variables</h2>
      <div class="item">
      <p id="ped_dyn.currentVersion" class="name">var <span class="ident">currentVersion</span></p>
      
  
  <div class="source_cont">
</div>

      </div>

    <h2 class="section-title" id="header-functions">Functions</h2>
      
  <div class="item">
    <div class="name def" id="ped_dyn.Calc_Seff">
    <p>def <span class="ident">Calc_Seff</span>(</p><p>modeshapeFunc, S, dx=2.0, makePlot=True, verbose=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculates effective span, as defined by NA.2.44.4 and Figure NA.7 in 
BS EN 1991-2</p>
<p><img alt="Figure_NA_7" src="../dynsys/img/UKNA_BSEN1991_2_FigNA7.PNG" /></p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>modeshapeFunc</code>, <em>function</em> defining variation of modeshapes with 
  chainage. In general, for systems with multiple modes, <code>modeshapeFunc</code> to 
  return <em>array</em>.</p>
</li>
<li>
<p><code>S</code>, length of structure. Integration of modeshapes to compute 
  <em>effective span</em> is carried out in the interval <em>[0, S]</em>.</p>
</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li><code>dx</code>, distance increment used by <code>scipy.integrate.cumtrapz()</code></li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.Calc_Seff', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.Calc_Seff" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">Calc_Seff</span><span class="p">(</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="p">,</span>
              <span class="n">dx</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span>
              <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
              <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates effective span, as defined by NA.2.44.4 and Figure NA.7 in </span>
<span class="sd">    BS EN 1991-2</span>
<span class="sd">    </span>
<span class="sd">    ![Figure_NA_7](../dynsys/img/UKNA_BSEN1991_2_FigNA7.PNG)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `modeshapeFunc`, _function_ defining variation of modeshapes with </span>
<span class="sd">      chainage. In general, for systems with multiple modes, `modeshapeFunc` to </span>
<span class="sd">      return _array_.</span>
<span class="sd">      </span>
<span class="sd">    * `S`, length of structure. Integration of modeshapes to compute </span>
<span class="sd">      _effective span_ is carried out in the interval _[0, S]_.</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">      </span>
<span class="sd">    * `dx`, distance increment used by `scipy.integrate.cumtrapz()`</span>
<span class="sd">      </span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Note absolute value integral to be computed</span>
    <span class="k">def</span> <span class="nf">abs_modeshapeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">modeshapeFunc</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    
    <span class="c1"># Evaluate modeshapes at specified chainages</span>
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="o">+</span><span class="mf">0.5</span><span class="o">*</span><span class="n">dx</span><span class="p">,</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">y_vals</span> <span class="o">=</span> <span class="n">modeshapeFunc</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
    <span class="n">y_abs_vals</span> <span class="o">=</span> <span class="n">abs_modeshapeFunc</span><span class="p">(</span><span class="n">x_vals</span><span class="p">)</span>
    
    <span class="c1"># Integrate using Scipy routine</span>
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        <span class="n">y_integral_vals</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">cumtrapz</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">x_vals</span><span class="p">,</span>
                                                   <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="n">y_integral</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">integrate</span><span class="o">.</span><span class="n">trapz</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">x_vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    
    <span class="c1"># Get maxima</span>
    <span class="n">y_absmax</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_abs_vals</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">y_absmax_overall</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y_absmax</span><span class="p">)</span>
    
    <span class="c1"># Compute Seff</span>
    <span class="n">Seff</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">divide</span><span class="p">(</span><span class="n">y_integral</span><span class="p">,</span> <span class="mf">0.634</span><span class="o">*</span><span class="n">y_absmax</span><span class="p">)</span>
    
    <span class="c1"># Compute lambda per eqn in Figure NA.7</span>
    <span class="n">lambda_vals</span> <span class="o">=</span> <span class="mf">0.634</span> <span class="o">*</span> <span class="n">Seff</span> <span class="o">/</span> <span class="n">S</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysing modeshape functions to determine Seff...&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;S (m):</span><span class="se">\t\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">S</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">Seff</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Max modeshapes:</span><span class="se">\t</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y_absmax</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Calculation of $S_{eff}$ (m)&quot;</span><span class="p">)</span>
        
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax3</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
        
        <span class="n">handles</span> <span class="o">=</span> <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_vals</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Modeshapes, $\phi(x)$&quot;</span><span class="p">)</span>
        <span class="n">ax1</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="n">y_absmax_overall</span><span class="p">,</span><span class="n">y_absmax_overall</span><span class="p">])</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_abs_vals</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$|\phi|(x)$&quot;</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">y_absmax_overall</span><span class="p">])</span>
        
        <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">y_integral_vals</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">S</span><span class="p">])</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Chainage (m)&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\int_{0}^{x}|\phi|(x).dx$&quot;</span><span class="p">)</span>
        <span class="n">ax3</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax3</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="k">for</span> <span class="n">val</span><span class="p">,</span> <span class="n">handle</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">y_integral</span><span class="p">,</span><span class="n">handles</span><span class="p">):</span>
        
            <span class="n">ax2</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">val</span><span class="o">/</span><span class="n">S</span><span class="p">,</span>
                        <span class="n">color</span><span class="o">=</span><span class="n">handle</span><span class="o">.</span><span class="n">get_color</span><span class="p">(),</span>
                        <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span>
                        <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
            
            <span class="n">ax3</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">S</span><span class="p">,</span><span class="n">val</span><span class="p">,</span><span class="s2">&quot; </span><span class="si">%.1f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">val</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_Figure_NA_11">
    <p>def <span class="ident">UKNA_BSEN1991_2_Figure_NA_11</span>(</p><p>fn, makePlot=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Determine critical D factor according to Figure NA.11 of UK NA to BS EN 
1991-2:2003</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_Figure_NA_11', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_Figure_NA_11" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">UKNA_BSEN1991_2_Figure_NA_11</span><span class="p">(</span><span class="n">fn</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine critical D factor according to Figure NA.11 of UK NA to BS EN </span>
<span class="sd">    1991-2:2003</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Data to digitise figure in code</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.165</span><span class="p">,</span><span class="mf">2.00</span><span class="p">],[</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">1.60</span><span class="p">],[</span><span class="mf">0.250</span><span class="p">,</span><span class="mf">1.30</span><span class="p">],[</span><span class="mf">0.300</span><span class="p">,</span><span class="mf">1.12</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.92</span><span class="p">],[</span><span class="mf">0.400</span><span class="p">,</span><span class="mf">0.79</span><span class="p">],[</span><span class="mf">0.450</span><span class="p">,</span><span class="mf">0.72</span><span class="p">],[</span><span class="mf">0.500</span><span class="p">,</span><span class="mf">0.67</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">0.600</span><span class="p">,</span><span class="mf">0.58</span><span class="p">],[</span><span class="mf">0.700</span><span class="p">,</span><span class="mf">0.51</span><span class="p">],[</span><span class="mf">0.800</span><span class="p">,</span><span class="mf">0.45</span><span class="p">],[</span><span class="mf">0.900</span><span class="p">,</span><span class="mf">0.40</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.000</span><span class="p">,</span><span class="mf">0.34</span><span class="p">],[</span><span class="mf">1.100</span><span class="p">,</span><span class="mf">0.29</span><span class="p">],[</span><span class="mf">1.200</span><span class="p">,</span><span class="mf">0.22</span><span class="p">],[</span><span class="mf">1.300</span><span class="p">,</span><span class="mf">0.16</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.400</span><span class="p">,</span><span class="mf">0.11</span><span class="p">],[</span><span class="mf">1.500</span><span class="p">,</span><span class="mf">0.07</span><span class="p">],[</span><span class="mf">1.600</span><span class="p">,</span><span class="mf">0.03</span><span class="p">],[</span><span class="mf">1.700</span><span class="p">,</span><span class="mf">0.01</span><span class="p">],</span>
            <span class="p">[</span><span class="mf">1.800</span><span class="p">,</span><span class="mf">0.00</span><span class="p">]]</span>
    
    <span class="n">vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">f_vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[:,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">D_vals</span> <span class="o">=</span> <span class="n">vals</span><span class="p">[:,</span><span class="mi">1</span><span class="p">]</span>
    
    <span class="c1"># Define interpolation function</span>
    <span class="n">D_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f_vals</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">D_vals</span><span class="p">,</span>
                                        <span class="n">bounds_error</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

    <span class="c1"># Determine D by interpolation</span>
    <span class="k">if</span> <span class="n">fn</span> <span class="o">&lt;</span> <span class="mf">0.5</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Warning: fn &lt; 0.5 requested. Corresponds to dotted line &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;in Figure NA.11. Use D value with caution!***&quot;</span><span class="p">)</span>
    
    <span class="n">D</span> <span class="o">=</span> <span class="n">D_func</span><span class="p">(</span><span class="n">fn</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span> <span class="c1"># similar aspect ratio to figure in code</span>
        
        <span class="n">f1</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.165</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        <span class="n">f2</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.8</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f1</span><span class="p">,</span><span class="n">D_func</span><span class="p">(</span><span class="n">f1</span><span class="p">),</span><span class="s1">&#39;k--&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f2</span><span class="p">,</span><span class="n">D_func</span><span class="p">(</span><span class="n">f2</span><span class="p">),</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">D</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fn</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.8</span><span class="p">])</span> <span class="c1"># per figure in code</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">])</span> <span class="c1"># per figure in code</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency of lateral mode (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;D&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Pedestrian mass damping parameter, D</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;per Figure NA.11, UK NA to BS EN 1992-1:2003&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">D</span><span class="p">,</span> <span class="n">fig</span>
    
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">D</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_Figure_NA_8">
    <p>def <span class="ident">UKNA_BSEN1991_2_Figure_NA_8</span>(</p><p>fv, analysis_type=&#39;walkers&#39;, load_direction=&#39;vertical&#39;, kind=&#39;cubic&#39;, makePlot=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns $k_{v}(f)$ from Figure NA.8 in BS EN 1992-1:2003</p>
<hr />
<p>For lateral loading, refer Tue 24/07/2018 12:56 Chris Barker email</p>
<hr />
<p>Required:</p>
<ul>
<li><code>fv</code>, mode frequency in Hz to evaluate kv at</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>analysis_type</code>, <em>string</em>, either 'walkers' or 'joggers'</p>
</li>
<li>
<p><code>load_direction</code>, <em>string</em>, either 'vertical' or 'lateral'</p>
</li>
<li>
<p><code>kind</code>, keyword argument used by scipy.interpolate.interp1d function. 
  Defines method of interpolation, e.g. 'linear' or 'cubic'</p>
</li>
<li>
<p><code>makePlot</code>, <em>boolean</em>, if True plot will be made akin to Figure NA.8</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_Figure_NA_8', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_Figure_NA_8" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span>
                                <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                                <span class="n">load_direction</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                                <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span>
                                <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns $k_{v}(f)$ from Figure NA.8 in BS EN 1992-1:2003</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    For lateral loading, refer Tue 24/07/2018 12:56 Chris Barker email</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `fv`, mode frequency in Hz to evaluate kv at</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * `analysis_type`, _string_, either &#39;walkers&#39; or &#39;joggers&#39;</span>
<span class="sd">    </span>
<span class="sd">    * `load_direction`, _string_, either &#39;vertical&#39; or &#39;lateral&#39;</span>
<span class="sd">    </span>
<span class="sd">    * `kind`, keyword argument used by scipy.interpolate.interp1d function. </span>
<span class="sd">      Defines method of interpolation, e.g. &#39;linear&#39; or &#39;cubic&#39;</span>
<span class="sd">      </span>
<span class="sd">    * `makePlot`, _boolean_, if True plot will be made akin to Figure NA.8</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">fv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">fv</span><span class="p">)</span> <span class="c1"># positive value to be used</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="n">load_direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span><span class="s1">&#39;lateral&#39;</span><span class="p">,</span><span class="s1">&#39;horizontal&#39;</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected load direction&quot;</span><span class="p">)</span>
        
    <span class="c1">#----------------</span>
    
    <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            
        <span class="c1"># Array to digitise Figure NA.8</span>
        <span class="n">walkersData</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span><span class="mf">0.010</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">0.080</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">,</span><span class="mf">0.240</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.20</span><span class="p">,</span><span class="mf">0.440</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.40</span><span class="p">,</span><span class="mf">0.720</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.60</span><span class="p">,</span><span class="mf">0.930</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.70</span><span class="p">,</span><span class="mf">0.980</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.80</span><span class="p">,</span><span class="mf">1.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">0.997</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.10</span><span class="p">,</span><span class="mf">0.970</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.20</span><span class="p">,</span><span class="mf">0.900</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.40</span><span class="p">,</span><span class="mf">0.650</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.60</span><span class="p">,</span><span class="mf">0.400</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.80</span><span class="p">,</span><span class="mf">0.250</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.00</span><span class="p">,</span><span class="mf">0.280</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.20</span><span class="p">,</span><span class="mf">0.320</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">0.340</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.60</span><span class="p">,</span><span class="mf">0.360</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.80</span><span class="p">,</span><span class="mf">0.360</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.00</span><span class="p">,</span><span class="mf">0.350</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.50</span><span class="p">,</span><span class="mf">0.280</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">5.00</span><span class="p">,</span><span class="mf">0.180</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.50</span><span class="p">,</span><span class="mf">0.130</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.00</span><span class="p">,</span><span class="mf">0.115</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.50</span><span class="p">,</span><span class="mf">0.098</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">7.00</span><span class="p">,</span><span class="mf">0.080</span><span class="p">],</span> <span class="p">[</span><span class="mf">8.00</span><span class="p">,</span><span class="mf">0.020</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]]</span>
        
    <span class="k">else</span><span class="p">:</span>
        
        <span class="c1"># Digitised curve per Tue 24/07/2018 12:56 Chris Barker email</span>
        <span class="n">walkersData</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.008</span><span class="p">],[</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.020</span><span class="p">],[</span><span class="mf">0.30</span><span class="p">,</span><span class="mf">0.060</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span><span class="mf">0.170</span><span class="p">],[</span><span class="mf">0.50</span><span class="p">,</span><span class="mf">0.350</span><span class="p">],[</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">0.620</span><span class="p">],[</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">0.870</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.75</span><span class="p">,</span><span class="mf">0.950</span><span class="p">],[</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">1.000</span><span class="p">],[</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.000</span><span class="p">],[</span><span class="mf">1.10</span><span class="p">,</span><span class="mf">0.950</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.15</span><span class="p">,</span><span class="mf">0.850</span><span class="p">],[</span><span class="mf">1.20</span><span class="p">,</span><span class="mf">0.730</span><span class="p">],[</span><span class="mf">1.30</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],[</span><span class="mf">1.40</span><span class="p">,</span><span class="mf">0.250</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.50</span><span class="p">,</span><span class="mf">0.120</span><span class="p">],[</span><span class="mf">1.52</span><span class="p">,</span><span class="mf">0.100</span><span class="p">],[</span><span class="mf">1.60</span><span class="p">,</span><span class="mf">0.065</span><span class="p">],[</span><span class="mf">1.70</span><span class="p">,</span><span class="mf">0.070</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.80</span><span class="p">,</span><span class="mf">0.070</span><span class="p">],[</span><span class="mf">1.90</span><span class="p">,</span><span class="mf">0.070</span><span class="p">],[</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">0.070</span><span class="p">],[</span><span class="mf">2.10</span><span class="p">,</span><span class="mf">0.065</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.20</span><span class="p">,</span><span class="mf">0.063</span><span class="p">],[</span><span class="mf">2.30</span><span class="p">,</span><span class="mf">0.055</span><span class="p">],[</span><span class="mf">2.40</span><span class="p">,</span><span class="mf">0.045</span><span class="p">],[</span><span class="mf">2.50</span><span class="p">,</span><span class="mf">0.035</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.60</span><span class="p">,</span><span class="mf">0.028</span><span class="p">],[</span><span class="mf">2.70</span><span class="p">,</span><span class="mf">0.020</span><span class="p">],[</span><span class="mf">2.80</span><span class="p">,</span><span class="mf">0.015</span><span class="p">],[</span><span class="mf">2.90</span><span class="p">,</span><span class="mf">0.008</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.10</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.20</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.30</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.50</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.60</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">3.70</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.80</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]]</span>
        
    <span class="n">walkersData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">walkersData</span><span class="p">)</span>
    <span class="n">walkersFunc</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">walkersData</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">y</span><span class="o">=</span><span class="n">walkersData</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="c1">#-------------------</span>
    
    <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
        
        <span class="c1"># Array to digitise Figure NA.8</span>
        <span class="n">joggersData</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.00</span><span class="p">,</span><span class="mf">0.010</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.20</span><span class="p">,</span><span class="mf">0.040</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.40</span><span class="p">,</span><span class="mf">0.150</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.60</span><span class="p">,</span><span class="mf">0.300</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.70</span><span class="p">,</span><span class="mf">0.450</span><span class="p">],</span> <span class="p">[</span><span class="mf">1.80</span><span class="p">,</span><span class="mf">0.550</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">0.870</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.10</span><span class="p">,</span><span class="mf">1.010</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.20</span><span class="p">,</span><span class="mf">1.110</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.40</span><span class="p">,</span><span class="mf">1.160</span><span class="p">],</span> <span class="p">[</span><span class="mf">2.60</span><span class="p">,</span><span class="mf">1.120</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.80</span><span class="p">,</span><span class="mf">0.930</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.00</span><span class="p">,</span><span class="mf">0.640</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.20</span><span class="p">,</span><span class="mf">0.360</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">0.160</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.60</span><span class="p">,</span><span class="mf">0.100</span><span class="p">],</span> <span class="p">[</span><span class="mf">3.80</span><span class="p">,</span><span class="mf">0.130</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.00</span><span class="p">,</span><span class="mf">0.160</span><span class="p">],</span> <span class="p">[</span><span class="mf">4.50</span><span class="p">,</span><span class="mf">0.210</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">5.00</span><span class="p">,</span><span class="mf">0.220</span><span class="p">],</span> <span class="p">[</span><span class="mf">5.50</span><span class="p">,</span><span class="mf">0.180</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.00</span><span class="p">,</span><span class="mf">0.110</span><span class="p">],</span> <span class="p">[</span><span class="mf">6.50</span><span class="p">,</span><span class="mf">0.040</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">7.00</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span> <span class="p">[</span><span class="mf">8.00</span><span class="p">,</span><span class="mf">0.020</span><span class="p">],</span> <span class="p">[</span><span class="mf">9.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]]</span>
        
    <span class="k">else</span><span class="p">:</span>
        
         <span class="c1"># Digitised curve per Tue 24/07/2018 12:56 Chris Barker email</span>
        <span class="n">joggersData</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">0.10</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">0.20</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],[</span><span class="mf">0.30</span><span class="p">,</span><span class="mf">0.000</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.40</span><span class="p">,</span><span class="mf">0.010</span><span class="p">],[</span><span class="mf">0.50</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],[</span><span class="mf">0.60</span><span class="p">,</span><span class="mf">0.100</span><span class="p">],[</span><span class="mf">0.70</span><span class="p">,</span><span class="mf">0.250</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">0.80</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],[</span><span class="mf">0.90</span><span class="p">,</span><span class="mf">0.790</span><span class="p">],[</span><span class="mf">1.00</span><span class="p">,</span><span class="mf">1.030</span><span class="p">],[</span><span class="mf">1.05</span><span class="p">,</span><span class="mf">1.120</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.10</span><span class="p">,</span><span class="mf">1.150</span><span class="p">],[</span><span class="mf">1.30</span><span class="p">,</span><span class="mf">1.150</span><span class="p">],[</span><span class="mf">1.35</span><span class="p">,</span><span class="mf">1.120</span><span class="p">],[</span><span class="mf">1.40</span><span class="p">,</span><span class="mf">1.030</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.45</span><span class="p">,</span><span class="mf">0.920</span><span class="p">],[</span><span class="mf">1.50</span><span class="p">,</span><span class="mf">0.780</span><span class="p">],[</span><span class="mf">1.60</span><span class="p">,</span><span class="mf">0.470</span><span class="p">],[</span><span class="mf">1.70</span><span class="p">,</span><span class="mf">0.240</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">1.80</span><span class="p">,</span><span class="mf">0.100</span><span class="p">],[</span><span class="mf">1.85</span><span class="p">,</span><span class="mf">0.060</span><span class="p">],[</span><span class="mf">1.90</span><span class="p">,</span><span class="mf">0.050</span><span class="p">],[</span><span class="mf">2.00</span><span class="p">,</span><span class="mf">0.055</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.10</span><span class="p">,</span><span class="mf">0.063</span><span class="p">],[</span><span class="mf">2.20</span><span class="p">,</span><span class="mf">0.068</span><span class="p">],[</span><span class="mf">2.30</span><span class="p">,</span><span class="mf">0.069</span><span class="p">],[</span><span class="mf">2.40</span><span class="p">,</span><span class="mf">0.069</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.50</span><span class="p">,</span><span class="mf">0.069</span><span class="p">],[</span><span class="mf">2.60</span><span class="p">,</span><span class="mf">0.068</span><span class="p">],[</span><span class="mf">2.70</span><span class="p">,</span><span class="mf">0.067</span><span class="p">],[</span><span class="mf">2.80</span><span class="p">,</span><span class="mf">0.060</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">2.90</span><span class="p">,</span><span class="mf">0.050</span><span class="p">],[</span><span class="mf">3.00</span><span class="p">,</span><span class="mf">0.040</span><span class="p">],[</span><span class="mf">3.10</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],[</span><span class="mf">3.20</span><span class="p">,</span><span class="mf">0.021</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">3.30</span><span class="p">,</span><span class="mf">0.014</span><span class="p">],[</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">0.007</span><span class="p">],[</span><span class="mf">3.50</span><span class="p">,</span><span class="mf">0.004</span><span class="p">],[</span><span class="mf">3.60</span><span class="p">,</span><span class="mf">0.002</span><span class="p">],</span>
                       <span class="p">[</span><span class="mf">4.00</span><span class="p">,</span><span class="mf">0.000</span><span class="p">]]</span>
        
    <span class="n">joggersData</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">joggersData</span><span class="p">)</span>
    <span class="n">joggersFunc</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">joggersData</span><span class="p">[:,</span><span class="mi">0</span><span class="p">],</span>
                                             <span class="n">y</span><span class="o">=</span><span class="n">joggersData</span><span class="p">[:,</span><span class="mi">1</span><span class="p">],</span>
                                             <span class="n">kind</span><span class="o">=</span><span class="n">kind</span><span class="p">,</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    
    <span class="c1">#-------------------</span>
    
    <span class="c1"># Get applicable array to use</span>
    <span class="k">if</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
        <span class="n">k_fv_func</span> <span class="o">=</span> <span class="n">walkersFunc</span>
    <span class="k">elif</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
        <span class="n">k_fv_func</span> <span class="o">=</span> <span class="n">joggersFunc</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39; specified!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Use interpolation function to read off value at fv</span>
    <span class="n">k_fv</span> <span class="o">=</span> <span class="n">k_fv_func</span><span class="p">(</span><span class="n">fv</span><span class="p">)</span>
    
    <span class="c1"># Make plot (to show digitised curves)</span>
    <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
        
        <span class="n">fVals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">8.2</span><span class="p">,</span><span class="mf">0.05</span><span class="p">)</span>
        <span class="n">caseA</span> <span class="o">=</span> <span class="n">walkersFunc</span><span class="p">(</span><span class="n">fVals</span><span class="p">)</span>
        <span class="n">caseB</span> <span class="o">=</span> <span class="n">joggersFunc</span><span class="p">(</span><span class="n">fVals</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fVals</span><span class="p">,</span><span class="n">caseA</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Walkers&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fVals</span><span class="p">,</span><span class="n">caseB</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Joggers&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">fv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">k_fv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">8.0</span><span class="p">])</span> <span class="c1"># per Fig.NA.8</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">4.0</span><span class="p">])</span> <span class="c1"># per Tue 24/07/2018 12:56 Chris Barker email</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">1.4</span><span class="p">])</span> <span class="c1"># per Fig.NA.8</span>
        
        <span class="n">title_str</span> <span class="o">=</span> <span class="s2">&quot;Combined population and harmonic factor k($f_{v}$)</span><span class="se">\n</span><span class="s2">&quot;</span>
        
        <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">title_str</span> <span class="o">+=</span> <span class="s2">&quot;per Figure NA.8, UK NA to BS EN 1992-1:2003&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">title_str</span> <span class="o">+=</span> <span class="s2">&quot;adjusted for lateral response calculations&quot;</span>
                    
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_str</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode frequency $f_{v}$, Hz&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;k($f_{v}$)&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">k_fv</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_Figure_NA_9">
    <p>def <span class="ident">UKNA_BSEN1991_2_Figure_NA_9</span>(</p><p>logDec, Seff=None, apply_PD6688_2_correction=True, groupType=&#39;pedestrian&#39;, makePlot=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Determine reduction factor gamma, 
per Figure NA.9, UK NA to BS EN 1991-2:2003</p>
<p>Gamma factors allows for the unsynchronized combination of pedestrian 
actions within groups and crowds.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_Figure_NA_9', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_Figure_NA_9" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">Seff</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                                <span class="n">apply_PD6688_2_correction</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                <span class="n">groupType</span><span class="o">=</span><span class="s2">&quot;pedestrian&quot;</span><span class="p">,</span>
                                <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Determine reduction factor gamma, </span>
<span class="sd">    per Figure NA.9, UK NA to BS EN 1991-2:2003</span>
<span class="sd">    </span>
<span class="sd">    Gamma factors allows for the unsynchronized combination of pedestrian </span>
<span class="sd">    actions within groups and crowds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">groupType</span><span class="o">==</span><span class="s2">&quot;pedestrian&quot;</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="n">Seff</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`Seff` required!&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">apply_PD6688_2_correction</span><span class="p">:</span>
            
            <span class="c1"># Manually digitised values per Figure 2 of PD6688-2:2011</span>
            <span class="n">delta_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.21</span><span class="p">,</span><span class="mf">0.02</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">Seff_vals</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">]</span>
            
            <span class="n">gamma_vals</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.685</span><span class="p">,</span><span class="mf">0.615</span><span class="p">,</span><span class="mf">0.534</span><span class="p">,</span><span class="mf">0.432</span><span class="p">,</span><span class="mf">0.312</span><span class="p">,</span><span class="mf">0.242</span><span class="p">,</span><span class="mf">0.167</span><span class="p">,</span><span class="mf">0.100</span><span class="p">,</span><span class="mf">0.048</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.700</span><span class="p">,</span><span class="mf">0.632</span><span class="p">,</span><span class="mf">0.550</span><span class="p">,</span><span class="mf">0.455</span><span class="p">,</span><span class="mf">0.343</span><span class="p">,</span><span class="mf">0.280</span><span class="p">,</span><span class="mf">0.213</span><span class="p">,</span><span class="mf">0.155</span><span class="p">,</span><span class="mf">0.108</span><span class="p">,</span><span class="mf">0.093</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.712</span><span class="p">,</span><span class="mf">0.646</span><span class="p">,</span><span class="mf">0.568</span><span class="p">,</span><span class="mf">0.476</span><span class="p">,</span><span class="mf">0.372</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.255</span><span class="p">,</span><span class="mf">0.205</span><span class="p">,</span><span class="mf">0.167</span><span class="p">,</span><span class="mf">0.155</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.725</span><span class="p">,</span><span class="mf">0.658</span><span class="p">,</span><span class="mf">0.584</span><span class="p">,</span><span class="mf">0.499</span><span class="p">,</span><span class="mf">0.401</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.298</span><span class="p">,</span><span class="mf">0.255</span><span class="p">,</span><span class="mf">0.224</span><span class="p">,</span><span class="mf">0.215</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.736</span><span class="p">,</span><span class="mf">0.673</span><span class="p">,</span><span class="mf">0.599</span><span class="p">,</span><span class="mf">0.518</span><span class="p">,</span><span class="mf">0.428</span><span class="p">,</span><span class="mf">0.385</span><span class="p">,</span><span class="mf">0.338</span><span class="p">,</span><span class="mf">0.302</span><span class="p">,</span><span class="mf">0.274</span><span class="p">,</span><span class="mf">0.268</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.746</span><span class="p">,</span><span class="mf">0.685</span><span class="p">,</span><span class="mf">0.613</span><span class="p">,</span><span class="mf">0.537</span><span class="p">,</span><span class="mf">0.455</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.376</span><span class="p">,</span><span class="mf">0.347</span><span class="p">,</span><span class="mf">0.323</span><span class="p">,</span><span class="mf">0.320</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.756</span><span class="p">,</span><span class="mf">0.696</span><span class="p">,</span><span class="mf">0.626</span><span class="p">,</span><span class="mf">0.554</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.447</span><span class="p">,</span><span class="mf">0.413</span><span class="p">,</span><span class="mf">0.386</span><span class="p">,</span><span class="mf">0.368</span><span class="p">,</span><span class="mf">0.366</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.765</span><span class="p">,</span><span class="mf">0.705</span><span class="p">,</span><span class="mf">0.639</span><span class="p">,</span><span class="mf">0.570</span><span class="p">,</span><span class="mf">0.505</span><span class="p">,</span><span class="mf">0.477</span><span class="p">,</span><span class="mf">0.448</span><span class="p">,</span><span class="mf">0.428</span><span class="p">,</span><span class="mf">0.410</span><span class="p">,</span><span class="mf">0.408</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.773</span><span class="p">,</span><span class="mf">0.715</span><span class="p">,</span><span class="mf">0.651</span><span class="p">,</span><span class="mf">0.588</span><span class="p">,</span><span class="mf">0.528</span><span class="p">,</span><span class="mf">0.506</span><span class="p">,</span><span class="mf">0.483</span><span class="p">,</span><span class="mf">0.465</span><span class="p">,</span><span class="mf">0.449</span><span class="p">,</span><span class="mf">0.445</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.780</span><span class="p">,</span><span class="mf">0.724</span><span class="p">,</span><span class="mf">0.662</span><span class="p">,</span><span class="mf">0.602</span><span class="p">,</span><span class="mf">0.552</span><span class="p">,</span><span class="mf">0.535</span><span class="p">,</span><span class="mf">0.515</span><span class="p">,</span><span class="mf">0.500</span><span class="p">,</span><span class="mf">0.486</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.785</span><span class="p">,</span><span class="mf">0.730</span><span class="p">,</span><span class="mf">0.671</span><span class="p">,</span><span class="mf">0.615</span><span class="p">,</span><span class="mf">0.575</span><span class="p">,</span><span class="mf">0.560</span><span class="p">,</span><span class="mf">0.545</span><span class="p">,</span><span class="mf">0.532</span><span class="p">,</span><span class="mf">0.520</span><span class="p">,</span><span class="mf">0.513</span><span class="p">]]</span>

        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;*** Warning: Figure NA.9 in UK NA to BS EN 1991-2 &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;is known to contain errors</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Cl. 3.20 of PD6688-2:2011 refers</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Figure 2 of PD6688-2:2011 should be used instead</span><span class="se">\n</span><span class="s2">&quot;</span>
                  <span class="s2">&quot;This can be done by setting `apply_PD6688_correction=True`&quot;</span><span class="p">)</span>
        
            <span class="c1"># Manually digitised values per Figure NA.9 of UK NA</span>
            <span class="n">delta_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.21</span><span class="p">,</span><span class="mf">0.02</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
            <span class="n">Seff_vals</span>  <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="p">,</span><span class="mi">12</span><span class="p">,</span><span class="mi">15</span><span class="p">,</span><span class="mi">20</span><span class="p">,</span><span class="mi">30</span><span class="p">,</span><span class="mi">40</span><span class="p">,</span><span class="mi">60</span><span class="p">,</span><span class="mi">100</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">300</span><span class="p">]</span>
            
            <span class="n">gamma_vals</span> <span class="o">=</span> <span class="p">[[</span><span class="mf">0.680</span><span class="p">,</span><span class="mf">0.435</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.245</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.135</span><span class="p">,</span><span class="mf">0.100</span><span class="p">,</span><span class="mf">0.062</span><span class="p">,</span><span class="mf">0.048</span><span class="p">,</span><span class="mf">0.030</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.692</span><span class="p">,</span><span class="mf">0.462</span><span class="p">,</span><span class="mf">0.345</span><span class="p">,</span><span class="mf">0.283</span><span class="p">,</span><span class="mf">0.240</span><span class="p">,</span><span class="mf">0.180</span><span class="p">,</span><span class="mf">0.150</span><span class="p">,</span><span class="mf">0.117</span><span class="p">,</span><span class="mf">0.103</span><span class="p">,</span><span class="mf">0.093</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.705</span><span class="p">,</span><span class="mf">0.488</span><span class="p">,</span><span class="mf">0.380</span><span class="p">,</span><span class="mf">0.320</span><span class="p">,</span><span class="mf">0.280</span><span class="p">,</span><span class="mf">0.225</span><span class="p">,</span><span class="mf">0.200</span><span class="p">,</span><span class="mf">0.175</span><span class="p">,</span><span class="mf">0.163</span><span class="p">,</span><span class="mf">0.155</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.716</span><span class="p">,</span><span class="mf">0.512</span><span class="p">,</span><span class="mf">0.410</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.315</span><span class="p">,</span><span class="mf">0.267</span><span class="p">,</span><span class="mf">0.248</span><span class="p">,</span><span class="mf">0.230</span><span class="p">,</span><span class="mf">0.218</span><span class="p">,</span><span class="mf">0.215</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.728</span><span class="p">,</span><span class="mf">0.535</span><span class="p">,</span><span class="mf">0.437</span><span class="p">,</span><span class="mf">0.382</span><span class="p">,</span><span class="mf">0.352</span><span class="p">,</span><span class="mf">0.310</span><span class="p">,</span><span class="mf">0.292</span><span class="p">,</span><span class="mf">0.277</span><span class="p">,</span><span class="mf">0.270</span><span class="p">,</span><span class="mf">0.268</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.738</span><span class="p">,</span><span class="mf">0.556</span><span class="p">,</span><span class="mf">0.465</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.385</span><span class="p">,</span><span class="mf">0.350</span><span class="p">,</span><span class="mf">0.335</span><span class="p">,</span><span class="mf">0.322</span><span class="p">,</span><span class="mf">0.320</span><span class="p">,</span><span class="mf">0.320</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.746</span><span class="p">,</span><span class="mf">0.577</span><span class="p">,</span><span class="mf">0.492</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.420</span><span class="p">,</span><span class="mf">0.390</span><span class="p">,</span><span class="mf">0.375</span><span class="p">,</span><span class="mf">0.367</span><span class="p">,</span><span class="mf">0.366</span><span class="p">,</span><span class="mf">0.366</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.755</span><span class="p">,</span><span class="mf">0.597</span><span class="p">,</span><span class="mf">0.518</span><span class="p">,</span><span class="mf">0.473</span><span class="p">,</span><span class="mf">0.451</span><span class="p">,</span><span class="mf">0.426</span><span class="p">,</span><span class="mf">0.415</span><span class="p">,</span><span class="mf">0.408</span><span class="p">,</span><span class="mf">0.408</span><span class="p">,</span><span class="mf">0.408</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.763</span><span class="p">,</span><span class="mf">0.614</span><span class="p">,</span><span class="mf">0.540</span><span class="p">,</span><span class="mf">0.503</span><span class="p">,</span><span class="mf">0.482</span><span class="p">,</span><span class="mf">0.460</span><span class="p">,</span><span class="mf">0.450</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.445</span><span class="p">,</span><span class="mf">0.445</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.774</span><span class="p">,</span><span class="mf">0.632</span><span class="p">,</span><span class="mf">0.565</span><span class="p">,</span><span class="mf">0.530</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.496</span><span class="p">,</span><span class="mf">0.485</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.480</span><span class="p">,</span><span class="mf">0.480</span><span class="p">],</span>
                          <span class="p">[</span><span class="mf">0.783</span><span class="p">,</span><span class="mf">0.645</span><span class="p">,</span><span class="mf">0.585</span><span class="p">,</span><span class="mf">0.555</span><span class="p">,</span><span class="mf">0.540</span><span class="p">,</span><span class="mf">0.530</span><span class="p">,</span><span class="mf">0.520</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.513</span><span class="p">,</span><span class="mf">0.513</span><span class="p">]]</span>
            
        <span class="c1"># Define 2D interpolation function using the above</span>
        <span class="n">gamma_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">gamma_vals</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">gamma_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">Seff_vals</span><span class="p">,</span><span class="n">gamma_vals</span><span class="p">,</span>
                                                <span class="n">bounds_error</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Use interpolation function to read off value at inputs specified</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma_func</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span>
        
        <span class="c1"># Make plot (to show digitised curves)</span>
        <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            
            <span class="c1"># Plot all curves</span>
            <span class="k">for</span> <span class="n">Seff</span> <span class="ow">in</span> <span class="n">Seff_vals</span><span class="p">:</span>
                
                <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">gamma_func</span><span class="p">(</span><span class="n">delta_vals</span><span class="p">,</span><span class="n">Seff</span><span class="p">),</span>
                        <span class="n">label</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="n">Seff</span><span class="p">))</span>
            
            <span class="c1"># Plot cross of lines to denote value obtained using function</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">logDec</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">gamma</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;$S_{eff}$ (m)&quot;</span><span class="p">)</span>
            
            <span class="c1"># Define axis limits</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.2</span><span class="p">])</span> <span class="c1"># per Fig.NA.9</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">0.8</span><span class="p">])</span> <span class="c1"># per Fig.NA.9</span>
                
            <span class="c1"># Define title according to values used above</span>
            <span class="n">title_str</span> <span class="o">=</span> <span class="s2">&quot;Reduction factor $\gamma$</span><span class="se">\n</span><span class="s2">&quot;</span>
            
            <span class="k">if</span> <span class="n">apply_PD6688_2_correction</span><span class="p">:</span>
                <span class="n">title_str</span> <span class="o">+=</span> <span class="s2">&quot;per Figure 2, PD6688-2:2011&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">title_str</span> <span class="o">+=</span> <span class="s2">&quot;per Figure NA.9, UK NA to BS EN 1992-1:2003&quot;</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">title_str</span><span class="p">)</span>
            
            <span class="c1"># Define axis labels</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Log decrement damping&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\gamma$&quot;</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">groupType</span><span class="o">==</span><span class="s2">&quot;crowd&quot;</span><span class="p">:</span>
        
        <span class="n">gamma</span> <span class="o">=</span> <span class="p">(</span><span class="n">logDec</span> <span class="o">/</span> <span class="mf">0.20</span><span class="p">)</span><span class="o">*</span><span class="mf">0.23</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `groupType`&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">gamma</span>
</pre></div>

  </div>
</div>

  </div>
  
      
  <div class="item">
    <div class="name def" id="ped_dyn.calc_psi_HIVOSS">
    <p>def <span class="ident">calc_psi_HIVOSS</span>(</p><p>fv, direction, makePlot=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculate reduction coefficient per Table 4-6 of HIVOSS guidelines</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.calc_psi_HIVOSS', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.calc_psi_HIVOSS" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_psi_HIVOSS</span><span class="p">(</span><span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">direction</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate reduction coefficient per Table 4-6 of HIVOSS guidelines</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        
        <span class="k">if</span> <span class="n">direction</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="s1">&#39;Longitudinal&#39;</span><span class="p">]:</span>
            
            <span class="c1"># Data defining phi variation with frequency</span>
            <span class="n">f_vals</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">1.7</span><span class="p">,</span><span class="mf">2.1</span><span class="p">,</span><span class="mf">2.3</span><span class="p">,</span><span class="mf">2.5</span><span class="p">,</span><span class="mf">3.40</span><span class="p">,</span><span class="mf">4.20</span><span class="p">,</span><span class="mf">4.6</span><span class="p">]</span>
            <span class="n">psi_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.00</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.25</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
            
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">:</span>
            
            <span class="c1"># Data defining phi variation with frequency</span>
            <span class="n">f_vals</span>   <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.7</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.2</span><span class="p">,</span><span class="mf">2.4</span><span class="p">]</span>
            <span class="n">psi_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.0</span><span class="p">]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `direction`&quot;</span><span class="p">)</span> 
        
        <span class="c1"># Define as interpolation function</span>
        <span class="n">psi_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f_vals</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="n">psi_vals</span><span class="p">,</span>
                                              <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                              <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        
        <span class="n">psi_fv</span> <span class="o">=</span> <span class="n">psi_func</span><span class="p">(</span><span class="n">fv</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">makePlot</span><span class="p">:</span>
            
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">psi_vals</span><span class="p">,</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">1.0</span><span class="p">)</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="n">psi_fv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.4</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">4.6</span><span class="p">])</span>
                
            <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\psi$&quot;</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Reduction coefficient $\psi$, HIVOSS</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                         <span class="s2">&quot;Loading direction: </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">direction</span><span class="p">)</span>
        
            <span class="k">return</span> <span class="n">psi_fv</span><span class="p">,</span> <span class="n">fig</span>
        
        <span class="k">else</span><span class="p">:</span>
        
            <span class="k">return</span> <span class="n">psi_fv</span>
</pre></div>

  </div>
</div>

  </div>
  

    <h2 class="section-title" id="header-classes">Classes</h2>
      
      <div class="item">
      <p id="ped_dyn.HIVOSS" class="name">class <span class="ident">HIVOSS</span></p>
      
  
    <div class="desc"><p>Implements HIVOSS rules for lateral vibration due to crowds</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">HIVOSS</span><span class="p">(</span><span class="n">SteadyStateCrowdLoading</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements HIVOSS rules for lateral vibration due to crowds</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">crowd_density</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation method</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">        </span>
<span class="sd">        * `crowd_density`, _float_ to denote crowd density, persons/m2</span>
<span class="sd">        </span>
<span class="sd">        * `direction`, _string_ to denote loading / response direction. </span>
<span class="sd">          Either &#39;Vertical&#39; or &#39;Lateral&#39; required.</span>
<span class="sd">          </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        Refer optional keyword arguments in parent class __init__() method</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">crowd_density</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crowd density for design situation consider, P/m2</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Direction of loading / response calculation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Run parent init function</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
    
    <span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to calculate intensity of uniform deck load</span>
<span class="sd">        according to HIVOSS guidance</span>
<span class="sd">        </span>
<span class="sd">        Note: overrides parent class method</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Calculating load intensity for mode </span><span class="si">%d</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">mode_index</span> <span class="o">+</span>
              <span class="s2">&quot;according to HIVOSS...&quot;</span><span class="p">)</span>
        
        <span class="n">rslts_dict</span> <span class="o">=</span> <span class="p">{}</span>
        
        <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span>
        <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span>
        
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span>
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Area of loaded surface, S: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">S</span><span class="p">)</span>
        
        <span class="c1"># Calculate number of pedestrians on loaded surface</span>
        <span class="n">n</span> <span class="o">=</span> <span class="n">S</span> <span class="o">*</span> <span class="n">d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of pedestrians on loaded surface</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Number of pedestrians, n: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
            
        <span class="c1"># Get damping ratio applicable to mode being considered</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">eta</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damping ratio for mode: </span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">eta</span><span class="p">)</span>
        
        <span class="c1"># Calculate effective number of pedestrians on loaded surface</span>
        <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="n">n_dash</span> <span class="o">=</span> <span class="mf">10.8</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">S</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">n_dash</span> <span class="o">=</span> <span class="mf">1.85</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">S</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">n_dash</span> <span class="o">=</span> <span class="n">n_dash</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Effective number of pedestrians on loaded surface, [1/m2]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;n_dash&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">n_dash</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Effective number of pedestrians, n&#39;: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n_dash</span><span class="p">)</span>
            
        <span class="c1"># Define reference load</span>
        <span class="c1"># refer Table 4-7, HIVOSS guidelines</span>
        <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span>
        
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">direction</span>
        
        <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Vertical&#39;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">280</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Longitudinal&#39;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">140</span>
        <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">:</span>
            <span class="n">P</span> <span class="o">=</span> <span class="mi">35</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid `direction`&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reference load, P [N]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">P</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Reference load, P [N]&#39;: </span><span class="si">%.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">P</span><span class="p">)</span>
           
        <span class="c1"># Calculate reduction factor</span>
        <span class="n">rslt</span> <span class="o">=</span> <span class="n">calc_psi_HIVOSS</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="mf">3.05</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        <span class="n">psi</span> <span class="o">=</span> <span class="n">rslt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">psi</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Reduction factor, psi&#39;: </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">psi</span><span class="p">)</span>
        
        <span class="c1"># Calculate load intensity</span>
        <span class="n">load_intensity</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n_dash</span> <span class="o">*</span> <span class="n">psi</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">=</span> <span class="n">load_intensity</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Load intensity [N/m2] of UDL due to crowd loading</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load intensity [N/m2]&#39;: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">load_intensity</span><span class="p">,</span> <span class="n">rslts_dict</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#ped_dyn.HIVOSS">HIVOSS</a></li>
          <li><a href="#ped_dyn.SteadyStateCrowdLoading">SteadyStateCrowdLoading</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, crowd_density, direction=&#39;Vertical&#39;, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation method</p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>crowd_density</code>, <em>float</em> to denote crowd density, persons/m2</p>
</li>
<li>
<p><code>direction</code>, <em>string</em> to denote loading / response direction. 
  Either 'Vertical' or 'Lateral' required.</p>
</li>
</ul>
<hr />
<p>Optional:</p>
<p>Refer optional keyword arguments in parent class <strong>init</strong>() method</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.__init__', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">crowd_density</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation method</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">    </span>
<span class="sd">    * `crowd_density`, _float_ to denote crowd density, persons/m2</span>
<span class="sd">    </span>
<span class="sd">    * `direction`, _string_ to denote loading / response direction. </span>
<span class="sd">      Either &#39;Vertical&#39; or &#39;Lateral&#39; required.</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    Refer optional keyword arguments in parent class __init__() method</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">crowd_density</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crowd density for design situation consider, P/m2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">direction</span> <span class="o">=</span> <span class="n">direction</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Direction of loading / response calculation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Run parent init function</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.calc_deck_area">
    <p>def <span class="ident">calc_deck_area</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the total deck area, taken across all deck strips</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.calc_deck_area', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.calc_deck_area" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_deck_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the total deck area, taken across all deck strips</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">total_area</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">calc_area</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_area</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.calc_load_intensity">
    <p>def <span class="ident">calc_load_intensity</span>(</p><p>self, mode_index, fv, verbose=True, makePlot=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Function to calculate intensity of uniform deck load
according to HIVOSS guidance</p>
<p>Note: overrides parent class method</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.calc_load_intensity', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.calc_load_intensity" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span><span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to calculate intensity of uniform deck load</span>
<span class="sd">    according to HIVOSS guidance</span>
<span class="sd">    </span>
<span class="sd">    Note: overrides parent class method</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Calculating load intensity for mode </span><span class="si">%d</span><span class="s2"> &quot;</span> <span class="o">%</span> <span class="n">mode_index</span> <span class="o">+</span>
          <span class="s2">&quot;according to HIVOSS...&quot;</span><span class="p">)</span>
    
    <span class="n">rslts_dict</span> <span class="o">=</span> <span class="p">{}</span>
    
    <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span>
    <span class="n">S</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span>
    
    <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;d&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">d</span>
    <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;S&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">S</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Area of loaded surface, S: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">S</span><span class="p">)</span>
    
    <span class="c1"># Calculate number of pedestrians on loaded surface</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">S</span> <span class="o">*</span> <span class="n">d</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
    <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;n&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">n</span>        
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Number of pedestrians on loaded surface</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Number of pedestrians, n: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
        
    <span class="c1"># Get damping ratio applicable to mode being considered</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>
    <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">eta</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damping ratio for mode: </span><span class="si">%.4f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">eta</span><span class="p">)</span>
    
    <span class="c1"># Calculate effective number of pedestrians on loaded surface</span>
    <span class="k">if</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="n">n_dash</span> <span class="o">=</span> <span class="mf">10.8</span> <span class="o">*</span> <span class="p">(</span><span class="n">eta</span><span class="o">*</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">S</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">n_dash</span> <span class="o">=</span> <span class="mf">1.85</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span> <span class="o">/</span> <span class="n">S</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">n_dash</span> <span class="o">=</span> <span class="n">n_dash</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Effective number of pedestrians on loaded surface, [1/m2]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;n_dash&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">n_dash</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Effective number of pedestrians, n&#39;: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">n_dash</span><span class="p">)</span>
        
    <span class="c1"># Define reference load</span>
    <span class="c1"># refer Table 4-7, HIVOSS guidelines</span>
    <span class="n">direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">direction</span>
    
    <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;direction&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">direction</span>
    
    <span class="k">if</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Vertical&#39;</span><span class="p">:</span>
        <span class="n">P</span> <span class="o">=</span> <span class="mi">280</span>
    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Longitudinal&#39;</span><span class="p">:</span>
        <span class="n">P</span> <span class="o">=</span> <span class="mi">140</span>
    <span class="k">elif</span> <span class="n">direction</span> <span class="o">==</span> <span class="s1">&#39;Lateral&#39;</span><span class="p">:</span>
        <span class="n">P</span> <span class="o">=</span> <span class="mi">35</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid `direction`&quot;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">P</span> <span class="o">=</span> <span class="n">P</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reference load, P [N]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;P&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">P</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Reference load, P [N]&#39;: </span><span class="si">%.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">P</span><span class="p">)</span>
       
    <span class="c1"># Calculate reduction factor</span>
    <span class="n">rslt</span> <span class="o">=</span> <span class="n">calc_psi_HIVOSS</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="mf">3.05</span><span class="p">,</span><span class="n">direction</span><span class="o">=</span><span class="s1">&#39;Vertical&#39;</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">rslt</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">rslts_dict</span><span class="p">[</span><span class="s2">&quot;psi&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">psi</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Reduction factor, psi&#39;: </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">psi</span><span class="p">)</span>
    
    <span class="c1"># Calculate load intensity</span>
    <span class="n">load_intensity</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="n">n_dash</span> <span class="o">*</span> <span class="n">psi</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">=</span> <span class="n">load_intensity</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Load intensity [N/m2] of UDL due to crowd loading</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load intensity [N/m2]&#39;: </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">load_intensity</span><span class="p">,</span> <span class="n">rslts_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.calc_modal_areas">
    <p>def <span class="ident">calc_modal_areas</span>(</p><p>self, mode_index, makePlot=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns modal area integrals</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.calc_modal_areas', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.calc_modal_areas" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_modal_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns modal area integrals</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.calc_responses">
    <p>def <span class="ident">calc_responses</span>(</p><p>self, output_mtrx=None, output_names=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculate steady-steady amplitude response of defined responses</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.calc_responses', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.calc_responses" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">output_mtrx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">output_names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate steady-steady amplitude response of defined responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get output matrix and output names, if not passed to this function</span>
    <span class="k">if</span> <span class="n">output_mtrx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">output_mtrx</span><span class="p">,</span> <span class="n">output_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetOutputMtrx</span><span class="p">(</span><span class="n">all_systems</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Get frequency response matrix for {disp,vel,accn} variables</span>
    <span class="c1"># (note: assumes already calculated!)</span>
    <span class="n">G_state_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span>
        
    <span class="c1"># Get modal forces</span>
    <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span>
    
    <span class="c1"># Calculate responses at steady-state</span>
    <span class="n">nResponses</span> <span class="o">=</span> <span class="n">output_mtrx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">nResponses</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            
        <span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">output_mtrx</span> <span class="err">@</span> <span class="n">G_state_vars</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">response_amplitudes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span> <span class="o">=</span> <span class="n">output_names</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No output matrix provided. &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Real-world responses have not been evaluated&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.get_response_amplitudes">
    <p>def <span class="ident">get_response_amplitudes</span>(</p><p>self, print_phase=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns response amplitudes as pandas dataframe</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.get_response_amplitudes', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.get_response_amplitudes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_response_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">print_phase</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns response amplitudes as pandas dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
    <span class="n">index_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
    <span class="n">columns_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">print_phase</span><span class="p">:</span>
        <span class="n">phase_angles</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span><span class="n">phase_angles</span><span class="p">))</span>
        <span class="n">columns_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Phase angle&quot;</span><span class="p">)</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                          <span class="n">index</span><span class="o">=</span><span class="n">index_list</span><span class="p">,</span>
                          <span class="n">columns</span><span class="o">=</span><span class="n">columns_list</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.get_response_stats">
    <p>def <span class="ident">get_response_stats</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns response stats for time-stepping analysis carried out</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.get_response_stats', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.get_response_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns response stats for time-stepping analysis carried out</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: no time-stepping analysis run, &quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;cannot retrieve results!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get dict of dict of stats</span>
    <span class="n">stats_dict_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">CalcResponseStats</span><span class="p">()</span>
    
    <span class="c1"># Loop over dict and return stats as list of pandas dataframes</span>
    <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">sys_obj</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">stats_dict_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>   
        
        <span class="n">sys_name</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">name</span>
        <span class="n">response_names</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">output_names</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stats_dict</span><span class="p">,</span>
                              <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">sys_name</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">x</span>
                                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_names</span><span class="p">])</span>
        
        <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="c1"># Merge pandas dataframes to return a single dataframe</span>
    <span class="c1"># with all stats for all responses for all systems</span>
    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
    
    <span class="c1"># Transpose such that stats as indexes, responses as columns</span>
    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            
    <span class="k">return</span> <span class="n">df_merged</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.plot_results">
    <p>def <span class="ident">plot_results</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots results of steady-state response analysis</p>
<p>If time-stepping analysis has also been carried out (as a cross-check) 
results of that analysis will be plotted also</p>
<hr />
<p><strong>Required:</strong></p>
<p>(No arguments required)</p>
<hr />
<p><strong>Optional:</strong></p>
<ul>
<li><code>overlay_val</code>, <em>float</em>, value to overlay onto response plots. 
  (A common use of this would be to overlay the applicable acceleration 
  limit, against which responses are to be compared)</li>
</ul>
<hr />
<p><strong>Returns:</strong></p>
<p><em>Nested list</em> of figure objects</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.plot_results', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.plot_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots results of steady-state response analysis</span>
<span class="sd">    </span>
<span class="sd">    If time-stepping analysis has also been carried out (as a cross-check) </span>
<span class="sd">    results of that analysis will be plotted also</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    **Required:**</span>
<span class="sd">    </span>
<span class="sd">    (No arguments required)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Optional:**</span>
<span class="sd">    </span>
<span class="sd">    * `overlay_val`, _float_, value to overlay onto response plots. </span>
<span class="sd">      (A common use of this would be to overlay the applicable acceleration </span>
<span class="sd">      limit, against which responses are to be compared)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Returns:**</span>
<span class="sd">    </span>
<span class="sd">    _Nested list_ of figure objects</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
            
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_freq_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="n">tstep_fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_tstep_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        <span class="n">fig_list</span> <span class="o">+=</span> <span class="n">tstep_fig_list</span>    
    
    <span class="k">return</span> <span class="n">fig_list</span>      
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.plot_results_freq_method">
    <p>def <span class="ident">plot_results_freq_method</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot results of frequency domain analysis method, if avaliable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.plot_results_freq_method', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.plot_results_freq_method" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_freq_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot results of frequency domain analysis method, if avaliable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for frequency domain method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="c1"># Produce and configure figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Steady-state pedestrian crowd loading analysis results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                 <span class="s2">&quot;Target mode: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="c1"># Produce bar plot of modal accelerations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_modal_accn</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># Produce bar plot of outputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_responses</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.plot_results_modal_accn">
    <p>def <span class="ident">plot_results_modal_accn</span>(</p><p>self, ax=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Produce bar plot of steady-state modal accelerations</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.plot_results_modal_accn', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.plot_results_modal_accn" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_modal_accn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce bar plot of steady-state modal accelerations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define axes to plot to, if not done so already</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span>
    
    <span class="c1"># Get or define tick labels</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="s1">&#39;mode_IDs&#39;</span><span class="p">):</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">mode_IDs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mode </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">nDOF</span><span class="p">)]</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state modal acceleration amplitudes (m/$s^2$)&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.plot_results_responses">
    <p>def <span class="ident">plot_results_responses</span>(</p><p>self, ax=None, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Produce bar plot of steady-state responses</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.plot_results_responses', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.plot_results_responses" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce bar plot of steady-state responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define axes to plot to, if not done so already</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="c1"># Get data to use in plot        </span>
    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
    
    <span class="c1"># Flatten list in case of nested lists (only when multiple subsystems)</span>
    <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">ticks</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state response amplitudes&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">overlay_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.plot_results_tstep_method">
    <p>def <span class="ident">plot_results_tstep_method</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot results of time-stepping analysis, if avaliable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.plot_results_tstep_method', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.plot_results_tstep_method" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_tstep_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot results of time-stepping analysis, if avaliable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for time-stepping method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="c1"># Define +/- values based on overlay_val, if provided</span>
    <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">overlay_val</span><span class="o">=</span><span class="p">[</span><span class="o">+</span><span class="n">overlay_val</span><span class="p">,</span><span class="o">-</span><span class="n">overlay_val</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span>
    
    <span class="n">fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">useCommonPlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                              <span class="n">useCommonScale</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                              <span class="n">y_overlay</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
    

    <span class="c1"># Overlay expected modal acceleration amplitudes</span>
    <span class="c1"># (from steady-state analysis, if run)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
    
        <span class="n">state_results_fig</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">state_results_fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># plot of modal accelerations</span>
        <span class="n">accn_val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span><span class="p">)</span>    <span class="c1"># value to overlay</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># Overlay expected response amplitudes </span>
        <span class="c1"># (from steady-state analysis, if run)</span>
        <span class="n">response_results_fig_list</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">axarr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_results_fig_list</span><span class="p">]</span>
        <span class="n">axarr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">axarr</span><span class="p">))</span> <span class="c1"># flatten list</span>
        <span class="n">val2overlay</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axarr</span><span class="p">,</span><span class="n">val2overlay</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> 
            
    <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.print_details">
    <p>def <span class="ident">print_details</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints details about the analysis that has been defined</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.print_details', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.print_details" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">print_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints details about the analysis that has been defined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Details of deck regions:&quot;</span><span class="p">)</span>
    
    <span class="n">deck_regions_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;nRegions: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">deck_regions_list</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">deckregion_obj</span> <span class="ow">in</span> <span class="n">deck_regions_list</span><span class="p">:</span>
        
        <span class="n">deckregion_obj</span><span class="o">.</span><span class="n">print_details</span><span class="p">()</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total deck area (m2):</span><span class="se">\n</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies of system (Hz):</span><span class="se">\n</span><span class="s2">{0}&quot;</span>
          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.print_results">
    <p>def <span class="ident">print_results</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints key results from analysis</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.print_results', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.print_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints key results from analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">printcomplex</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for printing magnitude and phase of complex-valued vals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Magnitudes:</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Phase angles (rad):</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
                
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal forces (N):&quot;</span><span class="p">)</span>
    <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal accelerations (m/s2):&quot;</span><span class="p">)</span>
        <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Responses:&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="p">)</span>
        <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.HIVOSS.run">
    <p>def <span class="ident">run</span>(</p><p>self, target_mode, load_intensity=None, forcing_freq=None, run_freq_method=True, run_tstep=False, tstep_kwargs={}, verbose=False, makePlot={&#39;calc_modal_areas&#39;: False, &#39;calc_load_intensity&#39;: True})</p>
    </div>
    

    
  
    <div class="desc"><p>Runs calculations to determine steady-state crowd loading responses</p>
<hr />
<p><strong>Required:</strong></p>
<ul>
<li><code>target_mode</code>, <em>integer</em>, denotes the mode at which resonance is 
  to be targeted</li>
</ul>
<hr />
<p><strong>Optional:</strong></p>
<ul>
<li>
<p><code>load_intensity</code>, <em>float</em>, denotes the load intensity (in N/m2) 
  to be applied. If <em>None</em>, <code>load_intensity</code> to be calculated 
  using <code>calc_load_intensity()</code> method function.</p>
</li>
<li>
<p><code>forcing_freq</code>, <em>float</em>, defines forcing frequency (in Hz) at which 
  response is to be determined. For ordinary modal systems with no 
  added dampers this value should normally be set to equal the damped 
  natural frequency for the mode given by <code>target_mode</code>, as this will 
  ensure the worst-case resonance response is obtained. This is thus 
  the default behaviour. However is some circumstances 
  (e.g. systems with multiple TMDs appended) it is necessary to 
  evaluate responses at various assumed forcing frequencies, 
  hence why this optional input is provided to the user.</p>
</li>
<li>
<p><code>run_freq_method</code>, <em>boolean</em>, if True the amplitude of modal and 
  real-world responses at steady-state will be determine by frequency 
  transfer matrix method. This is the default behaviour, as it allows 
  the steady-state amplitudes of responses to be efficiently 
  calculated. In some cases (e.g. for systems with constraints, for 
  which the <code>DynSys.CalcFreqResponse()</code> method is not currently 
  implemented), it may be desirable to carry out a time-stepping 
  analysis instead. This can be done by setting <code>run_freq_method=False</code> 
  and <code>run_tstep=True</code> (see documentation in next bullet for further 
  details)</p>
</li>
<li>
<p><code>run_tstep</code>, <em>boolean</em>, if True a time-stepping analysis will be run, 
  which can be used to verify the the steady-state resonance solution 
  that is ordinarily obtained.</p>
</li>
<li>
<p><code>tstep_kwargs</code>, <em>dict</em> of keyword arguments to be passed when 
  initialising time-stepping analysis using the <code>TStep()</code> class. Only 
  used if <code>run_tstep</code> is True. 
  Refer <a href="../docs/tstep.html">documentation</a> for <code>TStep()</code> 
  class for more details.</p>
</li>
<li>
<p><code>makePlot</code>, <em>dict</em> or <em>bool</em>, used to control which plots are 
  produced</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.HIVOSS.run', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.HIVOSS.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">target_mode</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">load_intensity</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">forcing_freq</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">run_freq_method</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">run_tstep</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">tstep_kwargs</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">makePlot</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
        <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs calculations to determine steady-state crowd loading responses</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Required:**</span>
<span class="sd">        </span>
<span class="sd">    * `target_mode`, _integer_, denotes the mode at which resonance is </span>
<span class="sd">      to be targeted</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    **Optional:**</span>
<span class="sd">    </span>
<span class="sd">    * `load_intensity`, _float_, denotes the load intensity (in N/m2) </span>
<span class="sd">      to be applied. If _None_, `load_intensity` to be calculated </span>
<span class="sd">      using `calc_load_intensity()` method function.</span>
<span class="sd">      </span>
<span class="sd">    * `forcing_freq`, _float_, defines forcing frequency (in Hz) at which </span>
<span class="sd">      response is to be determined. For ordinary modal systems with no </span>
<span class="sd">      added dampers this value should normally be set to equal the damped </span>
<span class="sd">      natural frequency for the mode given by `target_mode`, as this will </span>
<span class="sd">      ensure the worst-case resonance response is obtained. This is thus </span>
<span class="sd">      the default behaviour. However is some circumstances </span>
<span class="sd">      (e.g. systems with multiple TMDs appended) it is necessary to </span>
<span class="sd">      evaluate responses at various assumed forcing frequencies, </span>
<span class="sd">      hence why this optional input is provided to the user.</span>
<span class="sd">      </span>
<span class="sd">    * `run_freq_method`, _boolean_, if True the amplitude of modal and </span>
<span class="sd">      real-world responses at steady-state will be determine by frequency </span>
<span class="sd">      transfer matrix method. This is the default behaviour, as it allows </span>
<span class="sd">      the steady-state amplitudes of responses to be efficiently </span>
<span class="sd">      calculated. In some cases (e.g. for systems with constraints, for </span>
<span class="sd">      which the `DynSys.CalcFreqResponse()` method is not currently </span>
<span class="sd">      implemented), it may be desirable to carry out a time-stepping </span>
<span class="sd">      analysis instead. This can be done by setting `run_freq_method=False` </span>
<span class="sd">      and `run_tstep=True` (see documentation in next bullet for further </span>
<span class="sd">      details)</span>
<span class="sd">      </span>
<span class="sd">    * `run_tstep`, _boolean_, if True a time-stepping analysis will be run, </span>
<span class="sd">      which can be used to verify the the steady-state resonance solution </span>
<span class="sd">      that is ordinarily obtained.</span>
<span class="sd">      </span>
<span class="sd">    * `tstep_kwargs`, _dict_ of keyword arguments to be passed when </span>
<span class="sd">      initialising time-stepping analysis using the `TStep()` class. Only </span>
<span class="sd">      used if `run_tstep` is True. </span>
<span class="sd">      Refer [documentation](../docs/tstep.html) for `TStep()` </span>
<span class="sd">      class for more details.</span>
<span class="sd">      </span>
<span class="sd">    * `makePlot`, _dict_ or _bool_, used to control which plots are </span>
<span class="sd">      produced</span>
<span class="sd">      </span>
<span class="sd">      [documentation]: </span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** Running steady-state crowd loading analysis ****&quot;</span><span class="p">)</span>
    
    <span class="c1"># Handle makePlot</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">makePlot</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
        
        <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
        <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="n">makePlot</span>
    
    
    
    <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span> <span class="o">=</span> <span class="n">target_mode</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Target mode index: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_mode</span><span class="p">)</span>
    
    <span class="c1"># Define forcing frequency</span>
    <span class="k">if</span> <span class="n">forcing_freq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
        <span class="c1"># Set to be damped natural frequency of mode being targeted</span>
        <span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
        
    <span class="k">else</span><span class="p">:</span> <span class="c1"># where input value provided via optional arg</span>
        
        <span class="c1"># Check float type is provided</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: float expected for `forcing_freq`&quot;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">forcing_freq</span>
    
    <span class="c1"># Obtain area integrals over all deck strips</span>
    <span class="n">modal_areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_modal_areas</span><span class="p">(</span><span class="n">target_mode</span><span class="p">,</span>
                                        <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">])</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">modal_areas</span> <span class="o">=</span> <span class="n">modal_areas</span>
    
    <span class="c1"># Calculate load intensity, if not provided directly</span>
    <span class="k">if</span> <span class="n">load_intensity</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">load_intensity</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_load_intensity</span><span class="p">(</span><span class="n">mode_index</span><span class="o">=</span><span class="n">target_mode</span><span class="p">,</span>
                                                     <span class="n">fv</span><span class="o">=</span><span class="n">forcing_freq</span><span class="p">,</span>
                                                     <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                     <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># null dict</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">=</span> <span class="n">load_intensity</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uniform load intensity (in N/m2) to be applied to deck regions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity_rslts_dict</span> <span class="o">=</span> <span class="n">d</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    _Dict_ to store key results from load intensity calculation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;UDL intensity (N/m2): </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span><span class="p">)</span>
             
    <span class="c1"># Multiply by load intensity to obtain modal force amplitudes</span>
    <span class="c1"># Note modal force amplitudes should be regarded as complex variables </span>
    <span class="c1"># (although here they will be real-valued) whereby negative values </span>
    <span class="c1"># imply a force which is 180 degrees out of phase</span>
    <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">*</span> <span class="n">modal_areas</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span> <span class="o">=</span> <span class="n">modal_forces</span>
        
    <span class="c1"># Save settings used to determine which analyses run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span> <span class="o">=</span> <span class="n">run_freq_method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span> <span class="o">=</span> <span class="n">run_tstep</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Forcing frequency: </span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">forcing_freq</span><span class="p">)</span>
    
    <span class="c1"># Run frequency domain method to determine steady-state responses               </span>
    <span class="k">if</span> <span class="n">run_freq_method</span><span class="p">:</span>
        
        <span class="c1"># Evaluate frequency transfer functions G(f) relating applied forces </span>
        <span class="c1"># (i.e. modal forces in this application) to DOF accelerations, </span>
        <span class="c1"># displacements and velocities</span>
        <span class="c1"># (i.e. modal disp, vel, accn in this application)</span>
        <span class="c1">#</span>
        <span class="c1"># It is only necessary to evaluate G(f) at resonant frequency for mode </span>
        <span class="c1"># being targeted, although for validation / plotting it may be </span>
        <span class="c1"># advantageous to evaluate G(f) over a wider frequency range</span>
        <span class="c1">#</span>
        <span class="c1"># By definition, G(f1) is a matrix that can be used to relate </span>
        <span class="c1"># sinusoidal modal forces to sinusoidal modal accelerations, </span>
        <span class="c1"># given forcing frequency f1.</span>
        <span class="c1">#</span>
        <span class="c1"># Note: G(f) will in general be complex-valued; the should be </span>
        <span class="c1"># intepreted to denote scaling and phase lag</span>
        
        <span class="c1"># Calculate matrix mapping applied loads to state DOFs</span>
        <span class="k">def</span> <span class="nf">Calc_Gf</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">rslts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcFreqResponse</span><span class="p">(</span><span class="n">fVals</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                                                       <span class="n">C</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span>
                                                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
            <span class="n">G_f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;G_f&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">G_f</span>
        
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">Calc_Gf</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
        
        <span class="c1"># Retain only submatrix mapping modal forces to state DOFs</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modal_forces</span><span class="p">)</span>
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[:,:</span><span class="n">nModes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span>
        
        <span class="c1"># Get submatrix mapping applied forces to DOF accelerations</span>
        <span class="n">nDOF</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">G_state_vars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">G_acc</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nDOF</span><span class="p">:,:]</span>
        
        <span class="c1"># Get submatrix mapping modal forces to m accelerations</span>
        <span class="n">G_modalacc</span> <span class="o">=</span> <span class="n">G_acc</span><span class="p">[:</span><span class="n">nModes</span><span class="p">,:</span><span class="n">nModes</span><span class="p">]</span>
        
        <span class="c1"># Calculate modal acceleration amplitudes using transfer matrix</span>
        <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">G_modalacc</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span>
        
        <span class="c1"># Adjust phase such that acc for target mode has phase=0</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">]))</span>
        <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span> <span class="o">/</span> <span class="n">z1</span>
        
        <span class="c1"># Get modal acceleration of targeted mode</span>
        <span class="c1"># Note phase=0 due to above adjustment, hence ok to take real part only</span>
        <span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">modal_accn_target</span>
                       
        <span class="c1"># Calculate responses amplitudes using full transfer matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_responses</span><span class="p">()</span>
          
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;**** Analysis complete! ****</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">run_tstep</span><span class="p">:</span>
        
        <span class="c1"># Run time-stepping analysis to validate /check the above approach</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Running time-stepping analysis, as cross-check of &quot;</span><span class="o">+</span>
              <span class="s2">&quot;steady-state resonance approach...***&quot;</span><span class="p">)</span>
                    
        <span class="c1"># Define sinusoidal load function consistent with above</span>
        <span class="k">def</span> <span class="nf">load_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">modal_forces</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">forcing_freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        
        <span class="n">load_func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span> <span class="p">:</span> <span class="n">load_func</span><span class="p">}</span>
        
        <span class="c1"># Define and run time-stepping analysis</span>
        <span class="n">tstep_analysis</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">dynsys_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                     <span class="n">force_func_dict</span><span class="o">=</span><span class="n">load_func_dict</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">tstep_kwargs</span><span class="p">)</span>
        
        <span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_analysis</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>  
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_results</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Results from time-stepping analysis; instance of `TStep_Results()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Time-stepping analysis complete!***&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="ped_dyn.HIVOSS.crowd_density" class="name">var <span class="ident">crowd_density</span></p>
            

            
  
    <div class="desc"><p>Crowd density for design situation consider, P/m2</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.HIVOSS.direction" class="name">var <span class="ident">direction</span></p>
            

            
  
    <div class="desc"><p>Direction of loading / response calculation</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="ped_dyn.LatSync_McRobie" class="name">class <span class="ident">LatSync_McRobie</span></p>
      
  
    <div class="desc"><p>Class used to implement the multiple modes + multiple TMDs analysis method 
used to consider the phenomenon of Lateral Synchronous crowd loading 
response, per the following 
<a href="../references/The Lateral Dynamic Stablity of Stockton Infinity 
Footbridge using Complex Modes.pdf">paper</a></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">LatSync_McRobie</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class used to implement the multiple modes + multiple TMDs analysis method </span>
<span class="sd">    used to consider the phenomenon of Lateral Synchronous crowd loading </span>
<span class="sd">    response, per the following </span>
<span class="sd">    [paper](../references/The Lateral Dynamic Stablity of Stockton Infinity </span>
<span class="sd">    Footbridge using Complex Modes.pdf)    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys</span><span class="p">,</span>
                 <span class="n">cp_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">mp_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">store_mtrxs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">makePlots</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise analysis</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `modalsys`, instance of `ModalSys` class, defining the modal </span>
<span class="sd">          system to be analysed. For situations where TMDs are present, it is </span>
<span class="sd">          assumed that TMDs have already been appended to the parent modal </span>
<span class="sd">          system, e.g. by use of the `append_TMDs()` method in `damper.py`.</span>
<span class="sd">          </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `cp_func`, function of form g(fn), where fn is frequency in Hz,</span>
<span class="sd">          to define how _negative_ damping per pedestrian varies with frequency</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Initialising &#39;LatSync_McRobie&#39; analysis...&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">modalsys</span> <span class="o">=</span> <span class="n">modalsys</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Modal system that form the basis of this analysis. May have subsystems </span>
<span class="sd">        pre-appended (e.g. TMDs)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Defining pedestrian added damping function...&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">cp_func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Default cp(f) function will be used&quot;</span><span class="p">)</span>
            <span class="n">cp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_cp_func</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;cp = </span><span class="si">%.1f</span><span class="s2"> will be used for all f&quot;</span> <span class="o">%</span> <span class="n">cp_func</span><span class="p">)</span>
            <span class="n">cp_val</span> <span class="o">=</span> <span class="n">cp_func</span>
            <span class="n">cp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="n">cp_val</span><span class="p">,</span><span class="n">cp_val</span><span class="p">],</span>
                                                 <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                 <span class="n">fill_value</span><span class="o">=</span><span class="n">cp_val</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">cp_func</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;User-supplied cp(f) function will be used&quot;</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `cp_func` argument&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span> <span class="o">=</span> <span class="n">cp_func</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to define how added damping per pedestrian varies with</span>
<span class="sd">        frequency. Function with single argument &#39;fn&#39; expected, </span>
<span class="sd">        i.e. cp = g(fn), cp in [Ns/m]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Defining pedestrian added mass function...&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">mp_func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Default mp(f) function will be used&quot;</span><span class="p">)</span>
            <span class="n">mp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mp_func</span><span class="p">()</span>
            
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mp_func</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;mp = </span><span class="si">%.1f</span><span class="s2"> will be used for all f&quot;</span> <span class="o">%</span> <span class="n">mp_func</span><span class="p">)</span>
            <span class="n">mp_val</span> <span class="o">=</span> <span class="n">mp_func</span>
            <span class="n">mp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="n">mp_val</span><span class="p">,</span><span class="n">mp_val</span><span class="p">],</span>
                                                 <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                 <span class="n">fill_value</span><span class="o">=</span><span class="n">mp_val</span><span class="p">)</span>
            
        <span class="k">elif</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">mp_func</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;User-supplied mp(f) function will be used&quot;</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `mp_func` argument&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span> <span class="o">=</span> <span class="n">mp_func</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to define how added mass per pedestrian varies with</span>
<span class="sd">        frequency. Function with single argument &#39;fn&#39; expected, </span>
<span class="sd">        i.e. mp = g(fn), cp in [kg]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">store_mtrxs</span> <span class="o">=</span> <span class="n">store_mtrxs</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Boolean option, if True then system damping and stiffness matrices</span>
<span class="sd">        will be stored via nested list for all Np values and modes considered</span>
<span class="sd">        (this can result in a large amount of data being stored!)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Class variables defined later on</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of complex-valued eigenvalues of shape (N_Np,N_modes), where:</span>
<span class="sd">            </span>
<span class="sd">        * _N_Np_ is number of pedestrian cases considered</span>
<span class="sd">        </span>
<span class="sd">        * _N_modes_ is number of system matrix eigenmodes</span>
<span class="sd">        &quot;&quot;&quot;</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of effective damping ratio for each mode and pedestrian </span>
<span class="sd">        count considered.</span>
<span class="sd">        </span>
<span class="sd">        _Ndarray shape as per eigenvalues above._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of damped natural frequencies for each mode and pedestrian </span>
<span class="sd">        count considered.</span>
<span class="sd">        </span>
<span class="sd">        _Ndarray shape as per eigenvalues above._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of complex-valued eigenvalues of shape _(N_Np,N_modes,N_dof)_, </span>
<span class="sd">        where:</span>
<span class="sd">        * _N_Np_ is number of pedestrian cases considered</span>
<span class="sd">        </span>
<span class="sd">        * _N_modes_ is number of system matrix eigenmodes</span>
<span class="sd">        </span>
<span class="sd">        * _N_dof_ is the total number of degrees of freedom / state variables </span>
<span class="sd">          for the system analysed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Array listing the set of pedestrian numbers analysed</span>
<span class="sd">        &quot;&quot;&quot;</span>        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of effective damping rate per pedestrian for each mode and </span>
<span class="sd">        pedestrian count considered.</span>
<span class="sd">        </span>
<span class="sd">        _Ndarray shape as per eigenvalues above._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Ndarray of effective added mass per pedestrian for each mode and </span>
<span class="sd">        pedestrian count considered.</span>
<span class="sd">        </span>
<span class="sd">        _Ndarray shape as per eigenvalues above._</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Matrix to represent the smeared effect of one pedestrian on the deck</span>
<span class="sd">        Used to calculate additive system matrices due to pedestrians</span>
<span class="sd">        &quot;&quot;&quot;</span>
                
        <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Critical number of pedestrians to give zero net damping</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Index of (complex) eigenmode that loses stability at Np=Np_crit </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Damped natural frequency of mode that loses stability at Np=Np_crit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Effective damping ratio of mode that loses stability at Np=Np_crit</span>
<span class="sd">        (damping ratio = 0.00 expected)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Complex-valued pole / eigenvalue at Np=Np_crit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">X_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Complex-valued eigenvector of mode that loses stability at Np=Np_crit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Damping matrix (of &#39;parent&#39; modal system) applicable to mode that loses </span>
<span class="sd">        stability at Np=Np_crit.</span>
<span class="sd">        </span>
<span class="sd">        Will in general include off-diagonal terms due to mode coupling effect </span>
<span class="sd">        of pedestrians, determined per method presented in McRobie&#39;s paper  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_crit</span> <span class="o">=</span> <span class="bp">None</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Mass matrix (of &#39;parent&#39; modal system) applicable to mode that loses </span>
<span class="sd">        stability at Np=Np_crit.</span>
<span class="sd">        </span>
<span class="sd">        Will in general include off-diagonal terms due to mode coupling effect </span>
<span class="sd">        of pedestrians, determined per method presented in McRobie&#39;s paper  </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">makePlots</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">plot_cp_func</span><span class="p">()</span>
        
        
    <span class="k">def</span> <span class="nf">init_cp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conservative</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise default function to use to define frequency-dependence of </span>
<span class="sd">        effective added damping per pedestrian (Ns/m per pedestrian).</span>
<span class="sd">        </span>
<span class="sd">        Note damping taken in conventional sense, such that positive values</span>
<span class="sd">        define added damping i.e. increased attenuation of vibrations. </span>
<span class="sd">        Correspondingly the effect of pedestrians will tend to be represented </span>
<span class="sd">        by a negative damping rate.</span>
<span class="sd">        </span>
<span class="sd">        This default profile has been defined with regards to the work done by</span>
<span class="sd">        Dallard et al (2006) and John MacDonald (2008). The default curve </span>
<span class="sd">        defined within this function is taken to be a conservative </span>
<span class="sd">        representation of the damping values presented in Figure 9(a) of </span>
<span class="sd">        the latter&#39;s paper _&quot;Lateral excitation of bridges by balancing </span>
<span class="sd">        pedestrians&quot;_</span>
<span class="sd">        </span>
<span class="sd">        If `conservative=True` is used then the negative 300Ns/m value proposed </span>
<span class="sd">        by Dallard et al will be used. This value is taken to be independent </span>
<span class="sd">        of frequency.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">conservative</span><span class="p">:</span>
            <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
            <span class="n">cp_vals</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">]</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
            <span class="n">cp_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            
            
        <span class="n">cp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">cp_func</span>
    
    
    <span class="k">def</span> <span class="nf">init_mp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialise default function to use to define frequency-dependence of </span>
<span class="sd">        effective added mass per pedestrian (kg per pedestrian)</span>
<span class="sd">        </span>
<span class="sd">        The default curve defined within this function is taken to be a </span>
<span class="sd">        simplified representation of the added mass values presented in </span>
<span class="sd">        Figure 9(b) of John MacDonald&#39;s 2008 Proc. of the Royal Society paper </span>
<span class="sd">        _&quot;Lateral excitation of bridges by balancing pedestrians&quot;_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
        <span class="n">deltaM_vals</span> <span class="o">=</span> <span class="p">[</span><span class="o">+</span><span class="mi">70</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
            
        <span class="n">deltaM_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">deltaM_vals</span><span class="p">,</span>
                                                 <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                                 <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                 <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">deltaM_func</span>
    

    <span class="k">def</span> <span class="nf">calc_pedestrian_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates modal damping matrix due to pedestrians, per the method </span>
<span class="sd">        presented in McRobie paper</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get system matrix to represent distributed action of pedestrians</span>
        <span class="c1"># along deck modeshapes</span>
        <span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span>
            
        <span class="k">if</span> <span class="n">ped_effect_mtrx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                
            <span class="n">modalsys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys</span>
            <span class="n">modeshape_func</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">modeshapeFunc</span>
            <span class="n">L</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">Ltrack</span>
            
            <span class="c1"># Evaluate modeshape ordinates at unif</span>
            <span class="n">dL</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="n">num</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="n">dL</span><span class="o">/</span><span class="mi">2</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="n">modeshape_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
                
            <span class="c1"># Evaluate matrix product of modeshape ordinate matrices</span>
            <span class="n">phi_product</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">T</span> <span class="err">@</span> <span class="n">phi</span>
            
            <span class="c1"># Return mode-generalised damping matrix</span>
            <span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="n">dL</span> <span class="o">/</span> <span class="n">L</span> <span class="o">*</span> <span class="n">phi_product</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="n">ped_effect_mtrx</span>
        
        <span class="c1"># Evaluate cp and mp given mode natural frequency provided</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c1"># positive frequencies to be used</span>
        <span class="n">cp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="n">mp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        
        <span class="n">C_pa</span> <span class="o">=</span> <span class="n">cp</span> <span class="o">*</span> <span class="n">ped_effect_mtrx</span>
        <span class="n">M_pa</span> <span class="o">=</span> <span class="n">mp</span> <span class="o">*</span> <span class="n">ped_effect_mtrx</span>
        
        <span class="c1"># Return results as dict</span>
        <span class="n">rslts</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;C_pa&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">C_pa</span>
        <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;M_pa&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">M_pa</span>
        <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;cp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cp</span>
        <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;mp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mp</span>
        <span class="k">return</span> <span class="n">rslts</span>
        
    
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">calc_Np_crit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run analysis to explore eigenvalues of system state matrix for various </span>
<span class="sd">        assumed pedestrian crowd densities</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">            </span>
<span class="sd">        * `Np_vals`, _array-like_: each value defines total number of </span>
<span class="sd">          pedestrians on bridge; a range of values will typically be provided, </span>
<span class="sd">          to allow exploration of how system eigenproperties (in particular </span>
<span class="sd">          effective damping) varies with pedestrian numbers</span>
<span class="sd">         </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running lat sync eigenvalues analysis...&quot;</span><span class="p">)</span>
    
        <span class="c1"># Run analysis </span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_analysis</span><span class="p">(</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">append_rslts</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># Calculate critical number of pedestrians for onset on instability</span>
        <span class="k">if</span> <span class="n">calc_Np_crit</span><span class="p">:</span>
            <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Np_crit</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">None</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis complete!&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Np_crit</span>
    
    
    <span class="k">def</span> <span class="nf">_run_analysis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Np_vals</span><span class="p">,</span>
                      <span class="n">append_rslts</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Run analysis for various pedestrian numbers, as provided to function</span>
<span class="sd">        </span>
<span class="sd">        To cater for frequency-dependent nature of pedestrian damping/mass</span>
<span class="sd">        effect an iterative procedure is adopted, similar to the p-k method </span>
<span class="sd">        devised by Theodorsen for solving aeroelastic problems</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">modalsys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys</span>
        
        <span class="n">store_mtrxs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">store_mtrxs</span>
                
        <span class="c1"># Take copy of system damping matrix with no pedestrians</span>
        <span class="n">C0</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">modalsys</span><span class="o">.</span><span class="n">_C_mtrx</span><span class="p">)</span>
        <span class="n">M0</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="n">modalsys</span><span class="o">.</span><span class="n">_M_mtrx</span><span class="p">)</span>
        
        <span class="c1"># Define function to iterate with</span>
        <span class="k">def</span> <span class="nf">calc_modal_properties</span><span class="p">(</span><span class="n">f</span><span class="p">,</span><span class="n">mode_index</span><span class="p">,</span><span class="n">Np</span><span class="p">,</span><span class="n">return_rslts</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
            
            <span class="c1"># Calculate change in model damping matrix</span>
            <span class="c1"># due to smeared effect of N=1 pedestrian</span>
            <span class="n">rslts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_pedestrian_effect</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">f</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
            <span class="n">C_pa</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;C_pa&#39;</span><span class="p">]</span>
            <span class="n">M_pa</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;M_pa&#39;</span><span class="p">]</span>
            
            <span class="c1"># Adjust bridge damping and mass matrices</span>
            <span class="n">modalsys</span><span class="o">.</span><span class="n">_C_mtrx</span> <span class="o">=</span> <span class="n">C0</span> <span class="o">+</span> <span class="n">Np</span> <span class="o">*</span> <span class="n">C_pa</span>
            <span class="n">modalsys</span><span class="o">.</span><span class="n">_M_mtrx</span> <span class="o">=</span> <span class="n">M0</span> <span class="o">+</span> <span class="n">Np</span> <span class="o">*</span> <span class="n">M_pa</span>
                    
            <span class="c1"># Carry out eigevalue analysis using updated system matrices</span>
            <span class="n">eig_props</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
            <span class="n">f_new</span> <span class="o">=</span> <span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;f_d&#39;</span><span class="p">][</span><span class="n">mode_index</span><span class="p">]</span>
            
            <span class="n">f_error</span> <span class="o">=</span> <span class="n">f_new</span> <span class="o">-</span> <span class="n">f</span>
            
            <span class="c1">#print(&quot;Calculating: Np=%d, mode=%d, f=%.3f, f_error=%.3f&quot; </span>
            <span class="c1">#      % (Np,mode_index,f,f_error))</span>
            
            <span class="k">if</span> <span class="n">return_rslts</span><span class="p">:</span>
                
                <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;eig_props&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">eig_props</span>
                <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">d</span><span class="p">,</span> <span class="o">**</span><span class="n">rslts</span><span class="p">}</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;C_mtrx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">_C_mtrx</span>
                <span class="n">d</span><span class="p">[</span><span class="s1">&#39;M_mtrx&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">_M_mtrx</span>
                
                <span class="k">return</span> <span class="n">f_error</span><span class="p">,</span> <span class="n">d</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">f_error</span>
            
        <span class="c1"># Carry out eigevalue analysis of system with no pedestrians</span>
        <span class="n">eig_props</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
        <span class="n">fd_vals_last</span> <span class="o">=</span> <span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;f_d&#39;</span><span class="p">]</span>
        
        <span class="c1"># Loop over all pedestrian numbers provided to function</span>
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">mp_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">s_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">eta_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">fd_vals</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">X_vals</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
            <span class="n">C_mtrx_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">M_mtrx_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">_Np</span> <span class="ow">in</span> <span class="n">Np_vals</span><span class="p">:</span>
            
            <span class="n">cp_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">mp_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">s_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">eta_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fd_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">X_vals_inner</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                <span class="n">C_mtrx_inner_list</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="n">M_mtrx_inner_list</span> <span class="o">=</span> <span class="p">[]</span>
            
            <span class="k">for</span> <span class="n">_mode_index</span><span class="p">,</span> <span class="n">_fd</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">fd_vals_last</span><span class="p">):</span>
            
                <span class="c1"># Solve for consistent frequencies, allowing for </span>
                <span class="c1"># frequency-dependence of pedestrian-related mass and damping</span>
                <span class="n">fd_sol</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">newton</span><span class="p">(</span><span class="n">func</span><span class="o">=</span><span class="n">calc_modal_properties</span><span class="p">,</span>
                                               <span class="n">x0</span><span class="o">=</span><span class="n">_fd</span><span class="p">,</span>
                                               <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">_mode_index</span><span class="p">,</span><span class="n">_Np</span><span class="p">))</span>
                
                <span class="c1"># Rerun for converged frequency of given mode</span>
                <span class="n">ferr</span><span class="p">,</span> <span class="n">rslts</span> <span class="o">=</span> <span class="n">calc_modal_properties</span><span class="p">(</span><span class="n">fd_sol</span><span class="p">,</span>
                                                    <span class="n">_mode_index</span><span class="p">,</span><span class="n">_Np</span><span class="p">,</span>
                                                    <span class="n">return_rslts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
                
                <span class="n">eig_props</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;eig_props&#39;</span><span class="p">]</span>
                <span class="n">cp</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;cp&#39;</span><span class="p">]</span>
                <span class="n">mp</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;mp&#39;</span><span class="p">]</span>
                <span class="n">C_mtrx</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;C_mtrx&#39;</span><span class="p">]</span>
                <span class="n">M_mtrx</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;M_mtrx&#39;</span><span class="p">]</span>
                
                <span class="c1"># Unpack results for this mode and append to inner lists</span>
                <span class="n">cp_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp</span><span class="p">)</span>
                <span class="n">mp_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp</span><span class="p">)</span>
                <span class="n">s_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;s&#39;</span><span class="p">][</span><span class="n">_mode_index</span><span class="p">])</span>
                <span class="n">eta_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;eta&#39;</span><span class="p">][</span><span class="n">_mode_index</span><span class="p">])</span>
                <span class="n">fd_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;f_d&#39;</span><span class="p">][</span><span class="n">_mode_index</span><span class="p">])</span>
                <span class="n">X_vals_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">eig_props</span><span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">][:,</span><span class="n">_mode_index</span><span class="p">]))</span>
                
                <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                    <span class="n">C_mtrx_inner_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C_mtrx</span><span class="p">)</span>
                    <span class="n">M_mtrx_inner_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_mtrx</span><span class="p">)</span>
                
            <span class="c1"># Update last frequencies</span>
            <span class="n">fd_vals_last</span> <span class="o">=</span> <span class="n">fd_vals_inner</span>
                
            <span class="c1"># Append inner lists to outer lists</span>
            <span class="n">cp_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cp_vals_inner</span><span class="p">)</span>
            <span class="n">mp_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mp_vals_inner</span><span class="p">)</span>
            <span class="n">s_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">s_vals_inner</span><span class="p">)</span>
            <span class="n">eta_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">eta_vals_inner</span><span class="p">)</span>
            <span class="n">fd_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fd_vals_inner</span><span class="p">)</span>
            <span class="n">X_vals</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X_vals_inner</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                <span class="n">C_mtrx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C_mtrx_inner_list</span><span class="p">)</span>
                <span class="n">M_mtrx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_mtrx_inner_list</span><span class="p">)</span>
            
        <span class="c1"># Convert nested lists to numpy ndarray type</span>
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">cp_vals</span><span class="p">)</span>
        <span class="n">mp_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">mp_vals</span><span class="p">)</span>
        <span class="n">s_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s_vals</span><span class="p">)</span>
        <span class="n">eta_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">)</span>
        <span class="n">fd_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">fd_vals</span><span class="p">)</span>
        <span class="n">X_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">X_vals</span><span class="p">)</span>
        
        <span class="c1"># Restore original no-pedestrians system matrices</span>
        <span class="n">modalsys</span><span class="o">.</span><span class="n">_C_mtrx</span> <span class="o">=</span> <span class="n">C0</span>
        <span class="n">modalsys</span><span class="o">.</span><span class="n">_M_mtrx</span> <span class="o">=</span> <span class="n">M0</span>
        
        <span class="c1"># Check to see if previous results exist</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;eigenvalues&#39;</span><span class="p">):</span>
            <span class="n">append_rslts</span> <span class="o">=</span> <span class="bp">False</span> <span class="c1"># no previous results avaliable</span>
        
        <span class="c1"># Record key results as attributes, or append to previous results</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">append_rslts</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">s_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">eta_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span> <span class="o">=</span> <span class="n">fd_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">X_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span> <span class="o">=</span> <span class="n">Np_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span> <span class="o">=</span> <span class="n">cp_vals</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span> <span class="o">=</span> <span class="n">mp_vals</span>
            
            <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_list</span> <span class="o">=</span> <span class="n">C_mtrx_list</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_list</span> <span class="o">=</span> <span class="n">M_mtrx_list</span>
            
        <span class="k">if</span> <span class="n">append_rslts</span><span class="p">:</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">,</span><span class="n">s_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">,</span><span class="n">eta_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span><span class="p">,</span><span class="n">fd_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">,</span><span class="n">X_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">,</span><span class="n">Np_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span><span class="p">,</span><span class="n">mp_vals</span><span class="p">))</span>
            
            <span class="k">if</span> <span class="n">store_mtrxs</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">C_mtrx_list</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">M_mtrx_list</span><span class="p">)</span>
            
 
    <span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots results from the above analysis</span>
<span class="sd">        </span>
<span class="sd">        N.b: Figures intentionally emulate the format of figures in </span>
<span class="sd">        McRobie&#39;s paper, as these have been used to validate the above routine</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
        
        <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
        
        <span class="c1"># Prepare subplots</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_damping_vs_freq</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_poles</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_damping_vs_pedestrians</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        
        <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_cp_func</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">sharex</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_mp_func</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
                
        <span class="k">return</span> <span class="n">fig</span>
        
    
    <span class="k">def</span> <span class="nf">plot_damping_vs_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;            </span>
<span class="sd">        Plot damping ratio against damped natural frequency</span>
<span class="sd">        (per Figure 5 in McRobie&#39;s paper)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        
        <span class="n">eta_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span>
        <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">,</span><span class="n">fd_vals</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span><span class="n">fd_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fd_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1"># denotes stability limit</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damped natural frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Frequency vs Effective Damping</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
        
    
    <span class="k">def</span> <span class="nf">plot_poles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot eigenvalues (poles) on complex plane</span>
<span class="sd">        (per Figure 4 in paper)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        
        <span class="n">s_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">),</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">]),</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1"># stability limit</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># illustrates Im(z)=0 axis</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Real(s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Imag(s)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Eigenvalues of system state matrix&quot;</span><span class="p">)</span>
        
        <span class="n">s_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span>
        <span class="k">if</span> <span class="n">s_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_crit</span><span class="p">),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_crit</span><span class="p">),</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
        
    
    <span class="k">def</span> <span class="nf">plot_damping_vs_pedestrians</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots effective damping ratio of poles against number of pedestrians</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">Np_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span>
        <span class="n">eta_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">eta_vals</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of pedestrians&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Effective damping ratio&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Effect of pedestrians on effective damping&quot;</span><span class="p">)</span>
        
        <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span>
        <span class="k">if</span> <span class="n">Np_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Np_crit</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Np_crit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
            
            
    <span class="k">def</span> <span class="nf">plot_cp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">f_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots function defining how negative damping per pedestrian varies </span>
<span class="sd">        with frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">cp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span>
        
        <span class="k">if</span> <span class="n">f_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="n">f_vals</span> <span class="o">=</span> <span class="n">cp_func</span><span class="o">.</span><span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`f_vals` must be provided!&quot;</span><span class="p">)</span>
                
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="n">cp_func</span><span class="p">(</span><span class="n">f_vals</span><span class="p">)</span>
           
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Defined $c_p(f)$ function&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$c_p$ (Ns/m)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damping rate per pedestrian, $c_p$&quot;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cp_vals&#39;</span><span class="p">):</span>
            <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>
            <span class="n">cp_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="s1">&#39;r|&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$c_p$ values for modes&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>
    
    
    <span class="k">def</span> <span class="nf">plot_mp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">f_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots function defining how negative damping per pedestrian varies </span>
<span class="sd">        with frequency</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span>
        
        <span class="k">if</span> <span class="n">f_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mp_func</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
                <span class="n">f_vals</span> <span class="o">=</span> <span class="n">mp_func</span><span class="o">.</span><span class="n">x</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`f_vals` must be provided!&quot;</span><span class="p">)</span>
                
        <span class="n">mp_vals</span> <span class="o">=</span> <span class="n">mp_func</span><span class="p">(</span><span class="n">f_vals</span><span class="p">)</span>
           
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
            
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">mp_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Defined $m_p(f)$ function&#39;</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">+</span><span class="mi">100</span><span class="p">])</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta M$ (kg)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Added mass per pedestrian, $\Delta M$&quot;</span><span class="p">)</span>
                
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;mp_vals&#39;</span><span class="p">):</span>
            <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>
            <span class="n">mp_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span>
            <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd_vals</span><span class="p">,</span><span class="n">mp_vals</span><span class="p">,</span><span class="s1">&#39;r|&#39;</span><span class="p">)</span>
            
            <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$\Delta M$ values for modes&#39;</span><span class="p">)</span>

        <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">fig</span>
        
        
    <span class="k">def</span> <span class="nf">calc_Np_crit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rerun_factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates from results the critical number of pedestrians for the </span>
<span class="sd">        onset of pedestrian-induced lateral instability</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Determining critical number of pedestrians &quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;for onset on instability...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Check that analysis has been run</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;N_pedestrians&quot;</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis does not appear to have been run!&quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;Cannot calculate Np_crit&quot;</span><span class="p">)</span>
                                
        <span class="c1"># Check that analysis has been run up to pedestrian numbers such that </span>
        <span class="c1"># the net effective damping in (at least) one mode has become &lt;0.0</span>
        <span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">)</span>
        <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">)</span>
        
        <span class="k">while</span> <span class="n">min_damping</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
                 
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis has not identified net damping &lt; 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                      <span class="s2">&quot;Analysis will be extended to larger pedestrian numbers&quot;</span><span class="p">)</span>
            
            <span class="c1"># Get key details of Np analysed last time around</span>
            <span class="n">Np_max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">)</span> <span class="c1"># max from last run</span>
            <span class="n">Np_min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">)</span> <span class="c1"># min from last run</span>
            <span class="n">Np_step</span> <span class="o">=</span> <span class="p">(</span><span class="n">Np_max</span> <span class="o">-</span> <span class="n">Np_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">))</span>
            
            <span class="c1"># Define Np_vals for new analysis</span>
            <span class="n">new_Np_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Np_max</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Np_max</span><span class="o">*</span><span class="n">rerun_factor</span><span class="p">,</span><span class="n">Np_step</span><span class="p">)</span>
            
            <span class="c1"># Rerun analysis</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_run_analysis</span><span class="p">(</span><span class="n">new_Np_vals</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
            
            <span class="c1"># Recalculate minimum damping</span>
            <span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">)</span>
            <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">)</span>
            
        <span class="c1"># Determine minumum damping ratio across all modes for each Np value</span>
        <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        
        <span class="c1"># Define interpolation function</span>
        <span class="n">Np_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span>
        
        <span class="n">Np_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">,</span>
                                             <span class="n">y</span><span class="o">=</span><span class="n">min_damping</span><span class="p">)</span>
                                      
        <span class="c1"># Use root finding function to obtain Np such that damping = 0.0</span>
        <span class="n">Np_crit</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">Np_func</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span> <span class="o">=</span> <span class="n">Np_crit</span>
        
        <span class="c1"># Rerun analysis to obtain properties at critical point</span>
        <span class="c1"># 1) take copy of class to pick up same attributes as analysis run</span>
        <span class="n">crit_rslts</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="c1"># 2) Edit a few key properties for this purpose</span>
        <span class="n">crit_rslts</span><span class="o">.</span><span class="n">store_mtrxs</span> <span class="o">=</span> <span class="bp">True</span>
        <span class="c1"># 3) rerun to override results already held in the above object</span>
        <span class="n">crit_rslts</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Np_vals</span><span class="o">=</span><span class="p">[</span><span class="n">Np_crit</span><span class="p">],</span><span class="n">calc_Np_crit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Determine critical mode i.e. mode with damping =0 when Np=Np_crit</span>
        <span class="n">crit_mode</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">crit_rslts</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span> <span class="o">=</span> <span class="n">crit_mode</span>
        
        <span class="c1"># Extract key properties of critical mode at Np=Np_crit</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">damped_freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">X_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">,:]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">C_mtrx_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">crit_mode</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">M_mtrx_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">crit_mode</span><span class="p">]</span>
                    
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Critical no. pedestrians, Np_crit:</span><span class="se">\t</span><span class="si">%.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Index of critical mode:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damped nat freq, critical mode:</span><span class="se">\t</span><span class="si">%.3f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damping ratio, critical mode:</span><span class="se">\t</span><span class="si">%.2e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">Np_crit</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#ped_dyn.LatSync_McRobie">LatSync_McRobie</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, modalsys, cp_func=None, mp_func=None, store_mtrxs=False, makePlots=False, verbose=True, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialise analysis</p>
<hr />
<p>Required:</p>
<ul>
<li><code>modalsys</code>, instance of <code>ModalSys</code> class, defining the modal 
  system to be analysed. For situations where TMDs are present, it is 
  assumed that TMDs have already been appended to the parent modal 
  system, e.g. by use of the <code>append_TMDs()</code> method in <code>damper.py</code>.</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li><code>cp_func</code>, function of form g(fn), where fn is frequency in Hz,
  to define how <em>negative</em> damping per pedestrian varies with frequency</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.__init__', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">modalsys</span><span class="p">,</span>
             <span class="n">cp_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">mp_func</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">store_mtrxs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">makePlots</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialise analysis</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `modalsys`, instance of `ModalSys` class, defining the modal </span>
<span class="sd">      system to be analysed. For situations where TMDs are present, it is </span>
<span class="sd">      assumed that TMDs have already been appended to the parent modal </span>
<span class="sd">      system, e.g. by use of the `append_TMDs()` method in `damper.py`.</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `cp_func`, function of form g(fn), where fn is frequency in Hz,</span>
<span class="sd">      to define how _negative_ damping per pedestrian varies with frequency</span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Initialising &#39;LatSync_McRobie&#39; analysis...&quot;</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">modalsys</span> <span class="o">=</span> <span class="n">modalsys</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Modal system that form the basis of this analysis. May have subsystems </span>
<span class="sd">    pre-appended (e.g. TMDs)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Defining pedestrian added damping function...&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">cp_func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Default cp(f) function will be used&quot;</span><span class="p">)</span>
        <span class="n">cp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_cp_func</span><span class="p">()</span>
        
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="nb">float</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;cp = </span><span class="si">%.1f</span><span class="s2"> will be used for all f&quot;</span> <span class="o">%</span> <span class="n">cp_func</span><span class="p">)</span>
        <span class="n">cp_val</span> <span class="o">=</span> <span class="n">cp_func</span>
        <span class="n">cp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="n">cp_val</span><span class="p">,</span><span class="n">cp_val</span><span class="p">],</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="n">cp_val</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">cp_func</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;User-supplied cp(f) function will be used&quot;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `cp_func` argument&quot;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span> <span class="o">=</span> <span class="n">cp_func</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to define how added damping per pedestrian varies with</span>
<span class="sd">    frequency. Function with single argument &#39;fn&#39; expected, </span>
<span class="sd">    i.e. cp = g(fn), cp in [Ns/m]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Defining pedestrian added mass function...&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">mp_func</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Default mp(f) function will be used&quot;</span><span class="p">)</span>
        <span class="n">mp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">init_mp_func</span><span class="p">()</span>
        
    <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">mp_func</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;mp = </span><span class="si">%.1f</span><span class="s2"> will be used for all f&quot;</span> <span class="o">%</span> <span class="n">mp_func</span><span class="p">)</span>
        <span class="n">mp_val</span> <span class="o">=</span> <span class="n">mp_func</span>
        <span class="n">mp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">],[</span><span class="n">mp_val</span><span class="p">,</span><span class="n">mp_val</span><span class="p">],</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="n">mp_val</span><span class="p">)</span>
        
    <span class="k">elif</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">mp_func</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;User-supplied mp(f) function will be used&quot;</span><span class="p">)</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `mp_func` argument&quot;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span> <span class="o">=</span> <span class="n">mp_func</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to define how added mass per pedestrian varies with</span>
<span class="sd">    frequency. Function with single argument &#39;fn&#39; expected, </span>
<span class="sd">    i.e. mp = g(fn), cp in [kg]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">store_mtrxs</span> <span class="o">=</span> <span class="n">store_mtrxs</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Boolean option, if True then system damping and stiffness matrices</span>
<span class="sd">    will be stored via nested list for all Np values and modes considered</span>
<span class="sd">    (this can result in a large amount of data being stored!)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Class variables defined later on</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ndarray of complex-valued eigenvalues of shape (N_Np,N_modes), where:</span>
<span class="sd">        </span>
<span class="sd">    * _N_Np_ is number of pedestrian cases considered</span>
<span class="sd">    </span>
<span class="sd">    * _N_modes_ is number of system matrix eigenmodes</span>
<span class="sd">    &quot;&quot;&quot;</span>
            
    <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ndarray of effective damping ratio for each mode and pedestrian </span>
<span class="sd">    count considered.</span>
<span class="sd">    </span>
<span class="sd">    _Ndarray shape as per eigenvalues above._</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ndarray of damped natural frequencies for each mode and pedestrian </span>
<span class="sd">    count considered.</span>
<span class="sd">    </span>
<span class="sd">    _Ndarray shape as per eigenvalues above._</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">eigenvectors</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ndarray of complex-valued eigenvalues of shape _(N_Np,N_modes,N_dof)_, </span>
<span class="sd">    where:</span>
<span class="sd">    * _N_Np_ is number of pedestrian cases considered</span>
<span class="sd">    </span>
<span class="sd">    * _N_modes_ is number of system matrix eigenmodes</span>
<span class="sd">    </span>
<span class="sd">    * _N_dof_ is the total number of degrees of freedom / state variables </span>
<span class="sd">      for the system analysed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Array listing the set of pedestrian numbers analysed</span>
<span class="sd">    &quot;&quot;&quot;</span>        
    
    <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ndarray of effective damping rate per pedestrian for each mode and </span>
<span class="sd">    pedestrian count considered.</span>
<span class="sd">    </span>
<span class="sd">    _Ndarray shape as per eigenvalues above._</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Ndarray of effective added mass per pedestrian for each mode and </span>
<span class="sd">    pedestrian count considered.</span>
<span class="sd">    </span>
<span class="sd">    _Ndarray shape as per eigenvalues above._</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Matrix to represent the smeared effect of one pedestrian on the deck</span>
<span class="sd">    Used to calculate additive system matrices due to pedestrians</span>
<span class="sd">    &quot;&quot;&quot;</span>
            
    <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Critical number of pedestrians to give zero net damping</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Index of (complex) eigenmode that loses stability at Np=Np_crit </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Damped natural frequency of mode that loses stability at Np=Np_crit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Effective damping ratio of mode that loses stability at Np=Np_crit</span>
<span class="sd">    (damping ratio = 0.00 expected)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complex-valued pole / eigenvalue at Np=Np_crit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">X_crit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Complex-valued eigenvector of mode that loses stability at Np=Np_crit</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_crit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Damping matrix (of &#39;parent&#39; modal system) applicable to mode that loses </span>
<span class="sd">    stability at Np=Np_crit.</span>
<span class="sd">    </span>
<span class="sd">    Will in general include off-diagonal terms due to mode coupling effect </span>
<span class="sd">    of pedestrians, determined per method presented in McRobie&#39;s paper  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_crit</span> <span class="o">=</span> <span class="bp">None</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Mass matrix (of &#39;parent&#39; modal system) applicable to mode that loses </span>
<span class="sd">    stability at Np=Np_crit.</span>
<span class="sd">    </span>
<span class="sd">    Will in general include off-diagonal terms due to mode coupling effect </span>
<span class="sd">    of pedestrians, determined per method presented in McRobie&#39;s paper  </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">makePlots</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_cp_func</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.calc_Np_crit">
    <p>def <span class="ident">calc_Np_crit</span>(</p><p>self, rerun_factor=2.0, verbose=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculates from results the critical number of pedestrians for the 
onset of pedestrian-induced lateral instability</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.calc_Np_crit', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.calc_Np_crit" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_Np_crit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">rerun_factor</span><span class="o">=</span><span class="mf">2.0</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates from results the critical number of pedestrians for the </span>
<span class="sd">    onset of pedestrian-induced lateral instability</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Determining critical number of pedestrians &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;for onset on instability...&quot;</span><span class="p">)</span>
    
    <span class="c1"># Check that analysis has been run</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s2">&quot;N_pedestrians&quot;</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Analysis does not appear to have been run!&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;Cannot calculate Np_crit&quot;</span><span class="p">)</span>
                            
    <span class="c1"># Check that analysis has been run up to pedestrian numbers such that </span>
    <span class="c1"># the net effective damping in (at least) one mode has become &lt;0.0</span>
    <span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">)</span>
    <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">)</span>
    
    <span class="k">while</span> <span class="n">min_damping</span> <span class="o">&gt;=</span> <span class="mf">0.0</span><span class="p">:</span>
             
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis has not identified net damping &lt; 0</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Analysis will be extended to larger pedestrian numbers&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get key details of Np analysed last time around</span>
        <span class="n">Np_max</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">)</span> <span class="c1"># max from last run</span>
        <span class="n">Np_min</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">)</span> <span class="c1"># min from last run</span>
        <span class="n">Np_step</span> <span class="o">=</span> <span class="p">(</span><span class="n">Np_max</span> <span class="o">-</span> <span class="n">Np_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span><span class="p">))</span>
        
        <span class="c1"># Define Np_vals for new analysis</span>
        <span class="n">new_Np_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">Np_max</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span><span class="n">Np_max</span><span class="o">*</span><span class="n">rerun_factor</span><span class="p">,</span><span class="n">Np_step</span><span class="p">)</span>
        
        <span class="c1"># Rerun analysis</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_run_analysis</span><span class="p">(</span><span class="n">new_Np_vals</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Recalculate minimum damping</span>
        <span class="n">damping_ratios</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">)</span>
        <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">)</span>
        
    <span class="c1"># Determine minumum damping ratio across all modes for each Np value</span>
    <span class="n">min_damping</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">damping_ratios</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Define interpolation function</span>
    <span class="n">Np_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span>
    
    <span class="n">Np_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">,</span>
                                         <span class="n">y</span><span class="o">=</span><span class="n">min_damping</span><span class="p">)</span>
                                  
    <span class="c1"># Use root finding function to obtain Np such that damping = 0.0</span>
    <span class="n">Np_crit</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">optimize</span><span class="o">.</span><span class="n">bisect</span><span class="p">(</span><span class="n">f</span><span class="o">=</span><span class="n">Np_func</span><span class="p">,</span><span class="n">a</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">b</span><span class="o">=</span><span class="n">Np_vals</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span> <span class="o">=</span> <span class="n">Np_crit</span>
    
    <span class="c1"># Rerun analysis to obtain properties at critical point</span>
    <span class="c1"># 1) take copy of class to pick up same attributes as analysis run</span>
    <span class="n">crit_rslts</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
    <span class="c1"># 2) Edit a few key properties for this purpose</span>
    <span class="n">crit_rslts</span><span class="o">.</span><span class="n">store_mtrxs</span> <span class="o">=</span> <span class="bp">True</span>
    <span class="c1"># 3) rerun to override results already held in the above object</span>
    <span class="n">crit_rslts</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">Np_vals</span><span class="o">=</span><span class="p">[</span><span class="n">Np_crit</span><span class="p">],</span><span class="n">calc_Np_crit</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="c1"># Determine critical mode i.e. mode with damping =0 when Np=Np_crit</span>
    <span class="n">crit_mode</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">crit_rslts</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">[</span><span class="mi">0</span><span class="p">,:])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span> <span class="o">=</span> <span class="n">crit_mode</span>
    
    <span class="c1"># Extract key properties of critical mode at Np=Np_crit</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">damped_freqs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">damping_ratios</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">eigenvalues</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">X_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">eigenvectors</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="n">crit_mode</span><span class="p">,:]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">C_mtrx_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">C_mtrx_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">crit_mode</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">M_mtrx_crit</span> <span class="o">=</span> <span class="n">crit_rslts</span><span class="o">.</span><span class="n">M_mtrx_list</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="n">crit_mode</span><span class="p">]</span>
                
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Critical no. pedestrians, Np_crit:</span><span class="se">\t</span><span class="si">%.0f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Index of critical mode:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">crit_mode</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damped nat freq, critical mode:</span><span class="se">\t</span><span class="si">%.3f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damping ratio, critical mode:</span><span class="se">\t</span><span class="si">%.2e</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">Np_crit</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.calc_pedestrian_effect">
    <p>def <span class="ident">calc_pedestrian_effect</span>(</p><p>self, f=1.0, num=1000)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculates modal damping matrix due to pedestrians, per the method 
presented in McRobie paper</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.calc_pedestrian_effect', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.calc_pedestrian_effect" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_pedestrian_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">f</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates modal damping matrix due to pedestrians, per the method </span>
<span class="sd">    presented in McRobie paper</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get system matrix to represent distributed action of pedestrians</span>
    <span class="c1"># along deck modeshapes</span>
    <span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span>
        
    <span class="k">if</span> <span class="n">ped_effect_mtrx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
        <span class="n">modalsys</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys</span>
        <span class="n">modeshape_func</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">modeshapeFunc</span>
        <span class="n">L</span> <span class="o">=</span> <span class="n">modalsys</span><span class="o">.</span><span class="n">Ltrack</span>
        
        <span class="c1"># Evaluate modeshape ordinates at unif</span>
        <span class="n">dL</span> <span class="o">=</span> <span class="n">L</span><span class="o">/</span><span class="n">num</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">num</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span> <span class="o">+</span> <span class="n">dL</span><span class="o">/</span><span class="mi">2</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="n">modeshape_func</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            
        <span class="c1"># Evaluate matrix product of modeshape ordinate matrices</span>
        <span class="n">phi_product</span> <span class="o">=</span> <span class="n">phi</span><span class="o">.</span><span class="n">T</span> <span class="err">@</span> <span class="n">phi</span>
        
        <span class="c1"># Return mode-generalised damping matrix</span>
        <span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="n">dL</span> <span class="o">/</span> <span class="n">L</span> <span class="o">*</span> <span class="n">phi_product</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">ped_effect_mtrx</span> <span class="o">=</span> <span class="n">ped_effect_mtrx</span>
    
    <span class="c1"># Evaluate cp and mp given mode natural frequency provided</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="c1"># positive frequencies to be used</span>
    <span class="n">cp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="n">mp</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    
    <span class="n">C_pa</span> <span class="o">=</span> <span class="n">cp</span> <span class="o">*</span> <span class="n">ped_effect_mtrx</span>
    <span class="n">M_pa</span> <span class="o">=</span> <span class="n">mp</span> <span class="o">*</span> <span class="n">ped_effect_mtrx</span>
    
    <span class="c1"># Return results as dict</span>
    <span class="n">rslts</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;C_pa&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">C_pa</span>
    <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;M_pa&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">M_pa</span>
    <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;cp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">cp</span>
    <span class="n">rslts</span><span class="p">[</span><span class="s1">&#39;mp&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">mp</span>
    <span class="k">return</span> <span class="n">rslts</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.init_cp_func">
    <p>def <span class="ident">init_cp_func</span>(</p><p>self, conservative=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialise default function to use to define frequency-dependence of 
effective added damping per pedestrian (Ns/m per pedestrian).</p>
<p>Note damping taken in conventional sense, such that positive values
define added damping i.e. increased attenuation of vibrations. 
Correspondingly the effect of pedestrians will tend to be represented 
by a negative damping rate.</p>
<p>This default profile has been defined with regards to the work done by
Dallard et al (2006) and John MacDonald (2008). The default curve 
defined within this function is taken to be a conservative 
representation of the damping values presented in Figure 9(a) of 
the latter's paper <em>"Lateral excitation of bridges by balancing 
pedestrians"</em></p>
<p>If <code>conservative=True</code> is used then the negative 300Ns/m value proposed 
by Dallard et al will be used. This value is taken to be independent 
of frequency.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.init_cp_func', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.init_cp_func" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">init_cp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">conservative</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialise default function to use to define frequency-dependence of </span>
<span class="sd">    effective added damping per pedestrian (Ns/m per pedestrian).</span>
<span class="sd">    </span>
<span class="sd">    Note damping taken in conventional sense, such that positive values</span>
<span class="sd">    define added damping i.e. increased attenuation of vibrations. </span>
<span class="sd">    Correspondingly the effect of pedestrians will tend to be represented </span>
<span class="sd">    by a negative damping rate.</span>
<span class="sd">    </span>
<span class="sd">    This default profile has been defined with regards to the work done by</span>
<span class="sd">    Dallard et al (2006) and John MacDonald (2008). The default curve </span>
<span class="sd">    defined within this function is taken to be a conservative </span>
<span class="sd">    representation of the damping values presented in Figure 9(a) of </span>
<span class="sd">    the latter&#39;s paper _&quot;Lateral excitation of bridges by balancing </span>
<span class="sd">    pedestrians&quot;_</span>
<span class="sd">    </span>
<span class="sd">    If `conservative=True` is used then the negative 300Ns/m value proposed </span>
<span class="sd">    by Dallard et al will be used. This value is taken to be independent </span>
<span class="sd">    of frequency.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">conservative</span><span class="p">:</span>
        <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">]</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">1.0</span><span class="p">,</span><span class="mf">1.5</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="o">-</span><span class="mi">300</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        
        
    <span class="n">cp_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                         <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                         <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">cp_func</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.init_mp_func">
    <p>def <span class="ident">init_mp_func</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialise default function to use to define frequency-dependence of 
effective added mass per pedestrian (kg per pedestrian)</p>
<p>The default curve defined within this function is taken to be a 
simplified representation of the added mass values presented in 
Figure 9(b) of John MacDonald's 2008 Proc. of the Royal Society paper 
<em>"Lateral excitation of bridges by balancing pedestrians"</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.init_mp_func', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.init_mp_func" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">init_mp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialise default function to use to define frequency-dependence of </span>
<span class="sd">    effective added mass per pedestrian (kg per pedestrian)</span>
<span class="sd">    </span>
<span class="sd">    The default curve defined within this function is taken to be a </span>
<span class="sd">    simplified representation of the added mass values presented in </span>
<span class="sd">    Figure 9(b) of John MacDonald&#39;s 2008 Proc. of the Royal Society paper </span>
<span class="sd">    _&quot;Lateral excitation of bridges by balancing pedestrians&quot;_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">f_vals</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.8</span><span class="p">,</span><span class="mf">1.25</span><span class="p">,</span><span class="mf">2.0</span><span class="p">]</span>
    <span class="n">deltaM_vals</span> <span class="o">=</span> <span class="p">[</span><span class="o">+</span><span class="mi">70</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span><span class="o">-</span><span class="mi">45</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
        
    <span class="n">deltaM_func</span> <span class="o">=</span> <span class="n">scipy</span><span class="o">.</span><span class="n">interpolate</span><span class="o">.</span><span class="n">interp1d</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">deltaM_vals</span><span class="p">,</span>
                                             <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span>
                                             <span class="n">bounds_error</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                             <span class="n">fill_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">deltaM_func</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.plot_cp_func">
    <p>def <span class="ident">plot_cp_func</span>(</p><p>self, ax=None, f_vals=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots function defining how negative damping per pedestrian varies 
with frequency</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.plot_cp_func', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.plot_cp_func" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_cp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">f_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots function defining how negative damping per pedestrian varies </span>
<span class="sd">    with frequency</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">cp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_func</span>
    
    <span class="k">if</span> <span class="n">f_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cp_func</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
            <span class="n">f_vals</span> <span class="o">=</span> <span class="n">cp_func</span><span class="o">.</span><span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`f_vals` must be provided!&quot;</span><span class="p">)</span>
            
    <span class="n">cp_vals</span> <span class="o">=</span> <span class="n">cp_func</span><span class="p">(</span><span class="n">f_vals</span><span class="p">)</span>
       
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Defined $c_p(f)$ function&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$c_p$ (Ns/m)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damping rate per pedestrian, $c_p$&quot;</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;cp_vals&#39;</span><span class="p">):</span>
        <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>
        <span class="n">cp_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cp_vals</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd_vals</span><span class="p">,</span><span class="n">cp_vals</span><span class="p">,</span><span class="s1">&#39;r|&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$c_p$ values for modes&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.plot_damping_vs_freq">
    <p>def <span class="ident">plot_damping_vs_freq</span>(</p><p>self, ax=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot damping ratio against damped natural frequency
(per Figure 5 in McRobie's paper)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.plot_damping_vs_freq', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.plot_damping_vs_freq" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_damping_vs_freq</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;            </span>
<span class="sd">    Plot damping ratio against damped natural frequency</span>
<span class="sd">    (per Figure 5 in McRobie&#39;s paper)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    
    <span class="n">eta_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span>
    <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">,</span><span class="n">fd_vals</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span><span class="n">fd_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">],</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">eta_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">fd_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1"># denotes stability limit</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">0.0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damped natural frequency (Hz)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Frequency vs Effective Damping</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">fd_crit</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.plot_damping_vs_pedestrians">
    <p>def <span class="ident">plot_damping_vs_pedestrians</span>(</p><p>self, ax=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots effective damping ratio of poles against number of pedestrians</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.plot_damping_vs_pedestrians', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.plot_damping_vs_pedestrians" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_damping_vs_pedestrians</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots effective damping ratio of poles against number of pedestrians</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">Np_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">N_pedestrians</span>
    <span class="n">eta_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damping_ratios</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">eta_vals</span><span class="p">,</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Number of pedestrians&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Effective damping ratio&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Effect of pedestrians on effective damping&quot;</span><span class="p">)</span>
    
    <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">Np_crit</span>
    <span class="k">if</span> <span class="n">Np_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">Np_crit</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Np_crit</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">eta_crit</span><span class="p">,</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.plot_mp_func">
    <p>def <span class="ident">plot_mp_func</span>(</p><p>self, ax=None, f_vals=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots function defining how negative damping per pedestrian varies 
with frequency</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.plot_mp_func', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.plot_mp_func" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_mp_func</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">f_vals</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots function defining how negative damping per pedestrian varies </span>
<span class="sd">    with frequency</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">mp_func</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_func</span>
    
    <span class="k">if</span> <span class="n">f_vals</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">mp_func</span><span class="p">,</span><span class="s1">&#39;x&#39;</span><span class="p">):</span>
            <span class="n">f_vals</span> <span class="o">=</span> <span class="n">mp_func</span><span class="o">.</span><span class="n">x</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`f_vals` must be provided!&quot;</span><span class="p">)</span>
            
    <span class="n">mp_vals</span> <span class="o">=</span> <span class="n">mp_func</span><span class="p">(</span><span class="n">f_vals</span><span class="p">)</span>
       
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
        
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">f_vals</span><span class="p">,</span><span class="n">mp_vals</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="s1">&#39;Defined $m_p(f)$ function&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mi">100</span><span class="p">,</span><span class="o">+</span><span class="mi">100</span><span class="p">])</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Frequency (Hz)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$\Delta M$ (kg)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Added mass per pedestrian, $\Delta M$&quot;</span><span class="p">)</span>
            
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="s1">&#39;mp_vals&#39;</span><span class="p">):</span>
        <span class="n">fd_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">damped_freqs</span>
        <span class="n">mp_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mp_vals</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">fd_vals</span><span class="p">,</span><span class="n">mp_vals</span><span class="p">,</span><span class="s1">&#39;r|&#39;</span><span class="p">)</span>
        
        <span class="k">for</span> <span class="n">m</span><span class="p">,</span> <span class="n">line</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">lines</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">m</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">line</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;$\Delta M$ values for modes&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.plot_poles">
    <p>def <span class="ident">plot_poles</span>(</p><p>self, ax=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot eigenvalues (poles) on complex plane
(per Figure 4 in paper)</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.plot_poles', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.plot_poles" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_poles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot eigenvalues (poles) on complex plane</span>
<span class="sd">    (per Figure 4 in paper)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">get_figure</span><span class="p">()</span>
    
    <span class="n">s_vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">eigenvalues</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">),</span><span class="s1">&#39;k.&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[::</span><span class="mi">10</span><span class="p">]),</span><span class="s1">&#39;ko&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">1.5</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_vals</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="s1">&#39;bo&#39;</span><span class="p">,</span><span class="n">markersize</span><span class="o">=</span><span class="mf">3.0</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> <span class="c1"># stability limit</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span> <span class="c1"># illustrates Im(z)=0 axis</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Real(s)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Imag(s)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Eigenvalues of system state matrix&quot;</span><span class="p">)</span>
    
    <span class="n">s_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">s_crit</span>
    <span class="k">if</span> <span class="n">s_crit</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">real</span><span class="p">(</span><span class="n">s_crit</span><span class="p">),</span><span class="n">imag</span><span class="p">(</span><span class="n">s_crit</span><span class="p">),</span><span class="s1">&#39;r.&#39;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.plot_results">
    <p>def <span class="ident">plot_results</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots results from the above analysis</p>
<p>N.b: Figures intentionally emulate the format of figures in 
McRobie's paper, as these have been used to validate the above routine</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.plot_results', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.plot_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots results from the above analysis</span>
<span class="sd">    </span>
<span class="sd">    N.b: Figures intentionally emulate the format of figures in </span>
<span class="sd">    McRobie&#39;s paper, as these have been used to validate the above routine</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">9</span><span class="p">))</span>
    
    <span class="n">gs</span> <span class="o">=</span> <span class="n">gridspec</span><span class="o">.</span><span class="n">GridSpec</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">height_ratios</span><span class="o">=</span><span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">gs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.7</span><span class="p">)</span>
    
    <span class="c1"># Prepare subplots</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_damping_vs_freq</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_poles</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">:,</span> <span class="mi">0</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_damping_vs_pedestrians</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    
    <span class="n">ax1</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_cp_func</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax1</span><span class="p">)</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="n">gs</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span><span class="n">sharex</span> <span class="o">=</span> <span class="n">ax1</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_mp_func</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.LatSync_McRobie.run">
    <p>def <span class="ident">run</span>(</p><p>self, Np_vals, verbose=True, calc_Np_crit=True, append_rslts=False, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Run analysis to explore eigenvalues of system state matrix for various 
assumed pedestrian crowd densities</p>
<hr />
<p>Required:</p>
<ul>
<li><code>Np_vals</code>, <em>array-like</em>: each value defines total number of 
  pedestrians on bridge; a range of values will typically be provided, 
  to allow exploration of how system eigenproperties (in particular 
  effective damping) varies with pedestrian numbers</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.LatSync_McRobie.run', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.LatSync_McRobie.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">calc_Np_crit</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">append_rslts</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run analysis to explore eigenvalues of system state matrix for various </span>
<span class="sd">    assumed pedestrian crowd densities</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">        </span>
<span class="sd">    * `Np_vals`, _array-like_: each value defines total number of </span>
<span class="sd">      pedestrians on bridge; a range of values will typically be provided, </span>
<span class="sd">      to allow exploration of how system eigenproperties (in particular </span>
<span class="sd">      effective damping) varies with pedestrian numbers</span>
<span class="sd">     </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running lat sync eigenvalues analysis...&quot;</span><span class="p">)</span>

    <span class="c1"># Run analysis </span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_run_analysis</span><span class="p">(</span><span class="n">Np_vals</span><span class="p">,</span><span class="n">append_rslts</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="c1"># Calculate critical number of pedestrians for onset on instability</span>
    <span class="k">if</span> <span class="n">calc_Np_crit</span><span class="p">:</span>
        <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_Np_crit</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">Np_crit</span> <span class="o">=</span> <span class="bp">None</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis complete!&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">Np_crit</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.C_mtrx_crit" class="name">var <span class="ident">C_mtrx_crit</span></p>
            

            
  
    <div class="desc"><p>Damping matrix (of 'parent' modal system) applicable to mode that loses 
stability at Np=Np_crit.</p>
<p>Will in general include off-diagonal terms due to mode coupling effect 
of pedestrians, determined per method presented in McRobie's paper</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.M_mtrx_crit" class="name">var <span class="ident">M_mtrx_crit</span></p>
            

            
  
    <div class="desc"><p>Mass matrix (of 'parent' modal system) applicable to mode that loses 
stability at Np=Np_crit.</p>
<p>Will in general include off-diagonal terms due to mode coupling effect 
of pedestrians, determined per method presented in McRobie's paper</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.N_pedestrians" class="name">var <span class="ident">N_pedestrians</span></p>
            

            
  
    <div class="desc"><p>Array listing the set of pedestrian numbers analysed</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.Np_crit" class="name">var <span class="ident">Np_crit</span></p>
            

            
  
    <div class="desc"><p>Critical number of pedestrians to give zero net damping</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.X_crit" class="name">var <span class="ident">X_crit</span></p>
            

            
  
    <div class="desc"><p>Complex-valued eigenvector of mode that loses stability at Np=Np_crit</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.cp_func" class="name">var <span class="ident">cp_func</span></p>
            

            
  
    <div class="desc"><p>Function to define how added damping per pedestrian varies with
frequency. Function with single argument 'fn' expected, 
i.e. cp = g(fn), cp in [Ns/m]</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.cp_vals" class="name">var <span class="ident">cp_vals</span></p>
            

            
  
    <div class="desc"><p>Ndarray of effective damping rate per pedestrian for each mode and 
pedestrian count considered.</p>
<p><em>Ndarray shape as per eigenvalues above.</em></p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.crit_mode" class="name">var <span class="ident">crit_mode</span></p>
            

            
  
    <div class="desc"><p>Index of (complex) eigenmode that loses stability at Np=Np_crit</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.damped_freqs" class="name">var <span class="ident">damped_freqs</span></p>
            

            
  
    <div class="desc"><p>Ndarray of damped natural frequencies for each mode and pedestrian 
count considered.</p>
<p><em>Ndarray shape as per eigenvalues above.</em></p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.damping_ratios" class="name">var <span class="ident">damping_ratios</span></p>
            

            
  
    <div class="desc"><p>Ndarray of effective damping ratio for each mode and pedestrian 
count considered.</p>
<p><em>Ndarray shape as per eigenvalues above.</em></p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.eigenvalues" class="name">var <span class="ident">eigenvalues</span></p>
            

            
  
    <div class="desc"><p>Ndarray of complex-valued eigenvalues of shape (N_Np,N_modes), where:</p>
<ul>
<li>
<p><em>N_Np</em> is number of pedestrian cases considered</p>
</li>
<li>
<p><em>N_modes</em> is number of system matrix eigenmodes</p>
</li>
</ul></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.eigenvectors" class="name">var <span class="ident">eigenvectors</span></p>
            

            
  
    <div class="desc"><p>Ndarray of complex-valued eigenvalues of shape <em>(N_Np,N_modes,N_dof)</em>, 
where:
* <em>N_Np</em> is number of pedestrian cases considered</p>
<ul>
<li>
<p><em>N_modes</em> is number of system matrix eigenmodes</p>
</li>
<li>
<p><em>N_dof</em> is the total number of degrees of freedom / state variables 
  for the system analysed</p>
</li>
</ul></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.eta_crit" class="name">var <span class="ident">eta_crit</span></p>
            

            
  
    <div class="desc"><p>Effective damping ratio of mode that loses stability at Np=Np_crit
(damping ratio = 0.00 expected)</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.fd_crit" class="name">var <span class="ident">fd_crit</span></p>
            

            
  
    <div class="desc"><p>Damped natural frequency of mode that loses stability at Np=Np_crit</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.modalsys" class="name">var <span class="ident">modalsys</span></p>
            

            
  
    <div class="desc"><p>Modal system that form the basis of this analysis. May have subsystems 
pre-appended (e.g. TMDs)</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.mp_func" class="name">var <span class="ident">mp_func</span></p>
            

            
  
    <div class="desc"><p>Function to define how added mass per pedestrian varies with
frequency. Function with single argument 'fn' expected, 
i.e. mp = g(fn), cp in [kg]</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.mp_vals" class="name">var <span class="ident">mp_vals</span></p>
            

            
  
    <div class="desc"><p>Ndarray of effective added mass per pedestrian for each mode and 
pedestrian count considered.</p>
<p><em>Ndarray shape as per eigenvalues above.</em></p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.ped_effect_mtrx" class="name">var <span class="ident">ped_effect_mtrx</span></p>
            

            
  
    <div class="desc"><p>Matrix to represent the smeared effect of one pedestrian on the deck
Used to calculate additive system matrices due to pedestrians</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.s_crit" class="name">var <span class="ident">s_crit</span></p>
            

            
  
    <div class="desc"><p>Complex-valued pole / eigenvalue at Np=Np_crit</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.LatSync_McRobie.store_mtrxs" class="name">var <span class="ident">store_mtrxs</span></p>
            

            
  
    <div class="desc"><p>Boolean option, if True then system damping and stiffness matrices
will be stored via nested list for all Np values and modes considered
(this can result in a large amount of data being stored!)</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="ped_dyn.PedestrianDynamics_transientAnalyses" class="name">class <span class="ident">PedestrianDynamics_transientAnalyses</span></p>
      
  
    <div class="desc"><p>Implements the full set of analyses required to fully-implement the 
method given in NA.2.44.4 of UK NA to BS EN 1991-2
i.e. transient analyses for both walkers and joggers, for all modes</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.PedestrianDynamics_transientAnalyses', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.PedestrianDynamics_transientAnalyses" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">PedestrianDynamics_transientAnalyses</span><span class="p">(</span><span class="n">dyn_analysis</span><span class="o">.</span><span class="n">Multiple</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements the full set of analyses required to fully-implement the </span>
<span class="sd">    method given in NA.2.44.4 of UK NA to BS EN 1991-2</span>
<span class="sd">    i.e. transient analyses for both walkers and joggers, for all modes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        ****</span>
<span class="sd">        </span>
<span class="sd">        Required:</span>
<span class="sd">          </span>
<span class="sd">        * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `bridgeClass`, _string_, either &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, or &#39;D&#39;. </span>
<span class="sd">          Refer Table NA.7 for description of bridge classes</span>
<span class="sd">          </span>
<span class="sd">        Additional keyword arguments may be passed. These should relate to the </span>
<span class="sd">        `__init__()` function of the `Multiple` class.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get mode indexs to loop over</span>
        <span class="c1"># Note modes sorted into ascending frequency but in conjugate pairs</span>
        <span class="c1"># Hence step through modes x2</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetSystemMatrices</span><span class="p">()[</span><span class="s2">&quot;nDOF&quot;</span><span class="p">]</span>
        <span class="n">mode_index_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nModes</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        
        <span class="c1"># Run parent init function</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">classDef</span><span class="o">=</span><span class="n">UKNA_BSEN1991_2_walkers_joggers</span><span class="p">,</span>
                         <span class="n">dynsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                         <span class="n">bridgeClass</span><span class="o">=</span><span class="n">bridgeClass</span><span class="p">,</span>
                         <span class="n">mode_index</span><span class="o">=</span><span class="n">mode_index_list</span><span class="p">,</span>
                         <span class="n">analysis_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span><span class="s2">&quot;joggers&quot;</span><span class="p">],</span>
                         <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="c1"># Save key variables as attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
        
        
    <span class="k">def</span> <span class="nf">plot_modal_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
        
        <span class="c1"># Get modal properties as used in analyses</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">fv</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
        <span class="n">eta</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">eta</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
        
        <span class="c1"># Plot details of system</span>
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$f_{d}$ (Hz)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies&quot;</span><span class="p">)</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">eta</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s1">&#39;{:.1%}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> 
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Modal damping&quot;</span><span class="p">)</span>
        
        <span class="c1"># Add equivilent axis for log dec</span>
        <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
        
        <span class="k">def</span> <span class="nf">logdec</span><span class="p">(</span><span class="n">eta</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
        
        <span class="n">delta_incr</span> <span class="o">=</span> <span class="mf">0.01</span>
        <span class="n">new_yticks</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">delta_incr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
        
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">logdec</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)])</span>
        <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Log decrement $\delta$&quot;</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
    
    
    <span class="k">def</span> <span class="nf">plot_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">dynsys2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">responses2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots statistics of responses computed, across all analyses</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `dynsys2plot`, list of subsystem objects to plot responses </span>
<span class="sd">          for. If None (default) responses will be plotted for all </span>
<span class="sd">          subsystems</span>
<span class="sd">            </span>
<span class="sd">        * `responses2plot`, list of indices specifying responses to be</span>
<span class="sd">          plotted. If None (default) all responses will be plotted, for</span>
<span class="sd">          each sub-system</span>
<span class="sd">          </span>
<span class="sd">        * `sharey`, passed to pyplot.subplots() method. Controls whether </span>
<span class="sd">          subplots should share common y scale.</span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting response statistics...&quot;</span><span class="p">)</span>
        
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
        <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
        
        <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">if</span> <span class="n">dynsys2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dynsys2plot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dynsys2plot&#39; does not belong &quot;</span> <span class="o">+</span> 
                                 <span class="s2">&quot;to system analysed!&quot;</span><span class="p">)</span>
                
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dynsys2plot</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
                <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">dynsys2plot</span><span class="p">]</span>
            
        <span class="c1"># Loop over all systems and subsystems</span>
        <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">dynsys2plot</span><span class="p">:</span>
            
            <span class="c1"># Get stats dict relating to this system</span>
            <span class="n">stats_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span>
            
            <span class="c1"># Get indices of responses to plot</span>
            <span class="n">response_names</span> <span class="o">=</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names</span>
            
            <span class="k">if</span> <span class="n">responses2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
                <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_names</span><span class="p">)</span>
                <span class="n">responses2plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nResponses</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">)</span>
            
            <span class="c1"># Create new figure</span>
            <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nResponses</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
                                      <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                      <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
            <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
            <span class="c1"># Loop to plot all responses requested</span>
            <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">):</span>
                
                <span class="n">response_name</span> <span class="o">=</span> <span class="n">response_names</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
                
                <span class="c1"># Get stats for this response</span>
                <span class="n">stats_dict_r</span> <span class="o">=</span> <span class="p">{}</span>
                
                <span class="k">for</span> <span class="n">stats_name</span><span class="p">,</span> <span class="n">stats_vals</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    
                    <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">=</span><span class="n">stats_vals</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
            
                <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting stats for response &#39;</span><span class="si">%s</span><span class="s2">&#39;:&quot;</span> <span class="o">%</span> <span class="n">response_name</span><span class="p">)</span>
                
                <span class="c1"># Plot response stats for walkers and joggers responses</span>
                
                <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s1">&#39;walkers&#39;</span><span class="p">,</span><span class="s1">&#39;joggers&#39;</span><span class="p">]):</span>
                    
                    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
                    
                    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">]):</span>
                    
                        <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">][</span><span class="n">col</span><span class="p">,:]</span>
                        
                        <span class="n">w</span><span class="o">=</span><span class="mf">0.1</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                               <span class="n">stats_vals</span><span class="p">,</span>
                               <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                               <span class="n">label</span><span class="o">=</span><span class="n">stats_name</span>
                               <span class="p">)</span>
    
                    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
                    
                    <span class="k">if</span> <span class="n">col</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">response_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Responses to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">case</span><span class="p">)</span>
                        
                    <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="n">nResponses</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
                        <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
                        
                
            
            <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Statistics of computed responses to pedestrian loading</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;UK NA to BS EN 1991-2, NA.2.44.4</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;Subsystem: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">fontsize</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
    
        <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#ped_dyn.PedestrianDynamics_transientAnalyses">PedestrianDynamics_transientAnalyses</a></li>
          <li>dyn_analysis.Multiple</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="ped_dyn.PedestrianDynamics_transientAnalyses.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, modalsys_obj, bridgeClass=&#39;A&#39;, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Required:</p>
<ul>
<li><code>modalsys_obj</code>, modal system to which analysis relates</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li><code>bridgeClass</code>, <em>string</em>, either 'A', 'B', 'C', or 'D'. 
  Refer Table NA.7 for description of bridge classes</li>
</ul>
<p>Additional keyword arguments may be passed. These should relate to the 
<code>__init__()</code> function of the <code>Multiple</code> class.</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.PedestrianDynamics_transientAnalyses.__init__', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.PedestrianDynamics_transientAnalyses.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">modalsys_obj</span><span class="p">,</span>
             <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    ****</span>
<span class="sd">    </span>
<span class="sd">    Required:</span>
<span class="sd">      </span>
<span class="sd">    * `modalsys_obj`, modal system to which analysis relates</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `bridgeClass`, _string_, either &#39;A&#39;, &#39;B&#39;, &#39;C&#39;, or &#39;D&#39;. </span>
<span class="sd">      Refer Table NA.7 for description of bridge classes</span>
<span class="sd">      </span>
<span class="sd">    Additional keyword arguments may be passed. These should relate to the </span>
<span class="sd">    `__init__()` function of the `Multiple` class.</span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get mode indexs to loop over</span>
    <span class="c1"># Note modes sorted into ascending frequency but in conjugate pairs</span>
    <span class="c1"># Hence step through modes x2</span>
    <span class="n">nModes</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetSystemMatrices</span><span class="p">()[</span><span class="s2">&quot;nDOF&quot;</span><span class="p">]</span>
    <span class="n">mode_index_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="o">*</span><span class="n">nModes</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="c1"># Run parent init function</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">classDef</span><span class="o">=</span><span class="n">UKNA_BSEN1991_2_walkers_joggers</span><span class="p">,</span>
                     <span class="n">dynsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                     <span class="n">bridgeClass</span><span class="o">=</span><span class="n">bridgeClass</span><span class="p">,</span>
                     <span class="n">mode_index</span><span class="o">=</span><span class="n">mode_index_list</span><span class="p">,</span>
                     <span class="n">analysis_type</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span><span class="s2">&quot;joggers&quot;</span><span class="p">],</span>
                     <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="c1"># Save key variables as attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.PedestrianDynamics_transientAnalyses.collate_stats">
    <p>def <span class="ident">collate_stats</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Collates computed statistics into a dict of ndarrays, to faciliate 
efficient slicing operations, for example</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.PedestrianDynamics_transientAnalyses.collate_stats', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.PedestrianDynamics_transientAnalyses.collate_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">collate_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Collates computed statistics into a dict of ndarrays, to faciliate </span>
<span class="sd">    efficient slicing operations, for example</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating statistics...&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get list of all tstep_results objects associate with Multiple()</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;self.results_arr=None! No results to collate!&quot;</span><span class="p">)</span>
    
    <span class="n">results_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span><span class="p">)</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span> <span class="o">=</span> <span class="s1">&#39;max&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function to collate specified stats, across all results objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Loop over all tstep_results objects</span>
        <span class="n">stats_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">results_obj</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">results_list</span><span class="p">):</span>
            
            <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">results_obj</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span> <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
                <span class="n">stats_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">stats_vals</span><span class="p">)</span>
        
        <span class="c1"># Flatten nested list</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">stats_list</span><span class="p">)</span>
        
        <span class="c1"># Reshape as ndarray</span>
        <span class="n">newshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span> <span class="o">+</span> <span class="p">(</span><span class="n">nResponses</span><span class="p">,)</span>
        <span class="n">arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span><span class="n">newshape</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;`{0}` stats saved as {1} ndarray&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_name</span><span class="p">,</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
        
        <span class="k">return</span> <span class="n">arr</span>
    
    <span class="c1"># Loop over all systems and subsystems</span>
    <span class="n">stats_dict_outer</span><span class="o">=</span><span class="p">{}</span>
    
    <span class="n">DynSys_list</span> <span class="o">=</span> <span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
    
    <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">DynSys_list</span><span class="p">:</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Collating response stats for system &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>

        <span class="c1"># Loop over all response stats types, e.g. &#39;max&#39;, &#39;min&#39; etc.</span>
        <span class="n">stats_dict_inner</span><span class="o">=</span><span class="p">{}</span>
        <span class="n">stats_names_list</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">results_list</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">response_stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        
        <span class="k">for</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="n">stats_names_list</span><span class="p">:</span>
            
            <span class="n">stats_dict_inner</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">collate_specified_stats</span><span class="p">(</span><span class="n">stats_name</span><span class="p">)</span>
            
        <span class="n">stats_dict_outer</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span> <span class="o">=</span> <span class="n">stats_dict_inner</span>
            
    <span class="c1"># Save as attribute</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="o">=</span> <span class="n">stats_dict_outer</span>
    
    <span class="k">return</span> <span class="n">stats_dict_outer</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.PedestrianDynamics_transientAnalyses.plot_modal_params">
    <p>def <span class="ident">plot_modal_params</span>(</p><p>self)</p>
    </div>
    

    
  
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.PedestrianDynamics_transientAnalyses.plot_modal_params', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.PedestrianDynamics_transientAnalyses.plot_modal_params" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_modal_params</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span><span class="n">right</span><span class="o">=</span><span class="mf">0.8</span><span class="p">)</span>
    
    <span class="c1"># Get modal properties as used in analyses</span>
    <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    <span class="n">fv</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">fv</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
    <span class="n">eta</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">eta</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">][:</span><span class="n">nModes</span><span class="p">]</span>
    
    <span class="c1"># Plot details of system</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">fv</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;$f_{d}$ (Hz)&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies&quot;</span><span class="p">)</span>
    
    <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">eta</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Damping ratio&quot;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">FuncFormatter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">y</span><span class="p">,</span> <span class="n">_</span><span class="p">:</span> <span class="s1">&#39;{:.1%}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">y</span><span class="p">)))</span> 
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Modal damping&quot;</span><span class="p">)</span>
    
    <span class="c1"># Add equivilent axis for log dec</span>
    <span class="n">ax2</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">twinx</span><span class="p">()</span>
    
    <span class="k">def</span> <span class="nf">logdec</span><span class="p">(</span><span class="n">eta</span><span class="p">):</span>
        <span class="k">return</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
    
    <span class="n">delta_incr</span> <span class="o">=</span> <span class="mf">0.01</span>
    <span class="n">new_yticks</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">],</span><span class="n">delta_incr</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span>
    
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">())</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_yticklabels</span><span class="p">([</span><span class="s2">&quot;</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">d</span> <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">logdec</span><span class="p">(</span><span class="n">new_yticks</span><span class="p">)])</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Log decrement $\delta$&quot;</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.PedestrianDynamics_transientAnalyses.plot_response_stats">
    <p>def <span class="ident">plot_response_stats</span>(</p><p>self, dynsys2plot=None, responses2plot=None, sharey=&#39;row&#39;, verbose=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots statistics of responses computed, across all analyses</p>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>dynsys2plot</code>, list of subsystem objects to plot responses 
  for. If None (default) responses will be plotted for all 
  subsystems</p>
</li>
<li>
<p><code>responses2plot</code>, list of indices specifying responses to be
  plotted. If None (default) all responses will be plotted, for
  each sub-system</p>
</li>
<li>
<p><code>sharey</code>, passed to pyplot.subplots() method. Controls whether 
  subplots should share common y scale.</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.PedestrianDynamics_transientAnalyses.plot_response_stats', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.PedestrianDynamics_transientAnalyses.plot_response_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">dynsys2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">responses2plot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots statistics of responses computed, across all analyses</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `dynsys2plot`, list of subsystem objects to plot responses </span>
<span class="sd">      for. If None (default) responses will be plotted for all </span>
<span class="sd">      subsystems</span>
<span class="sd">        </span>
<span class="sd">    * `responses2plot`, list of indices specifying responses to be</span>
<span class="sd">      plotted. If None (default) all responses will be plotted, for</span>
<span class="sd">      each sub-system</span>
<span class="sd">      </span>
<span class="sd">    * `sharey`, passed to pyplot.subplots() method. Controls whether </span>
<span class="sd">      subplots should share common y scale.</span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting response statistics...&quot;</span><span class="p">)</span>
    
    <span class="n">nModes</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">mode_index</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">nModes</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">+</span><span class="mi">1</span>
    
    <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">if</span> <span class="n">dynsys2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">dynsys2plot</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">DynSys_list</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;dynsys2plot&#39; does not belong &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;to system analysed!&quot;</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">dynsys2plot</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>
            <span class="n">dynsys2plot</span> <span class="o">=</span> <span class="p">[</span><span class="n">dynsys2plot</span><span class="p">]</span>
        
    <span class="c1"># Loop over all systems and subsystems</span>
    <span class="k">for</span> <span class="n">dynsys_obj</span> <span class="ow">in</span> <span class="n">dynsys2plot</span><span class="p">:</span>
        
        <span class="c1"># Get stats dict relating to this system</span>
        <span class="n">stats_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">dynsys_obj</span><span class="p">]</span>
        
        <span class="c1"># Get indices of responses to plot</span>
        <span class="n">response_names</span> <span class="o">=</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names</span>
        
        <span class="k">if</span> <span class="n">responses2plot</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">response_names</span><span class="p">)</span>
            <span class="n">responses2plot</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">nResponses</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">nResponses</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">)</span>
        
        <span class="c1"># Create new figure</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nResponses</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span>
                                  <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                                  <span class="n">sharey</span><span class="o">=</span><span class="n">sharey</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="c1"># Loop to plot all responses requested</span>
        <span class="k">for</span> <span class="n">row</span><span class="p">,</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">responses2plot</span><span class="p">):</span>
            
            <span class="n">response_name</span> <span class="o">=</span> <span class="n">response_names</span><span class="p">[</span><span class="n">r</span><span class="p">]</span>
            
            <span class="c1"># Get stats for this response</span>
            <span class="n">stats_dict_r</span> <span class="o">=</span> <span class="p">{}</span>
            
            <span class="k">for</span> <span class="n">stats_name</span><span class="p">,</span> <span class="n">stats_vals</span> <span class="ow">in</span> <span class="n">stats_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                
                <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">]</span><span class="o">=</span><span class="n">stats_vals</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
        
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Plotting stats for response &#39;</span><span class="si">%s</span><span class="s2">&#39;:&quot;</span> <span class="o">%</span> <span class="n">response_name</span><span class="p">)</span>
            
            <span class="c1"># Plot response stats for walkers and joggers responses</span>
            
            <span class="k">for</span> <span class="n">col</span><span class="p">,</span> <span class="n">case</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],[</span><span class="s1">&#39;walkers&#39;</span><span class="p">,</span><span class="s1">&#39;joggers&#39;</span><span class="p">]):</span>
                
                <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">row</span><span class="p">,</span><span class="n">col</span><span class="p">]</span>
                
                <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">stats_name</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span><span class="s1">&#39;max&#39;</span><span class="p">,</span><span class="s1">&#39;min&#39;</span><span class="p">]):</span>
                
                    <span class="n">stats_vals</span> <span class="o">=</span> <span class="n">stats_dict_r</span><span class="p">[</span><span class="n">stats_name</span><span class="p">][</span><span class="n">col</span><span class="p">,:]</span>
                    
                    <span class="n">w</span><span class="o">=</span><span class="mf">0.1</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="p">(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">w</span><span class="p">,</span>
                           <span class="n">stats_vals</span><span class="p">,</span>
                           <span class="n">width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span>
                           <span class="n">label</span><span class="o">=</span><span class="n">stats_name</span>
                           <span class="p">)</span>

                <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mf">6.0</span><span class="p">)</span>
                
                <span class="k">if</span> <span class="n">col</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">response_name</span><span class="p">,</span><span class="n">size</span><span class="o">=</span><span class="mf">8.0</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Responses to </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">case</span><span class="p">)</span>
                    
                <span class="k">if</span> <span class="n">row</span><span class="o">==</span><span class="n">nResponses</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Mode index&quot;</span><span class="p">)</span>
                    <span class="n">ax</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">mode_index</span><span class="p">)</span>
                    
            
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Statistics of computed responses to pedestrian loading</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;UK NA to BS EN 1991-2, NA.2.44.4</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;Subsystem: &#39;</span><span class="si">%s</span><span class="s2">&#39;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
                     <span class="n">fontsize</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.PedestrianDynamics_transientAnalyses.plot_stats">
    <p>def <span class="ident">plot_stats</span>(</p><p>self, stat_name=&#39;absmax&#39;, key2plot=&#39;loadVel&#39;, xConversionFactor=1.0, xlabel=None, figsize_inches=(14, 8))</p>
    </div>
    

    
  
    <div class="desc"><p>Produces a plot of a given taken across multiple analyses</p>
<p>Optional:</p>
<ul>
<li><code>stat_name</code>, name of statistic to be plotted</li>
<li><code>key2plot</code>, name of key within <code>vals2permute</code> dict to be used
  as x-axis in plot</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.PedestrianDynamics_transientAnalyses.plot_stats', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.PedestrianDynamics_transientAnalyses.plot_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">stat_name</span><span class="o">=</span><span class="s1">&#39;absmax&#39;</span><span class="p">,</span>
               <span class="n">key2plot</span><span class="o">=</span><span class="s1">&#39;loadVel&#39;</span><span class="p">,</span>
               <span class="n">xConversionFactor</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
               <span class="n">xlabel</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
               <span class="n">figsize_inches</span><span class="o">=</span><span class="p">(</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">)):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produces a plot of a given taken across multiple analyses</span>
<span class="sd">    </span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * `stat_name`, name of statistic to be plotted</span>
<span class="sd">    * `key2plot`, name of key within `vals2permute` dict to be used</span>
<span class="sd">      as x-axis in plot</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;UNFINISHED: DO NOT USE!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Re-collate statistics as required</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
        
    <span class="c1"># Check requested stats is in dict</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">stat_name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid statistic selected!&quot;</span><span class="p">)</span>
        
    <span class="c1"># Obtain responses names</span>
    <span class="n">responseNames</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">output_names_list</span>
    <span class="k">print</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
    
    <span class="c1"># Get index and value to use along x-axis</span>
    <span class="c1">#kwargs2permute = list(self.vals2permute.keys())</span>
    <span class="c1">#key2plot_index=[i for i, x in enumerate(kwargs2permute) if x==key2plot][0]</span>
    
    <span class="n">x_vals</span> <span class="o">=</span> <span class="n">xConversionFactor</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vals2permute</span><span class="p">[</span><span class="n">key2plot</span><span class="p">])</span>
    <span class="c1"># Retrieve stats to plot</span>
    <span class="n">stats_arr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">stats_dict</span><span class="p">[</span><span class="n">stat_name</span><span class="p">]</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;stats_arr.shape: {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stats_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
    
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Current manual workaround to produce load vs velocity plot!</span>
<span class="sd">    (Code should be tidied to be more generic)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create figure for each set of responses</span>
    <span class="n">nFigures</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">)</span>
    <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">fig_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nFigures</span><span class="p">):</span>
            
        <span class="n">nSubplots</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">])</span>
        
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="n">figsize_inches</span><span class="p">)</span>
        
        <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
        <span class="c1"># Create subplots for each response</span>
        <span class="k">for</span> <span class="n">splt_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nSubplots</span><span class="p">):</span>
            
            <span class="n">r</span> <span class="o">=</span> <span class="n">splt_index</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">axarr</span><span class="p">[</span><span class="n">splt_index</span><span class="p">]</span>
            <span class="n">vals2plot</span> <span class="o">=</span> <span class="n">stats_arr</span><span class="p">[:,:,</span><span class="n">r</span><span class="p">]</span>
            
            <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_vals</span><span class="p">,</span><span class="n">vals2plot</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">responseNames</span><span class="p">[</span><span class="n">fig_index</span><span class="p">][</span><span class="n">r</span><span class="p">])</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">xlabel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">splt_index</span><span class="o">==</span><span class="n">nSubplots</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">xlabel</span><span class="p">)</span>
            
    <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.PedestrianDynamics_transientAnalyses.run">
    <p>def <span class="ident">run</span>(</p><p>self, save=True, solveInParallel=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Runs multiple dynamic analyses, as defined by <code>__init__</code></p>
<hr />
<p>In principle this can be done in parallel, to efficiently use all 
avaliable cores and give improve runtime.</p>
<p><em>Parallel processing not yet implemented due to outstanding bug 
associated with using <code>multiprocessing</code> module from within Spyder</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.PedestrianDynamics_transientAnalyses.run', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.PedestrianDynamics_transientAnalyses.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span><span class="n">solveInParallel</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs multiple dynamic analyses, as defined by `__init__`</span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    In principle this can be done in parallel, to efficiently use all </span>
<span class="sd">    avaliable cores and give improve runtime.</span>
<span class="sd">    </span>
<span class="sd">    _Parallel processing not yet implemented due to outstanding bug </span>
<span class="sd">    associated with using `multiprocessing` module from within Spyder_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Running multiple `{0}`</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">))</span>
    <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
        
    <span class="c1"># Run analyses using parallel processing (if possible)</span>
    <span class="k">if</span> <span class="n">solveInParallel</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Parallel processing not yet implemented due to &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;outstanding bug associated with using &quot;</span><span class="o">+</span>
              <span class="s2">&quot;`multiprocessing` module from within Spyder</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
              <span class="s2">&quot;A single-process analysis will be carried out instead.&quot;</span><span class="p">)</span>    
    <span class="c1"># Run all pre-defined analyses</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">):</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Analysis #</span><span class="si">%04d</span><span class="s2"> of #</span><span class="si">%04d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">)))</span>
        <span class="n">x</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span><span class="c1">#clear line for emphasis</span>
    
    <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Multiple `</span><span class="si">%s</span><span class="s2">` analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds!</span><span class="se">\n</span><span class="s2">&quot;</span> 
          <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">analysisType</span><span class="p">,(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">)))</span>
        
    <span class="c1"># Reshape results objects in ndarray</span>
    <span class="n">results_obj_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">results_obj</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">analysis_list</span><span class="p">]</span>
    <span class="n">reqdShape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vals2permute_shape</span>
    <span class="n">results_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">results_obj_list</span><span class="p">,</span><span class="n">reqdShape</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results_arr</span> <span class="o">=</span> <span class="n">results_arr</span>
    
    <span class="c1"># Collate statistics</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">collate_stats</span><span class="p">()</span>
    
    <span class="c1"># Pickle results</span>
    <span class="k">if</span> <span class="n">save</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.PedestrianDynamics_transientAnalyses.save">
    <p>def <span class="ident">save</span>(</p><p>self, fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Serialises object to file <code>fName</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.PedestrianDynamics_transientAnalyses.save', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.PedestrianDynamics_transientAnalyses.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialises object to file `fName`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="ped_dyn.PedestrianDynamics_transientAnalyses.bridgeClass" class="name">var <span class="ident">bridgeClass</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="ped_dyn.SteadyStateCrowdLoading" class="name">class <span class="ident">SteadyStateCrowdLoading</span></p>
      
  
    <div class="desc"><p>Class to implement steady state crowd loading analysis</p>
<p><em>Will usually be used as base class for analyses to specific codes, 
e.g. HiVoSS or UK NA to BS EN 1991-2</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">SteadyStateCrowdLoading</span><span class="p">():</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to implement steady state crowd loading analysis</span>
<span class="sd">    </span>
<span class="sd">    _Will usually be used as base class for analyses to specific codes, </span>
<span class="sd">    e.g. HiVoSS or UK NA to BS EN 1991-2_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">width_func_list</span><span class="o">=</span><span class="p">[</span><span class="mf">3.0</span><span class="p">],</span>
                 <span class="n">modeshapes_fname_arr</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;modeshapes_edge1.csv&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;modeshapes_edge2.csv&quot;</span><span class="p">],</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">               </span>
<span class="sd">        * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">            </span>
<span class="sd">        * `modeshapes_fname_arr`, array of strings, of shape (nRegions,2) </span>
<span class="sd">          denoting files containing modeshape variation along the edges of </span>
<span class="sd">          each deck region:</span>
<span class="sd">              </span>
<span class="sd">              * Axis 1 to be of shape = 2 (1 file for each edge)</span>
<span class="sd">              </span>
<span class="sd">              * Axis 0 length corresponds to number of deck regions, nRegions</span>
<span class="sd">          </span>
<span class="sd">        * `width_func_list`, list of functions to denote how width (m) of </span>
<span class="sd">          each deck region varies with chainage _along the centreline of the </span>
<span class="sd">          region_:</span>
<span class="sd">              </span>
<span class="sd">              * List length = nRegions required (this is checked)</span>
<span class="sd">              </span>
<span class="sd">              * List of floats may be provided if deck width is constant within </span>
<span class="sd">                each regions. But list length requirement above still applies</span>
<span class="sd">    </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">          computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">          used (conservative)</span>
<span class="sd">          </span>
<span class="sd">        * `nLcuts`, _integer_, denotes number of transverse cuts to make when </span>
<span class="sd">          evaluating area integrals. Increasing number will increase accuracy,  </span>
<span class="sd">          at the cost of longer computation time</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Create default name for analysis object</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Crowd Loading&quot;</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Name assigned to class instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
        <span class="c1"># Check `width_func_list` input</span>
        <span class="n">width_func_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_width_func_list</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">)</span>
        <span class="n">nRegions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">nRegions</span> <span class="o">=</span> <span class="n">nRegions</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Integer, denotes number deck regions</span>
<span class="sd">        &quot;&quot;&quot;</span>
            
        <span class="c1"># Check `modeshapes_fname_arr` input</span>
        
        <span class="k">if</span> <span class="n">modeshapes_fname_arr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="c1"># Use already-defined modeshope for system</span>
            <span class="n">mFunc</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span>
            <span class="n">mFunc_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">mFunc</span><span class="p">,</span><span class="n">mFunc</span><span class="p">]])</span>
            
            <span class="n">Ltrack</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
            <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Ltrack</span><span class="p">,</span><span class="n">Ltrack</span><span class="p">]])</span>
            
            <span class="n">max_ordinates</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mFunc</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
            
        <span class="k">else</span><span class="p">:</span>
                
            <span class="n">modeshapes_fname_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modeshapes_fname_arr</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_check_modeshapes_fname_arr</span><span class="p">(</span><span class="n">modeshapes_fname_arr</span><span class="p">,</span><span class="n">nRegions</span><span class="p">)</span>
                
            <span class="c1"># Read modeshape data from file, determine interpolation functions</span>
            <span class="n">mFunc_list</span><span class="p">,</span> <span class="n">Ltrack_list</span><span class="p">,</span> <span class="n">max_ordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_modeshapes</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                                                          <span class="n">modeshapes_fname_arr</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">max_modeshape</span> <span class="o">=</span> <span class="n">max_ordinates</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Maximum |modeshape| ordinates, evaluated over all deck regions.</span>
<span class="sd">        Array of length equal to number of modes considered</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define deck regions</span>
        <span class="n">deck_regions_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRegions</span><span class="p">):</span>
            
            <span class="n">deckregion_obj</span> <span class="o">=</span> <span class="n">_DeckStrip</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Region </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">,</span>
                                        <span class="n">L</span><span class="o">=</span><span class="n">Ltrack_list</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
                                        <span class="n">width_func</span><span class="o">=</span><span class="n">width_func_list</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
                                        <span class="n">func_edge1</span><span class="o">=</span><span class="n">mFunc_list</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                                        <span class="n">func_edge2</span><span class="o">=</span><span class="n">mFunc_list</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

            <span class="n">deck_regions_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deckregion_obj</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span> <span class="o">=</span> <span class="n">deck_regions_list</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        List of DeckStrip classes, defining deck strips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Calculate deck area</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_deck_area</span><span class="p">()</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Total deck area ($m^2$), obtained by integration over all deck strips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get damped natural frequencies for system</span>
        <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Damped natural frequencies of system being analysed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Damping ratios for system modes</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Save other attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span> <span class="o">=</span> <span class="n">modalsys_obj</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        `ModalSys` object, corresponding to system being analysed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Names of responses computed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Amplitudes of defined responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
                
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
            
            <span class="bp">self</span><span class="o">.</span><span class="n">print_details</span><span class="p">()</span>
                
        
        
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
            <span class="n">target_mode</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
            <span class="n">load_intensity</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">forcing_freq</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
            <span class="n">run_freq_method</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
            <span class="n">run_tstep</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">tstep_kwargs</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{},</span>
            <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
            <span class="n">makePlot</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
            <span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Runs calculations to determine steady-state crowd loading responses</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        **Required:**</span>
<span class="sd">            </span>
<span class="sd">        * `target_mode`, _integer_, denotes the mode at which resonance is </span>
<span class="sd">          to be targeted</span>
<span class="sd">          </span>
<span class="sd">        ***</span>
<span class="sd">        **Optional:**</span>
<span class="sd">        </span>
<span class="sd">        * `load_intensity`, _float_, denotes the load intensity (in N/m2) </span>
<span class="sd">          to be applied. If _None_, `load_intensity` to be calculated </span>
<span class="sd">          using `calc_load_intensity()` method function.</span>
<span class="sd">          </span>
<span class="sd">        * `forcing_freq`, _float_, defines forcing frequency (in Hz) at which </span>
<span class="sd">          response is to be determined. For ordinary modal systems with no </span>
<span class="sd">          added dampers this value should normally be set to equal the damped </span>
<span class="sd">          natural frequency for the mode given by `target_mode`, as this will </span>
<span class="sd">          ensure the worst-case resonance response is obtained. This is thus </span>
<span class="sd">          the default behaviour. However is some circumstances </span>
<span class="sd">          (e.g. systems with multiple TMDs appended) it is necessary to </span>
<span class="sd">          evaluate responses at various assumed forcing frequencies, </span>
<span class="sd">          hence why this optional input is provided to the user.</span>
<span class="sd">          </span>
<span class="sd">        * `run_freq_method`, _boolean_, if True the amplitude of modal and </span>
<span class="sd">          real-world responses at steady-state will be determine by frequency </span>
<span class="sd">          transfer matrix method. This is the default behaviour, as it allows </span>
<span class="sd">          the steady-state amplitudes of responses to be efficiently </span>
<span class="sd">          calculated. In some cases (e.g. for systems with constraints, for </span>
<span class="sd">          which the `DynSys.CalcFreqResponse()` method is not currently </span>
<span class="sd">          implemented), it may be desirable to carry out a time-stepping </span>
<span class="sd">          analysis instead. This can be done by setting `run_freq_method=False` </span>
<span class="sd">          and `run_tstep=True` (see documentation in next bullet for further </span>
<span class="sd">          details)</span>
<span class="sd">          </span>
<span class="sd">        * `run_tstep`, _boolean_, if True a time-stepping analysis will be run, </span>
<span class="sd">          which can be used to verify the the steady-state resonance solution </span>
<span class="sd">          that is ordinarily obtained.</span>
<span class="sd">          </span>
<span class="sd">        * `tstep_kwargs`, _dict_ of keyword arguments to be passed when </span>
<span class="sd">          initialising time-stepping analysis using the `TStep()` class. Only </span>
<span class="sd">          used if `run_tstep` is True. </span>
<span class="sd">          Refer [documentation](../docs/tstep.html) for `TStep()` </span>
<span class="sd">          class for more details.</span>
<span class="sd">          </span>
<span class="sd">        * `makePlot`, _dict_ or _bool_, used to control which plots are </span>
<span class="sd">          produced</span>
<span class="sd">          </span>
<span class="sd">          [documentation]: </span>
<span class="sd">          </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** Running steady-state crowd loading analysis ****&quot;</span><span class="p">)</span>
        
        <span class="c1"># Handle makePlot</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">makePlot</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
            
            <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="p">{}</span>
            <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
            <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="n">makePlot</span>
        
        
        
        <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span> <span class="o">=</span> <span class="n">target_mode</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Target mode index: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_mode</span><span class="p">)</span>
        
        <span class="c1"># Define forcing frequency</span>
        <span class="k">if</span> <span class="n">forcing_freq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
            <span class="c1"># Set to be damped natural frequency of mode being targeted</span>
            <span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
            
        <span class="k">else</span><span class="p">:</span> <span class="c1"># where input value provided via optional arg</span>
            
            <span class="c1"># Check float type is provided</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: float expected for `forcing_freq`&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">forcing_freq</span>
        
        <span class="c1"># Obtain area integrals over all deck strips</span>
        <span class="n">modal_areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_modal_areas</span><span class="p">(</span><span class="n">target_mode</span><span class="p">,</span>
                                            <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">])</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_areas</span> <span class="o">=</span> <span class="n">modal_areas</span>
        
        <span class="c1"># Calculate load intensity, if not provided directly</span>
        <span class="k">if</span> <span class="n">load_intensity</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">load_intensity</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_load_intensity</span><span class="p">(</span><span class="n">mode_index</span><span class="o">=</span><span class="n">target_mode</span><span class="p">,</span>
                                                         <span class="n">fv</span><span class="o">=</span><span class="n">forcing_freq</span><span class="p">,</span>
                                                         <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                         <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># null dict</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">=</span> <span class="n">load_intensity</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uniform load intensity (in N/m2) to be applied to deck regions</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity_rslts_dict</span> <span class="o">=</span> <span class="n">d</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _Dict_ to store key results from load intensity calculation</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;UDL intensity (N/m2): </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span><span class="p">)</span>
                 
        <span class="c1"># Multiply by load intensity to obtain modal force amplitudes</span>
        <span class="c1"># Note modal force amplitudes should be regarded as complex variables </span>
        <span class="c1"># (although here they will be real-valued) whereby negative values </span>
        <span class="c1"># imply a force which is 180 degrees out of phase</span>
        <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">*</span> <span class="n">modal_areas</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span> <span class="o">=</span> <span class="n">modal_forces</span>
            
        <span class="c1"># Save settings used to determine which analyses run</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span> <span class="o">=</span> <span class="n">run_freq_method</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span> <span class="o">=</span> <span class="n">run_tstep</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Forcing frequency: </span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">forcing_freq</span><span class="p">)</span>
        
        <span class="c1"># Run frequency domain method to determine steady-state responses               </span>
        <span class="k">if</span> <span class="n">run_freq_method</span><span class="p">:</span>
            
            <span class="c1"># Evaluate frequency transfer functions G(f) relating applied forces </span>
            <span class="c1"># (i.e. modal forces in this application) to DOF accelerations, </span>
            <span class="c1"># displacements and velocities</span>
            <span class="c1"># (i.e. modal disp, vel, accn in this application)</span>
            <span class="c1">#</span>
            <span class="c1"># It is only necessary to evaluate G(f) at resonant frequency for mode </span>
            <span class="c1"># being targeted, although for validation / plotting it may be </span>
            <span class="c1"># advantageous to evaluate G(f) over a wider frequency range</span>
            <span class="c1">#</span>
            <span class="c1"># By definition, G(f1) is a matrix that can be used to relate </span>
            <span class="c1"># sinusoidal modal forces to sinusoidal modal accelerations, </span>
            <span class="c1"># given forcing frequency f1.</span>
            <span class="c1">#</span>
            <span class="c1"># Note: G(f) will in general be complex-valued; the should be </span>
            <span class="c1"># intepreted to denote scaling and phase lag</span>
            
            <span class="c1"># Calculate matrix mapping applied loads to state DOFs</span>
            <span class="k">def</span> <span class="nf">Calc_Gf</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
                <span class="n">rslts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcFreqResponse</span><span class="p">(</span><span class="n">fVals</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                                                           <span class="n">C</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span>
                                                           <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
                <span class="n">G_f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;G_f&quot;</span><span class="p">]</span>
                <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">G_f</span>
            
            <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">Calc_Gf</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
            
            <span class="c1"># Retain only submatrix mapping modal forces to state DOFs</span>
            <span class="n">nModes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modal_forces</span><span class="p">)</span>
            <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[:,:</span><span class="n">nModes</span><span class="p">]</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span>
            
            <span class="c1"># Get submatrix mapping applied forces to DOF accelerations</span>
            <span class="n">nDOF</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">G_state_vars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
            <span class="n">G_acc</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nDOF</span><span class="p">:,:]</span>
            
            <span class="c1"># Get submatrix mapping modal forces to m accelerations</span>
            <span class="n">G_modalacc</span> <span class="o">=</span> <span class="n">G_acc</span><span class="p">[:</span><span class="n">nModes</span><span class="p">,:</span><span class="n">nModes</span><span class="p">]</span>
            
            <span class="c1"># Calculate modal acceleration amplitudes using transfer matrix</span>
            <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">G_modalacc</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span>
            
            <span class="c1"># Adjust phase such that acc for target mode has phase=0</span>
            <span class="n">z1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">]))</span>
            <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span> <span class="o">/</span> <span class="n">z1</span>
            
            <span class="c1"># Get modal acceleration of targeted mode</span>
            <span class="c1"># Note phase=0 due to above adjustment, hence ok to take real part only</span>
            <span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">modal_accn_target</span>
                           
            <span class="c1"># Calculate responses amplitudes using full transfer matrix</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">calc_responses</span><span class="p">()</span>
              
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;**** Analysis complete! ****</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">run_tstep</span><span class="p">:</span>
            
            <span class="c1"># Run time-stepping analysis to validate /check the above approach</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Running time-stepping analysis, as cross-check of &quot;</span><span class="o">+</span>
                  <span class="s2">&quot;steady-state resonance approach...***&quot;</span><span class="p">)</span>
                        
            <span class="c1"># Define sinusoidal load function consistent with above</span>
            <span class="k">def</span> <span class="nf">load_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">modal_forces</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">forcing_freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
            
            <span class="n">load_func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span> <span class="p">:</span> <span class="n">load_func</span><span class="p">}</span>
            
            <span class="c1"># Define and run time-stepping analysis</span>
            <span class="n">tstep_analysis</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">dynsys_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                         <span class="n">force_func_dict</span><span class="o">=</span><span class="n">load_func_dict</span><span class="p">,</span>
                                         <span class="o">**</span><span class="n">tstep_kwargs</span><span class="p">)</span>
            
            <span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_analysis</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>  
            
            <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_results</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Results from time-stepping analysis; instance of `TStep_Results()`</span>
<span class="sd">            &quot;&quot;&quot;</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Time-stepping analysis complete!***&quot;</span><span class="p">)</span>
            
            
    <span class="k">def</span> <span class="nf">calc_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">output_mtrx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">output_names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate steady-steady amplitude response of defined responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Get output matrix and output names, if not passed to this function</span>
        <span class="k">if</span> <span class="n">output_mtrx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">output_mtrx</span><span class="p">,</span> <span class="n">output_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetOutputMtrx</span><span class="p">(</span><span class="n">all_systems</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        
        <span class="c1"># Get frequency response matrix for {disp,vel,accn} variables</span>
        <span class="c1"># (note: assumes already calculated!)</span>
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span>
            
        <span class="c1"># Get modal forces</span>
        <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span>
        
        <span class="c1"># Calculate responses at steady-state</span>
        <span class="n">nResponses</span> <span class="o">=</span> <span class="n">output_mtrx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">nResponses</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
                
            <span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">output_mtrx</span> <span class="err">@</span> <span class="n">G_state_vars</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">response_amplitudes</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span> <span class="o">=</span> <span class="n">output_names</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No output matrix provided. &quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Real-world responses have not been evaluated&quot;</span><span class="p">)</span>
                
    
    <span class="k">def</span> <span class="nf">print_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints details about the analysis that has been defined</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Details of deck regions:&quot;</span><span class="p">)</span>
        
        <span class="n">deck_regions_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;nRegions: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">deck_regions_list</span><span class="p">))</span>
        
        <span class="k">for</span> <span class="n">deckregion_obj</span> <span class="ow">in</span> <span class="n">deck_regions_list</span><span class="p">:</span>
            
            <span class="n">deckregion_obj</span><span class="o">.</span><span class="n">print_details</span><span class="p">()</span>
            
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total deck area (m2):</span><span class="se">\n</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies of system (Hz):</span><span class="se">\n</span><span class="s2">{0}&quot;</span>
              <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">))</span>
        
        
        
    <span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Prints key results from analysis</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">def</span> <span class="nf">printcomplex</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">            Function for printing magnitude and phase of complex-valued vals</span>
<span class="sd">            &quot;&quot;&quot;</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Magnitudes:</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Phase angles (rad):</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
                    
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
                
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal forces (N):&quot;</span><span class="p">)</span>
        <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal accelerations (m/s2):&quot;</span><span class="p">)</span>
            <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Responses:&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="p">)</span>
            <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">get_response_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">print_phase</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns response amplitudes as pandas dataframe</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        <span class="n">index_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
        <span class="n">columns_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">]</span>
        
        <span class="k">if</span> <span class="n">print_phase</span><span class="p">:</span>
            <span class="n">phase_angles</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span><span class="n">phase_angles</span><span class="p">))</span>
            <span class="n">columns_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Phase angle&quot;</span><span class="p">)</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                              <span class="n">index</span><span class="o">=</span><span class="n">index_list</span><span class="p">,</span>
                              <span class="n">columns</span><span class="o">=</span><span class="n">columns_list</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">df</span>
    
    
    <span class="k">def</span> <span class="nf">get_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns response stats for time-stepping analysis carried out</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: no time-stepping analysis run, &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;cannot retrieve results!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Get dict of dict of stats</span>
        <span class="n">stats_dict_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">CalcResponseStats</span><span class="p">()</span>
        
        <span class="c1"># Loop over dict and return stats as list of pandas dataframes</span>
        <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
        
        <span class="k">for</span> <span class="n">sys_obj</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">stats_dict_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>   
            
            <span class="n">sys_name</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">name</span>
            <span class="n">response_names</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">output_names</span>
            
            <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stats_dict</span><span class="p">,</span>
                                  <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">sys_name</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">x</span>
                                         <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_names</span><span class="p">])</span>
            
            <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        
        <span class="c1"># Merge pandas dataframes to return a single dataframe</span>
        <span class="c1"># with all stats for all responses for all systems</span>
        <span class="n">df_merged</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
        
        <span class="c1"># Transpose such that stats as indexes, responses as columns</span>
        <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                
        <span class="k">return</span> <span class="n">df_merged</span>
    
        
    <span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plots results of steady-state response analysis</span>
<span class="sd">        </span>
<span class="sd">        If time-stepping analysis has also been carried out (as a cross-check) </span>
<span class="sd">        results of that analysis will be plotted also</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        </span>
<span class="sd">        **Required:**</span>
<span class="sd">        </span>
<span class="sd">        (No arguments required)</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        **Optional:**</span>
<span class="sd">        </span>
<span class="sd">        * `overlay_val`, _float_, value to overlay onto response plots. </span>
<span class="sd">          (A common use of this would be to overlay the applicable acceleration </span>
<span class="sd">          limit, against which responses are to be compared)</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        **Returns:**</span>
<span class="sd">        </span>
<span class="sd">        _Nested list_ of figure objects</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
                
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_freq_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
            <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
            
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
            <span class="n">tstep_fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_tstep_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
            <span class="n">fig_list</span> <span class="o">+=</span> <span class="n">tstep_fig_list</span>    
        
        <span class="k">return</span> <span class="n">fig_list</span>      
    
    
    <span class="k">def</span> <span class="nf">plot_results_freq_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot results of frequency domain analysis method, if avaliable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for frequency domain method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">None</span>
        
        <span class="c1"># Produce and configure figure</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
        
        <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Steady-state pedestrian crowd loading analysis results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                     <span class="s2">&quot;Target mode: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># Produce bar plot of modal accelerations</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_modal_accn</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        
        <span class="c1"># Produce bar plot of outputs</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_responses</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="n">fig</span>
    
    
    <span class="k">def</span> <span class="nf">plot_results_modal_accn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produce bar plot of steady-state modal accelerations</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define axes to plot to, if not done so already</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span>
        
        <span class="c1"># Get or define tick labels</span>
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="s1">&#39;mode_IDs&#39;</span><span class="p">):</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">mode_IDs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mode </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                     <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">nDOF</span><span class="p">)]</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state modal acceleration amplitudes (m/$s^2$)&quot;</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">plot_results_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Produce bar plot of steady-state responses</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Define axes to plot to, if not done so already</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>

        <span class="c1"># Get data to use in plot        </span>
        <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
        
        <span class="c1"># Flatten list in case of nested lists (only when multiple subsystems)</span>
        <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">ticks</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
            <span class="n">ticks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
        
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state response amplitudes&quot;</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">overlay_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
            
        
    <span class="k">def</span> <span class="nf">plot_results_tstep_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot results of time-stepping analysis, if avaliable</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for time-stepping method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
                  <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        
        <span class="c1"># Define +/- values based on overlay_val, if provided</span>
        <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">overlay_val</span><span class="o">=</span><span class="p">[</span><span class="o">+</span><span class="n">overlay_val</span><span class="p">,</span><span class="o">-</span><span class="n">overlay_val</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span>
        
        <span class="n">fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">useCommonPlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                  <span class="n">useCommonScale</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                                  <span class="n">y_overlay</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        
    
        <span class="c1"># Overlay expected modal acceleration amplitudes</span>
        <span class="c1"># (from steady-state analysis, if run)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        
            <span class="n">state_results_fig</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            
            <span class="n">ax</span> <span class="o">=</span> <span class="n">state_results_fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># plot of modal accelerations</span>
            <span class="n">accn_val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span><span class="p">)</span>    <span class="c1"># value to overlay</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            
            <span class="c1"># Overlay expected response amplitudes </span>
            <span class="c1"># (from steady-state analysis, if run)</span>
            <span class="n">response_results_fig_list</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            
            <span class="n">axarr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_results_fig_list</span><span class="p">]</span>
            <span class="n">axarr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">axarr</span><span class="p">))</span> <span class="c1"># flatten list</span>

            <span class="n">val2overlay</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axarr</span><span class="p">,</span><span class="n">val2overlay</span><span class="p">):</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
                <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> 
                
        <span class="k">return</span> <span class="n">fig_list</span>
    

    <span class="k">def</span> <span class="nf">_check_width_func_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                               <span class="n">width_func_list</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Performs checks on input `width_func_list` </span>
<span class="sd">        as supplied to `__init__()`</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Check that list type</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>

            <span class="c1"># Handle case of single float supplied by converting to list</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
                <span class="n">width_func_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">width_func_list</span><span class="p">]</span>

            <span class="k">else</span><span class="p">:</span>    
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`width_func_list`: list expected&quot;</span><span class="p">)</span>

        <span class="c1"># Check all list items are functions or floats</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">width_func</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">isfunction</span><span class="p">(</span><span class="n">width_func</span><span class="p">):</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">width_func</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>

                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`width_func_list[</span><span class="si">%d</span><span class="s2">]`&quot;</span> <span class="o">%</span> <span class="n">i</span> <span class="o">+</span> 
                                     <span class="s2">&quot; is not a function, as required&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">width_func_list</span>


    <span class="k">def</span> <span class="nf">_check_modeshapes_fname_arr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                                    <span class="n">modeshapes_fname_arr</span><span class="p">,</span>
                                    <span class="n">nRegions_expected</span><span class="p">):</span>

        <span class="c1"># Check shapes</span>
        <span class="n">nRegions</span><span class="p">,</span> <span class="n">nEdges</span> <span class="o">=</span> <span class="n">modeshapes_fname_arr</span><span class="o">.</span><span class="n">shape</span>

        <span class="k">if</span> <span class="n">nRegions_expected</span> <span class="o">!=</span> <span class="n">nRegions</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Unexpected `nRegions`</span><span class="se">\n</span><span class="s2">: &quot;</span> <span class="o">+</span>
                             <span class="s2">&quot;Conflicts with nRegions inferred &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;from `width_func_list` input&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">nEdges</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;nEdges = 2 required</span><span class="se">\n</span><span class="s2"> &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;Modeshapes at edges &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;of each regions must be provided via &quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;`modeshapes_fname_arr` input&quot;</span><span class="p">)</span>

        <span class="c1"># Check all files exist</span>
        <span class="k">for</span> <span class="n">index</span><span class="p">,</span> <span class="n">file_str</span> <span class="ow">in</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">modeshapes_fname_arr</span><span class="p">):</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">file_str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`modeshapes_fname_list[{0}]`&quot;</span> <span class="o">%</span> <span class="n">index</span> <span class="o">+</span>
                                 <span class="s2">&quot; does not exist!&quot;</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">_read_modeshapes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">modeshapes_fname_arr</span><span class="p">,</span><span class="n">num</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reads modeshapes from file</span>

<span class="sd">        ***</span>
<span class="sd">        Required:</span>

<span class="sd">        * `modeshapes_fname_arr`, array of strings, denoting file paths</span>

<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">modeshapeFunc_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">absmax_vals_list</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># Loop through array containing modeshape filenames</span>
        <span class="k">for</span> <span class="n">fname_list</span> <span class="ow">in</span> <span class="n">modeshapes_fname_arr</span><span class="p">:</span>

            <span class="n">Ltrack_list_inner</span> <span class="o">=</span> <span class="p">[]</span> 
            <span class="n">modeshapeFunc_list_inner</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">absmax_vals_list_inner</span> <span class="o">=</span> <span class="p">[]</span>

            <span class="k">for</span> <span class="n">fName</span> <span class="ow">in</span> <span class="n">fname_list</span><span class="p">:</span>

                <span class="n">mfunc</span><span class="p">,</span> <span class="n">L</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">DefineModeshapes</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">fName</span><span class="p">)</span>
                
                <span class="c1"># Evaluate to obtain maximum ordinates</span>
                <span class="n">m_vals</span> <span class="o">=</span> <span class="n">mfunc</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">L</span><span class="p">,</span><span class="n">num</span><span class="p">))</span>
                <span class="n">absmax_vals</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">m_vals</span><span class="p">),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">absmax_vals_list_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">absmax_vals</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>

                <span class="c1"># Append to inner lists</span>
                <span class="n">Ltrack_list_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">L</span><span class="p">)</span>
                <span class="n">modeshapeFunc_list_inner</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mfunc</span><span class="p">)</span>

            <span class="c1"># Append to create list of lists</span>
            <span class="n">Ltrack_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Ltrack_list_inner</span><span class="p">)</span>
            <span class="n">modeshapeFunc_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">modeshapeFunc_list_inner</span><span class="p">)</span>
            <span class="n">absmax_vals_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">absmax_vals_list_inner</span><span class="p">)</span>

        <span class="c1"># Obtain overall max modeshape ordinate</span>
        <span class="n">absmax_vals_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">absmax_vals_list</span><span class="p">)</span>
        <span class="n">max_ordinate</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">absmax_vals_list</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span>

        <span class="c1"># Convert lists to arrays</span>
        <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">Ltrack_list</span><span class="p">)</span>
        <span class="n">modeshapeFunc_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modeshapeFunc_list</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">modeshapeFunc_list</span><span class="p">,</span> <span class="n">Ltrack_list</span><span class="p">,</span> <span class="n">max_ordinate</span>
        
    
    <span class="k">def</span> <span class="nf">calc_deck_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the total deck area, taken across all deck strips</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">total_area</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">calc_area</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">])</span>
        
        <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_area</span><span class="p">)</span>
    
    
    <span class="k">def</span> <span class="nf">calc_modal_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns modal area integrals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
                          <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        
    
    <span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        _Method to be overriden by derived classes_</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`calc_load_intensity` not implemented!&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;To be overriden by derived class method&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#ped_dyn.SteadyStateCrowdLoading">SteadyStateCrowdLoading</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, modalsys_obj, width_func_list=[3.0], modeshapes_fname_arr=[&#39;modeshapes_edge1.csv&#39;, &#39;modeshapes_edge2.csv&#39;], name=None, verbose=False, makePlot=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>modalsys_obj</code>, object defining modal system to be analysed</p>
</li>
<li>
<p><code>modeshapes_fname_arr</code>, array of strings, of shape (nRegions,2) 
  denoting files containing modeshape variation along the edges of 
  each deck region:</p>
<ul>
<li>
<p>Axis 1 to be of shape = 2 (1 file for each edge)</p>
</li>
<li>
<p>Axis 0 length corresponds to number of deck regions, nRegions</p>
</li>
</ul>
</li>
<li>
<p><code>width_func_list</code>, list of functions to denote how width (m) of 
  each deck region varies with chainage <em>along the centreline of the 
  region</em>:</p>
<ul>
<li>
<p>List length = nRegions required (this is checked)</p>
</li>
<li>
<p>List of floats may be provided if deck width is constant within 
    each regions. But list length requirement above still applies</p>
</li>
</ul>
</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li>
<p>calc_Seff`, <em>boolean</em>, dictates whether effective span will be 
  computed according to Figure NA.7. If False, overall span will be 
  used (conservative)</p>
</li>
<li>
<p><code>nLcuts</code>, <em>integer</em>, denotes number of transverse cuts to make when 
  evaluating area integrals. Increasing number will increase accuracy,<br />
  at the cost of longer computation time</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.__init__', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">modalsys_obj</span><span class="p">,</span>
             <span class="n">width_func_list</span><span class="o">=</span><span class="p">[</span><span class="mf">3.0</span><span class="p">],</span>
             <span class="n">modeshapes_fname_arr</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;modeshapes_edge1.csv&quot;</span><span class="p">,</span>
                                    <span class="s2">&quot;modeshapes_edge2.csv&quot;</span><span class="p">],</span>
             <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">           </span>
<span class="sd">    * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">        </span>
<span class="sd">    * `modeshapes_fname_arr`, array of strings, of shape (nRegions,2) </span>
<span class="sd">      denoting files containing modeshape variation along the edges of </span>
<span class="sd">      each deck region:</span>
<span class="sd">          </span>
<span class="sd">          * Axis 1 to be of shape = 2 (1 file for each edge)</span>
<span class="sd">          </span>
<span class="sd">          * Axis 0 length corresponds to number of deck regions, nRegions</span>
<span class="sd">      </span>
<span class="sd">    * `width_func_list`, list of functions to denote how width (m) of </span>
<span class="sd">      each deck region varies with chainage _along the centreline of the </span>
<span class="sd">      region_:</span>
<span class="sd">          </span>
<span class="sd">          * List length = nRegions required (this is checked)</span>
<span class="sd">          </span>
<span class="sd">          * List of floats may be provided if deck width is constant within </span>
<span class="sd">            each regions. But list length requirement above still applies</span>

<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">      computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">      used (conservative)</span>
<span class="sd">      </span>
<span class="sd">    * `nLcuts`, _integer_, denotes number of transverse cuts to make when </span>
<span class="sd">      evaluating area integrals. Increasing number will increase accuracy,  </span>
<span class="sd">      at the cost of longer computation time</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create default name for analysis object</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Crowd Loading&quot;</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Name assigned to class instance</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># Check `width_func_list` input</span>
    <span class="n">width_func_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_check_width_func_list</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">)</span>
    <span class="n">nRegions</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">width_func_list</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">nRegions</span> <span class="o">=</span> <span class="n">nRegions</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Integer, denotes number deck regions</span>
<span class="sd">    &quot;&quot;&quot;</span>
        
    <span class="c1"># Check `modeshapes_fname_arr` input</span>
    
    <span class="k">if</span> <span class="n">modeshapes_fname_arr</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
        <span class="c1"># Use already-defined modeshope for system</span>
        <span class="n">mFunc</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span>
        <span class="n">mFunc_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">mFunc</span><span class="p">,</span><span class="n">mFunc</span><span class="p">]])</span>
        
        <span class="n">Ltrack</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
        <span class="n">Ltrack_list</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">Ltrack</span><span class="p">,</span><span class="n">Ltrack</span><span class="p">]])</span>
        
        <span class="n">max_ordinates</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">mFunc</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
        
    <span class="k">else</span><span class="p">:</span>
            
        <span class="n">modeshapes_fname_arr</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">modeshapes_fname_arr</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_check_modeshapes_fname_arr</span><span class="p">(</span><span class="n">modeshapes_fname_arr</span><span class="p">,</span><span class="n">nRegions</span><span class="p">)</span>
            
        <span class="c1"># Read modeshape data from file, determine interpolation functions</span>
        <span class="n">mFunc_list</span><span class="p">,</span> <span class="n">Ltrack_list</span><span class="p">,</span> <span class="n">max_ordinates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_modeshapes</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                                                      <span class="n">modeshapes_fname_arr</span><span class="p">)</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">max_modeshape</span> <span class="o">=</span> <span class="n">max_ordinates</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Maximum |modeshape| ordinates, evaluated over all deck regions.</span>
<span class="sd">    Array of length equal to number of modes considered</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define deck regions</span>
    <span class="n">deck_regions_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">nRegions</span><span class="p">):</span>
        
        <span class="n">deckregion_obj</span> <span class="o">=</span> <span class="n">_DeckStrip</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;Region </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">r</span><span class="p">,</span>
                                    <span class="n">L</span><span class="o">=</span><span class="n">Ltrack_list</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
                                    <span class="n">width_func</span><span class="o">=</span><span class="n">width_func_list</span><span class="p">[</span><span class="n">r</span><span class="p">],</span>
                                    <span class="n">func_edge1</span><span class="o">=</span><span class="n">mFunc_list</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
                                    <span class="n">func_edge2</span><span class="o">=</span><span class="n">mFunc_list</span><span class="p">[</span><span class="n">r</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
        <span class="n">deck_regions_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">deckregion_obj</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span> <span class="o">=</span> <span class="n">deck_regions_list</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    List of DeckStrip classes, defining deck strips</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Calculate deck area</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_deck_area</span><span class="p">()</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Total deck area ($m^2$), obtained by integration over all deck strips</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get damped natural frequencies for system</span>
    <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Damped natural frequencies of system being analysed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Damping ratios for system modes</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Save other attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span> <span class="o">=</span> <span class="n">modalsys_obj</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    `ModalSys` object, corresponding to system being analysed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Names of responses computed</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Amplitudes of defined responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
            
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> 
        
        <span class="bp">self</span><span class="o">.</span><span class="n">print_details</span><span class="p">()</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.calc_deck_area">
    <p>def <span class="ident">calc_deck_area</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the total deck area, taken across all deck strips</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.calc_deck_area', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.calc_deck_area" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_deck_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the total deck area, taken across all deck strips</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">total_area</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">calc_area</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_area</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.calc_load_intensity">
    <p>def <span class="ident">calc_load_intensity</span>(</p><p>self, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p><em>Method to be overriden by derived classes</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.calc_load_intensity', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.calc_load_intensity" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    _Method to be overriden by derived classes_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`calc_load_intensity` not implemented!&quot;</span> <span class="o">+</span> 
                     <span class="s2">&quot;To be overriden by derived class method&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.calc_modal_areas">
    <p>def <span class="ident">calc_modal_areas</span>(</p><p>self, mode_index, makePlot=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns modal area integrals</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.calc_modal_areas', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.calc_modal_areas" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_modal_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns modal area integrals</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.calc_responses">
    <p>def <span class="ident">calc_responses</span>(</p><p>self, output_mtrx=None, output_names=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculate steady-steady amplitude response of defined responses</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.calc_responses', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.calc_responses" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">output_mtrx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">output_names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate steady-steady amplitude response of defined responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get output matrix and output names, if not passed to this function</span>
    <span class="k">if</span> <span class="n">output_mtrx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">output_mtrx</span><span class="p">,</span> <span class="n">output_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetOutputMtrx</span><span class="p">(</span><span class="n">all_systems</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Get frequency response matrix for {disp,vel,accn} variables</span>
    <span class="c1"># (note: assumes already calculated!)</span>
    <span class="n">G_state_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span>
        
    <span class="c1"># Get modal forces</span>
    <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span>
    
    <span class="c1"># Calculate responses at steady-state</span>
    <span class="n">nResponses</span> <span class="o">=</span> <span class="n">output_mtrx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">nResponses</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            
        <span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">output_mtrx</span> <span class="err">@</span> <span class="n">G_state_vars</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">response_amplitudes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span> <span class="o">=</span> <span class="n">output_names</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No output matrix provided. &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Real-world responses have not been evaluated&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.get_response_amplitudes">
    <p>def <span class="ident">get_response_amplitudes</span>(</p><p>self, print_phase=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns response amplitudes as pandas dataframe</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.get_response_amplitudes', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.get_response_amplitudes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_response_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">print_phase</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns response amplitudes as pandas dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
    <span class="n">index_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
    <span class="n">columns_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">print_phase</span><span class="p">:</span>
        <span class="n">phase_angles</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span><span class="n">phase_angles</span><span class="p">))</span>
        <span class="n">columns_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Phase angle&quot;</span><span class="p">)</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                          <span class="n">index</span><span class="o">=</span><span class="n">index_list</span><span class="p">,</span>
                          <span class="n">columns</span><span class="o">=</span><span class="n">columns_list</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.get_response_stats">
    <p>def <span class="ident">get_response_stats</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns response stats for time-stepping analysis carried out</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.get_response_stats', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.get_response_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns response stats for time-stepping analysis carried out</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: no time-stepping analysis run, &quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;cannot retrieve results!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get dict of dict of stats</span>
    <span class="n">stats_dict_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">CalcResponseStats</span><span class="p">()</span>
    
    <span class="c1"># Loop over dict and return stats as list of pandas dataframes</span>
    <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">sys_obj</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">stats_dict_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>   
        
        <span class="n">sys_name</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">name</span>
        <span class="n">response_names</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">output_names</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stats_dict</span><span class="p">,</span>
                              <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">sys_name</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">x</span>
                                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_names</span><span class="p">])</span>
        
        <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="c1"># Merge pandas dataframes to return a single dataframe</span>
    <span class="c1"># with all stats for all responses for all systems</span>
    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
    
    <span class="c1"># Transpose such that stats as indexes, responses as columns</span>
    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            
    <span class="k">return</span> <span class="n">df_merged</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.plot_results">
    <p>def <span class="ident">plot_results</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots results of steady-state response analysis</p>
<p>If time-stepping analysis has also been carried out (as a cross-check) 
results of that analysis will be plotted also</p>
<hr />
<p><strong>Required:</strong></p>
<p>(No arguments required)</p>
<hr />
<p><strong>Optional:</strong></p>
<ul>
<li><code>overlay_val</code>, <em>float</em>, value to overlay onto response plots. 
  (A common use of this would be to overlay the applicable acceleration 
  limit, against which responses are to be compared)</li>
</ul>
<hr />
<p><strong>Returns:</strong></p>
<p><em>Nested list</em> of figure objects</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.plot_results', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.plot_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots results of steady-state response analysis</span>
<span class="sd">    </span>
<span class="sd">    If time-stepping analysis has also been carried out (as a cross-check) </span>
<span class="sd">    results of that analysis will be plotted also</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    **Required:**</span>
<span class="sd">    </span>
<span class="sd">    (No arguments required)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Optional:**</span>
<span class="sd">    </span>
<span class="sd">    * `overlay_val`, _float_, value to overlay onto response plots. </span>
<span class="sd">      (A common use of this would be to overlay the applicable acceleration </span>
<span class="sd">      limit, against which responses are to be compared)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Returns:**</span>
<span class="sd">    </span>
<span class="sd">    _Nested list_ of figure objects</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
            
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_freq_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="n">tstep_fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_tstep_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        <span class="n">fig_list</span> <span class="o">+=</span> <span class="n">tstep_fig_list</span>    
    
    <span class="k">return</span> <span class="n">fig_list</span>      
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.plot_results_freq_method">
    <p>def <span class="ident">plot_results_freq_method</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot results of frequency domain analysis method, if avaliable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.plot_results_freq_method', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.plot_results_freq_method" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_freq_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot results of frequency domain analysis method, if avaliable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for frequency domain method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="c1"># Produce and configure figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Steady-state pedestrian crowd loading analysis results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                 <span class="s2">&quot;Target mode: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="c1"># Produce bar plot of modal accelerations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_modal_accn</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># Produce bar plot of outputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_responses</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.plot_results_modal_accn">
    <p>def <span class="ident">plot_results_modal_accn</span>(</p><p>self, ax=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Produce bar plot of steady-state modal accelerations</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.plot_results_modal_accn', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.plot_results_modal_accn" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_modal_accn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce bar plot of steady-state modal accelerations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define axes to plot to, if not done so already</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span>
    
    <span class="c1"># Get or define tick labels</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="s1">&#39;mode_IDs&#39;</span><span class="p">):</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">mode_IDs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mode </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">nDOF</span><span class="p">)]</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state modal acceleration amplitudes (m/$s^2$)&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.plot_results_responses">
    <p>def <span class="ident">plot_results_responses</span>(</p><p>self, ax=None, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Produce bar plot of steady-state responses</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.plot_results_responses', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.plot_results_responses" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce bar plot of steady-state responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define axes to plot to, if not done so already</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="c1"># Get data to use in plot        </span>
    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
    
    <span class="c1"># Flatten list in case of nested lists (only when multiple subsystems)</span>
    <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">ticks</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state response amplitudes&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">overlay_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.plot_results_tstep_method">
    <p>def <span class="ident">plot_results_tstep_method</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot results of time-stepping analysis, if avaliable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.plot_results_tstep_method', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.plot_results_tstep_method" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_tstep_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot results of time-stepping analysis, if avaliable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for time-stepping method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="c1"># Define +/- values based on overlay_val, if provided</span>
    <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">overlay_val</span><span class="o">=</span><span class="p">[</span><span class="o">+</span><span class="n">overlay_val</span><span class="p">,</span><span class="o">-</span><span class="n">overlay_val</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span>
    
    <span class="n">fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">useCommonPlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                              <span class="n">useCommonScale</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                              <span class="n">y_overlay</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
    

    <span class="c1"># Overlay expected modal acceleration amplitudes</span>
    <span class="c1"># (from steady-state analysis, if run)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
    
        <span class="n">state_results_fig</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">state_results_fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># plot of modal accelerations</span>
        <span class="n">accn_val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span><span class="p">)</span>    <span class="c1"># value to overlay</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># Overlay expected response amplitudes </span>
        <span class="c1"># (from steady-state analysis, if run)</span>
        <span class="n">response_results_fig_list</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">axarr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_results_fig_list</span><span class="p">]</span>
        <span class="n">axarr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">axarr</span><span class="p">))</span> <span class="c1"># flatten list</span>
        <span class="n">val2overlay</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axarr</span><span class="p">,</span><span class="n">val2overlay</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> 
            
    <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.print_details">
    <p>def <span class="ident">print_details</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints details about the analysis that has been defined</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.print_details', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.print_details" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">print_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints details about the analysis that has been defined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Details of deck regions:&quot;</span><span class="p">)</span>
    
    <span class="n">deck_regions_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;nRegions: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">deck_regions_list</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">deckregion_obj</span> <span class="ow">in</span> <span class="n">deck_regions_list</span><span class="p">:</span>
        
        <span class="n">deckregion_obj</span><span class="o">.</span><span class="n">print_details</span><span class="p">()</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total deck area (m2):</span><span class="se">\n</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies of system (Hz):</span><span class="se">\n</span><span class="s2">{0}&quot;</span>
          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.print_results">
    <p>def <span class="ident">print_results</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints key results from analysis</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.print_results', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.print_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints key results from analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">printcomplex</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for printing magnitude and phase of complex-valued vals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Magnitudes:</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Phase angles (rad):</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
                
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal forces (N):&quot;</span><span class="p">)</span>
    <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal accelerations (m/s2):&quot;</span><span class="p">)</span>
        <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Responses:&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="p">)</span>
        <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.SteadyStateCrowdLoading.run">
    <p>def <span class="ident">run</span>(</p><p>self, target_mode, load_intensity=None, forcing_freq=None, run_freq_method=True, run_tstep=False, tstep_kwargs={}, verbose=False, makePlot={&#39;calc_modal_areas&#39;: False, &#39;calc_load_intensity&#39;: True})</p>
    </div>
    

    
  
    <div class="desc"><p>Runs calculations to determine steady-state crowd loading responses</p>
<hr />
<p><strong>Required:</strong></p>
<ul>
<li><code>target_mode</code>, <em>integer</em>, denotes the mode at which resonance is 
  to be targeted</li>
</ul>
<hr />
<p><strong>Optional:</strong></p>
<ul>
<li>
<p><code>load_intensity</code>, <em>float</em>, denotes the load intensity (in N/m2) 
  to be applied. If <em>None</em>, <code>load_intensity</code> to be calculated 
  using <code>calc_load_intensity()</code> method function.</p>
</li>
<li>
<p><code>forcing_freq</code>, <em>float</em>, defines forcing frequency (in Hz) at which 
  response is to be determined. For ordinary modal systems with no 
  added dampers this value should normally be set to equal the damped 
  natural frequency for the mode given by <code>target_mode</code>, as this will 
  ensure the worst-case resonance response is obtained. This is thus 
  the default behaviour. However is some circumstances 
  (e.g. systems with multiple TMDs appended) it is necessary to 
  evaluate responses at various assumed forcing frequencies, 
  hence why this optional input is provided to the user.</p>
</li>
<li>
<p><code>run_freq_method</code>, <em>boolean</em>, if True the amplitude of modal and 
  real-world responses at steady-state will be determine by frequency 
  transfer matrix method. This is the default behaviour, as it allows 
  the steady-state amplitudes of responses to be efficiently 
  calculated. In some cases (e.g. for systems with constraints, for 
  which the <code>DynSys.CalcFreqResponse()</code> method is not currently 
  implemented), it may be desirable to carry out a time-stepping 
  analysis instead. This can be done by setting <code>run_freq_method=False</code> 
  and <code>run_tstep=True</code> (see documentation in next bullet for further 
  details)</p>
</li>
<li>
<p><code>run_tstep</code>, <em>boolean</em>, if True a time-stepping analysis will be run, 
  which can be used to verify the the steady-state resonance solution 
  that is ordinarily obtained.</p>
</li>
<li>
<p><code>tstep_kwargs</code>, <em>dict</em> of keyword arguments to be passed when 
  initialising time-stepping analysis using the <code>TStep()</code> class. Only 
  used if <code>run_tstep</code> is True. 
  Refer <a href="../docs/tstep.html">documentation</a> for <code>TStep()</code> 
  class for more details.</p>
</li>
<li>
<p><code>makePlot</code>, <em>dict</em> or <em>bool</em>, used to control which plots are 
  produced</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.SteadyStateCrowdLoading.run', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.SteadyStateCrowdLoading.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">target_mode</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">load_intensity</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">forcing_freq</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">run_freq_method</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">run_tstep</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">tstep_kwargs</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">makePlot</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
        <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs calculations to determine steady-state crowd loading responses</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Required:**</span>
<span class="sd">        </span>
<span class="sd">    * `target_mode`, _integer_, denotes the mode at which resonance is </span>
<span class="sd">      to be targeted</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    **Optional:**</span>
<span class="sd">    </span>
<span class="sd">    * `load_intensity`, _float_, denotes the load intensity (in N/m2) </span>
<span class="sd">      to be applied. If _None_, `load_intensity` to be calculated </span>
<span class="sd">      using `calc_load_intensity()` method function.</span>
<span class="sd">      </span>
<span class="sd">    * `forcing_freq`, _float_, defines forcing frequency (in Hz) at which </span>
<span class="sd">      response is to be determined. For ordinary modal systems with no </span>
<span class="sd">      added dampers this value should normally be set to equal the damped </span>
<span class="sd">      natural frequency for the mode given by `target_mode`, as this will </span>
<span class="sd">      ensure the worst-case resonance response is obtained. This is thus </span>
<span class="sd">      the default behaviour. However is some circumstances </span>
<span class="sd">      (e.g. systems with multiple TMDs appended) it is necessary to </span>
<span class="sd">      evaluate responses at various assumed forcing frequencies, </span>
<span class="sd">      hence why this optional input is provided to the user.</span>
<span class="sd">      </span>
<span class="sd">    * `run_freq_method`, _boolean_, if True the amplitude of modal and </span>
<span class="sd">      real-world responses at steady-state will be determine by frequency </span>
<span class="sd">      transfer matrix method. This is the default behaviour, as it allows </span>
<span class="sd">      the steady-state amplitudes of responses to be efficiently </span>
<span class="sd">      calculated. In some cases (e.g. for systems with constraints, for </span>
<span class="sd">      which the `DynSys.CalcFreqResponse()` method is not currently </span>
<span class="sd">      implemented), it may be desirable to carry out a time-stepping </span>
<span class="sd">      analysis instead. This can be done by setting `run_freq_method=False` </span>
<span class="sd">      and `run_tstep=True` (see documentation in next bullet for further </span>
<span class="sd">      details)</span>
<span class="sd">      </span>
<span class="sd">    * `run_tstep`, _boolean_, if True a time-stepping analysis will be run, </span>
<span class="sd">      which can be used to verify the the steady-state resonance solution </span>
<span class="sd">      that is ordinarily obtained.</span>
<span class="sd">      </span>
<span class="sd">    * `tstep_kwargs`, _dict_ of keyword arguments to be passed when </span>
<span class="sd">      initialising time-stepping analysis using the `TStep()` class. Only </span>
<span class="sd">      used if `run_tstep` is True. </span>
<span class="sd">      Refer [documentation](../docs/tstep.html) for `TStep()` </span>
<span class="sd">      class for more details.</span>
<span class="sd">      </span>
<span class="sd">    * `makePlot`, _dict_ or _bool_, used to control which plots are </span>
<span class="sd">      produced</span>
<span class="sd">      </span>
<span class="sd">      [documentation]: </span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** Running steady-state crowd loading analysis ****&quot;</span><span class="p">)</span>
    
    <span class="c1"># Handle makePlot</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">makePlot</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
        
        <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
        <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="n">makePlot</span>
    
    
    
    <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span> <span class="o">=</span> <span class="n">target_mode</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Target mode index: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_mode</span><span class="p">)</span>
    
    <span class="c1"># Define forcing frequency</span>
    <span class="k">if</span> <span class="n">forcing_freq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
        <span class="c1"># Set to be damped natural frequency of mode being targeted</span>
        <span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
        
    <span class="k">else</span><span class="p">:</span> <span class="c1"># where input value provided via optional arg</span>
        
        <span class="c1"># Check float type is provided</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: float expected for `forcing_freq`&quot;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">forcing_freq</span>
    
    <span class="c1"># Obtain area integrals over all deck strips</span>
    <span class="n">modal_areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_modal_areas</span><span class="p">(</span><span class="n">target_mode</span><span class="p">,</span>
                                        <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">])</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">modal_areas</span> <span class="o">=</span> <span class="n">modal_areas</span>
    
    <span class="c1"># Calculate load intensity, if not provided directly</span>
    <span class="k">if</span> <span class="n">load_intensity</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">load_intensity</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_load_intensity</span><span class="p">(</span><span class="n">mode_index</span><span class="o">=</span><span class="n">target_mode</span><span class="p">,</span>
                                                     <span class="n">fv</span><span class="o">=</span><span class="n">forcing_freq</span><span class="p">,</span>
                                                     <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                     <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># null dict</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">=</span> <span class="n">load_intensity</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uniform load intensity (in N/m2) to be applied to deck regions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity_rslts_dict</span> <span class="o">=</span> <span class="n">d</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    _Dict_ to store key results from load intensity calculation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;UDL intensity (N/m2): </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span><span class="p">)</span>
             
    <span class="c1"># Multiply by load intensity to obtain modal force amplitudes</span>
    <span class="c1"># Note modal force amplitudes should be regarded as complex variables </span>
    <span class="c1"># (although here they will be real-valued) whereby negative values </span>
    <span class="c1"># imply a force which is 180 degrees out of phase</span>
    <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">*</span> <span class="n">modal_areas</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span> <span class="o">=</span> <span class="n">modal_forces</span>
        
    <span class="c1"># Save settings used to determine which analyses run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span> <span class="o">=</span> <span class="n">run_freq_method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span> <span class="o">=</span> <span class="n">run_tstep</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Forcing frequency: </span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">forcing_freq</span><span class="p">)</span>
    
    <span class="c1"># Run frequency domain method to determine steady-state responses               </span>
    <span class="k">if</span> <span class="n">run_freq_method</span><span class="p">:</span>
        
        <span class="c1"># Evaluate frequency transfer functions G(f) relating applied forces </span>
        <span class="c1"># (i.e. modal forces in this application) to DOF accelerations, </span>
        <span class="c1"># displacements and velocities</span>
        <span class="c1"># (i.e. modal disp, vel, accn in this application)</span>
        <span class="c1">#</span>
        <span class="c1"># It is only necessary to evaluate G(f) at resonant frequency for mode </span>
        <span class="c1"># being targeted, although for validation / plotting it may be </span>
        <span class="c1"># advantageous to evaluate G(f) over a wider frequency range</span>
        <span class="c1">#</span>
        <span class="c1"># By definition, G(f1) is a matrix that can be used to relate </span>
        <span class="c1"># sinusoidal modal forces to sinusoidal modal accelerations, </span>
        <span class="c1"># given forcing frequency f1.</span>
        <span class="c1">#</span>
        <span class="c1"># Note: G(f) will in general be complex-valued; the should be </span>
        <span class="c1"># intepreted to denote scaling and phase lag</span>
        
        <span class="c1"># Calculate matrix mapping applied loads to state DOFs</span>
        <span class="k">def</span> <span class="nf">Calc_Gf</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">rslts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcFreqResponse</span><span class="p">(</span><span class="n">fVals</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                                                       <span class="n">C</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span>
                                                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
            <span class="n">G_f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;G_f&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">G_f</span>
        
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">Calc_Gf</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
        
        <span class="c1"># Retain only submatrix mapping modal forces to state DOFs</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modal_forces</span><span class="p">)</span>
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[:,:</span><span class="n">nModes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span>
        
        <span class="c1"># Get submatrix mapping applied forces to DOF accelerations</span>
        <span class="n">nDOF</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">G_state_vars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">G_acc</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nDOF</span><span class="p">:,:]</span>
        
        <span class="c1"># Get submatrix mapping modal forces to m accelerations</span>
        <span class="n">G_modalacc</span> <span class="o">=</span> <span class="n">G_acc</span><span class="p">[:</span><span class="n">nModes</span><span class="p">,:</span><span class="n">nModes</span><span class="p">]</span>
        
        <span class="c1"># Calculate modal acceleration amplitudes using transfer matrix</span>
        <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">G_modalacc</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span>
        
        <span class="c1"># Adjust phase such that acc for target mode has phase=0</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">]))</span>
        <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span> <span class="o">/</span> <span class="n">z1</span>
        
        <span class="c1"># Get modal acceleration of targeted mode</span>
        <span class="c1"># Note phase=0 due to above adjustment, hence ok to take real part only</span>
        <span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">modal_accn_target</span>
                       
        <span class="c1"># Calculate responses amplitudes using full transfer matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_responses</span><span class="p">()</span>
          
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;**** Analysis complete! ****</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">run_tstep</span><span class="p">:</span>
        
        <span class="c1"># Run time-stepping analysis to validate /check the above approach</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Running time-stepping analysis, as cross-check of &quot;</span><span class="o">+</span>
              <span class="s2">&quot;steady-state resonance approach...***&quot;</span><span class="p">)</span>
                    
        <span class="c1"># Define sinusoidal load function consistent with above</span>
        <span class="k">def</span> <span class="nf">load_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">modal_forces</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">forcing_freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        
        <span class="n">load_func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span> <span class="p">:</span> <span class="n">load_func</span><span class="p">}</span>
        
        <span class="c1"># Define and run time-stepping analysis</span>
        <span class="n">tstep_analysis</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">dynsys_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                     <span class="n">force_func_dict</span><span class="o">=</span><span class="n">load_func_dict</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">tstep_kwargs</span><span class="p">)</span>
        
        <span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_analysis</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>  
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_results</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Results from time-stepping analysis; instance of `TStep_Results()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Time-stepping analysis complete!***&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.deck_area" class="name">var <span class="ident">deck_area</span></p>
            

            
  
    <div class="desc"><p>Total deck area ($m^2$), obtained by integration over all deck strips</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.deck_regions_list" class="name">var <span class="ident">deck_regions_list</span></p>
            

            
  
    <div class="desc"><p>List of DeckStrip classes, defining deck strips</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.eta" class="name">var <span class="ident">eta</span></p>
            

            
  
    <div class="desc"><p>Damping ratios for system modes</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.f_d" class="name">var <span class="ident">f_d</span></p>
            

            
  
    <div class="desc"><p>Damped natural frequencies of system being analysed</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.max_modeshape" class="name">var <span class="ident">max_modeshape</span></p>
            

            
  
    <div class="desc"><p>Maximum |modeshape| ordinates, evaluated over all deck regions.
Array of length equal to number of modes considered</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.modalsys_obj" class="name">var <span class="ident">modalsys_obj</span></p>
            

            
  
    <div class="desc"><p><code>ModalSys</code> object, corresponding to system being analysed</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.nRegions" class="name">var <span class="ident">nRegions</span></p>
            

            
  
    <div class="desc"><p>Integer, denotes number deck regions</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.name" class="name">var <span class="ident">name</span></p>
            

            
  
    <div class="desc"><p>Name assigned to class instance</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.response_amplitudes" class="name">var <span class="ident">response_amplitudes</span></p>
            

            
  
    <div class="desc"><p>Amplitudes of defined responses</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.SteadyStateCrowdLoading.response_names" class="name">var <span class="ident">response_names</span></p>
            

            
  
    <div class="desc"><p>Names of responses computed</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="ped_dyn.UKNA_BSEN1991_2_crowd" class="name">class <span class="ident">UKNA_BSEN1991_2_crowd</span></p>
      
  
    <div class="desc"><p>Class to implement steady state crowd loading analysis 
to UK NA to BS EN1991-2</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_crowd</span><span class="p">(</span><span class="n">SteadyStateCrowdLoading</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Class to implement steady state crowd loading analysis </span>
<span class="sd">    to UK NA to BS EN1991-2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">crowd_density</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">load_direction</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * `bridgeClass`, string character (&#39;A&#39; to &#39;D&#39;), defines bridge class</span>
<span class="sd">          per UK NA to BS EN1991-2</span>
<span class="sd">          </span>
<span class="sd">        * `crowd_density`, float, defines crowd density (P/m2). Note only used </span>
<span class="sd">          if `bridgeClass=None`</span>
<span class="sd">          </span>
<span class="sd">        * `load_direction`, string, either &#39;vertical&#39; or &#39;lateral&#39; required</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="n">bridgeClass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
            <span class="k">if</span> <span class="n">crowd_density</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either `bridgeClass` or `crowd_density` required&quot;</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bridgeClass</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`bridgeClass` to be string character&quot;</span><span class="p">)</span>
                
            <span class="k">else</span><span class="p">:</span>
                <span class="c1"># correct to uppercase</span>
                <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Bridge class per Table NA.7</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">crowd_density</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Crowd density (P/m2)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">load_direction</span> <span class="o">=</span> <span class="n">load_direction</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Direction of applied crowd loading</span>
<span class="sd">        &quot;&quot;&quot;</span>
               
        <span class="c1"># Run parent init function</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        
    <span class="k">def</span> <span class="nf">get_crowd_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                          <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                          <span class="n">saveAsAttr</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get crowd density according from Table NA.7, UK NA to BS EN </span>
<span class="sd">        1991-2, according to `bridgeClass`</span>

<span class="sd">        Returns density expressed as persons/m2</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># Define crowd density via bridge class, if defined</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        
            <span class="n">bridgeClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span>

            <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
                <span class="n">density</span><span class="o">=</span><span class="mf">0.0</span>
    
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
                <span class="n">density</span><span class="o">=</span><span class="mf">0.4</span>
    
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
                <span class="n">density</span><span class="o">=</span><span class="mf">0.8</span>
    
            <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
                <span class="n">density</span><span class="o">=</span><span class="mf">1.5</span>
    
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
             
        <span class="c1"># Otherwise use pre-defined density</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">density</span>

        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Crowd density (persons/m2): </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">density</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">density</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Crowd density = 0; no analysis required!&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">density</span>
       
    
    <span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                            <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                            <span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">load_direction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                            <span class="n">calc_lambda</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                            <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculates required load intensity (N/m2) to UK NA to BS EN 1991-2</span>
<span class="sd">        </span>
<span class="sd">        ![Cl_2_44_5](../dynsys/img/UKNA_BSEN1991_2_Cl_2_44_5.png)</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">load_direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">load_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_direction</span>
        
        <span class="c1"># Retrieve attributes    </span>
        <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span>
        <span class="n">max_modeshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_modeshape</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>
        
        <span class="c1"># Get crowd density according to bridgeClass</span>
        <span class="c1"># Crowd density, expressed in persons/m2</span>
        <span class="n">crowd_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crowd_density</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        
        <span class="c1"># Get total number of pedestrians</span>
        <span class="n">N</span> <span class="o">=</span> <span class="n">crowd_density</span> <span class="o">*</span> <span class="n">A</span>
        
        <span class="c1"># Define code inputs</span>
        <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="mf">280.0</span>
            <span class="c1"># N, refer Table NA.8</span>
            <span class="c1"># n.b &#39;walkers&#39; value to be used in crowd loading calcs</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="mf">70.0</span>  <span class="c1"># N, refer Tue 24/07/2018 12:56 Chris Barker email</span>

        <span class="c1"># Derive adjustment factors</span>
        <span class="k">if</span> <span class="n">fv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># If not provided explicitly set to damped frequency of target mode</span>
            <span class="n">fv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
            
        <span class="n">k</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span>
                                        <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                                        <span class="n">load_direction</span><span class="o">=</span><span class="n">load_direction</span><span class="p">,</span>
                                        <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        
        <span class="n">log_dec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>

        <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logDec</span><span class="o">=</span><span class="n">log_dec</span><span class="p">,</span>
                                            <span class="n">groupType</span><span class="o">=</span><span class="s2">&quot;crowd&quot;</span><span class="p">,</span>
                                            <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        
        <span class="c1"># Effective number of pedestrians parameter, refer NA. 2.44.5(1)</span>
        <span class="c1"># To generalise to deck of variable width, use area ratio as Seff/S</span>
        <span class="k">if</span> <span class="n">calc_lambda</span><span class="p">:</span>
            <span class="n">Aeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_areas</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.634</span> <span class="o">*</span> <span class="n">max_modeshape</span><span class="p">)</span>
            <span class="n">lambda_val</span> <span class="o">=</span> <span class="mf">0.634</span><span class="o">*</span><span class="n">Aeff</span><span class="o">/</span><span class="n">A</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lambda_val</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># conservative according to text - but not always!</span>
    
        <span class="c1"># Calculate load intensity per NA.2.44.5(1)</span>
        <span class="n">load_intensity</span> <span class="o">=</span> <span class="mf">1.8</span><span class="o">*</span><span class="p">(</span><span class="n">F0</span><span class="o">/</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">((</span><span class="n">gamma</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="n">lambda_val</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
        
        <span class="c1"># Prepare markdown string of nicely formatted text</span>
        <span class="n">md_txt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;Key results from UK NA to BS EN 1991-2 load intensity calculation:&quot;</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;F0        = </span><span class="si">%.1f</span><span class="se">\t</span><span class="s2">(N)&quot;</span> <span class="o">%</span> <span class="n">F0</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;A         = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(m2)&quot;</span> <span class="o">%</span> <span class="n">A</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;gamma_max = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">max_modeshape</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Aeff      = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(m2)&quot;</span> <span class="o">%</span> <span class="n">Aeff</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;rho       = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(P/m2)&quot;</span> <span class="o">%</span> <span class="n">crowd_density</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;N         = </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">N</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;fv        = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">(Hz)&quot;</span> <span class="o">%</span> <span class="n">fv</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;k         = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">k</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;log_dec   = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">log_dec</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;gamma     = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;lambda    = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">lambda_val</span>
        <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;w         = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">(N/m2)&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">md_txt</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>    

        <span class="c1"># Prepare dict to return key results</span>
        <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;F0&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">F0</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;fv&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">fv</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">crowd_density</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">N</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">k</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;lambda&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">lambda_val</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;log_dec&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">log_dec</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">load_intensity</span>
        <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;md_txt&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">md_txt</span>

        <span class="k">return</span> <span class="n">load_intensity</span><span class="p">,</span> <span class="n">results_dict</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#ped_dyn.UKNA_BSEN1991_2_crowd">UKNA_BSEN1991_2_crowd</a></li>
          <li><a href="#ped_dyn.SteadyStateCrowdLoading">SteadyStateCrowdLoading</a></li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, bridgeClass=None, crowd_density=None, load_direction=&#39;vertical&#39;, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>bridgeClass</code>, string character ('A' to 'D'), defines bridge class
  per UK NA to BS EN1991-2</p>
</li>
<li>
<p><code>crowd_density</code>, float, defines crowd density (P/m2). Note only used 
  if <code>bridgeClass=None</code></p>
</li>
<li>
<p><code>load_direction</code>, string, either 'vertical' or 'lateral' required</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.__init__', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">bridgeClass</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">crowd_density</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">load_direction</span><span class="o">=</span><span class="s1">&#39;vertical&#39;</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * `bridgeClass`, string character (&#39;A&#39; to &#39;D&#39;), defines bridge class</span>
<span class="sd">      per UK NA to BS EN1991-2</span>
<span class="sd">      </span>
<span class="sd">    * `crowd_density`, float, defines crowd density (P/m2). Note only used </span>
<span class="sd">      if `bridgeClass=None`</span>
<span class="sd">      </span>
<span class="sd">    * `load_direction`, string, either &#39;vertical&#39; or &#39;lateral&#39; required</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">bridgeClass</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
    
        <span class="k">if</span> <span class="n">crowd_density</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Either `bridgeClass` or `crowd_density` required&quot;</span><span class="p">)</span>
    
    <span class="k">else</span><span class="p">:</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">bridgeClass</span><span class="p">,</span><span class="nb">str</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`bridgeClass` to be string character&quot;</span><span class="p">)</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># correct to uppercase</span>
            <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Bridge class per Table NA.7</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">crowd_density</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Crowd density (P/m2)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">load_direction</span> <span class="o">=</span> <span class="n">load_direction</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Direction of applied crowd loading</span>
<span class="sd">    &quot;&quot;&quot;</span>
           
    <span class="c1"># Run parent init function</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.calc_deck_area">
    <p>def <span class="ident">calc_deck_area</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns the total deck area, taken across all deck strips</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.calc_deck_area', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.calc_deck_area" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_deck_area</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns the total deck area, taken across all deck strips</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">total_area</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">calc_area</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">total_area</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.calc_load_intensity">
    <p>def <span class="ident">calc_load_intensity</span>(</p><p>self, mode_index, fv=None, load_direction=None, calc_lambda=True, verbose=True, makePlot=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculates required load intensity (N/m2) to UK NA to BS EN 1991-2</p>
<p><img alt="Cl_2_44_5" src="../dynsys/img/UKNA_BSEN1991_2_Cl_2_44_5.png" /></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.calc_load_intensity', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.calc_load_intensity" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_load_intensity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                        <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                        <span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">load_direction</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                        <span class="n">calc_lambda</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                        <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates required load intensity (N/m2) to UK NA to BS EN 1991-2</span>
<span class="sd">    </span>
<span class="sd">    ![Cl_2_44_5](../dynsys/img/UKNA_BSEN1991_2_Cl_2_44_5.png)</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">load_direction</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">load_direction</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_direction</span>
    
    <span class="c1"># Retrieve attributes    </span>
    <span class="n">A</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span>
    <span class="n">max_modeshape</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">max_modeshape</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>
    
    <span class="c1"># Get crowd density according to bridgeClass</span>
    <span class="c1"># Crowd density, expressed in persons/m2</span>
    <span class="n">crowd_density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_crowd_density</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
    
    <span class="c1"># Get total number of pedestrians</span>
    <span class="n">N</span> <span class="o">=</span> <span class="n">crowd_density</span> <span class="o">*</span> <span class="n">A</span>
    
    <span class="c1"># Define code inputs</span>
    <span class="k">if</span> <span class="n">load_direction</span> <span class="o">==</span> <span class="s1">&#39;vertical&#39;</span><span class="p">:</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="mf">280.0</span>
        <span class="c1"># N, refer Table NA.8</span>
        <span class="c1"># n.b &#39;walkers&#39; value to be used in crowd loading calcs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="mf">70.0</span>  <span class="c1"># N, refer Tue 24/07/2018 12:56 Chris Barker email</span>
    <span class="c1"># Derive adjustment factors</span>
    <span class="k">if</span> <span class="n">fv</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># If not provided explicitly set to damped frequency of target mode</span>
        <span class="n">fv</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
        
    <span class="n">k</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span>
                                    <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                                    <span class="n">load_direction</span><span class="o">=</span><span class="n">load_direction</span><span class="p">,</span>
                                    <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
    
    <span class="n">log_dec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">eta</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logDec</span><span class="o">=</span><span class="n">log_dec</span><span class="p">,</span>
                                        <span class="n">groupType</span><span class="o">=</span><span class="s2">&quot;crowd&quot;</span><span class="p">,</span>
                                        <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
    
    <span class="c1"># Effective number of pedestrians parameter, refer NA. 2.44.5(1)</span>
    <span class="c1"># To generalise to deck of variable width, use area ratio as Seff/S</span>
    <span class="k">if</span> <span class="n">calc_lambda</span><span class="p">:</span>
        <span class="n">Aeff</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_areas</span><span class="p">[</span><span class="n">mode_index</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.634</span> <span class="o">*</span> <span class="n">max_modeshape</span><span class="p">)</span>
        <span class="n">lambda_val</span> <span class="o">=</span> <span class="mf">0.634</span><span class="o">*</span><span class="n">Aeff</span><span class="o">/</span><span class="n">A</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lambda_val</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># conservative according to text - but not always!</span>

    <span class="c1"># Calculate load intensity per NA.2.44.5(1)</span>
    <span class="n">load_intensity</span> <span class="o">=</span> <span class="mf">1.8</span><span class="o">*</span><span class="p">(</span><span class="n">F0</span><span class="o">/</span><span class="n">A</span><span class="p">)</span><span class="o">*</span><span class="n">k</span><span class="o">*</span><span class="p">((</span><span class="n">gamma</span><span class="o">*</span><span class="n">N</span><span class="o">/</span><span class="n">lambda_val</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
    
    <span class="c1"># Prepare markdown string of nicely formatted text</span>
    <span class="n">md_txt</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;Key results from UK NA to BS EN 1991-2 load intensity calculation:&quot;</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;F0        = </span><span class="si">%.1f</span><span class="se">\t</span><span class="s2">(N)&quot;</span> <span class="o">%</span> <span class="n">F0</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;A         = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(m2)&quot;</span> <span class="o">%</span> <span class="n">A</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;gamma_max = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">max_modeshape</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;Aeff      = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(m2)&quot;</span> <span class="o">%</span> <span class="n">Aeff</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;rho       = </span><span class="si">%.2f</span><span class="se">\t</span><span class="s2">(P/m2)&quot;</span> <span class="o">%</span> <span class="n">crowd_density</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;N         = </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">N</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;fv        = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">(Hz)&quot;</span> <span class="o">%</span> <span class="n">fv</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;k         = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">k</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;log_dec   = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">log_dec</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;gamma     = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;lambda    = </span><span class="si">%.3f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">lambda_val</span>
    <span class="n">md_txt</span> <span class="o">+=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;w         = </span><span class="si">%.3f</span><span class="se">\t</span><span class="s2">(N/m2)&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="n">md_txt</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>    
    <span class="c1"># Prepare dict to return key results</span>
    <span class="n">results_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;F0&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">F0</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;fv&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">fv</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;rho&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">crowd_density</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;N&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">N</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;k&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">k</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;lambda&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">lambda_val</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;log_dec&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">log_dec</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;w&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">load_intensity</span>
    <span class="n">results_dict</span><span class="p">[</span><span class="s2">&quot;md_txt&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">md_txt</span>
    <span class="k">return</span> <span class="n">load_intensity</span><span class="p">,</span> <span class="n">results_dict</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.calc_modal_areas">
    <p>def <span class="ident">calc_modal_areas</span>(</p><p>self, mode_index, makePlot=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns modal area integrals</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.calc_modal_areas', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.calc_modal_areas" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_modal_areas</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns modal area integrals</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sum</span><span class="p">([</span><span class="n">x</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">mode_index</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
                      <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span><span class="p">],</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.calc_responses">
    <p>def <span class="ident">calc_responses</span>(</p><p>self, output_mtrx=None, output_names=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Calculate steady-steady amplitude response of defined responses</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.calc_responses', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.calc_responses" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">calc_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">output_mtrx</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">output_names</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate steady-steady amplitude response of defined responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get output matrix and output names, if not passed to this function</span>
    <span class="k">if</span> <span class="n">output_mtrx</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">output_mtrx</span><span class="p">,</span> <span class="n">output_names</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">GetOutputMtrx</span><span class="p">(</span><span class="n">all_systems</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    
    <span class="c1"># Get frequency response matrix for {disp,vel,accn} variables</span>
    <span class="c1"># (note: assumes already calculated!)</span>
    <span class="n">G_state_vars</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span>
        
    <span class="c1"># Get modal forces</span>
    <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span>
    
    <span class="c1"># Calculate responses at steady-state</span>
    <span class="n">nResponses</span> <span class="o">=</span> <span class="n">output_mtrx</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">nResponses</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">:</span>
            
        <span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">output_mtrx</span> <span class="err">@</span> <span class="n">G_state_vars</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span> <span class="o">=</span> <span class="n">response_amplitudes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span> <span class="o">=</span> <span class="n">output_names</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No output matrix provided. &quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Real-world responses have not been evaluated&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.get_crowd_density">
    <p>def <span class="ident">get_crowd_density</span>(</p><p>self, verbose=True, saveAsAttr=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Get crowd density according from Table NA.7, UK NA to BS EN 
1991-2, according to <code>bridgeClass</code></p>
<p>Returns density expressed as persons/m2</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.get_crowd_density', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.get_crowd_density" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_crowd_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                      <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                      <span class="n">saveAsAttr</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Get crowd density according from Table NA.7, UK NA to BS EN </span>
<span class="sd">    1991-2, according to `bridgeClass`</span>
<span class="sd">    Returns density expressed as persons/m2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Define crowd density via bridge class, if defined</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
    
        <span class="n">bridgeClass</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">bridgeClass</span>
        <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">density</span><span class="o">=</span><span class="mf">0.0</span>

        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
            <span class="n">density</span><span class="o">=</span><span class="mf">0.4</span>

        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">density</span><span class="o">=</span><span class="mf">0.8</span>

        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
            <span class="n">density</span><span class="o">=</span><span class="mf">1.5</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
         
    <span class="c1"># Otherwise use pre-defined density</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">density</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">crowd_density</span> <span class="o">=</span> <span class="n">density</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class: &#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Crowd density (persons/m2): </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">density</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">density</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Crowd density = 0; no analysis required!&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">density</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.get_response_amplitudes">
    <p>def <span class="ident">get_response_amplitudes</span>(</p><p>self, print_phase=False)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns response amplitudes as pandas dataframe</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.get_response_amplitudes', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.get_response_amplitudes" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_response_amplitudes</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">print_phase</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns response amplitudes as pandas dataframe</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
    <span class="n">index_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
    <span class="n">columns_list</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Amplitude&quot;</span><span class="p">]</span>
    
    <span class="k">if</span> <span class="n">print_phase</span><span class="p">:</span>
        <span class="n">phase_angles</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">hstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span><span class="n">phase_angles</span><span class="p">))</span>
        <span class="n">columns_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;Phase angle&quot;</span><span class="p">)</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
                          <span class="n">index</span><span class="o">=</span><span class="n">index_list</span><span class="p">,</span>
                          <span class="n">columns</span><span class="o">=</span><span class="n">columns_list</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">df</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.get_response_stats">
    <p>def <span class="ident">get_response_stats</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns response stats for time-stepping analysis carried out</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.get_response_stats', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.get_response_stats" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">get_response_stats</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns response stats for time-stepping analysis carried out</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: no time-stepping analysis run, &quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;cannot retrieve results!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Get dict of dict of stats</span>
    <span class="n">stats_dict_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">CalcResponseStats</span><span class="p">()</span>
    
    <span class="c1"># Loop over dict and return stats as list of pandas dataframes</span>
    <span class="n">df_list</span> <span class="o">=</span> <span class="p">[]</span>
    
    <span class="k">for</span> <span class="n">sys_obj</span><span class="p">,</span> <span class="n">stats_dict</span> <span class="ow">in</span> <span class="n">stats_dict_dict</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>   
        
        <span class="n">sys_name</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">name</span>
        <span class="n">response_names</span> <span class="o">=</span> <span class="n">sys_obj</span><span class="o">.</span><span class="n">output_names</span>
        
        <span class="n">df</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">stats_dict</span><span class="p">,</span>
                              <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="n">sys_name</span> <span class="o">+</span> <span class="s2">&quot; - &quot;</span> <span class="o">+</span> <span class="n">x</span>
                                     <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_names</span><span class="p">])</span>
        
        <span class="n">df_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="c1"># Merge pandas dataframes to return a single dataframe</span>
    <span class="c1"># with all stats for all responses for all systems</span>
    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">pandas</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">df_list</span><span class="p">)</span>
    
    <span class="c1"># Transpose such that stats as indexes, responses as columns</span>
    <span class="n">df_merged</span> <span class="o">=</span> <span class="n">df_merged</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
            
    <span class="k">return</span> <span class="n">df_merged</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.plot_results">
    <p>def <span class="ident">plot_results</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots results of steady-state response analysis</p>
<p>If time-stepping analysis has also been carried out (as a cross-check) 
results of that analysis will be plotted also</p>
<hr />
<p><strong>Required:</strong></p>
<p>(No arguments required)</p>
<hr />
<p><strong>Optional:</strong></p>
<ul>
<li><code>overlay_val</code>, <em>float</em>, value to overlay onto response plots. 
  (A common use of this would be to overlay the applicable acceleration 
  limit, against which responses are to be compared)</li>
</ul>
<hr />
<p><strong>Returns:</strong></p>
<p><em>Nested list</em> of figure objects</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots results of steady-state response analysis</span>
<span class="sd">    </span>
<span class="sd">    If time-stepping analysis has also been carried out (as a cross-check) </span>
<span class="sd">    results of that analysis will be plotted also</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    </span>
<span class="sd">    **Required:**</span>
<span class="sd">    </span>
<span class="sd">    (No arguments required)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Optional:**</span>
<span class="sd">    </span>
<span class="sd">    * `overlay_val`, _float_, value to overlay onto response plots. </span>
<span class="sd">      (A common use of this would be to overlay the applicable acceleration </span>
<span class="sd">      limit, against which responses are to be compared)</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Returns:**</span>
<span class="sd">    </span>
<span class="sd">    _Nested list_ of figure objects</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="n">fig_list</span> <span class="o">=</span> <span class="p">[]</span>
            
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        <span class="n">fig</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_freq_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        <span class="n">fig_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="n">tstep_fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_tstep_method</span><span class="p">(</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
        <span class="n">fig_list</span> <span class="o">+=</span> <span class="n">tstep_fig_list</span>    
    
    <span class="k">return</span> <span class="n">fig_list</span>      
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_freq_method">
    <p>def <span class="ident">plot_results_freq_method</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot results of frequency domain analysis method, if avaliable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_freq_method', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_freq_method" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_freq_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot results of frequency domain analysis method, if avaliable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for frequency domain method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>
    
    <span class="c1"># Produce and configure figure</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axarr</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    
    <span class="n">fig</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s2">&quot;Steady-state pedestrian crowd loading analysis results</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">+</span>
                 <span class="s2">&quot;Target mode: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">8</span><span class="p">))</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">hspace</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
    
    <span class="c1"># Produce bar plot of modal accelerations</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_modal_accn</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    
    <span class="c1"># Produce bar plot of outputs</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_results_responses</span><span class="p">(</span><span class="n">axarr</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">overlay_val</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">fig</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_modal_accn">
    <p>def <span class="ident">plot_results_modal_accn</span>(</p><p>self, ax=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Produce bar plot of steady-state modal accelerations</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_modal_accn', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_modal_accn" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_modal_accn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce bar plot of steady-state modal accelerations</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define axes to plot to, if not done so already</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span>
    
    <span class="c1"># Get or define tick labels</span>
    <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="s1">&#39;mode_IDs&#39;</span><span class="p">):</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">mode_IDs</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Mode </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>
                 <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">nDOF</span><span class="p">)]</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state modal acceleration amplitudes (m/$s^2$)&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_responses">
    <p>def <span class="ident">plot_results_responses</span>(</p><p>self, ax=None, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Produce bar plot of steady-state responses</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_responses', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_responses" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_responses</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Produce bar plot of steady-state responses</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Define axes to plot to, if not done so already</span>
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">((</span><span class="mi">14</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
    <span class="c1"># Get data to use in plot        </span>
    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span>
    <span class="n">ticks</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">response_names</span>
    
    <span class="c1"># Flatten list in case of nested lists (only when multiple subsystems)</span>
    <span class="k">if</span> <span class="n">vals</span><span class="o">.</span><span class="n">shape</span> <span class="o">!=</span> <span class="n">ticks</span><span class="o">.</span><span class="n">shape</span><span class="p">:</span>
        <span class="n">ticks</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="o">.</span><span class="n">tolist</span><span class="p">()))</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">barh</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">vals</span><span class="p">)),</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span><span class="n">tick_label</span><span class="o">=</span><span class="n">ticks</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">labelsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Steady-state response amplitudes&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">overlay_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkorange&#39;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_tstep_method">
    <p>def <span class="ident">plot_results_tstep_method</span>(</p><p>self, overlay_val=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plot results of time-stepping analysis, if avaliable</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_tstep_method', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.plot_results_tstep_method" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_results_tstep_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot results of time-stepping analysis, if avaliable</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;No results avaliable for time-stepping method</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> 
              <span class="s2">&quot;Could not plot results&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">[]</span>
    
    <span class="c1"># Define +/- values based on overlay_val, if provided</span>
    <span class="k">if</span> <span class="n">overlay_val</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">overlay_val</span><span class="o">=</span><span class="p">[</span><span class="o">+</span><span class="n">overlay_val</span><span class="p">,</span><span class="o">-</span><span class="n">overlay_val</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">overlay_val</span><span class="o">=</span><span class="bp">None</span>
    
    <span class="n">fig_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">useCommonPlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                              <span class="n">useCommonScale</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                                              <span class="n">y_overlay</span><span class="o">=</span><span class="n">overlay_val</span><span class="p">)</span>
    

    <span class="c1"># Overlay expected modal acceleration amplitudes</span>
    <span class="c1"># (from steady-state analysis, if run)</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
    
        <span class="n">state_results_fig</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        
        <span class="n">ax</span> <span class="o">=</span> <span class="n">state_results_fig</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()[</span><span class="mi">3</span><span class="p">]</span> <span class="c1"># plot of modal accelerations</span>
        <span class="n">accn_val</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span><span class="p">)</span>    <span class="c1"># value to overlay</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">accn_val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
        
        <span class="c1"># Overlay expected response amplitudes </span>
        <span class="c1"># (from steady-state analysis, if run)</span>
        <span class="n">response_results_fig_list</span> <span class="o">=</span> <span class="n">fig_list</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        
        <span class="n">axarr</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">get_axes</span><span class="p">()</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">response_results_fig_list</span><span class="p">]</span>
        <span class="n">axarr</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">chain</span><span class="p">(</span><span class="o">*</span><span class="n">axarr</span><span class="p">))</span> <span class="c1"># flatten list</span>
        <span class="n">val2overlay</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">axarr</span><span class="p">,</span><span class="n">val2overlay</span><span class="p">):</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">+</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="o">-</span><span class="n">val</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;--&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span> 
            
    <span class="k">return</span> <span class="n">fig_list</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.print_details">
    <p>def <span class="ident">print_details</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints details about the analysis that has been defined</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.print_details', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.print_details" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">print_details</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints details about the analysis that has been defined</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Details of deck regions:&quot;</span><span class="p">)</span>
    
    <span class="n">deck_regions_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_regions_list</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;nRegions: </span><span class="si">%d</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">deck_regions_list</span><span class="p">))</span>
    
    <span class="k">for</span> <span class="n">deckregion_obj</span> <span class="ow">in</span> <span class="n">deck_regions_list</span><span class="p">:</span>
        
        <span class="n">deckregion_obj</span><span class="o">.</span><span class="n">print_details</span><span class="p">()</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Total deck area (m2):</span><span class="se">\n</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">deck_area</span><span class="p">)</span>
    
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Damped natural frequencies of system (Hz):</span><span class="se">\n</span><span class="s2">{0}&quot;</span>
          <span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.print_results">
    <p>def <span class="ident">print_results</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints key results from analysis</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.print_results', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.print_results" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">print_results</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints key results from analysis</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="nf">printcomplex</span><span class="p">(</span><span class="n">vals</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Function for printing magnitude and phase of complex-valued vals</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Magnitudes:</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Phase angles (rad):</span><span class="se">\n</span><span class="s2">{0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">vals</span><span class="p">)))</span>
                
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal forces (N):&quot;</span><span class="p">)</span>
    <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span><span class="p">)</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span><span class="p">:</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal accelerations (m/s2):&quot;</span><span class="p">)</span>
        <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Responses:&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_names</span><span class="p">)</span>
        <span class="n">printcomplex</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">response_amplitudes</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_crowd.run">
    <p>def <span class="ident">run</span>(</p><p>self, target_mode, load_intensity=None, forcing_freq=None, run_freq_method=True, run_tstep=False, tstep_kwargs={}, verbose=False, makePlot={&#39;calc_modal_areas&#39;: False, &#39;calc_load_intensity&#39;: True})</p>
    </div>
    

    
  
    <div class="desc"><p>Runs calculations to determine steady-state crowd loading responses</p>
<hr />
<p><strong>Required:</strong></p>
<ul>
<li><code>target_mode</code>, <em>integer</em>, denotes the mode at which resonance is 
  to be targeted</li>
</ul>
<hr />
<p><strong>Optional:</strong></p>
<ul>
<li>
<p><code>load_intensity</code>, <em>float</em>, denotes the load intensity (in N/m2) 
  to be applied. If <em>None</em>, <code>load_intensity</code> to be calculated 
  using <code>calc_load_intensity()</code> method function.</p>
</li>
<li>
<p><code>forcing_freq</code>, <em>float</em>, defines forcing frequency (in Hz) at which 
  response is to be determined. For ordinary modal systems with no 
  added dampers this value should normally be set to equal the damped 
  natural frequency for the mode given by <code>target_mode</code>, as this will 
  ensure the worst-case resonance response is obtained. This is thus 
  the default behaviour. However is some circumstances 
  (e.g. systems with multiple TMDs appended) it is necessary to 
  evaluate responses at various assumed forcing frequencies, 
  hence why this optional input is provided to the user.</p>
</li>
<li>
<p><code>run_freq_method</code>, <em>boolean</em>, if True the amplitude of modal and 
  real-world responses at steady-state will be determine by frequency 
  transfer matrix method. This is the default behaviour, as it allows 
  the steady-state amplitudes of responses to be efficiently 
  calculated. In some cases (e.g. for systems with constraints, for 
  which the <code>DynSys.CalcFreqResponse()</code> method is not currently 
  implemented), it may be desirable to carry out a time-stepping 
  analysis instead. This can be done by setting <code>run_freq_method=False</code> 
  and <code>run_tstep=True</code> (see documentation in next bullet for further 
  details)</p>
</li>
<li>
<p><code>run_tstep</code>, <em>boolean</em>, if True a time-stepping analysis will be run, 
  which can be used to verify the the steady-state resonance solution 
  that is ordinarily obtained.</p>
</li>
<li>
<p><code>tstep_kwargs</code>, <em>dict</em> of keyword arguments to be passed when 
  initialising time-stepping analysis using the <code>TStep()</code> class. Only 
  used if <code>run_tstep</code> is True. 
  Refer <a href="../docs/tstep.html">documentation</a> for <code>TStep()</code> 
  class for more details.</p>
</li>
<li>
<p><code>makePlot</code>, <em>dict</em> or <em>bool</em>, used to control which plots are 
  produced</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_crowd.run', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_crowd.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">target_mode</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
        <span class="n">load_intensity</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">forcing_freq</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
        <span class="n">run_freq_method</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">run_tstep</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">tstep_kwargs</span><span class="p">:</span><span class="nb">dict</span><span class="o">=</span><span class="p">{},</span>
        <span class="n">verbose</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">makePlot</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">:</span><span class="bp">False</span><span class="p">,</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">:</span><span class="bp">True</span><span class="p">}</span>
        <span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs calculations to determine steady-state crowd loading responses</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    **Required:**</span>
<span class="sd">        </span>
<span class="sd">    * `target_mode`, _integer_, denotes the mode at which resonance is </span>
<span class="sd">      to be targeted</span>
<span class="sd">      </span>
<span class="sd">    ***</span>
<span class="sd">    **Optional:**</span>
<span class="sd">    </span>
<span class="sd">    * `load_intensity`, _float_, denotes the load intensity (in N/m2) </span>
<span class="sd">      to be applied. If _None_, `load_intensity` to be calculated </span>
<span class="sd">      using `calc_load_intensity()` method function.</span>
<span class="sd">      </span>
<span class="sd">    * `forcing_freq`, _float_, defines forcing frequency (in Hz) at which </span>
<span class="sd">      response is to be determined. For ordinary modal systems with no </span>
<span class="sd">      added dampers this value should normally be set to equal the damped </span>
<span class="sd">      natural frequency for the mode given by `target_mode`, as this will </span>
<span class="sd">      ensure the worst-case resonance response is obtained. This is thus </span>
<span class="sd">      the default behaviour. However is some circumstances </span>
<span class="sd">      (e.g. systems with multiple TMDs appended) it is necessary to </span>
<span class="sd">      evaluate responses at various assumed forcing frequencies, </span>
<span class="sd">      hence why this optional input is provided to the user.</span>
<span class="sd">      </span>
<span class="sd">    * `run_freq_method`, _boolean_, if True the amplitude of modal and </span>
<span class="sd">      real-world responses at steady-state will be determine by frequency </span>
<span class="sd">      transfer matrix method. This is the default behaviour, as it allows </span>
<span class="sd">      the steady-state amplitudes of responses to be efficiently </span>
<span class="sd">      calculated. In some cases (e.g. for systems with constraints, for </span>
<span class="sd">      which the `DynSys.CalcFreqResponse()` method is not currently </span>
<span class="sd">      implemented), it may be desirable to carry out a time-stepping </span>
<span class="sd">      analysis instead. This can be done by setting `run_freq_method=False` </span>
<span class="sd">      and `run_tstep=True` (see documentation in next bullet for further </span>
<span class="sd">      details)</span>
<span class="sd">      </span>
<span class="sd">    * `run_tstep`, _boolean_, if True a time-stepping analysis will be run, </span>
<span class="sd">      which can be used to verify the the steady-state resonance solution </span>
<span class="sd">      that is ordinarily obtained.</span>
<span class="sd">      </span>
<span class="sd">    * `tstep_kwargs`, _dict_ of keyword arguments to be passed when </span>
<span class="sd">      initialising time-stepping analysis using the `TStep()` class. Only </span>
<span class="sd">      used if `run_tstep` is True. </span>
<span class="sd">      Refer [documentation](../docs/tstep.html) for `TStep()` </span>
<span class="sd">      class for more details.</span>
<span class="sd">      </span>
<span class="sd">    * `makePlot`, _dict_ or _bool_, used to control which plots are </span>
<span class="sd">      produced</span>
<span class="sd">      </span>
<span class="sd">      [documentation]: </span>
<span class="sd">      </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">**** Running steady-state crowd loading analysis ****&quot;</span><span class="p">)</span>
    
    <span class="c1"># Handle makePlot</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">makePlot</span><span class="p">,</span><span class="nb">bool</span><span class="p">):</span>
        
        <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
        <span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">]</span><span class="o">=</span><span class="n">makePlot</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="n">makePlot_dict</span> <span class="o">=</span> <span class="n">makePlot</span>
    
    
    
    <span class="bp">self</span><span class="o">.</span><span class="n">target_mode</span> <span class="o">=</span> <span class="n">target_mode</span>
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Target mode index: </span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">target_mode</span><span class="p">)</span>
    
    <span class="c1"># Define forcing frequency</span>
    <span class="k">if</span> <span class="n">forcing_freq</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        
        <span class="c1"># Set to be damped natural frequency of mode being targeted</span>
        <span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">f_d</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
        
    <span class="k">else</span><span class="p">:</span> <span class="c1"># where input value provided via optional arg</span>
        
        <span class="c1"># Check float type is provided</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">,</span><span class="nb">float</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Error: float expected for `forcing_freq`&quot;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">forcing_freq</span> <span class="o">=</span> <span class="n">forcing_freq</span>
    
    <span class="c1"># Obtain area integrals over all deck strips</span>
    <span class="n">modal_areas</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_modal_areas</span><span class="p">(</span><span class="n">target_mode</span><span class="p">,</span>
                                        <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_modal_areas&#39;</span><span class="p">])</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">modal_areas</span> <span class="o">=</span> <span class="n">modal_areas</span>
    
    <span class="c1"># Calculate load intensity, if not provided directly</span>
    <span class="k">if</span> <span class="n">load_intensity</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">load_intensity</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">calc_load_intensity</span><span class="p">(</span><span class="n">mode_index</span><span class="o">=</span><span class="n">target_mode</span><span class="p">,</span>
                                                     <span class="n">fv</span><span class="o">=</span><span class="n">forcing_freq</span><span class="p">,</span>
                                                     <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                                     <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot_dict</span><span class="p">[</span><span class="s1">&#39;calc_load_intensity&#39;</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>  <span class="c1"># null dict</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">=</span> <span class="n">load_intensity</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Uniform load intensity (in N/m2) to be applied to deck regions</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity_rslts_dict</span> <span class="o">=</span> <span class="n">d</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    _Dict_ to store key results from load intensity calculation</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span> <span class="k">print</span><span class="p">(</span><span class="s2">&quot;UDL intensity (N/m2): </span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">load_intensity</span><span class="p">)</span>
             
    <span class="c1"># Multiply by load intensity to obtain modal force amplitudes</span>
    <span class="c1"># Note modal force amplitudes should be regarded as complex variables </span>
    <span class="c1"># (although here they will be real-valued) whereby negative values </span>
    <span class="c1"># imply a force which is 180 degrees out of phase</span>
    <span class="n">modal_forces</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_intensity</span> <span class="o">*</span> <span class="n">modal_areas</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">modal_forces</span> <span class="o">=</span> <span class="n">modal_forces</span>
        
    <span class="c1"># Save settings used to determine which analyses run</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_freq_method</span> <span class="o">=</span> <span class="n">run_freq_method</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">run_tstep</span> <span class="o">=</span> <span class="n">run_tstep</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Forcing frequency: </span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">forcing_freq</span><span class="p">)</span>
    
    <span class="c1"># Run frequency domain method to determine steady-state responses               </span>
    <span class="k">if</span> <span class="n">run_freq_method</span><span class="p">:</span>
        
        <span class="c1"># Evaluate frequency transfer functions G(f) relating applied forces </span>
        <span class="c1"># (i.e. modal forces in this application) to DOF accelerations, </span>
        <span class="c1"># displacements and velocities</span>
        <span class="c1"># (i.e. modal disp, vel, accn in this application)</span>
        <span class="c1">#</span>
        <span class="c1"># It is only necessary to evaluate G(f) at resonant frequency for mode </span>
        <span class="c1"># being targeted, although for validation / plotting it may be </span>
        <span class="c1"># advantageous to evaluate G(f) over a wider frequency range</span>
        <span class="c1">#</span>
        <span class="c1"># By definition, G(f1) is a matrix that can be used to relate </span>
        <span class="c1"># sinusoidal modal forces to sinusoidal modal accelerations, </span>
        <span class="c1"># given forcing frequency f1.</span>
        <span class="c1">#</span>
        <span class="c1"># Note: G(f) will in general be complex-valued; the should be </span>
        <span class="c1"># intepreted to denote scaling and phase lag</span>
        
        <span class="c1"># Calculate matrix mapping applied loads to state DOFs</span>
        <span class="k">def</span> <span class="nf">Calc_Gf</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
            <span class="n">rslts</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcFreqResponse</span><span class="p">(</span><span class="n">fVals</span><span class="o">=</span><span class="n">f</span><span class="p">,</span>
                                                       <span class="n">C</span><span class="o">=</span><span class="n">numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">0</span><span class="p">,)),</span>
                                                       <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
            <span class="n">f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;f&quot;</span><span class="p">]</span>
            <span class="n">G_f</span> <span class="o">=</span> <span class="n">rslts</span><span class="p">[</span><span class="s2">&quot;G_f&quot;</span><span class="p">]</span>
            <span class="k">return</span> <span class="n">f</span><span class="p">,</span> <span class="n">G_f</span>
        
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">Calc_Gf</span><span class="p">(</span><span class="n">forcing_freq</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">0</span><span class="p">,:,:]</span>
        
        <span class="c1"># Retain only submatrix mapping modal forces to state DOFs</span>
        <span class="n">nModes</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">modal_forces</span><span class="p">)</span>
        <span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[:,:</span><span class="n">nModes</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">G_state_vars</span> <span class="o">=</span> <span class="n">G_state_vars</span>
        
        <span class="c1"># Get submatrix mapping applied forces to DOF accelerations</span>
        <span class="n">nDOF</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">G_state_vars</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">/</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">G_acc</span> <span class="o">=</span> <span class="n">G_state_vars</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">nDOF</span><span class="p">:,:]</span>
        
        <span class="c1"># Get submatrix mapping modal forces to m accelerations</span>
        <span class="n">G_modalacc</span> <span class="o">=</span> <span class="n">G_acc</span><span class="p">[:</span><span class="n">nModes</span><span class="p">,:</span><span class="n">nModes</span><span class="p">]</span>
        
        <span class="c1"># Calculate modal acceleration amplitudes using transfer matrix</span>
        <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">G_modalacc</span> <span class="err">@</span> <span class="n">modal_forces</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span>
        
        <span class="c1"># Adjust phase such that acc for target mode has phase=0</span>
        <span class="n">z1</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mi">1j</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">]))</span>
        <span class="n">modal_accn</span> <span class="o">=</span> <span class="n">modal_accn</span> <span class="o">/</span> <span class="n">z1</span>
        
        <span class="c1"># Get modal acceleration of targeted mode</span>
        <span class="c1"># Note phase=0 due to above adjustment, hence ok to take real part only</span>
        <span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">modal_accn</span><span class="p">[</span><span class="n">target_mode</span><span class="p">])</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">modal_accn_target</span> <span class="o">=</span> <span class="n">modal_accn_target</span>
                       
        <span class="c1"># Calculate responses amplitudes using full transfer matrix</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">calc_responses</span><span class="p">()</span>
          
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;**** Analysis complete! ****</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">run_tstep</span><span class="p">:</span>
        
        <span class="c1"># Run time-stepping analysis to validate /check the above approach</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Running time-stepping analysis, as cross-check of &quot;</span><span class="o">+</span>
              <span class="s2">&quot;steady-state resonance approach...***&quot;</span><span class="p">)</span>
                    
        <span class="c1"># Define sinusoidal load function consistent with above</span>
        <span class="k">def</span> <span class="nf">load_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">modal_forces</span> <span class="o">*</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">forcing_freq</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        
        <span class="n">load_func_dict</span> <span class="o">=</span> <span class="p">{</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span> <span class="p">:</span> <span class="n">load_func</span><span class="p">}</span>
        
        <span class="c1"># Define and run time-stepping analysis</span>
        <span class="n">tstep_analysis</span> <span class="o">=</span> <span class="n">tstep</span><span class="o">.</span><span class="n">TStep</span><span class="p">(</span><span class="n">dynsys_obj</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">modalsys_obj</span><span class="p">,</span>
                                     <span class="n">force_func_dict</span><span class="o">=</span><span class="n">load_func_dict</span><span class="p">,</span>
                                     <span class="o">**</span><span class="n">tstep_kwargs</span><span class="p">)</span>
        
        <span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_analysis</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>  
        
        <span class="bp">self</span><span class="o">.</span><span class="n">tstep_results</span> <span class="o">=</span> <span class="n">tstep_results</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Results from time-stepping analysis; instance of `TStep_Results()`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***Time-stepping analysis complete!***&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_crowd.bridgeClass" class="name">var <span class="ident">bridgeClass</span></p>
            

            
  
    <div class="desc"><p>Bridge class per Table NA.7</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_crowd.crowd_density" class="name">var <span class="ident">crowd_density</span></p>
            

            
  
    <div class="desc"><p>Crowd density (P/m2)</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_crowd.load_direction" class="name">var <span class="ident">load_direction</span></p>
            

            
  
    <div class="desc"><p>Direction of applied crowd loading</p></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers" class="name">class <span class="ident">UKNA_BSEN1991_2_walkers_joggers</span></p>
      
  
    <div class="desc"><p>Implements transient analysis for walkers/joggers case
per NA.2.44.4 of UK NA to BS EN 1992-1:2003</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_walkers_joggers</span><span class="p">(</span><span class="n">dyn_analysis</span><span class="o">.</span><span class="n">MovingLoadAnalysis</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Implements transient analysis for walkers/joggers case</span>
<span class="sd">    per NA.2.44.4 of UK NA to BS EN 1992-1:2003</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">modalsys_obj</span><span class="p">,</span>
                 <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
                 <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
                 <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                 <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                 <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
                 <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                 <span class="n">dt_factor</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
                 <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialisation function</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">           </span>
<span class="sd">        * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">        </span>
<span class="sd">        * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">          to targeted</span>
<span class="sd">    </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">            </span>
<span class="sd">        * `dt`, time step to be used for results evaluation. If _None_ then </span>
<span class="sd">          a suitable `dt` to use will be determined according to </span>
<span class="sd">          `dt_factor` (see below)</span>
<span class="sd">          </span>
<span class="sd">        * `dt_factor`, factor to apply to damped natural frequency `f_d` of </span>
<span class="sd">          mode under consideration, for the purpose of determining </span>
<span class="sd">          appropriate `dt` value (see above):</span>
<span class="sd">          `dt = 1 / (dt_factor * f_d)`.</span>
<span class="sd">          Note only used if `dt=None`</span>
<span class="sd">        </span>
<span class="sd">        * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">          computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">          used (conservative)</span>
<span class="sd">        </span>
<span class="sd">        Additional keyword arguments can be defined. These should relate </span>
<span class="sd">        the `__init__()` function of the `MovingLoadAnalysis` class </span>
<span class="sd">            </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Create default name for analysis object</span>
        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="p">,</span>
                                                            <span class="n">analysis_type</span><span class="p">)</span>
        
        <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
        <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
            <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">2</span>
            <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">0</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
            <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">4</span>
            <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">1</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
            <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">8</span>
            <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">2</span>
            
        <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
            <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">16</span>
            <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">4</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
        
        <span class="c1"># Define loading velocity per Table NA.8</span>
        <span class="c1"># Get appropriate N value to use</span>
        <span class="k">if</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
            <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">1.7</span>
            <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_walkers</span>
            
        <span class="k">elif</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
            <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">3.0</span>
            <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_joggers</span>
            
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span><span class="p">)</span>
            
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N_to_use</span>
            
        <span class="c1"># Get natural frequency of mode to consider</span>
        <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
        <span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">]</span> <span class="c1"># damped natural frequencies of mode</span>
        <span class="n">f_d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
        
        <span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="n">mode_index</span><span class="p">]</span>
        <span class="n">logdec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logdec</span> <span class="o">=</span> <span class="n">logdec</span>
        
        <span class="c1"># Analyse modeshape to determine effective span</span>
        <span class="n">S</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
        
        <span class="k">if</span> <span class="n">calc_Seff</span><span class="p">:</span>
            
            <span class="n">attrName</span> <span class="o">=</span> <span class="s2">&quot;Seff&quot;</span>
            
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">):</span>
                <span class="n">Seff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">)</span>
            
            <span class="k">else</span><span class="p">:</span>
                
                <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">Calc_Seff</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span>
                                              <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                              <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
                
                <span class="c1"># save to avoid recalculating</span>
                <span class="nb">setattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span> 
                <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">lambda_vals</span>
                
            <span class="c1"># Get Seff for mode being considered</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Seff</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mode_index</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                        
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># &quot;In all cases it is conservative to use Seff = S&quot;</span>
            <span class="n">Seff</span> <span class="o">=</span> <span class="n">S</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span>
        
        <span class="c1"># Obtain gamma from Figure NA.9</span>
        <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logdec</span><span class="p">,</span><span class="n">Seff</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        
        <span class="c1"># Define loading objects to represent walkers and joggers</span>
        <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_walkers_joggers_loading</span><span class="p">(</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span><span class="p">,</span>
                                                              <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                                              <span class="n">N</span><span class="o">=</span><span class="n">N_to_use</span><span class="p">,</span>
                                                              <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">,</span>
                                                              <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        
        <span class="c1"># Determine reasonable time step to use</span>
        <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
            <span class="c1"># Rule of thumb - 10x frequency under consideration</span>
            <span class="n">fs</span> <span class="o">=</span> <span class="n">dt_factor</span> <span class="o">*</span> <span class="n">f_d</span>
            <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span>  
        
        <span class="c1"># Run parent init</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                         <span class="n">loadtrain_obj</span><span class="o">=</span><span class="n">loading_obj</span><span class="p">,</span>
                         <span class="n">loadVel</span><span class="o">=</span><span class="n">load_velocity</span><span class="p">,</span>
                         <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c1"># use sign-corrected modeshapes</span>
                         <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                         <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Transient moving load analysis initialised *****&quot;</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal system:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode index:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode frequency:</span><span class="se">\t\t</span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">f_d</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Loading object:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity:</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2"> m/s&quot;</span> <span class="o">%</span> <span class="n">load_velocity</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Seff</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;gamma:</span><span class="se">\t\t\t</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers">UKNA_BSEN1991_2_walkers_joggers</a></li>
          <li>dyn_analysis.MovingLoadAnalysis</li>
          <li>dyn_analysis.Dyn_Analysis</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, modalsys_obj, mode_index, name=None, bridgeClass=&#39;A&#39;, analysis_type=&#39;walkers&#39;, dt=None, verbose=True, calc_Seff=True, makePlot=False, dt_factor=20, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Initialisation function</p>
<hr />
<p>Required:</p>
<ul>
<li>
<p><code>modalsys_obj</code>, object defining modal system to be analysed</p>
</li>
<li>
<p><code>mode_index</code>, <em>integer</em> to denote mode at which resonance should 
  to targeted</p>
</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>dt</code>, time step to be used for results evaluation. If <em>None</em> then 
  a suitable <code>dt</code> to use will be determined according to 
  <code>dt_factor</code> (see below)</p>
</li>
<li>
<p><code>dt_factor</code>, factor to apply to damped natural frequency <code>f_d</code> of 
  mode under consideration, for the purpose of determining 
  appropriate <code>dt</code> value (see above):
  <code>dt = 1 / (dt_factor * f_d)</code>.
  Note only used if <code>dt=None</code></p>
</li>
<li>
<p>calc_Seff`, <em>boolean</em>, dictates whether effective span will be 
  computed according to Figure NA.7. If False, overall span will be 
  used (conservative)</p>
</li>
</ul>
<p>Additional keyword arguments can be defined. These should relate 
the <code>__init__()</code> function of the <code>MovingLoadAnalysis</code> class</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers.__init__', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">modalsys_obj</span><span class="p">,</span>
             <span class="n">mode_index</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span>
             <span class="n">name</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">bridgeClass</span><span class="o">=</span><span class="s1">&#39;A&#39;</span><span class="p">,</span>
             <span class="n">analysis_type</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
             <span class="n">dt</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
             <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">calc_Seff</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
             <span class="n">makePlot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
             <span class="n">dt_factor</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
             <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Initialisation function</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">       </span>
<span class="sd">    * `modalsys_obj`, object defining modal system to be analysed</span>
<span class="sd">    </span>
<span class="sd">    * `mode_index`, _integer_ to denote mode at which resonance should </span>
<span class="sd">      to targeted</span>

<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">        </span>
<span class="sd">    * `dt`, time step to be used for results evaluation. If _None_ then </span>
<span class="sd">      a suitable `dt` to use will be determined according to </span>
<span class="sd">      `dt_factor` (see below)</span>
<span class="sd">      </span>
<span class="sd">    * `dt_factor`, factor to apply to damped natural frequency `f_d` of </span>
<span class="sd">      mode under consideration, for the purpose of determining </span>
<span class="sd">      appropriate `dt` value (see above):</span>
<span class="sd">      `dt = 1 / (dt_factor * f_d)`.</span>
<span class="sd">      Note only used if `dt=None`</span>
<span class="sd">    </span>
<span class="sd">    * calc_Seff`, _boolean_, dictates whether effective span will be </span>
<span class="sd">      computed according to Figure NA.7. If False, overall span will be </span>
<span class="sd">      used (conservative)</span>
<span class="sd">    </span>
<span class="sd">    Additional keyword arguments can be defined. These should relate </span>
<span class="sd">    the `__init__()` function of the `MovingLoadAnalysis` class </span>
<span class="sd">        </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Create default name for analysis object</span>
    <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span> <span class="o">+</span> <span class="s2">&quot; - Mode </span><span class="si">%d</span><span class="s2"> - </span><span class="si">%s</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="p">,</span>
                                                        <span class="n">analysis_type</span><span class="p">)</span>
    
    <span class="c1"># Get applicable parameters per Table NA.7 according to bridgeClass</span>
    <span class="n">bridgeClass</span> <span class="o">=</span> <span class="n">bridgeClass</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;A&#39;</span><span class="p">:</span>
        <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">2</span>
        <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">0</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span>
        <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">1</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span>
        <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">8</span>
        <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">2</span>
        
    <span class="k">elif</span> <span class="n">bridgeClass</span> <span class="o">==</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span>
        <span class="n">N_walkers</span> <span class="o">=</span> <span class="mi">16</span>
        <span class="n">N_joggers</span> <span class="o">=</span> <span class="mi">4</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;bridgeClass&#39;!&quot;</span><span class="p">)</span>
    
    <span class="c1"># Define loading velocity per Table NA.8</span>
    <span class="c1"># Get appropriate N value to use</span>
    <span class="k">if</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
        <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">1.7</span>
        <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_walkers</span>
        
    <span class="k">elif</span> <span class="n">analysis_type</span> <span class="o">==</span> <span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
        <span class="n">load_velocity</span> <span class="o">=</span> <span class="mf">3.0</span>
        <span class="n">N_to_use</span> <span class="o">=</span> <span class="n">N_joggers</span>
        
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span><span class="p">)</span>
        
    <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N_to_use</span>
        
    <span class="c1"># Get natural frequency of mode to consider</span>
    <span class="n">eig_results</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">CalcEigenproperties</span><span class="p">()</span>
    <span class="n">f_d</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;f_d&quot;</span><span class="p">]</span> <span class="c1"># damped natural frequencies of mode</span>
    <span class="n">f_d</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">f_d</span><span class="p">[</span><span class="n">mode_index</span><span class="p">])</span>
    
    <span class="n">eta</span> <span class="o">=</span> <span class="n">eig_results</span><span class="p">[</span><span class="s2">&quot;eta&quot;</span><span class="p">][</span><span class="n">mode_index</span><span class="p">]</span>
    <span class="n">logdec</span> <span class="o">=</span> <span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">eta</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">eta</span> <span class="o">=</span> <span class="n">eta</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">logdec</span> <span class="o">=</span> <span class="n">logdec</span>
    
    <span class="c1"># Analyse modeshape to determine effective span</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">Ltrack</span>
    
    <span class="k">if</span> <span class="n">calc_Seff</span><span class="p">:</span>
        
        <span class="n">attrName</span> <span class="o">=</span> <span class="s2">&quot;Seff&quot;</span>
        
        <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">):</span>
            <span class="n">Seff</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">)</span>
        
        <span class="k">else</span><span class="p">:</span>
            
            <span class="n">Seff</span><span class="p">,</span> <span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">Calc_Seff</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">.</span><span class="n">modeshapeFunc</span><span class="p">,</span><span class="n">S</span><span class="o">=</span><span class="n">S</span><span class="p">,</span>
                                          <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">,</span>
                                          <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
            
            <span class="c1"># save to avoid recalculating</span>
            <span class="nb">setattr</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="p">,</span><span class="n">attrName</span><span class="p">,</span><span class="n">Seff</span><span class="p">)</span> 
            <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">lambda_vals</span> <span class="o">=</span> <span class="n">lambda_vals</span>
            
        <span class="c1"># Get Seff for mode being considered</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">Seff</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">mode_index</span><span class="o">/</span><span class="mi">2</span><span class="p">)]</span>
                    
    <span class="k">else</span><span class="p">:</span>
        <span class="c1"># &quot;In all cases it is conservative to use Seff = S&quot;</span>
        <span class="n">Seff</span> <span class="o">=</span> <span class="n">S</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">Seff</span> <span class="o">=</span> <span class="n">Seff</span>
    
    <span class="c1"># Obtain gamma from Figure NA.9</span>
    <span class="n">gamma</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_9</span><span class="p">(</span><span class="n">logdec</span><span class="p">,</span><span class="n">Seff</span><span class="p">,</span><span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
    
    <span class="c1"># Define loading objects to represent walkers and joggers</span>
    <span class="n">loading_obj</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_walkers_joggers_loading</span><span class="p">(</span><span class="n">fv</span> <span class="o">=</span> <span class="n">f_d</span><span class="p">,</span>
                                                          <span class="n">gamma</span><span class="o">=</span><span class="n">gamma</span><span class="p">,</span>
                                                          <span class="n">N</span><span class="o">=</span><span class="n">N_to_use</span><span class="p">,</span>
                                                          <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">,</span>
                                                          <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
    
    <span class="c1"># Determine reasonable time step to use</span>
    <span class="k">if</span> <span class="n">dt</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="c1"># Rule of thumb - 10x frequency under consideration</span>
        <span class="n">fs</span> <span class="o">=</span> <span class="n">dt_factor</span> <span class="o">*</span> <span class="n">f_d</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">fs</span>  
    
    <span class="c1"># Run parent init</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">modalsys_obj</span><span class="o">=</span><span class="n">modalsys_obj</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="n">name</span><span class="p">,</span>
                     <span class="n">loadtrain_obj</span><span class="o">=</span><span class="n">loading_obj</span><span class="p">,</span>
                     <span class="n">loadVel</span><span class="o">=</span><span class="n">load_velocity</span><span class="p">,</span>
                     <span class="n">use_abs_modeshape</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="c1"># use sign-corrected modeshapes</span>
                     <span class="n">dt</span><span class="o">=</span><span class="n">dt</span><span class="p">,</span>
                     <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Transient moving load analysis initialised *****&quot;</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Modal system:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">modalsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Bridge class:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">bridgeClass</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode index:</span><span class="se">\t\t</span><span class="si">%d</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">mode_index</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Mode frequency:</span><span class="se">\t\t</span><span class="si">%.2f</span><span class="s2"> Hz&quot;</span> <span class="o">%</span> <span class="n">f_d</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Loading object:</span><span class="se">\t\t</span><span class="s2">&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity:</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2"> m/s&quot;</span> <span class="o">%</span> <span class="n">load_velocity</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Seff (m):</span><span class="se">\t\t</span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">Seff</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;gamma:</span><span class="se">\t\t\t</span><span class="si">%.2f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="n">gamma</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.PlotResults">
    <p>def <span class="ident">PlotResults</span>(</p><p>self, dofs2Plot=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots results using <code>tstep_results.PlotResults()</code>.</p>
<p><em>Refer documentation from that function for further details</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers.PlotResults', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers.PlotResults" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">PlotResults</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots results using `tstep_results.PlotResults()`.</span>
<span class="sd">    </span>
<span class="sd">    _Refer documentation from that function for further details_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">results_obj</span><span class="o">.</span><span class="n">PlotResults</span><span class="p">(</span><span class="n">dofs2Plot</span><span class="o">=</span><span class="n">dofs2Plot</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.run">
    <p>def <span class="ident">run</span>(</p><p>self, verbose=True, saveResults=False, save_fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Runs moving load analysis, using <code>tstep.run()</code></p>
<p><em>Refer documentation for that function for more details</em></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers.run', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers.run" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
        <span class="n">verbose</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
        <span class="n">saveResults</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
        <span class="n">save_fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Runs moving load analysis, using `tstep.run()`</span>
<span class="sd">    </span>
<span class="sd">    _Refer documentation for that function for more details_</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Running `</span><span class="si">%s</span><span class="s2">`...&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Dynamic system: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">dynsys_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load pattern: &#39;{0}&#39;&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loading_obj</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load velocity: </span><span class="si">%.1f</span><span class="s2">&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadVel</span><span class="p">)</span>
    
    <span class="n">tic</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    
    <span class="n">results_obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">tstep_obj</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span>
    
    <span class="n">toc</span><span class="o">=</span><span class="n">timeit</span><span class="o">.</span><span class="n">default_timer</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;***** Analysis complete after </span><span class="si">%.3f</span><span class="s2"> seconds.&quot;</span> <span class="o">%</span> <span class="p">(</span><span class="n">toc</span><span class="o">-</span><span class="n">tic</span><span class="p">))</span>
           
    <span class="k">if</span> <span class="n">saveResults</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">fName</span><span class="o">=</span><span class="n">save_fName</span><span class="p">)</span>
        
    <span class="k">return</span> <span class="n">results_obj</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.save">
    <p>def <span class="ident">save</span>(</p><p>self, fName=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Serialises object to file <code>fName</code></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers.save', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers.save" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">save</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">fName</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Serialises object to file `fName`</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">fName</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_pickle_fName</span><span class="p">(</span><span class="n">fName</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fName</span><span class="p">),</span> <span class="s1">&#39;wb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">dill_file</span><span class="p">:</span>
        <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialising `{0}` object to `{1}`&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">fName</span><span class="p">))</span>         
        <span class="n">dill</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">dill_file</span><span class="p">)</span>
        
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Serialisation complete!&quot;</span><span class="p">)</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.N" class="name">var <span class="ident">N</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.Seff" class="name">var <span class="ident">Seff</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.eta" class="name">var <span class="ident">eta</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.fv" class="name">var <span class="ident">fv</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.gamma" class="name">var <span class="ident">gamma</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers.logdec" class="name">var <span class="ident">logdec</span></p>
            

            
  
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>
      
      <div class="item">
      <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading" class="name">class <span class="ident">UKNA_BSEN1991_2_walkers_joggers_loading</span></p>
      
  
    <div class="desc"><p>Defines moving point load to represent the action of walkers / joggers
per NA.2.44.4 of BS EN 1991-2</p>
<p><img alt="NA.2.44.4" src="../dynsys/img/UKNA_BSEN1991_2_NA2_44_4.PNG" /></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading" class="source">
    <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">UKNA_BSEN1991_2_walkers_joggers_loading</span><span class="p">(</span><span class="n">loading</span><span class="o">.</span><span class="n">LoadTrain</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines moving point load to represent the action of walkers / joggers</span>
<span class="sd">    per NA.2.44.4 of BS EN 1991-2</span>
<span class="sd">    </span>
<span class="sd">    ![NA.2.44.4](../dynsys/img/UKNA_BSEN1991_2_NA2_44_4.PNG)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
                 <span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
                 <span class="n">gamma</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
                 <span class="n">N</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                 <span class="n">analysis_type</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
                 <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Defines fluctuating point load to represent either walkers or joggers </span>
<span class="sd">        according to NA.2.44.4, UK NA to BS EN 1991-2</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Required:</span>
<span class="sd">        </span>
<span class="sd">        * `fv`, natural frequency (Hz) of the mode under consideration</span>
<span class="sd">        </span>
<span class="sd">        ***</span>
<span class="sd">        Optional:</span>
<span class="sd">        </span>
<span class="sd">        * `gamma`, reduction factor to allow for unsynchronised actions in a </span>
<span class="sd">          pedestrian group. Value of 1.0 used by default (conservative)</span>
<span class="sd">          </span>
<span class="sd">        * `N`, _integer_ number of pedestrians in group. Default value </span>
<span class="sd">          corresponds to bridge class A; but actual value should generally be </span>
<span class="sd">          provided</span>
<span class="sd">          </span>
<span class="sd">        * `analysis_type`, _string_, either &#39;walkers&#39; or &#39;joggers&#39; required, </span>
<span class="sd">          to denote the case under consideration</span>
<span class="sd">        </span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Determine F0 from Table NA.8</span>
        <span class="k">if</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="mi">280</span>
        <span class="k">elif</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
            <span class="n">F0</span> <span class="o">=</span> <span class="mi">910</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span> <span class="o">+</span> 
                             <span class="s2">&quot;&#39;walkers&#39; or &#39;joggers&#39; expected&quot;</span><span class="p">)</span>
            
        <span class="c1"># Get k(fv) factor</span>
        <span class="n">k</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span>
                                        <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">,</span>
                                        <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
            
        <span class="c1"># Calculate amplitude of sinusoidal forcing function per NA.2.44.4(1)</span>
        <span class="n">F_amplitude</span> <span class="o">=</span> <span class="n">F0</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gamma</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
        
        <span class="c1"># Define sinusoidal function of unit amplitude</span>
        <span class="k">def</span> <span class="nf">sine_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fv</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
        
        <span class="c1"># Run init for parent &#39;LoadTrain&#39; class</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">loadX</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                         <span class="n">loadVals</span><span class="o">=</span><span class="n">F_amplitude</span><span class="p">,</span>
                         <span class="n">intensityFunc</span><span class="o">=</span><span class="n">sine_func</span><span class="p">,</span>
                         <span class="n">name</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">)</span>
        
        <span class="c1"># Save other attributes</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F0</span> <span class="o">=</span> <span class="n">F0</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reference amplitude of applied fluctuating force (N)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Number of pedestrians in the group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reduction factor, in the range [0,1.0], to allow for unsynchronised </span>
<span class="sd">        actions in a pedestrian group</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">fv</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Natural frequency (Hz) of the mode for which loading has been derived</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Factor to account for:</span>
<span class="sd">            </span>
<span class="sd">        * The effects of a more realistic pedestrian population</span>
<span class="sd">        * Harmonic responses</span>
<span class="sd">        * Relative weighting of pedestrian sensitivity to response</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">F_amplitude</span> <span class="o">=</span> <span class="n">F_amplitude</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Amplitude of sinusoidal moving load (N)</span>
<span class="sd">        calculated according to NA.2.44.4(1)</span>
<span class="sd">        &quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>


      <div class="class">
          <h3>Ancestors (in MRO)</h3>
          <ul class="class_list">
          <li><a href="#ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading">UKNA_BSEN1991_2_walkers_joggers_loading</a></li>
          <li>loading.LoadTrain</li>
          <li>loading.Loading</li>
          <li>builtins.object</li>
          </ul>
          <h3>Static methods</h3>
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.__init__">
    <p>def <span class="ident">__init__</span>(</p><p>self, fv, gamma=1.0, N=2, analysis_type=&#39;walkers&#39;, makePlot=True)</p>
    </div>
    

    
  
    <div class="desc"><p>Defines fluctuating point load to represent either walkers or joggers 
according to NA.2.44.4, UK NA to BS EN 1991-2</p>
<hr />
<p>Required:</p>
<ul>
<li><code>fv</code>, natural frequency (Hz) of the mode under consideration</li>
</ul>
<hr />
<p>Optional:</p>
<ul>
<li>
<p><code>gamma</code>, reduction factor to allow for unsynchronised actions in a 
  pedestrian group. Value of 1.0 used by default (conservative)</p>
</li>
<li>
<p><code>N</code>, <em>integer</em> number of pedestrians in group. Default value 
  corresponds to bridge class A; but actual value should generally be 
  provided</p>
</li>
<li>
<p><code>analysis_type</code>, <em>string</em>, either 'walkers' or 'joggers' required, 
  to denote the case under consideration</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.__init__', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.__init__" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span>
             <span class="n">fv</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span>
             <span class="n">gamma</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span>
             <span class="n">N</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">analysis_type</span><span class="p">:</span><span class="nb">str</span><span class="o">=</span><span class="s2">&quot;walkers&quot;</span><span class="p">,</span>
             <span class="n">makePlot</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Defines fluctuating point load to represent either walkers or joggers </span>
<span class="sd">    according to NA.2.44.4, UK NA to BS EN 1991-2</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Required:</span>
<span class="sd">    </span>
<span class="sd">    * `fv`, natural frequency (Hz) of the mode under consideration</span>
<span class="sd">    </span>
<span class="sd">    ***</span>
<span class="sd">    Optional:</span>
<span class="sd">    </span>
<span class="sd">    * `gamma`, reduction factor to allow for unsynchronised actions in a </span>
<span class="sd">      pedestrian group. Value of 1.0 used by default (conservative)</span>
<span class="sd">      </span>
<span class="sd">    * `N`, _integer_ number of pedestrians in group. Default value </span>
<span class="sd">      corresponds to bridge class A; but actual value should generally be </span>
<span class="sd">      provided</span>
<span class="sd">      </span>
<span class="sd">    * `analysis_type`, _string_, either &#39;walkers&#39; or &#39;joggers&#39; required, </span>
<span class="sd">      to denote the case under consideration</span>
<span class="sd">    </span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Determine F0 from Table NA.8</span>
    <span class="k">if</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;walkers&quot;</span><span class="p">:</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="mi">280</span>
    <span class="k">elif</span> <span class="n">analysis_type</span><span class="o">==</span><span class="s2">&quot;joggers&quot;</span><span class="p">:</span>
        <span class="n">F0</span> <span class="o">=</span> <span class="mi">910</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid &#39;analysis_type&#39;!&quot;</span> <span class="o">+</span> 
                         <span class="s2">&quot;&#39;walkers&#39; or &#39;joggers&#39; expected&quot;</span><span class="p">)</span>
        
    <span class="c1"># Get k(fv) factor</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">UKNA_BSEN1991_2_Figure_NA_8</span><span class="p">(</span><span class="n">fv</span><span class="o">=</span><span class="n">fv</span><span class="p">,</span>
                                    <span class="n">analysis_type</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">,</span>
                                    <span class="n">makePlot</span><span class="o">=</span><span class="n">makePlot</span><span class="p">)</span>
        
    <span class="c1"># Calculate amplitude of sinusoidal forcing function per NA.2.44.4(1)</span>
    <span class="n">F_amplitude</span> <span class="o">=</span> <span class="n">F0</span> <span class="o">*</span> <span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">gamma</span><span class="o">*</span><span class="p">(</span><span class="n">N</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span><span class="o">**</span><span class="mf">0.5</span>
    
    <span class="c1"># Define sinusoidal function of unit amplitude</span>
    <span class="k">def</span> <span class="nf">sine_func</span><span class="p">(</span><span class="n">t</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">numpy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">numpy</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">fv</span><span class="o">*</span><span class="n">t</span><span class="p">)</span>
    
    <span class="c1"># Run init for parent &#39;LoadTrain&#39; class</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">loadX</span><span class="o">=</span><span class="p">[</span><span class="mf">0.0</span><span class="p">],</span>
                     <span class="n">loadVals</span><span class="o">=</span><span class="n">F_amplitude</span><span class="p">,</span>
                     <span class="n">intensityFunc</span><span class="o">=</span><span class="n">sine_func</span><span class="p">,</span>
                     <span class="n">name</span><span class="o">=</span><span class="n">analysis_type</span><span class="p">)</span>
    
    <span class="c1"># Save other attributes</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">F0</span> <span class="o">=</span> <span class="n">F0</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reference amplitude of applied fluctuating force (N)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">N</span> <span class="o">=</span> <span class="n">N</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Number of pedestrians in the group</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">gamma</span> <span class="o">=</span> <span class="n">gamma</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Reduction factor, in the range [0,1.0], to allow for unsynchronised </span>
<span class="sd">    actions in a pedestrian group</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">fv</span> <span class="o">=</span> <span class="n">fv</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Natural frequency (Hz) of the mode for which loading has been derived</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">k</span> <span class="o">=</span> <span class="n">k</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Factor to account for:</span>
<span class="sd">        </span>
<span class="sd">    * The effects of a more realistic pedestrian population</span>
<span class="sd">    * Harmonic responses</span>
<span class="sd">    * Relative weighting of pedestrian sensitivity to response</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="bp">self</span><span class="o">.</span><span class="n">F_amplitude</span> <span class="o">=</span> <span class="n">F_amplitude</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Amplitude of sinusoidal moving load (N)</span>
<span class="sd">    calculated according to NA.2.44.4(1)</span>
<span class="sd">    &quot;&quot;&quot;</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.PrintDetails">
    <p>def <span class="ident">PrintDetails</span>(</p><p>self)</p>
    </div>
    

    
  
    <div class="desc"><p>Prints details of loading definition to std output</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.PrintDetails', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.PrintDetails" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">PrintDetails</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Prints details of loading definition to std output</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Run parent function</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">PrintDetails</span><span class="p">()</span>
    
    <span class="c1"># Assemble pandas dataframe</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load pattern length: </span><span class="se">\t</span><span class="s2"> {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadLength</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;X positions of loads:</span><span class="se">\t</span><span class="s2"> {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">loadX</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Load intensities:</span><span class="se">\t</span><span class="s2"> {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_loadVals</span><span class="p">))</span>
    <span class="k">print</span><span class="p">(</span><span class="s2">&quot;Intensity function:</span><span class="se">\t</span><span class="s2"> {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">intensityFunc</span><span class="p">))</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.evaluate_loads">
    <p>def <span class="ident">evaluate_loads</span>(</p><p>self, t)</p>
    </div>
    

    
  
    <div class="desc"><p>Returns intensity of point loads at time t</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.evaluate_loads', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.evaluate_loads" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">evaluate_loads</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">t</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Returns intensity of point loads at time t</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">intensityFunc</span><span class="p">(</span><span class="n">t</span><span class="p">)</span><span class="o">*</span><span class="bp">self</span><span class="o">.</span><span class="n">loadVals</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot">
    <p>def <span class="ident">plot</span>(</p><p>self, ax=None, **kwargs)</p>
    </div>
    

    
  
    <div class="desc"><p>Plots diagram to illustrate load definition</p>
<p>Refer docs for <strong>plot_init()</strong> and <strong>plot_update()</strong> for further 
details. All additional kwargs are passed to <strong>plot_update()</strong></p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plots diagram to illustrate load definition</span>
<span class="sd">    </span>
<span class="sd">    Refer docs for **plot_init()** and **plot_update()** for further </span>
<span class="sd">    details. All additional kwargs are passed to **plot_update()**</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Initialise then update plot</span>
    <span class="n">ax</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_init</span><span class="p">(</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_update</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
    
    <span class="c1"># Rescale plot (as update method will not do otherwise!)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">relim</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">autoscale</span><span class="p">()</span>
    
    <span class="c1"># Define labels etc</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="n">ax</span><span class="o">.</span><span class="n">get_ylim</span><span class="p">()[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Distance along load track (m)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Load intensity (N)&quot;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;&#39;</span><span class="si">%s</span><span class="s2">&#39;&quot;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot_init">
    <p>def <span class="ident">plot_init</span>(</p><p>self, ax=None)</p>
    </div>
    

    
  
    <div class="desc"><p>Method to initialise plot
(used when producing animations, for example)</p>
<p><code>ax</code> will be used for plot, if provided. 
Otherwise new figure will be created</p></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot_init', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot_init" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_init</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to initialise plot</span>
<span class="sd">    (used when producing animations, for example)</span>
<span class="sd">    </span>
<span class="sd">    `ax` will be used for plot, if provided. </span>
<span class="sd">    Otherwise new figure will be created</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
           
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_artists</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_artists</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="n">label</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_artists</span><span class="p">[</span><span class="s1">&#39;line_heads&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([],[],</span><span class="s1">&#39;bv&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">ax</span>
</pre></div>

  </div>
</div>

  </div>
  
            
  <div class="item">
    <div class="name def" id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot_update">
    <p>def <span class="ident">plot_update</span>(</p><p>self, t=0, lead_x=0, load_scale=1.0)</p>
    </div>
    

    
  
    <div class="desc"><p>Method to update plot for given time and lead axle position
(used when producing animations, for example)</p>
<ul>
<li>
<p><code>t</code>, time value (secs) to plot loads at</p>
</li>
<li>
<p><code>lead_x</code>, position of lead axle (m)</p>
</li>
<li>
<p><code>load_scale</code>, factor used to convert loads (N) to distance (m) 
  for plotting</p>
</li>
</ul></div>
  <div class="source_cont">
  <p class="source_link"><a href="javascript:void(0);" onclick="toggle('source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot_update', this);">Show source &equiv;</a></p>
  <div id="source-ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.plot_update" class="source">
    <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">plot_update</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">t</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">lead_x</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">load_scale</span><span class="o">=</span><span class="mf">1.0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method to update plot for given time and lead axle position</span>
<span class="sd">    (used when producing animations, for example)</span>
<span class="sd">    </span>
<span class="sd">    * `t`, time value (secs) to plot loads at</span>
<span class="sd">    </span>
<span class="sd">    * `lead_x`, position of lead axle (m)</span>
<span class="sd">    </span>
<span class="sd">    * `load_scale`, factor used to convert loads (N) to distance (m) </span>
<span class="sd">      for plotting</span>
<span class="sd">    &quot;&quot;&quot;</span>
    
    <span class="c1"># Get axle positions</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">lead_x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">loadX</span>
    
    <span class="c1"># Get load values at time t</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">evaluate_loads</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    
    <span class="n">z</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">nan</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">numpy</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    
    <span class="n">X</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">nan</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">numpy</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="o">-</span><span class="n">vals</span><span class="p">,</span><span class="n">z</span><span class="p">,</span><span class="n">nan</span><span class="p">))</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="n">Y</span> <span class="o">=</span> <span class="n">Y</span> <span class="o">*</span> <span class="n">load_scale</span>
    
    <span class="c1"># Update plot artists</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_artists</span><span class="p">[</span><span class="s1">&#39;lines&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">Y</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">plot_artists</span><span class="p">[</span><span class="s1">&#39;line_heads&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">set_data</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">z</span><span class="p">)</span>
                         
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">plot_artists</span>
</pre></div>

  </div>
</div>

  </div>
  
          <h3>Instance variables</h3>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.F0" class="name">var <span class="ident">F0</span></p>
            

            
  
    <div class="desc"><p>Reference amplitude of applied fluctuating force (N)</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.F_amplitude" class="name">var <span class="ident">F_amplitude</span></p>
            

            
  
    <div class="desc"><p>Amplitude of sinusoidal moving load (N)
calculated according to NA.2.44.4(1)</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.N" class="name">var <span class="ident">N</span></p>
            

            
  
    <div class="desc"><p>Number of pedestrians in the group</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.fv" class="name">var <span class="ident">fv</span></p>
            

            
  
    <div class="desc"><p>Natural frequency (Hz) of the mode for which loading has been derived</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.gamma" class="name">var <span class="ident">gamma</span></p>
            

            
  
    <div class="desc"><p>Reduction factor, in the range [0,1.0], to allow for unsynchronised 
actions in a pedestrian group</p></div>
  <div class="source_cont">
</div>

            </div>
            <div class="item">
            <p id="ped_dyn.UKNA_BSEN1991_2_walkers_joggers_loading.k" class="name">var <span class="ident">k</span></p>
            

            
  
    <div class="desc"><p>Factor to account for:</p>
<ul>
<li>The effects of a more realistic pedestrian population</li>
<li>Harmonic responses</li>
<li>Relative weighting of pedestrian sensitivity to response</li>
</ul></div>
  <div class="source_cont">
</div>

            </div>
      </div>
      </div>

  </section>

    </article>
  <div class="clear"> </div>
  <footer id="footer">
    <p>
      Documentation generated by
      <a href="https://github.com/BurntSushi/pdoc">pdoc 0.3.2</a>
    </p>

    <p>pdoc is in the public domain with the
      <a href="http://unlicense.org">UNLICENSE</a></p>

    <p>Design by <a href="http://nadh.in">Kailash Nadh</a></p>
  </footer>
</div>
</body>
</html>